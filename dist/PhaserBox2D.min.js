/**
 * @license
 * Phaser Box2D v1.1.0
 * Sunday, 6 April 2025 at 04:27
 * 
 * This library includes code that is ported from the original C version. The original C code is Copyright 2023 Erin Catto
 * and was released under the MIT license. The JavaScript port of the C code along with all additional code is
 * Copyright 2025 Phaser Studio Inc and is released under the MIT license.
 */

function so(t){let e=Ut(t);if(e<Ft)return{length:0,normal:new B(0,0)};let o=1/e;return{length:e,normal:new B(o*t.x,o*t.y)}}var Bo=3.14159265359,Ft=1e-10,bn=Ft*Ft,Fe={b2Vec2Count:0,b2Rot2Count:0,b2ManifoldCount:0,b2ManifoldPointCount:0,b2FrameCount:0,b2PolyCollideCount:0,b2ContactSimCount:0,b2TOIInputCount:0,b2ShapeCastPairInputCount:0,b2SweepCount:0},Ll={calls:{}},El={calls:{}},jl={calls:{}};var B=class t{constructor(e=0,o=0){this.x=e,this.y=o}copy(e){return this.x=e.x,this.y=e.y,this}clone(){return new t(this.x,this.y)}},rt=class t{constructor(e=1,o=0){this.c=e,this.s=o}copy(e){return this.c=e.c,this.s=e.s,this}clone(){return new t(this.c,this.s)}},at=class t{constructor(e=null,o=null){this.p=e,this.q=o}static identity(){return new t(new B,new rt)}clone(){return new t(this.p,this.q)}deepClone(){return new t(this.p.clone(),this.q.clone())}},ro=class t{constructor(e=new B,o=new B){this.cx=e,this.cy=o}clone(){return new t(this.cx.clone(),this.cy.clone())}},xt=class{constructor(e=0,o=0,n=0,s=0){this.lowerBoundX=e,this.lowerBoundY=o,this.upperBoundX=n,this.upperBoundY=s}};function yh(t,e){return t<e?t:e}function fh(t,e){return t>e?t:e}function xh(t){return t<0?-t:t}function mt(t,e,o){return t<e?e:t>o?o:t}function Ih(t,e){return t<e?t:e}function Sh(t,e){return t>e?t:e}function gh(t){return t<0?-t:t}function _h(t,e,o){return t<e?e:t>o?o:t}function F(t,e){return t.x*e.x+t.y*e.y}function z(t,e){return t.x*e.y-t.y*e.x}function hn(t,e){return new B(e*t.y,-e*t.x)}function Gt(t,e){return new B(-t*e.y,t*e.x)}function pe(t){return new B(-t.y,t.x)}function be(t){return new B(t.y,-t.x)}function O(t,e){return new B(t.x+e.x,t.y+e.y)}function J(t,e){return new B(t.x-e.x,t.y-e.y)}function Qt(t){return new B(-t.x,-t.y)}function Zt(t,e,o){return new B((1-o)*t.x+o*e.x,(1-o)*t.y+o*e.y)}function Bh(t,e){return new B(t.x*e.x,t.y*e.y)}function it(t,e){return new B(t*e.x,t*e.y)}function $(t,e,o){return new B(t.x+e*o.x,t.y+e*o.y)}function jr(t,e,o,n){n.x=t.x+e*o.x,n.y=t.y+e*o.y}function It(t,e,o){return new B(t.x-e*o.x,t.y-e*o.y)}function ga(t,e,o){let n=t.x-e.x,s=t.y-e.y;return n*o.x+s*o.y}function Xr(t){return new B(Math.abs(t.x),Math.abs(t.y))}function _a(t,e){return new B(Math.min(t.x,e.x),Math.min(t.y,e.y))}function Ba(t,e){return new B(Math.max(t.x,e.x),Math.max(t.y,e.y))}function Ah(t,e,o){return new B(mt(t.x,e.x,o.x),mt(t.y,e.y,o.y))}function Ut(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function Aa(t,e){return Math.sqrt(t*t+e*e)}function he(t){return t.x*t.x+t.y*t.y}function vs(t,e){let o=e.x-t.x,n=e.y-t.y;return Math.sqrt(o*o+n*n)}function me(t,e){let o=e.x-t.x,n=e.y-t.y;return o*o+n*n}function wa(t){return new rt(Math.cos(t),Math.sin(t))}function Fr(t){let e=Math.sqrt(t.s*t.s+t.c*t.c),o=e>0?1/e:0;return new rt(t.c*o,t.s*o)}function Xl(t,e){let o=Math.sqrt(e*e+t*t);return o>0?1/o:0}function Sa(t){let e=t.s*t.s+t.c*t.c;return 1-6e-4<e&&e<1+6e-4}function Ca(t,e,o){let n=1-o,s=new rt(n*t.c+o*e.c,n*t.s+o*e.s);return Fr(s)}function wh(t,e){let o=t.c-e*t.s,n=t.s+e*t.c,s=Math.sqrt(n*n+o*o),r=s>0?1/s:0;return new rt(o*r,n*r)}function Fl(t,e,o){let n=t.c-e*t.s,s=t.s+e*t.c,r=Math.sqrt(s*s+n*n),i=r>0?1/r:0;o.c=n*i,o.s=s*i}function Ch(t,e,o){return o*(e.s*t.c-e.c*t.s)}function vh(t){return Math.atan2(t.s,t.c)}function Jh(t){return new B(t.c,t.s)}function Mh(t){return new B(-t.s,t.c)}function ql(t,e){return new rt(t.c*e.c-t.s*e.s,t.s*e.c+t.c*e.s)}function Vl(t,e){return t.c*e.c-t.s*e.s}function Yl(t,e){return t.s*e.c+t.c*e.s}function Dh(t,e){return new rt(t.c*e.c+t.s*e.s,t.c*e.s-t.s*e.c)}function ae(t,e){let o=t.s*e.c-t.c*e.s,n=t.c*e.c+t.s*e.s;return Math.atan2(o,n)}function Fo(t){return t<-Bo?t+2*Bo:t>Bo?t-2*Bo:t}function K(t,e){return new B(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)}function ge(t,e){return new B(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)}function H(t,e){let o=t.q.c*e.x-t.q.s*e.y+t.p.x,n=t.q.s*e.x+t.q.c*e.y+t.p.y;return new B(o,n)}function de(t,e,o){let n=t.q.c*e.x-t.q.s*e.y+t.p.x,s=t.q.s*e.x+t.q.c*e.y+t.p.y;o.x=n,o.y=s}function Nl(t,e,o){o.p.x=t.q.c*e.x-t.q.s*e.y+t.p.x,o.p.y=t.q.s*e.x+t.q.c*e.y+t.p.y,o.q.c=t.q.c,o.q.s=t.q.s}function qe(t,e){let o=e.x-t.p.x,n=e.y-t.p.y;return new B(t.q.c*o+t.q.s*n,-t.q.s*o+t.q.c*n)}function kh(t,e){let o=new at;return o.q=ql(t.q,e.q),o.p=O(K(t.q,e.p),t.p),o}function va(t,e){let o=new at(new B,new rt);o.q.c=t.q.c*e.q.c+t.q.s*e.q.s,o.q.s=t.q.c*e.q.s-t.q.s*e.q.c;let n=e.p.x-t.p.x,s=e.p.y-t.p.y;return o.p.x=t.q.c*n+t.q.s*s,o.p.y=-t.q.s*n+t.q.c*s,o}function qo(t,e,o){let n=o;n.q.c=t.q.c*e.q.c+t.q.s*e.q.s,n.q.s=t.q.c*e.q.s-t.q.s*e.q.c;let s=e.p.x-t.p.x,r=e.p.y-t.p.y;n.p.x=t.q.c*s+t.q.s*r,n.p.y=-t.q.s*s+t.q.c*r}function Js(t,e){return new B(t.cx.x*e.x+t.cy.x*e.y,t.cx.y*e.x+t.cy.y*e.y)}function Ms(t){let e=t.cx.x,o=t.cy.x,n=t.cx.y,s=t.cy.y,r=e*s-o*n;return r!==0&&(r=1/r),new ro(new B(r*s,-r*n),new B(-r*o,r*e))}function mn(t,e){let o=t.cx.x,n=t.cy.x,s=t.cx.y,r=t.cy.y,i=o*r-n*s;return i!==0&&(i=1/i),new B(i*(r*e.x-n*e.y),i*(o*e.y-s*e.x))}function Vo(t,e){return t.lowerBoundX<=e.lowerBoundX&&t.lowerBoundY<=e.lowerBoundY&&e.upperBoundX<=t.upperBoundX&&e.upperBoundY<=t.upperBoundY}function Ve(t){return new B(.5*(t.lowerBoundX+t.upperBoundX),.5*(t.lowerBoundY+t.upperBoundY))}function Ds(t){return new B(.5*(t.upperBoundX-t.lowerBoundX),.5*(t.upperBoundY-t.lowerBoundY))}function Vt(t,e){let o=new xt;return o.lowerBoundX=Math.min(t.lowerBoundX,e.lowerBoundX),o.lowerBoundY=Math.min(t.lowerBoundY,e.lowerBoundY),o.upperBoundX=Math.max(t.upperBoundX,e.upperBoundX),o.upperBoundY=Math.max(t.upperBoundY,e.upperBoundY),o}function le(t){return isFinite(t)&&!isNaN(t)}function qr(t){return t&&le(t.x)&&le(t.y)}function Ph(t){return t&&le(t.s)&&le(t.c)&&Sa(t)}function Wl(t){if(!t)return!1;let e=t.upperBoundX-t.lowerBoundX,o=t.upperBoundY-t.lowerBoundY;return e>=0&&o>=0&&le(t.lowerBoundX)&&le(t.lowerBoundY)&&le(t.upperBoundX)&&le(t.upperBoundY)}function dt(t){let e=Ut(t);if(e>Ft){let o=1/e;return new B(t.x*o,t.y*o)}return new B(0,0)}function Th(t){let o=1/Ut(t);return new B(t.x*o,t.y*o)}var Vr=class{constructor(e=0,o=0,n=0){this.major=e,this.minor=o,this.revision=n}};var Ul=1,I=-1;function zl(t){Ul=t}function Kl(){return Ul}function Hl(t){}function $l(){return new Vr(3,1,0)}var Ye=1,Me=1e5*Ye,te=2,St=.005*Ye;var Ql=.25*Math.PI,Ht=4*St,yn=.1*Ye,Zl=.5;function Gh(){}function Rh(){}function Lh(){}function Eh(){}function jh(){}function Xh(t){}function Fh(t){}function qh(){}var Yo=class{constructor(e=0,o=0){this.index1=e,this.revision=o}},Ne=class{constructor(e=0,o=0,n=0){this.index1=e,this.world0=o,this.revision=n}},_t=class{constructor(e=0,o=0,n=0){this.index1=e,this.world0=o,this.revision=n}},zt=class{constructor(e=0,o=0,n=0){this.index1=e,this.world0=o,this.revision=n}},No=class{constructor(e=0,o=0,n=0){this.index1=e,this.world0=o,this.revision=n}};function Yh(t){return t.index1===0}function Nh(t){return t.index1!==0}function Wh(t,e){return t.index1===e.index1&&t.world0===e.world0&&t.revision===e.revision}var Ae=8;var In=4294967295,Wo=class{constructor(){this.origin=null,this.translation=null,this.maxFraction=0}},fn=class{constructor(){this.points=[],this.count=0,this.radius=0,this.translation=null,this.maxFraction=0}},xe=class{constructor(e=null,o=null){this.normal=e,this.point=o,this.fraction=0,this.iterations=0,this.hit=!1}},We=class{constructor(){this.mass=0,this.center=null,this.rotationalInertia=0}},oe=class{constructor(e=null,o=0){this.center=e,this.center||(this.center=new B(0,0)),this.radius=o}},_e=class{constructor(){this.center1=null,this.center2=null,this.radius=0}},Be=class{constructor(e){e>0?(this.vertices=new Array(e).fill().map(()=>new B(0,0)),this.normals=new Array(e).fill().map(()=>new B(0,0))):(this.vertices=[],this.normals=[]),this.centroid=null,this.radius=0,this.count=0}},io=class{constructor(e=null,o=null){this.point1=e,this.point2=o}},ao=class{constructor(){this.ghost1=null,this.segment=null,this.ghost2=null,this.chainId=0}},Un=class{constructor(){this.points=[],this.count=0}},ks=class{constructor(){this.closest1=null,this.closest2=null,this.fraction1=0,this.fraction2=0,this.distanceSquared=0}},Re=class t{constructor(e=[],o=null,n=0){this.points=e,this.count=o,this.radius=n}clone(){let e=[];for(let o=0,n=this.points.length;o<n;o++)e.push(this.points[o]);return new t(e,this.count,this.radius)}},Ie=class t{constructor(){this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}clone(){let e=new t;return e.count=this.count,e.indexA=[...this.indexA],e.indexB=[...this.indexB],e}},ye=class{constructor(){this.proxyA=new Re,this.proxyB=new Re,this.transformA=new at(new B(0,0),new rt(0,0)),this.transformB=new at(new B(0,0),new rt(0,0)),this.useRadii=!1}},Ps=class{constructor(){this.pointA=new B(0,0),this.pointB=new B(0,0),this.distance=0,this.iterations=0,this.simplexCount=0}},Ao=class t{constructor(){this.wA=null,this.wB=null,this.w=null,this.a=0,this.indexA=0,this.indexB=0}clone(){let e=new t;return e.wA=this.wA.clone(),e.wB=this.wB.clone(),e.w=this.w.clone(),e.a=this.a,e.indexA=this.indexA,e.indexB=this.indexB,e}},zn=class{constructor(){this.v1=new Ao,this.v2=new Ao,this.v3=new Ao,this.count=0}},wo=class{constructor(){this.proxyA=new Re,this.proxyB=new Re,this.transformA=new at(new B(0,0),new rt(0,0)),this.transformB=new at(new B(0,0),new rt(0,0)),this.translationB=new B(0,0),this.maxFraction=0}},Co=class t{constructor(e=null,o=null,n=null,s=null,r=null){this.localCenter=e,this.c1=o,this.c2=n,this.q1=s,this.q2=r}clone(){return new t(this.localCenter.clone(),this.c1.clone(),this.c2.clone(),this.q1.clone(),this.q2.clone())}},Ts=class t{constructor(e=null,o=null,n=null,s=null,r=0){this.proxyA=e,this.proxyB=o,this.sweepA=n,this.sweepB=s,this.tMax=r}clone(){return new t(this.proxyA.clone(),this.proxyB.clone(),this.sweepA.clone(),this.sweepB.clone(),this.tMax)}},Jo={b2_toiStateUnknown:0,b2_toiStateFailed:1,b2_toiStateOverlapped:2,b2_toiStateHit:3,b2_toiStateSeparated:4},Gs=class{constructor(){this.state=Jo.b2_toiStateUnknown,this.t=0}},vo=class t{constructor(){this.pointX=0,this.pointY=0,this.anchorAX=0,this.anchorAY=0,this.anchorBX=0,this.anchorBY=0,this.separation=0,this.normalImpulse=0,this.tangentImpulse=0,this.maxNormalImpulse=0,this.normalVelocity=0,this.id=0,this.persisted=!1}clone(){let e=new t;return e.pointX=this.pointX,e.pointY=this.pointY,e.anchorAX=this.anchorAX,e.anchorAY=this.anchorAY,e.anchorBX=this.anchorBX,e.anchorBY=this.anchorBY,e.separation=this.separation,e.normalImpulse=this.normalImpulse,e.tangentImpulse=this.tangentImpulse,e.maxNormalImpulse=this.maxNormalImpulse,e.normalVelocity=this.normalVelocity,e.id=this.id,e.persisted=this.persisted,e}clear(){return this.pointX=0,this.pointY=0,this.anchorAX=0,this.anchorAY=0,this.anchorBX=0,this.anchorBY=0,this.separation=0,this.normalImpulse=0,this.tangentImpulse=0,this.maxNormalImpulse=0,this.normalVelocity=0,this.id=0,this.persisted=!1,this}copyTo(e){e.pointX=this.pointX,e.pointY=this.pointY,e.anchorAX=this.anchorAX,e.anchorAY=this.anchorAY,e.anchorBX=this.anchorBX,e.anchorBY=this.anchorBY,e.separation=this.separation,e.normalImpulse=this.normalImpulse,e.tangentImpulse=this.tangentImpulse,e.maxNormalImpulse=this.maxNormalImpulse,e.normalVelocity=this.normalVelocity,e.id=this.id,e.persisted=this.persisted}},Oo=class t{constructor(e=new vo,o=new vo){this.points=[e,o],this.normalX=this.normalY=0,this.pointCount=0}clone(){let e=new t;return this.copyTo(e),e}clear(){return this.points[0]&&this.points[0].clear(),this.points[1]&&this.points[1].clear(),this.normalX=this.normalY=0,this.pointCount=0,this}copyTo(e){this.points[0].copyTo(e.points[0]),this.points[1].copyTo(e.points[1]),e.normalX=this.normalX,e.normalY=this.normalY,e.pointCount=this.pointCount}},xn=class{constructor(){this.aabb=null,this.categoryBits=0,this.parent_next=I,this.child1=I,this.child2=I,this.userData=0,this.height=-1,this.enlarged=!1}};function Yr(){return new Map}function Nr(t){t.clear()}function Ja(t){t.clear()}function Wr(t,e){return t.has(e)}function Rs(t,e){return t.has(e)?!0:(t.set(e,1),!1)}function Ls(t,e){return t.delete(e)}var Es=(t,e)=>t<e?BigInt(t)<<32n|BigInt(e):BigInt(e)<<32n|BigInt(t);var Kn=class{constructor(){this.data=null,this.entries=null}},Ma=class{constructor(){this.data=null,this.name=null,this.size=0}};function Da(t){let e=new Kn;return e.data=[],e.entries=[],e}function ka(t){t.data=null,t.entries=null}function Oe(t,e,o,n=null){let s=new Ma;s.size=e,s.name=o,s.data=[];for(let r=0;r<e;r++)n?s.data.push(n()):s.data.push(null);return t.entries.push(s),s.data}function Ue(t,e){let o=t.entries.length,n=t.entries[o-1];t.entries.pop()}function co(t,e=null){let o=[];if(e)for(let n=0;n<t;n++)o[n]=e();return o}function Sn(t,e,o=null){let n=t.length;if(o)for(let s=n;s<e;s++)t[s]=o();return t}var lo=!1;function Or(){let t=new js;return t.gravity=new B(0,-10),t.hitEventThreshold=1*Ye,t.restitutionThreshold=10*Ye,t.contactPushoutVelocity=5*Ye,t.contactHertz=30,t.contactDampingRatio=10,t.jointHertz=60,t.jointDampingRatio=5,t.maximumLinearVelocity=400*Ye,t.enableSleep=!0,t.enableContinuous=!0,t}function we(){let t=new Xs;return t.type=et.b2_staticBody,t.position=new B(0,0),t.rotation=new rt(1,0),t.linearVelocity=new B(0,0),t.angularVelocity=0,t.linearDamping=0,t.angularDamping=0,t.gravityScale=1,t.sleepThreshold=.05*Ye,t.userData=null,t.enableSleep=!0,t.isAwake=!0,t.fixedRotation=!1,t.isBullet=!1,t.isEnabled=!0,t.updateBodyMass=!0,t.allowFastRotation=!1,t}function Ur(){let t=new Mo;return t.categoryBits=1,t.maskBits=4294967295,t.groupIndex=0,t}function td(){let t=new Vs;return t.categoryBits=1,t.maskBits=4294967295,t}function ce(){let t=new Fs;return t.friction=.6,t.density=1,t.restitution=.1,t.filter=Ur(),t.enableSensorEvents=!0,t.enableContactEvents=!0,t}function ed(){let t=new qs;return t.friction=.6,t.filter=Ur(),t}var et={b2_staticBody:0,b2_kinematicBody:1,b2_dynamicBody:2,b2_bodyTypeCount:3},Y={b2_circleShape:0,b2_capsuleShape:1,b2_segmentShape:2,b2_polygonShape:3,b2_chainSegmentShape:4,b2_shapeTypeCount:5},T={b2_distanceJoint:0,b2_motorJoint:1,b2_mouseJoint:2,b2_prismaticJoint:3,b2_revoluteJoint:4,b2_weldJoint:5,b2_wheelJoint:6,b2_unknown:-1},Ys=class{constructor(){this.shapeId=null,this.point=new B(0,0),this.normal=new B(0,0),this.fraction=0,this.hit=!1}},js=class{constructor(){this.gravity=new B(0,0),this.restitutionThreshold=0,this.contactPushoutVelocity=0,this.hitEventThreshold=0,this.contactHertz=0,this.contactDampingRatio=0,this.jointHertz=0,this.jointDampingRatio=0,this.maximumLinearVelocity=0,this.enableSleep=!1,this.enableContinuous=!0,this.workerCount=0}},Xs=class{constructor(){this.type=et.b2_staticBody,this.position=new B(0,0),this.rotation=new rt(1,0),this.linearVelocity=new B(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.gravityScale=0,this.sleepThreshold=0,this.userData=null,this.enableSleep=!1,this.isAwake=!1,this.fixedRotation=!1,this.isBullet=!1,this.isEnabled=!1,this.updateBodyMass=!1,this.allowFastRotation=!1}},Fs=class{constructor(){this.userData=null,this.friction=0,this.restitution=0,this.density=0,this.filter=new Mo,this.customColor=V.b2_colorAqua,this.isSensor=!1,this.enableSensorEvents=!1,this.enableContactEvents=!1,this.enableHitEvents=!1,this.enablePreSolveEvents=!1,this.forceContactCreation=!1}},qs=class{constructor(){this.userData=null,this.points=null,this.count=0,this.friction=0,this.restitution=0,this.filter=new Mo,this.isLoop=!1}},gn=class{constructor(){this.bodyIdA=null,this.bodyIdB=null,this.localAnchorA=new B(0,0),this.localAnchorB=new B(0,0),this.length=0,this.enableSpring=!1,this.hertz=0,this.dampingRatio=0,this.enableLimit=!1,this.minLength=0,this.maxLength=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0,this.collideConnected=!1,this.userData=null}},_n=class{constructor(){this.bodyIdA=null,this.bodyIdB=null,this.linearOffset=new B(0,0),this.angularOffset=0,this.maxForce=0,this.maxTorque=0,this.correctionFactor=0,this.collideConnected=!1,this.userData=null}},Bn=class{constructor(){this.bodyIdA=null,this.bodyIdB=null,this.target=new B(0,0),this.hertz=0,this.dampingRatio=0,this.maxForce=0,this.collideConnected=!1,this.userData=null}},An=class{constructor(){this.bodyIdA=null,this.bodyIdB=null,this.localAnchorA=new B(0,0),this.localAnchorB=new B(0,0),this.localAxisA=new B(0,0),this.referenceAngle=0,this.enableSpring=!1,this.hertz=0,this.dampingRatio=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0,this.collideConnected=!1,this.userData=null}},Do=class{constructor(){this.bodyIdA=null,this.bodyIdB=null,this.localAnchorA=new B(0,0),this.localAnchorB=new B(0,0),this.referenceAngle=0,this.enableSpring=!1,this.hertz=0,this.dampingRatio=0,this.enableLimit=!1,this.lowerAngle=0,this.upperAngle=0,this.enableMotor=!1,this.maxMotorTorque=0,this.motorSpeed=0,this.drawSize=0,this.collideConnected=!1,this.userData=null}},wn=class{constructor(){this.bodyIdA=null,this.bodyIdB=null,this.localAnchorA=new B(0,0),this.localAnchorB=new B(0,0),this.referenceAngle=0,this.linearHertz=0,this.angularHertz=0,this.linearDampingRatio=0,this.angularDampingRatio=0,this.collideConnected=!1,this.userData=null}},Cn=class{constructor(){this.bodyIdA=null,this.bodyIdB=null,this.localAnchorA=new B(0,0),this.localAnchorB=new B(0,0),this.localAxisA=new B(0,0),this.enableSpring=!1,this.hertz=0,this.dampingRatio=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorTorque=0,this.motorSpeed=0,this.collideConnected=!1,this.userData=null}},Ns=class{constructor(){this.sensorShapeId=null,this.visitorShapeId=null}},vn=class{constructor(){this.sensorShapeId=null,this.visitorShapeId=null}},Hn=class{constructor(){this.beginEvents=null,this.endEvents=null,this.beginCount=0,this.endCount=0}},zr=class{constructor(){this.shapeIdA=null,this.shapeIdB=null,this.manifold=null}},Jn=class{constructor(e=null,o=null){this.shapeIdA=e,this.shapeIdB=o}},Kr=class{constructor(){this.shapeIdA=null,this.shapeIdB=null,this.pointX=0,this.pointY=0,this.normalX=0,this.normalY=0,this.approachSpeed=0}},$n=class{constructor(){this.beginEvents=null,this.endEvents=null,this.hitEvents=null,this.beginCount=0,this.endCount=0,this.hitCount=0}},Hr=class{constructor(){this.transform=null,this.bodyId=null,this.userData=null,this.fellAsleep=!1}},Qn=class{constructor(){this.moveEvents=null,this.moveCount=0}},Pa=class{constructor(){this.shapeIdA=null,this.shapeIdB=null,this.manifold=null}},V={b2_colorAliceBlue:15792383,b2_colorAntiqueWhite:16444375,b2_colorAqua:65535,b2_colorAquamarine:8388564,b2_colorAzure:15794175,b2_colorBeige:16119260,b2_colorBisque:16770244,b2_colorBlack:1,b2_colorBlanchedAlmond:16772045,b2_colorBlue:255,b2_colorBlueViolet:9055202,b2_colorBrown:10824234,b2_colorBurlywood:14596231,b2_colorCadetBlue:6266528,b2_colorChartreuse:8388352,b2_colorChocolate:13789470,b2_colorCoral:16744272,b2_colorCornflowerBlue:6591981,b2_colorCornsilk:16775388,b2_colorCrimson:14423100,b2_colorCyan:65535,b2_colorDarkBlue:139,b2_colorDarkCyan:35723,b2_colorDarkGoldenrod:12092939,b2_colorDarkGray:11119017,b2_colorDarkGreen:25600,b2_colorDarkKhaki:12433259,b2_colorDarkMagenta:9109643,b2_colorDarkOliveGreen:5597999,b2_colorDarkOrange:16747520,b2_colorDarkOrchid:10040012,b2_colorDarkRed:9109504,b2_colorDarkSalmon:15308410,b2_colorDarkSeaGreen:9419919,b2_colorDarkSlateBlue:4734347,b2_colorDarkSlateGray:3100495,b2_colorDarkTurquoise:52945,b2_colorDarkViolet:9699539,b2_colorDeepPink:16716947,b2_colorDeepSkyBlue:49151,b2_colorDimGray:6908265,b2_colorDodgerBlue:2003199,b2_colorFirebrick:11674146,b2_colorFloralWhite:16775920,b2_colorForestGreen:2263842,b2_colorFuchsia:16711935,b2_colorGainsboro:14474460,b2_colorGhostWhite:16316671,b2_colorGold:16766720,b2_colorGoldenrod:14329120,b2_colorGray:12500670,b2_colorGray1:1710618,b2_colorGray2:3355443,b2_colorGray3:5066061,b2_colorGray4:6710886,b2_colorGray5:8355711,b2_colorGray6:10066329,b2_colorGray7:11776947,b2_colorGray8:13421772,b2_colorGray9:15066597,b2_colorGreen:65280,b2_colorGreenYellow:11403055,b2_colorHoneydew:15794160,b2_colorHotPink:16738740,b2_colorIndianRed:13458524,b2_colorIndigo:4915330,b2_colorIvory:16777200,b2_colorKhaki:15787660,b2_colorLavender:15132410,b2_colorLavenderBlush:16773365,b2_colorLawnGreen:8190976,b2_colorLemonChiffon:16775885,b2_colorLightBlue:11393254,b2_colorLightCoral:15761536,b2_colorLightCyan:14745599,b2_colorLightGoldenrod:15654274,b2_colorLightGoldenrodYellow:16448210,b2_colorLightGray:13882323,b2_colorLightGreen:9498256,b2_colorLightPink:16758465,b2_colorLightSalmon:16752762,b2_colorLightSeaGreen:2142890,b2_colorLightSkyBlue:8900346,b2_colorLightSlateBlue:8679679,b2_colorLightSlateGray:7833753,b2_colorLightSteelBlue:11584734,b2_colorLightYellow:16777184,b2_colorLime:65280,b2_colorLimeGreen:3329330,b2_colorLinen:16445670,b2_colorMagenta:16711935,b2_colorMaroon:11546720,b2_colorMediumAquamarine:6737322,b2_colorMediumBlue:205,b2_colorMediumOrchid:12211667,b2_colorMediumPurple:9662683,b2_colorMediumSeaGreen:3978097,b2_colorMediumSlateBlue:8087790,b2_colorMediumSpringGreen:64154,b2_colorMediumTurquoise:4772300,b2_colorMediumVioletRed:13047173,b2_colorMidnightBlue:1644912,b2_colorMintCream:16121850,b2_colorMistyRose:16770273,b2_colorMoccasin:16770229,b2_colorNavajoWhite:16768685,b2_colorNavy:128,b2_colorNavyBlue:128,b2_colorOldLace:16643558,b2_colorOlive:8421376,b2_colorOliveDrab:7048739,b2_colorOrange:16753920,b2_colorOrangeRed:16729344,b2_colorOrchid:14315734,b2_colorPaleGoldenrod:15657130,b2_colorPaleGreen:10025880,b2_colorPaleTurquoise:11529966,b2_colorPaleVioletRed:14381203,b2_colorPapayaWhip:16773077,b2_colorPeachPuff:16767673,b2_colorPeru:13468991,b2_colorPink:16761035,b2_colorPlum:14524637,b2_colorPowderBlue:11591910,b2_colorPurple:10494192,b2_colorRebeccaPurple:6697881,b2_colorRed:16711680,b2_colorRosyBrown:12357519,b2_colorRoyalBlue:4286945,b2_colorSaddleBrown:9127187,b2_colorSalmon:16416882,b2_colorSandyBrown:16032864,b2_colorSeaGreen:3050327,b2_colorSeashell:16774638,b2_colorSienna:10506797,b2_colorSilver:12632256,b2_colorSkyBlue:8900331,b2_colorSlateBlue:6970061,b2_colorSlateGray:7372944,b2_colorSnow:16775930,b2_colorSpringGreen:65407,b2_colorSteelBlue:4620980,b2_colorTan:13808780,b2_colorTeal:32896,b2_colorThistle:14204888,b2_colorTomato:16737095,b2_colorTurquoise:4251856,b2_colorViolet:15631086,b2_colorVioletRed:13639824,b2_colorWheat:16113331,b2_colorWhite:16777215,b2_colorWhiteSmoke:16119285,b2_colorYellow:16776960,b2_colorYellowGreen:10145074,b2_colorBox2DRed:14430514,b2_colorBox2DBlue:3190463,b2_colorBox2DGreen:9226532,b2_colorBox2DYellow:16772748},Ws=class{constructor(){this.DrawPolygon=null,this.DrawImagePolygon=null,this.DrawSolidPolygon=null,this.DrawCircle=null,this.DrawImageCircle=null,this.DrawSolidCircle=null,this.DrawCapsule=null,this.DrawImageCapsule=null,this.DrawSolidCapsule=null,this.DrawSegment=null,this.DrawTransform=null,this.DrawPoint=null,this.DrawString=null,this.SetPosition=null,this.drawingBounds=new xt,this.useDrawingBounds=!1,this.positionOffset=new B,this.drawShapes=!0,this.drawJoints=!1,this.drawAABBs=!1,this.drawMass=!1,this.drawContacts=!1,this.drawGraphColors=!1,this.drawContactNormals=!1,this.drawContactImpulses=!1,this.drawFrictionImpulses=!1,this.context=null}},Mo=class{constructor(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}},Vs=class{constructor(){this.categoryBits=65535,this.maskBits=65535}};var $r=class{constructor(e){this.name=e,this.freeArray=[],this.nextIndex=0}};function Zn(t){return t.nextIndex}function ko(t="pool"){return new $r(t)}function Po(t){t.freeArray=null,t.nextIndex=0}function ne(t){if(t.freeArray.length>0)return t.freeArray.pop();let e=t.nextIndex;return t.nextIndex++,e}function fe(t,e){if(e===t.nextIndex-1){t.nextIndex--;return}t.freeArray.push(e)}function Uo(t){return t.nextIndex-t.freeArray.length}function De(t,e){let o=new at;o.p=O(it(1-e,t.c1),it(e,t.c2));let n=new rt((1-e)*t.q1.c+e*t.q2.c,(1-e)*t.q1.s+e*t.q2.s);return o.q=Fr(n),o.p=J(o.p,K(o.q,t.localCenter)),o}var ts=new ks;function Qr(t,e,o,n,s,r,i,c){let a=0,l=0,d=o-t,p=n-e,u=i-s,b=c-r,h=t-s,m=e-r,f=d*d+p*p,y=u*u+b*b,x=h*u+m*b,w=h*d+m*p;if(f<bn||y<bn)f>=bn?(a=mt(-w/f,0,1),l=0):y>=bn&&(a=0,l=mt(x/y,0,1));else{let k=d*u+p*b,P=f*y-k*k,G=0;P!==0&&(G=mt((k*x-w*y)/P,0,1));let E=(k*G+x)/y;E<0?(E=0,G=mt(-w/f,0,1)):E>1&&(E=1,G=mt((k-w)/f,0,1)),a=G,l=E}let g=t+a*d,S=e+a*p,A=s+l*u,_=r+l*b,C=g-A,D=S-_,v=C*C+D*D;return ts.closest1=ts.closest2=null,ts.fraction1=a,ts.fraction2=l,ts.distanceSquared=v,ts}function vt(t,e,o){e=Math.min(e,Ae);let n=new Re;n.points=[],n.count=e,n.radius=o;for(let s=0;s<e;++s)n.points[s]=t[s].clone();return n}function Os(t,e,o,n){return new B(t*e.x+o*n.x,t*e.y+o*n.y)}function od(t,e,o,n,s,r){return new B(t*e.x+o*n.x+s*r.x,t*e.y+o*n.y+s*r.y)}function uo(t,e){let o=0,n=F(t.points[0],e);for(let s=1;s<t.count;++s){let r=F(t.points[s],e);r>n&&(o=s,n=r)}return o}function Oh(t,e,o,n,s){let r=new zn;r.count=t.count;let i=[r.v1,r.v2,r.v3];for(let c=0;c<r.count;++c){let a=i[c];a.indexA=t.indexA[c],a.indexB=t.indexB[c];let l=e.points[a.indexA],d=n.points[a.indexB];a.wA=H(o,l),a.wB=H(s,d),a.w=J(a.wB,a.wA),a.a=-1}if(r.count===0){let c=i[0];c.indexA=0,c.indexB=0;let a=e.points[0],l=n.points[0];c.wA=H(o,a),c.wB=H(s,l),c.w=J(c.wB,c.wA),c.a=1,r.count=1}return r}function Uh(t,e){t.count=e.count;let o=[e.v1,e.v2,e.v3];for(let n=0;n<e.count;++n)t.indexA[n]=o[n].indexA,t.indexB[n]=o[n].indexB}function zh(t){switch(t.count){case 1:return Qt(t.v1.w);case 2:let e=J(t.v2.w,t.v1.w);return z(e,Qt(t.v1.w))>0?pe(e):be(e);default:return new B(0,0)}}function Kh(t){switch(t.count){case 0:return new B(0,0);case 1:return t.v1.w;case 2:return Os(t.v1.a,t.v1.w,t.v2.a,t.v2.w);case 3:return new B(0,0);default:return new B(0,0)}}function sd(t,e,o){switch(o.count){case 0:break;case 1:t.x=o.v1.wA.x,t.y=o.v1.wA.y,e.x=o.v1.wB.x,e.y=o.v1.wB.y;break;case 2:t.x=Os(o.v1.a,o.v1.wA,o.v2.a,o.v2.wA).x,t.y=Os(o.v1.a,o.v1.wA,o.v2.a,o.v2.wA).y,e.x=Os(o.v1.a,o.v1.wB,o.v2.a,o.v2.wB).x,e.y=Os(o.v1.a,o.v1.wB,o.v2.a,o.v2.wB).y;break;case 3:t.x=od(o.v1.a,o.v1.wA,o.v2.a,o.v2.wA,o.v3.a,o.v3.wA).x,t.y=od(o.v1.a,o.v1.wA,o.v2.a,o.v2.wA,o.v3.a,o.v3.wA).y,e.x=t.x,e.y=t.y;break;default:break}}function rd(t){let e=t.v1.w,o=t.v2.w,n=J(o,e),s=-F(e,n);if(s<=0){t.v1.a=1,t.count=1;return}let r=F(o,n);if(r<=0){t.v2.a=1,t.count=1,t.v1=t.v2;return}let i=1/(r+s);t.v1.a=r*i,t.v2.a=s*i,t.count=2}function id(t){let e=t.v1.w,o=t.v2.w,n=t.v3.w,s=J(o,e),r=F(e,s),c=F(o,s),a=-r,l=J(n,e),d=F(e,l),u=F(n,l),b=-d,h=J(n,o),m=F(o,h),y=F(n,h),x=-m,w=z(s,l),g=w*z(o,n),S=w*z(n,e),A=w*z(e,o);if(a<=0&&b<=0){t.v1.a=1,t.count=1;return}if(c>0&&a>0&&A<=0){let C=1/(c+a);t.v1.a=c*C,t.v2.a=a*C,t.count=2;return}if(u>0&&b>0&&S<=0){let C=1/(u+b);t.v1.a=u*C,t.v3.a=b*C,t.count=2,t.v2=t.v3.clone();return}if(c<=0&&x<=0){t.v2.a=1,t.count=1,t.v1=t.v2.clone();return}if(u<=0&&y<=0){t.v3.a=1,t.count=1,t.v1=t.v3.clone();return}if(y>0&&x>0&&g<=0){let C=1/(y+x);t.v2.a=y*C,t.v3.a=x*C,t.count=2,t.v1=t.v3.clone();return}let _=1/(g+S+A);t.v1.a=g*_,t.v2.a=S*_,t.v3.a=A*_,t.count=3}var es=new B;function Ce(t,e,o,n){let s=new Ps,r=e.proxyA,i=e.proxyB,c=e.transformA,a=e.transformB,l=Oh(t,r,c,i,a),d=0;o!==null&&d<n&&(o[d]=l,d+=1);let p=[l.v1,l.v2,l.v3],u=20,b=[0,0,0],h=[0,0,0],m=0;for(;m<u;){let f=l.count;for(let g=0;g<f;++g)b[g]=p[g].indexA,h[g]=p[g].indexB;switch(l.count){case 1:break;case 2:rd(l);break;case 3:id(l);break;default:break}if(l.count===3)break;o!==null&&d<n&&(o[d]=l,d+=1);let y=zh(l);if(F(y,y)<Ft*Ft)break;let x=p[l.count];x.indexA=uo(r,ge(c.q,Qt(y))),x.wA=H(c,r.points[x.indexA]),x.indexB=uo(i,ge(a.q,y)),x.wB=H(a,i.points[x.indexB]),x.w=J(x.wB,x.wA),++m;let w=!1;for(let g=0;g<f;++g)if(x.indexA===b[g]&&x.indexB===h[g]){w=!0;break}if(w)break;++l.count}if(o!==null&&d<n&&(o[d]=l,d+=1),sd(s.pointA,s.pointB,l),s.distance=vs(s.pointA,s.pointB),s.iterations=m,s.simplexCount=d,Uh(t,l),e.useRadii)if(s.distance<Ft)es.x=.5*(s.pointA.x+s.pointB.x),es.y=.5*(s.pointA.y+s.pointB.y),s.pointA.x=es.x,s.pointA.y=es.y,s.pointB.x=es.x,s.pointB.y=es.y,s.distance=0;else{let f=r.radius,y=i.radius;s.distance=Math.max(0,s.distance-f-y);let x=dt(J(s.pointB,s.pointA)),w=f*x.x,g=f*x.y,S=y*x.x,A=y*x.y;s.pointA.x+=w,s.pointA.y+=g,s.pointB.x-=S,s.pointB.y-=A}return s}var Hh=new B(0,0),$h=new B(0,1);function zo(t){let e=new xe($h,Hh);e.fraction=t.maxFraction;let o=t.proxyA,n=t.transformA,s=t.transformB,r=va(n,s),i=new Re;i.count=t.proxyB.count,i.radius=t.proxyB.radius,i.points=[];for(let v=0;v<i.count;++v)i.points[v]=H(r,t.proxyB.points[v]);let c=o.radius+i.radius,a=K(r.q,t.translationB),l=0,d=t.maxFraction,p=new zn;p.count=0,p.v1=new Ao,p.v2=new Ao,p.v3=new Ao;let u=[p.v1,p.v2,p.v3],b=uo(o,Qt(a)),h=o.points[b],m=uo(i,a),f=i.points[m],y=J(h,f),x=.005,w=Math.max(x,c-x),g=20,S=0;for(;S<g&&Ut(y)>w+.5*x;){e.iterations+=1,b=uo(o,Qt(y)),h=o.points[b],m=uo(i,y),f=i.points[m];let v=J(h,f);y=dt(y);let k=F(y,v),P=F(y,a);if(k-w>l*P){if(P<=0||(l=(k-w)/P,l>d))return e;p.count=0}let G=u[p.count];switch(G.indexA=m,G.wA=new B(f.x+l*a.x,f.y+l*a.y),G.indexB=b,G.wB=h.clone(),G.w=J(G.wB,G.wA),G.a=1,p.count+=1,p.count){case 1:break;case 2:rd(p);break;case 3:id(p);break;default:}if(p.count===3)return e;y=Kh(p),++S}if(S===0||l===0)return e;let A=new B,_=new B;sd(_,A,p);let C=dt(Qt(y)),D=new B(A.x+o.radius*C.x,A.y+o.radius*C.y);return e.point=H(n,D),e.normal=K(n.q,C),e.fraction=l,e.iterations=S,e.hit=!0,e}var To={b2_pointsType:0,b2_faceAType:1,b2_faceBType:2},Ta=class{constructor(){this.proxyA=null,this.proxyB=null,this.sweepA=null,this.sweepB=null,this.localPoint=new B,this.axis=new B,this.type=0}};function Qh(t,e,o,n,s,r){let i=new Ta;i.proxyA=e,i.proxyB=n;let c=t.count;i.sweepA=new Co,Object.assign(i.sweepA,o),i.sweepB=new Co,Object.assign(i.sweepB,s),i.localPoint=new B,i.axis=new B,i.type=0;let a=De(o,r),l=De(s,r);if(c===1){i.type=To.b2_pointsType;let y=e.points[t.indexA[0]],x=n.points[t.indexB[0]],w=H(a,y),g=H(l,x);return i.axis=dt(J(g,w)),i.localPoint=new B,i}if(t.indexA[0]===t.indexA[1]){i.type=To.b2_faceBType;let y=n.points[t.indexB[0]],x=n.points[t.indexB[1]];i.axis=hn(J(x,y),1),i.axis=dt(i.axis);let w=K(l.q,i.axis);i.localPoint=new B(.5*(y.x+x.x),.5*(y.y+x.y));let g=H(l,i.localPoint),S=e.points[t.indexA[0]],A=H(a,S);return F(J(A,g),w)<0&&(i.axis=Qt(i.axis)),i}i.type=To.b2_faceAType;let d=e.points[t.indexA[0]],p=e.points[t.indexA[1]];i.axis=hn(J(p,d),1),i.axis=dt(i.axis);let u=K(a.q,i.axis);i.localPoint=new B(.5*(d.x+p.x),.5*(d.y+p.y));let b=H(a,i.localPoint),h=n.points[t.indexB[0]],m=H(l,h);return F(J(m,b),u)<0&&(i.axis=Qt(i.axis)),i}var os=class{constructor(e,o,n){this.indexA=e,this.indexB=o,this.separation=n}};function Zh(t,e){let o=De(t.sweepA,e),n=De(t.sweepB,e);switch(t.type){case To.b2_pointsType:{let s=ge(o.q,t.axis),r=ge(n.q,Qt(t.axis)),i=uo(t.proxyA,s),c=uo(t.proxyB,r),a=t.proxyA.points[i],l=t.proxyB.points[c],d=H(o,a),p=H(n,l),u=F(J(p,d),t.axis);return new os(i,c,u)}case To.b2_faceAType:{let s=K(o.q,t.axis),r=H(o,t.localPoint),i=ge(n.q,Qt(s)),c=-1,a=uo(t.proxyB,i),l=t.proxyB.points[a],d=H(n,l),p=F(J(d,r),s);return new os(c,a,p)}case To.b2_faceBType:{let s=K(n.q,t.axis),r=H(n,t.localPoint),i=ge(o.q,Qt(s)),c=-1,a=uo(t.proxyA,i),l=t.proxyA.points[a],d=H(o,l),p=F(J(d,r),s);return new os(a,c,p)}default:return new os(-1,-1,0)}}function nd(t,e,o,n){let s=De(t.sweepA,n),r=De(t.sweepB,n);switch(t.type){case To.b2_pointsType:{let i=t.proxyA.points[e],c=t.proxyB.points[o],a=H(s,i),l=H(r,c);return F(J(l,a),t.axis)}case To.b2_faceAType:{let i=K(s.q,t.axis),c=H(s,t.localPoint),a=t.proxyB.points[o],l=H(r,a);return F(J(l,c),i)}case To.b2_faceBType:{let i=K(r.q,t.axis),c=H(r,t.localPoint),a=t.proxyA.points[e],l=H(s,a);return F(J(l,c),i)}default:return 0}}function Us(t){let e=new Gs;e.state=Jo.b2_toiStateUnknown,e.t=t.tMax;let o=t.proxyA,n=t.proxyB,s=t.sweepA,r=t.sweepB,i=t.tMax,c=o.radius+n.radius,a=Math.max(St,c-St),l=.25*St,d=0,p=20,u=0,b=new Ie,h=new ye;for(h.proxyA=t.proxyA,h.proxyB=t.proxyB,h.useRadii=!1;;){let m=De(s,d),f=De(r,d);h.transformA=m,h.transformB=f;let y=Ce(b,h,null,0);if(y.distance<=0){e.state=Jo.b2_toiStateOverlapped,e.t=0;break}if(y.distance<a+l){e.state=Jo.b2_toiStateHit,e.t=d;break}let x=Qh(b,o,s,n,r,d),w=!1,g=i,S=0;for(;;){let A=Zh(x,g),_=A.separation,C=A.indexA,D=A.indexB;if(_>a+l){e.state=Jo.b2_toiStateSeparated,e.t=i,w=!0;break}if(_>a-l){d=g;break}let v=nd(x,C,D,d);if(v<a-l){e.state=Jo.b2_toiStateFailed,e.t=d,w=!0;break}if(v<=a+l){e.state=Jo.b2_toiStateHit,e.t=d,w=!0;break}let k=0,P=d,G=g;for(;;){let E;k&1?E=P+(a-v)*(G-P)/(_-v):E=.5*(P+G),++k;let X=nd(x,C,D,E);if(Math.abs(X-a)<l){g=E;break}if(X>a?(P=E,v=X):(G=E,_=X),k==50)break}if(++S,S==Ae)break}if(++u,w)break;if(u==p){e.state=Jo.b2_toiStateFailed,e.t=d;break}}return e}function Zr(t,e,o,n){let s=new Un;if(n===0)return s;let r=dt(J(e,t)),i=[],c=0,a=0,l=z(J(o[a],t),r);l>0&&(i[c++]=o[a]);for(let b=1;b<n;++b){let h=z(J(o[b],t),r);h>l&&(a=b,l=h),h>0&&(i[c++]=o[b])}if(l<2*St)return s;let d=o[a],p=Zr(t,d,i,c),u=Zr(d,e,i,c);for(let b=0;b<p.count;++b)s.points[s.count++]=p.points[b];s.points[s.count++]=d;for(let b=0;b<u.count;++b)s.points[s.count++]=u.points[b];return s}function ad(t,e){let o=0;for(let n=0;n<e;n++){let s=(n+1)%e;o+=(t[s].x-t[n].x)*(t[s].y+t[n].y)}return o<0}function Mn(t,e){let o=new Un;if(e<3||e>Ae)return o;let n=new xt(Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),s=[],r=0,i=16*St*St;for(let A=0;A<e;++A){n.lowerBoundX=Math.min(n.lowerBoundX,t[A].x),n.lowerBoundY=Math.min(n.lowerBoundY,t[A].y),n.upperBoundX=Math.max(n.upperBoundX,t[A].x),n.upperBoundY=Math.max(n.upperBoundY,t[A].y);let _=t[A],C=!0;for(let D=0;D<A;++D){let v=t[D];if(me(_,v)<i){C=!1;break}}C&&(s[r++]=_)}if(r<3)return o;let c=Ve(n),a=0,l=me(c,s[a]);for(let A=1;A<r;++A){let _=me(c,s[A]);_>l&&(a=A,l=_)}let d=s[a];s[a]=s[r-1],r=r-1;let p=0,u=me(d,s[p]);for(let A=1;A<r;++A){let _=me(d,s[A]);_>u&&(p=A,u=_)}let b=s[p];s[p]=s[r-1],r=r-1;let h=[],m=0,f=[],y=0,x=dt(J(b,d));for(let A=0;A<r;++A){let _=z(J(s[A],d),x);_>=2*St?h[m++]=s[A]:_<=-2*St&&(f[y++]=s[A])}let w=Zr(d,b,h,m),g=Zr(b,d,f,y);if(w.count===0&&g.count===0)return o;o.points[o.count++]=d;for(let A=0;A<w.count;++A)o.points[o.count++]=w.points[A];o.points[o.count++]=b;for(let A=0;A<g.count;++A)o.points[o.count++]=g.points[A];let S=!0;for(;S&&o.count>2;){S=!1;for(let A=0;A<o.count;++A){let _=A,C=(A+1)%o.count,D=(A+2)%o.count,v=o.points[_],k=o.points[C],P=o.points[D],G=dt(J(P,v));if(z(J(k,v),G)<=2*St){for(let X=C;X<o.count-1;++X)o.points[X]=o.points[X+1];o.count-=1,S=!0;break}}}return o.count<3&&(o.count=0),o}function ti(t){if(!lo)return!0;if(t.count<3||Ae<t.count||!ad(t.points,t.count))return!1;for(let e=0;e<t.count;++e){let o=e,n=e<t.count-1?o+1:0,s=t.points[o],r=dt(J(t.points[n],s));for(let i=0;i<t.count;++i){if(i===o||i===n)continue;if(z(J(t.points[i],s),r)>=0)return!1}}for(let e=0;e<t.count;++e){let o=e,n=(e+1)%t.count,s=(e+2)%t.count,r=t.points[o],i=t.points[n],c=t.points[s],a=dt(J(c,r));if(z(J(i,r),a)<=St)return!1}return!0}function cd(t){return qr(t.origin)&&qr(t.translation)&&le(t.maxFraction)&&0<=t.maxFraction&&t.maxFraction<Me}function ld(t,e){let o=new B(0,0),n=0,s=t[0],r=1/3;for(let c=1;c<e-1;++c){let a=J(t[c],s),l=J(t[c+1],s),d=.5*z(a,l);o=$(o,d*r,O(a,l)),n+=d}let i=1/n;return o.x*=i,o.y*=i,o=O(s,o),o}function Dn(t,e,o=!0){if(o&&!ti(t))return null;if(t.count<3)return ei(.5);let n=new Be;n.count=t.count,n.radius=e;for(let s=0;s<n.count;++s)n.vertices[s]=t.points[s];for(let s=0;s<n.count;++s){let r=s,i=s+1<n.count?s+1:0,c=J(n.vertices[i],n.vertices[r]);n.normals[s]=dt(hn(c,1))}return n.centroid=ld(n.vertices,n.count),n}function Hs(t,e,o,n=!0){if(t.count<3)return ei(.5);let s=new Be;s.count=t.count,s.radius=e;for(let r=0;r<s.count;++r)s.vertices[r]=H(o,t.points[r]);for(let r=0;r<s.count;++r){let i=r,c=r+1<s.count?r+1:0,a=J(s.vertices[c],s.vertices[i]);s.normals[r]=dt(hn(a,1))}return s.centroid=ld(s.vertices,s.count),s}function ei(t){return Go(t,t)}function Go(t,e){let o=new Be;return o.count=4,o.vertices[0]=new B(-t,-e),o.vertices[1]=new B(t,-e),o.vertices[2]=new B(t,e),o.vertices[3]=new B(-t,e),o.normals[0]=new B(0,-1),o.normals[1]=new B(1,0),o.normals[2]=new B(0,1),o.normals[3]=new B(-1,0),o.radius=0,o.centroid=new B(0,0),o}function dd(t,e,o){let n=Go(t,e);return n.radius=o,n}function oi(t,e,o,n){let s=new at;s.p=o,s.q=n;let r=new Be;return r.count=4,r.vertices[0]=H(s,new B(-t,-e)),r.vertices[1]=H(s,new B(t,-e)),r.vertices[2]=H(s,new B(t,e)),r.vertices[3]=H(s,new B(-t,e)),r.normals[0]=K(s.q,new B(0,-1)),r.normals[1]=K(s.q,new B(1,0)),r.normals[2]=K(s.q,new B(0,1)),r.normals[3]=K(s.q,new B(-1,0)),r.radius=0,r.centroid=o,r}function ud(t,e){let o=e;for(let n=0;n<o.count;++n)o.vertices[n]=H(t,o.vertices[n]),o.normals[n]=K(t.q,o.normals[n]);return o.centroid=H(t,o.centroid),o}function $s(t,e){let o=t.radius*t.radius,n=new We;return n.mass=e*Math.PI*o,n.center=t.center.clone(),n.rotationalInertia=n.mass*(.5*o+F(t.center,t.center)),n}function Qs(t,e){let o=t.radius,n=o*o,s=t.center1,r=t.center2,i=Ut(J(r,s)),c=i*i,a=e*Math.PI*n,l=e*(2*o*i),d=new We;d.mass=a+l,d.center=new B(.5*(s.x+r.x),.5*(s.y+r.y));let p=4*o/(3*Math.PI),u=.5*i,b=a*(.5*n+u*u+2*u*p),h=l*(4*n+c)/12;return d.rotationalInertia=b+h,d.rotationalInertia+=d.mass*F(d.center,d.center),d}function ni(t,e){if(t.count==1){let u=new oe;return u.center=t.vertices[0].clone(),u.radius=t.radius,$s(u,e)}if(t.count==2){let u=new _e;return u.center1=t.vertices[0].clone(),u.center2=t.vertices[1].clone(),u.radius=t.radius,Qs(u,e)}let o=new Array(Ae),n=t.count,s=t.radius;if(s>0)for(let b=0;b<n;++b){let h=b==0?n-1:b-1,m=t.normals[h],f=t.normals[b],y=dt(O(m,f));o[b]=$(t.vertices[b],1.412*s,y)}else for(let u=0;u<n;++u)o[u]=t.vertices[u];let r=new B(0,0),i=0,c=0,a=o[0],l=1/3;for(let u=1;u<n-1;++u){let b=J(o[u],a),h=J(o[u+1],a),m=z(b,h),f=.5*m;i+=f,r=$(r,f*l,O(b,h));let y=b.x,x=b.y,w=h.x,g=h.y,S=y*y+w*y+w*w,A=x*x+g*x+g*g;c+=.25*l*m*(S+A)}let d=new We;d.mass=e*i;let p=1/i;return r.x*=p,r.y*=p,d.center=O(a,r),d.rotationalInertia=e*c,d.rotationalInertia+=d.mass*(F(d.center,d.center)-F(r,r)),d}function ns(t,e){let o=e.q.c*t.center.x-e.q.s*t.center.y+e.p.x,n=e.q.s*t.center.x+e.q.c*t.center.y+e.p.y,s=t.radius;return new xt(o-s,n-s,o+s,n+s)}function ss(t,e){let o=H(e,t.center1),n=H(e,t.center2),s=Math.min(o.x,n.x)-t.radius,r=Math.min(o.y,n.y)-t.radius,i=Math.max(o.x,n.x)+t.radius,c=Math.max(o.y,n.y)+t.radius;return new xt(s,r,i,c)}function rs(t,e){let o=t.vertices[0],n=e.q.c*o.x-e.q.s*o.y+e.p.x,s=e.q.s*o.x+e.q.c*o.y+e.p.y,r=n,i=s;for(let l=1;l<t.count;++l){let d=t.vertices[l],p=e.q.c*d.x-e.q.s*d.y+e.p.x,u=e.q.s*d.x+e.q.c*d.y+e.p.y;n=Math.min(n,p),s=Math.min(s,u),r=Math.max(r,p),i=Math.max(i,u)}let c=t.radius;return n-=c,s-=c,r+=c,i+=c,new xt(n,s,r,i)}function Zs(t,e){let o=H(e,t.point1),n=H(e,t.point2),s=_a(o,n),r=Ba(o,n);return new xt(s.x,s.y,r.x,r.y)}function si(t,e){let o=e.center;return me(t,o)<=e.radius*e.radius}function ri(t,e){let o=e.radius*e.radius,n=e.center1,s=e.center2,r=J(s,n),i=F(r,r);if(i==0)return me(t,n)<=o;let c=F(J(t,n),r)/i;c=mt(c,0,1);let a=$(n,c,r);return me(t,a)<=o}function ii(t,e){let o=new ye;o.proxyA=vt(e.vertices,e.count,0),o.proxyB=vt([t],1,0),o.transformA=new at(new B(0,0),new rt(1,0)),o.transformB=new at(new B(0,0),new rt(1,0)),o.useRadii=!1;let n=new Ie;return Ce(n,o,null,0).distance<=e.radius}var zs=new B(0,0),Ks=new B(0,1);function po(t,e){let o=e.center.clone(),n=new xe(Ks,zs),s=J(t.origin,o),r=so(t.translation),i=r.length;if(i==0)return n;let c=r.normal,a=-F(s,c),l=$(s,a,c),d=F(l,l),p=e.radius,u=p*p;if(d>u)return n;let b=Math.sqrt(u-d),h=a-b;if(h<0||t.maxFraction*i<h)return n;let m=$(s,h,c);return n.fraction=h/i,n.normal=dt(m),n.point=$(o,e.radius,n.normal),n.hit=!0,n}function tr(t,e){let o=new xe(Ks,zs),n=e.center1,s=e.center2,r=J(s,n),i=so(r),c=i.length,a=i.normal;if(c<Ft){let P=new oe;return P.center=n,P.radius=e.radius,po(t,P)}let l=t.origin,d=t.translation,p=J(l,n),u=F(p,a),b=$(p,-u,a),h=e.radius;if(F(b,b)<h*h){if(u<0){let P=new oe;return P.center=n,P.radius=e.radius,po(t,P)}if(u>1){let P=new oe;return P.center=s,P.radius=e.radius,po(t,P)}return o}let m=new B(a.y,-a.x),f=so(d),y=f.length,x=f.normal,w=-a.x*x.y+x.x*a.y;if(-Ft<w&&w<Ft)return o;let g=It(p,h,m),S=$(p,h,m),A=1/w,_=(a.x*g.y-g.x*a.y)*A,C=(a.x*S.y-S.x*a.y)*A,D,v;if(_<C?(D=_,v=g):(D=C,v=S,m=Qt(m)),D<0||t.maxFraction*y<D)return o;let k=(-v.x*x.y+x.x*v.y)*A;if(k<0){let P=new oe;return P.center=n,P.radius=e.radius,po(t,P)}else if(c<k){let P=new oe;return P.center=s,P.radius=e.radius,po(t,P)}else return o.fraction=D/y,o.point=O(Zt(n,s,k/c),it(e.radius,m)),o.normal=m,o.hit=!0,o}function kn(t,e,o){if(o&&z(J(t.origin,e.point1),J(e.point2,e.point1))<0)return new xe(Ks,zs);let n=t.origin,s=t.translation,r=e.point1,i=e.point2,c=J(i,r),a=new xe(Ks,zs),l=so(c),d=l.length,p=l.normal;if(d==0)return a;let u=be(p),b=F(u,J(r,n)),h=F(u,s);if(h==0)return a;let m=b/h;if(m<0||t.maxFraction<m)return a;let f=$(n,m,s),y=F(J(f,r),p);return y<0||d<y||(b>0&&(u=Qt(u)),a.fraction=m,a.point=$(n,m,s),a.normal=u,a.hit=!0),a}function er(t,e){if(e.radius===0){let n=t.origin,s=t.translation,r=0,i=t.maxFraction,c=-1,a=new xe(Ks,zs);for(let l=0;l<e.count;++l){let d=F(e.normals[l],J(e.vertices[l],n)),p=F(e.normals[l],s);if(p===0){if(d<0)return a}else p<0&&d<r*p?(r=d/p,c=l):p>0&&d<i*p&&(i=d/p);if(i<r)return a}return c>=0&&(a.fraction=r,a.normal=e.normals[c],a.point=$(n,r,s),a.hit=!0),a}let o=new wo;return o.proxyA=vt(e.vertices,e.count,e.radius),o.proxyB=vt([t.origin],1,0),o.transformA=new at(new B(0,0),new rt(1,0)),o.transformB=new at(new B(0,0),new rt(1,0)),o.translationB=t.translation,o.maxFraction=t.maxFraction,zo(o)}function ai(t,e){let o=new wo;return o.proxyA=vt([e.center.clone()],1,e.radius),o.proxyB=vt(t.points,t.count,t.radius),o.transformA=new at(new B(0,0),new rt(1,0)),o.transformB=new at(new B(0,0),new rt(1,0)),o.translationB=t.translation,o.maxFraction=t.maxFraction,zo(o)}function ci(t,e){let o=new wo;return o.proxyA=vt([e.center1,e.center2],2,e.radius),o.proxyB=vt(t.points,t.count,t.radius),o.transformA=new at(new B(0,0),new rt(1,0)),o.transformB=new at(new B(0,0),new rt(1,0)),o.translationB=t.translation,o.maxFraction=t.maxFraction,zo(o)}function or(t,e){let o=new wo;return o.proxyA=vt([e.point1,e.point2],2,0),o.proxyB=vt(t.points,t.count,t.radius),o.transformA=new at(new B(0,0),new rt(1,0)),o.transformB=new at(new B(0,0),new rt(1,0)),o.translationB=t.translation,o.maxFraction=t.maxFraction,zo(o)}function li(t,e){let o=new wo;return o.proxyA=vt(e.vertices,e.count,e.radius),o.proxyB=vt(t.points,t.count,t.radius),o.transformA=new at(new B(0,0),new rt(1,0)),o.transformB=new at(new B(0,0),new rt(1,0)),o.translationB=t.translation,o.maxFraction=t.maxFraction,zo(o)}function Bt(t,e){let o=e.index1-1;return t.shapeArray[o]}function Ra(t,e){return ue(t,e.bodyId)}function pd(t,e){let o=e.index1-1;return t.chainArray[o]}function Ga(t,e,o){let n=Ht,s=yn,r=ho(t,e);r.lowerBoundX-=n,r.lowerBoundY-=n,r.upperBoundX+=n,r.upperBoundY+=n,t.aabb=r;let i=o==et.b2_staticBody?n:s,c=new xt(r.lowerBoundX-i,r.lowerBoundY-i,r.upperBoundX+i,r.upperBoundY+i);t.fatAABB=c}function nr(t,e,o,n,s,r){let i=ne(t.shapeIdPool);i==t.shapeArray.length&&t.shapeArray.push(new ui);let c=t.shapeArray[i];switch(r){case Y.b2_capsuleShape:c.capsule=s;break;case Y.b2_circleShape:c.circle=s;break;case Y.b2_polygonShape:c.polygon=s;break;case Y.b2_segmentShape:c.segment=s;break;case Y.b2_chainSegmentShape:c.chainSegment=s;break;default:break}if(c.id=i,c.bodyId=e.id,c.type=r,c.density=n.density,c.friction=n.friction,c.restitution=n.restitution,c.filter=n.filter,c.userData=n.userData,c.customColor=n.customColor,c.isSensor=n.isSensor,c.enlargedAABB=!1,c.enableSensorEvents=n.enableSensorEvents,c.enableContactEvents=n.enableContactEvents,c.enableHitEvents=n.enableHitEvents,c.enablePreSolveEvents=n.enablePreSolveEvents,c.isFast=!1,c.proxyKey=I,c.localCentroid=as(c),c.aabb=new xt,c.fatAABB=new xt,c.revision+=1,e.setIndex!=M.b2_disabledSet){let a=e.type;Tn(c,t.broadPhase,a,o,n.forceContactCreation||n.isSensor)}if(e.headShapeId!=I){let a=t.shapeArray[e.headShapeId];a.prevShapeId=i}return c.prevShapeId=I,c.nextShapeId=e.headShapeId,e.headShapeId=i,e.shapeCount+=1,Lt(t),c}function sr(t,e,o,n){let s=yt(t.world0);if(s===null)return new _t(0,0,0);let r=Z(s,t),i=Rt(s,r),c=nr(s,r,i,e,o,n);return r.updateBodyMass===!0&&Ho(s,r),Lt(s),new _t(c.id+1,t.world0,c.revision)}function Pn(t,e,o){return sr(t,e,o,Y.b2_circleShape)}function is(t,e,o){if(me(o.center1,o.center2)<=St*St){let s=new oe;return s.center=Zt(o.center1,o.center2,.5),s.radius=o.radius,sr(t,e,s,Y.b2_circleShape)}return sr(t,e,o,Y.b2_capsuleShape)}function bo(t,e,o){return sr(t,e,o,Y.b2_polygonShape)}function bd(t,e,o){return me(o.point1,o.point2)<=St*St?new _t:sr(t,e,o,Y.b2_segmentShape)}function hd(t,e,o,n){let s=e.id;e.prevShapeId!==I&&(t.shapeArray[e.prevShapeId].nextShapeId=e.nextShapeId),e.nextShapeId!==I&&(t.shapeArray[e.nextShapeId].prevShapeId=e.prevShapeId),s===o.headShapeId&&(o.headShapeId=e.nextShapeId),o.shapeCount-=1,Ko(e,t.broadPhase);let r=o.headContactKey;for(;r!==I;){let i=r>>1,c=r&1,a=t.contactArray[i];r=a.edges[c].nextKey,(a.shapeIdA===s||a.shapeIdB===s)&&mo(t,a,n)}fe(t.shapeIdPool,s),e.id=I,Lt(t)}function md(t){let e=yt(t.world0),o=t.index1-1,n=e.shapeArray[o],s=!0,r=gt(e,n.bodyId);hd(e,n,r,s),r.updateBodyMass===!0&&Ho(e,r)}function yd(t,e){let o=yt(t.world0);if(o===null)return new No;let n=Z(o,t),s=Rt(o,n),r=ne(o.chainIdPool);r===o.chainArray.length&&o.chainArray.push(new pi);let i=o.chainArray[r];i.id=r,i.bodyId=n.id,i.nextChainId=n.headChainId,i.revision+=1,n.headChainId=r;let c=ce();c.userData=e.userData,c.restitution=e.restitution,c.friction=e.friction,c.filter=e.filter,c.enableContactEvents=!1,c.enableHitEvents=!1,c.enableSensorEvents=!1;let a=e.count,l=e.points,d;if(e.isLoop){i.count=a,i.shapeIndices=new Array(a);let u=a-1;for(let h=0;h<a-2;++h){d=new ao,d.ghost1=l[u].clone(),d.segment=new io,d.segment.point1=l[h].clone(),d.segment.point2=l[h+1].clone(),d.ghost2=l[h+2].clone(),d.chainId=r,u=h;let m=nr(o,n,s,c,d,Y.b2_chainSegmentShape);i.shapeIndices[h]=m.id}d=new ao,d.ghost1=l[a-3].clone(),d.segment=new io,d.segment.point1=l[a-2].clone(),d.segment.point2=l[a-1].clone(),d.ghost2=l[0].clone(),d.chainId=r;let b=nr(o,n,s,c,d,Y.b2_chainSegmentShape);i.shapeIndices[a-2]=b.id,d=new ao,d.ghost1=l[a-2].clone(),d.segment=new io,d.segment.point1=l[a-1].clone(),d.segment.point2=l[0].clone(),d.ghost2=l[1].clone(),d.chainId=r,b=nr(o,n,s,c,d,Y.b2_chainSegmentShape),i.shapeIndices[a-1]=b.id}else{i.count=a-3,i.shapeIndices=new Array(a);for(let u=0;u<a-3;++u){d=new ao,d.ghost1=l[u].clone(),d.segment=new io,d.segment.point1=l[u+1].clone(),d.segment.point2=l[u+2].clone(),d.ghost2=l[u+3].clone(),d.chainId=r;let b=nr(o,n,s,c,d,Y.b2_chainSegmentShape);i.shapeIndices[u]=b.id}}return new No(r+1,o.worldId,i.revision)}function fd(t){let e=yt(t.world0),o=t.index1-1,n=e.chainArray[o],s=!0,r=gt(e,n.bodyId),i=r.headChainId,c=!1;for(;i!==null;){if(i===n.id){c=!0;break}i=e.chainArray[i].nextChainId}if(c===!1)return;let a=n.count;for(let l=0;l<a;++l){let d=n.shapeIndices[l],p=e.shapeArray[d];hd(e,p,r,s)}n.shapeIndices=null,fe(e.chainIdPool,o),n.id=null,Lt(e)}function ho(t,e){switch(t.type){case Y.b2_capsuleShape:return ss(t.capsule,e);case Y.b2_circleShape:return ns(t.circle,e);case Y.b2_polygonShape:return rs(t.polygon,e);case Y.b2_segmentShape:return Zs(t.segment,e);case Y.b2_chainSegmentShape:return Zs(t.chainSegment.segment,e);default:return new xt(e.p.x,e.p.y,e.p.x,e.p.y)}}function as(t){switch(t.type){case Y.b2_capsuleShape:return Zt(t.capsule.center1,t.capsule.center2,.5);case Y.b2_circleShape:return t.circle.center.clone();case Y.b2_polygonShape:return t.polygon.centroid.clone();case Y.b2_segmentShape:return Zt(t.segment.point1,t.segment.point2,.5);case Y.b2_chainSegmentShape:return Zt(t.chainSegment.segment.point1,t.chainSegment.segment.point2,.5);default:return new B(0,0)}}function La(t){switch(t.type){case Y.b2_capsuleShape:return 2*Ut(J(t.capsule.center1,t.capsule.center2))+2*Math.PI*t.capsule.radius;case Y.b2_circleShape:return 2*Math.PI*t.circle.radius;case Y.b2_polygonShape:{let e=t.polygon.vertices,o=t.polygon.count,n=2*Math.PI*t.polygon.radius,s=e[o-1];for(let r=0;r<o;++r){let i=e[r];n+=Ut(J(i,s)),s=i}return n}case Y.b2_segmentShape:return 2*Ut(J(t.segment.point1,t.segment.point2));case Y.b2_chainSegmentShape:return 2*Ut(J(t.chainSegment.segment.point1,t.chainSegment.segment.point2));default:return 0}}function Ea(t){switch(t.type){case Y.b2_capsuleShape:return Qs(t.capsule,t.density);case Y.b2_circleShape:return $s(t.circle,t.density);case Y.b2_polygonShape:return ni(t.polygon,t.density);default:return new We}}function di(t,e){let o=new bi;switch(t.type){case Y.b2_capsuleShape:{let n=t.capsule.radius;o.minExtent=n;let s=J(t.capsule.center1,e),r=J(t.capsule.center2,e);o.maxExtent=Math.sqrt(Math.max(he(s),he(r)))+n}break;case Y.b2_circleShape:{let n=t.circle.radius;o.minExtent=n,o.maxExtent=Ut(J(t.circle.center,e))+n}break;case Y.b2_polygonShape:{let n=t.polygon,s=Number.MAX_VALUE,r=0,i=n.count;for(let c=0;c<i;++c){let a=n.vertices[c],l=F(n.normals[c],J(a,n.centroid));s=Math.min(s,l);let d=he(J(a,e));r=Math.max(r,d)}o.minExtent=s+n.radius,o.maxExtent=Math.sqrt(r)+n.radius}break;case Y.b2_segmentShape:{o.minExtent=0;let n=J(t.segment.point1,e),s=J(t.segment.point2,e);o.maxExtent=Math.sqrt(Math.max(he(n),he(s)))}break;case Y.b2_chainSegmentShape:{o.minExtent=0;let n=J(t.chainSegment.segment.point1,e),s=J(t.chainSegment.segment.point2,e);o.maxExtent=Math.sqrt(Math.max(he(n),he(s)))}break;default:break}return o}var tm=new B(0,0),em=new B(0,1);function ja(t,e,o){let n=t;n.origin=qe(o,t.origin),n.translation=ge(o.q,t.translation);let s=new xe;switch(s.hit=!1,s.fraction=0,s.normal=new B(0,0),s.point=new B(0,0),e.type){case Y.b2_capsuleShape:s=tr(n,e.capsule);break;case Y.b2_circleShape:s=po(n,e.circle);break;case Y.b2_polygonShape:s=er(n,e.polygon);break;case Y.b2_segmentShape:s=kn(n,e.segment,!1);break;case Y.b2_chainSegmentShape:s=kn(n,e.chainSegment.segment,!0);break;default:return s}return s.point=H(o,s.point),s.normal=K(o.q,s.normal),s}function Xa(t,e,o){let n=t;for(let r=0;r<n.count;++r)n.points[r]=qe(o,t.points[r]);n.translation=ge(o.q,t.translation);let s=new xe;switch(s.hit=!1,s.fraction=0,s.normal=new B(0,0),s.point=new B(0,0),e.type){case Y.b2_capsuleShape:s=ci(n,e.capsule);break;case Y.b2_circleShape:s=ai(n,e.circle);break;case Y.b2_polygonShape:s=li(n,e.polygon);break;case Y.b2_segmentShape:s=or(n,e.segment);break;case Y.b2_chainSegmentShape:s=or(n,e.chainSegment.segment);break;default:return s}return s.point=H(o,s.point),s.normal=K(o.q,s.normal),s}function Tn(t,e,o,n,s){Ga(t,n,o),t.proxyKey=hi(e,o,t.fatAABB,t.filter.categoryBits,t.id,s)}function Ko(t,e){t.proxyKey!=I&&(mi(e,t.proxyKey),t.proxyKey=I)}function ze(t){switch(t.type){case Y.b2_capsuleShape:return vt([t.capsule.center1.clone(),t.capsule.center2.clone()],2,t.capsule.radius);case Y.b2_circleShape:return vt([t.circle.center.clone()],1,t.circle.radius);case Y.b2_polygonShape:return vt(t.polygon.vertices,t.polygon.count,t.polygon.radius);case Y.b2_segmentShape:return vt([t.segment.point1,t.segment.point2],2,0);case Y.b2_chainSegmentShape:return vt([t.chainSegment.segment.point1.clone(),t.chainSegment.segment.point2.clone()],2,0);default:return new Re}}function xd(t){let e=U(t.world0),o=Bt(e,t);return cs(e,o.bodyId)}function Id(t,e){let o=U(t.world0),n=Bt(o,t);n.userData=e}function Sd(t){let e=U(t.world0);return Bt(e,t).userData}function gd(t){let e=U(t.world0);return Bt(e,t).isSensor}function _d(t,e){let o=U(t.world0),n=Bt(o,t),s=Ra(o,n),r=qe(s,e);switch(n.type){case Y.b2_capsuleShape:return ri(r,n.capsule);case Y.b2_circleShape:return si(r,n.circle);case Y.b2_polygonShape:return ii(r,n.polygon);default:return!1}}function Bd(t,e,o){let n=U(t.world0),s=Bt(n,t),r=Ra(n,s),i=new Wo;i.maxFraction=1,i.origin=qe(r,e),i.translation=ge(r.q,o);let c=new xe(em,tm);switch(s.type){case Y.b2_capsuleShape:c=tr(i,s.capsule);break;case Y.b2_circleShape:c=po(i,s.circle);break;case Y.b2_segmentShape:c=kn(i,s.segment,!1);break;case Y.b2_polygonShape:c=er(i,s.polygon);break;case Y.b2_chainSegmentShape:c=kn(i,s.chainSegment.segment,!0);break;default:return c}return c.hit&&(c.normal=K(r.q,c.normal),c.point=H(r,c.point)),c}function Ad(t,e){let o=yt(t.world0);if(o==null)return;let n=Bt(o,t);e!=n.density&&(n.density=e)}function wd(t){let e=U(t.world0);return Bt(e,t).density}function Cd(t,e){let o=U(t.world0);if(o.locked)return;let n=Bt(o,t);n.friction=e}function vd(t){let e=U(t.world0);return Bt(e,t).friction}function Jd(t,e){let o=U(t.world0);if(o.locked)return;let n=Bt(o,t);n.restitution=e}function Md(t){let e=U(t.world0);return Bt(e,t).restitution}function Dd(t){let e=U(t.world0);return Bt(e,t).filter}function rr(t,e,o,n){let s=gt(t,e.bodyId),r=e.id,i=s.headContactKey;for(;i!==I;){let a=i>>1,l=i&1,d=t.contactArray[a];i=d.edges[l].nextKey,(d.shapeIdA===r||d.shapeIdB===r)&&mo(t,d,o)}let c=Rt(t,s);if(e.proxyKey!==I){let a=Ro(e.proxyKey);if(Ga(e,c,a),n){mi(t.broadPhase,e.proxyKey);let l=!0;e.proxyKey=hi(t.broadPhase,a,e.fatAABB,e.filter.categoryBits,r,l)}else ir(t.broadPhase,e.proxyKey,e.fatAABB)}else{let a=s.type;Ga(e,c,a)}Lt(t)}function kd(t,e){let o=yt(t.world0);if(o===null)return;let n=Bt(o,t);if(e.maskBits===n.filter.maskBits&&e.categoryBits===n.filter.categoryBits&&e.groupIndex===n.filter.groupIndex)return;let s=e.categoryBits===n.filter.categoryBits;n.filter=e,rr(o,n,!0,s)}function Pd(t,e){let o=yt(t.world0);if(o===null)return;let n=Bt(o,t);n.enableSensorEvents=e}function Td(t){let e=U(t.world0);return Bt(e,t).enableSensorEvents}function Gd(t,e){let o=yt(t.world0);if(o===null)return;let n=Bt(o,t);n.enableContactEvents=e}function Rd(t){let e=U(t.world0);return Bt(e,t).enableContactEvents}function Ld(t,e){let o=yt(t.world0);if(o===null)return;let n=Bt(o,t);n.enablePreSolveEvents=e}function Ed(t){let e=U(t.world0);return Bt(e,t).enablePreSolveEvents}function jd(t,e){let o=yt(t.world0);if(o===null)return;let n=Bt(o,t);n.enableHitEvents=e}function Xd(t){let e=U(t.world0);return Bt(e,t).enableHitEvents}function Fd(t){let e=U(t.world0);return Bt(e,t).type}function qd(t){let e=U(t.world0);return Bt(e,t).circle}function Vd(t){let e=U(t.world0);return Bt(e,t).segment}function Yd(t){let e=U(t.world0);return Bt(e,t).chainSegment}function Nd(t){let e=U(t.world0);return Bt(e,t).capsule}function Wd(t){let e=U(t.world0);return Bt(e,t).polygon}function Od(t,e){let o=yt(t.world0);if(o===null)return;let n=Bt(o,t);n.circle=e,n.type=Y.b2_circleShape,rr(o,n,!0,!0)}function Ud(t,e){let o=yt(t.world0);if(o===null)return;let n=Bt(o,t);n.capsule=e,n.type=Y.b2_capsuleShape,rr(o,n,!0,!0)}function zd(t,e){let o=yt(t.world0);if(o===null)return;let n=Bt(o,t);n.segment=e,n.type=Y.b2_segmentShape,rr(o,n,!0,!0)}function Kd(t,e){let o=yt(t.world0);if(o===null)return;let n=Bt(o,t);n.polygon=e,n.type=Y.b2_polygonShape,rr(o,n,!0,!0)}function Hd(t){let e=U(t.world0),o=Bt(e,t);if(o.type===Y.b2_chainSegmentShape){let n=o.chainSegment.chainId;if(n!==I){let s=e.chainArray[n];return new No(n+1,t.world0,s.revision)}}return new No}function $d(t,e){let o=yt(t.world0);if(o===null)return;let n=pd(o,t),s=n.count;for(let r=0;r<s;++r){let i=n.shapeIndices[r],c=o.shapeArray[i];c.friction=e}}function Qd(t,e){let o=yt(t.world0);if(o===null)return;let n=pd(o,t),s=n.count;for(let r=0;r<s;++r){let i=n.shapeIndices[r],c=o.shapeArray[i];c.restitution=e}}function Zd(t){let e=yt(t.world0);if(e===null)return 0;let o=Bt(e,t);return o.isSensor?0:gt(e,o.bodyId).contactCount}function tu(t,e,o){let n=yt(t.world0);if(n===null)return 0;let s=Bt(n,t);if(s.isSensor)return 0;let i=gt(n,s.bodyId).headContactKey,c=0;for(;i!==I&&c<o;){let a=i>>1,l=i&1,d=n.contactArray[a];if((d.shapeIdA===t.index1-1||d.shapeIdB===t.index1-1)&&d.flags&ht.b2_contactTouchingFlag){let p=n.shapeArray[d.shapeIdA],u=n.shapeArray[d.shapeIdB];e[c].shapeIdA=new _t(p.id+1,t.world0,p.revision),e[c].shapeIdB=new _t(u.id+1,t.world0,u.revision);let b=Gn(n,d);e[c].manifold=b.manifold,c+=1}i=d.edges[l].nextKey}return c}function eu(t){let e=U(t.world0);return e===null?new xt:Bt(e,t).aabb}function ou(t,e){let o=U(t.world0);if(o===null)return new B(0,0);let n=Bt(o,t),s=gt(o,n.bodyId),r=Rt(o,s),i=new ye;i.proxyA=ze(n),i.proxyB=vt([e],1,0),i.transformA=r,i.transformB=new at(new B(0,0),new rt(1,0)),i.useRadii=!0;let c=new Ie;return Ce(c,i,null,0).pointA}var ui=class{constructor(){this.id=0,this.bodyId=0,this.prevShapeId=0,this.nextShapeId=0,this.type=Y.e_unknown,this.density=0,this.friction=0,this.restitution=0,this.aabb=new xt,this.fatAABB=new xt,this.localCentroid=new B,this.proxyKey=0,this.filter=new Mo,this.userData=null,this.customColor=0,this.capsule=new _e,this.circle=new oe,this.polygon=new Be,this.segment=new io,this.chainSegment=new ao,this.revision=0,this.isSensor=!1,this.enableSensorEvents=!1,this.enableContactEvents=!1,this.enableHitEvents=!1,this.enablePreSolveEvents=!1,this.enlargedAABB=!1,this.isFast=!1,this.imageNoDebug=!1,this.image=null,this.imageScale=null,this.imageOffset=null,this.imageRect=null}},pi=class{constructor(){this.id=0,this.bodyId=0,this.nextChainId=0,this.shapeIndices=[],this.count=0,this.revision=0}},bi=class{constructor(){this.minExtent=0,this.maxExtent=0}};var yi=8;function Ke(t){let e=new ke,o=Math.floor((t+yi*8-1)/(yi*8));return e.blockCapacity=o,e.blockCount=0,e.bits=new BigUint64Array(e.blockCapacity),e.bits.fill(0n),e}function He(t){t.blockCapacity=0,t.blockCount=0,t.bits=null}function $e(t,e){let o=Math.floor((e+yi*8-1)/(yi*8));if(t.blockCapacity<o){He(t);let n=e+(e>>1);t=Ke(n)}return t.blockCount=o,t.bits.fill(0n),t}function ls(t,e){let o=t.blockCount;for(let n=0;n<o;++n)t.bits[n]|=e.bits[n]}var ke=class{constructor(){this.bits=null,this.blockCapacity=0,this.blockCount=0}};function Qe(t,e){let o=Math.floor(e/64);t.bits[o]|=BigInt(1)<<BigInt(e%64)}function yo(t,e){let o=Math.floor(e/64);o>=t.blockCount||(t.bits[o]&=~(BigInt(1)<<BigInt(e%64)))}function nu(t,e){let o=Math.floor(e/64);return o>=t.blockCount?!1:(t.bits[o]&BigInt(1)<<BigInt(e%64))!==BigInt(0)}var Mt=te-1,fi=class{constructor(){this.bodySet=new ke,this.contacts=new $o,this.joints=new Qo,this.overflowConstraints=null}},ds=class{constructor(){this.colors=[];for(let e=0;e<te;e++)this.colors.push(new fi)}};function Fa(t,e){t=new ds,e=Math.max(e,8);for(let o=0;o<Mt;o++){let n=t.colors[o];n.bodySet=Ke(e),n.bodySet=$e(n.bodySet,e)}return t}function qa(t){for(let e=0;e<te;e++){let o=t.colors[e];He(o.bodySet),o.bodySet=null,o.contacts=null,o.joints=null}}function ar(t,e,o){if(e.manifold.pointCount<=0)throw new Error("Assert failed: contactSim.manifold.pointCount > 0");if(!(e.simFlags&Yt.b2_simTouchingFlag))throw new Error("Assert failed: contactSim.simFlags & b2_simTouchingFlag");if(!(o.flags&ht.b2_contactTouchingFlag))throw new Error("Assert failed: contact.flags & b2_contactTouchingFlag");let n=t.constraintGraph,s=Mt,r=o.edges[0].bodyId,i=o.edges[1].bodyId;se(t.bodyArray,r),se(t.bodyArray,i);let c=t.bodyArray[r],a=t.bodyArray[i],l=c.setIndex==M.b2_staticSet,d=a.setIndex==M.b2_staticSet;if(l&&d)throw new Error("Assert failed: staticA == false || staticB == false");let p=n.colors[s];o.colorIndex=s,o.localIndex=p.contacts.count;let u=Le(p.contacts);if(u.set(e),l)u.bodySimIndexA=I,u.invMassA=0,u.invIA=0;else{if(c.setIndex!==M.b2_awakeSet)throw new Error("Assert failed: bodyA.setIndex == b2SetType.b2_awakeSet");let b=t.solverSetArray[M.b2_awakeSet],h=c.localIndex;if(!(0<=h&&h<b.sims.count))throw new Error("Assert failed: 0 <= localIndex && localIndex < awakeSet.sims.count");u.bodySimIndexA=h;let m=b.sims.data[h];u.invMassA=m.invMass,u.invIA=m.invInertia}if(d)u.bodySimIndexB=I,u.invMassB=0,u.invIB=0;else{if(a.setIndex!==M.b2_awakeSet)throw new Error("Assert failed: bodyB.setIndex == b2SetType.b2_awakeSet");let b=t.solverSetArray[M.b2_awakeSet],h=a.localIndex;if(!(0<=h&&h<b.sims.count))throw new Error("Assert failed: 0 <= localIndex && localIndex < awakeSet.sims.count");u.bodySimIndexB=h;let m=b.sims.data[h];u.invMassB=m.invMass,u.invIB=m.invInertia}}function cr(t,e,o,n,s){let r=t.constraintGraph;if(n!==Mt)throw new Error("Assert failed: colorIndex == b2_overflowIndex");let i=r.colors[n];n!=Mt&&(yo(i.bodySet,e),yo(i.bodySet,o));let c=to(i.contacts,s);if(c!==I){let l=i.contacts.data[s].contactId,d=t.contactArray[l];if(d.setIndex!==M.b2_awakeSet)throw new Error("Assert failed: movedContact.setIndex == b2SetType.b2_awakeSet");if(d.colorIndex!==n)throw new Error("Assert failed: movedContact.colorIndex == colorIndex");if(d.localIndex!==c)throw new Error("Assert failed: movedContact.localIndex == movedIndex");d.localIndex=s}}function sm(t,e,o,n,s){return Mt}function xi(t,e){let o=t.constraintGraph,n=e.edges[0].bodyId,s=e.edges[1].bodyId,r=t.bodyArray[n],i=t.bodyArray[s],c=r.setIndex===M.b2_staticSet,a=i.setIndex===M.b2_staticSet;if(c&&a)throw new Error("Assert failed: staticA == false || staticB == false");let l=sm(o,n,s,c,a),d=Ze(o.colors[l].joints);return e.colorIndex=l,e.localIndex=o.colors[l].joints.count-1,d}function Ii(t,e,o){let n=xi(t,o);Object.assign(n,e)}function lr(t,e,o,n,s){let i=t.constraintGraph.colors[n];n!=Mt&&(yo(i.bodySet,e),yo(i.bodySet,o));let c=Zo(i.joints,s);if(c!==I){let l=i.joints.data[s].jointId;if(l!=t.jointArray[l].jointId)throw new Error("Assert failed: movedId != jointId");let d=t.jointArray[l];if(d.setIndex!==M.b2_awakeSet)throw new Error("Assert failed: movedJoint.setIndex == b2SetType.b2_awakeSet");if(d.colorIndex!==n)throw new Error("Assert failed: movedJoint.colorIndex == colorIndex");if(d.localIndex!==c)throw new Error("Assert failed: movedJoint.localIndex == movedIndex");d.localIndex=s}}var dr=class{constructor(){this.indexA=0,this.indexB=0,this.normalX=0,this.normalY=0,this.friction=0,this.restitution=0,this.pointCount=0,this.softness=new re,this.invMassA=0,this.invIA=0,this.invMassB=0,this.invIB=0,this.points=[]}},Si=class{constructor(){this.normalImpulse=0,this.tangentImpulse=0,this.maxNormalImpulse=0,this.anchorAX=0,this.anchorAY=0,this.anchorBX=0,this.anchorBY=0,this.baseSeparation=0,this.normalMass=0,this.tangentMass=0,this.relativeVelocity=0}};function Va(t){let e=t.world,n=t.graph.colors[Mt],s=n.overflowConstraints,r=n.contacts.count,i=n.contacts.data,c=t.states,a=t.contactSoftness,l=t.staticSoftness,d=e.enableWarmStarting?1:0;for(let p=0;p<r;++p){let u=i[p],b=u.manifold,h=b.pointCount,m=u.bodySimIndexA,f=u.bodySimIndexB,y=s[p];y.indexA=m,y.indexB=f,y.normalX=b.normalX,y.normalY=b.normalY,y.friction=u.friction,y.restitution=u.restitution,y.pointCount=h;let x=0,w=0,g=0,S=u.invMassA,A=u.invIA;if(m!==I){let L=c[m];x=L.linearVelocity.x,w=L.linearVelocity.y,g=L.angularVelocity}let _=0,C=0,D=0,v=u.invMassB,k=u.invIB;if(f!==I){let L=c[f];_=L.linearVelocity.x,C=L.linearVelocity.y,D=L.angularVelocity}y.softness=m===I||f===I?l:a,y.invMassA=S,y.invIA=A,y.invMassB=v,y.invIB=k;let P=y.normalX,G=y.normalY,E=y.normalY,X=-y.normalX;for(let L=0;L<h;++L){let W=b.points[L],tt=y.points[L]=new Si;tt.normalImpulse=d*W.normalImpulse,tt.tangentImpulse=d*W.tangentImpulse,tt.maxNormalImpulse=0;let st=W.anchorAX,ot=W.anchorAY,j=W.anchorBX,nt=W.anchorBY;tt.anchorAX=st,tt.anchorAY=ot,tt.anchorBX=j,tt.anchorBY=nt;let wt=j-st,N=nt-ot;tt.baseSeparation=W.separation-(wt*P+N*G);let Q=st*G-ot*P,Ct=j*G-nt*P,ct=S+v+A*Q*Q+k*Ct*Ct;tt.normalMass=ct>0?1/ct:0;let At=st*X-ot*E,Tt=j*X-nt*E,lt=S+v+A*At*At+k*Tt*Tt;tt.tangentMass=lt>0?1/lt:0;let Et=x+-g*ot,Xt=w+g*st,Jt=_+-D*nt,Te=C+D*j;tt.relativeVelocity=P*(Jt-Et)+G*(Te-Xt)}}}function Ya(t){let o=t.graph.colors[Mt],n=o.overflowConstraints,s=o.contacts.count,i=t.world.solverSetArray[M.b2_awakeSet].states.data,c=new kt;for(let a=0;a<s;++a){let l=n[a],d=l.indexA,p=l.indexB,u=d===I?c:i[d],b=p===I?c:i[p],h=u.linearVelocity,m=u.angularVelocity,f=b.linearVelocity,y=b.angularVelocity,x=l.invMassA,w=l.invIA,g=l.invMassB,S=l.invIB,A=l.normalX,_=l.normalY,C=l.normalY,D=-l.normalX,v=l.pointCount;for(let k=0;k<v;++k){let P=l.points[k],G=P.anchorAX,E=P.anchorAY,X=P.anchorBX,L=P.anchorBY,W=P.normalImpulse*A+P.tangentImpulse*C,tt=P.normalImpulse*_+P.tangentImpulse*D;m-=w*(G*tt-E*W),h.x-=x*W,h.y-=x*tt,y+=S*(X*tt-L*W),f.x+=g*W,f.y+=g*tt}u.linearVelocity=h,u.angularVelocity=m,b.linearVelocity=f,b.angularVelocity=y}}function gi(t,e){let n=t.graph.colors[Mt],s=n.overflowConstraints,r=n.contacts.count,c=t.world.solverSetArray[M.b2_awakeSet].states,a=t.inv_h,l=t.world.contactPushoutVelocity,d=new kt;for(let p=0;p<r;++p){let u=s[p],b=u.invMassA,h=u.invIA,m=u.invMassB,f=u.invIB,y=u.indexA===I?d:c.data[u.indexA],x=y.linearVelocity.x,w=y.linearVelocity.y,g=y.angularVelocity,S=y.deltaRotation,A=u.indexB===I?d:c.data[u.indexB],_=A.linearVelocity.x,C=A.linearVelocity.y,D=A.angularVelocity,v=A.deltaRotation,k=A.deltaPosition.x-y.deltaPosition.x,P=A.deltaPosition.y-y.deltaPosition.y,G=u.normalX,E=u.normalY,X=E,L=-G,W=u.friction,tt=u.softness,st=u.pointCount;for(let ot=0;ot<st;++ot){let j=u.points[ot],nt=v.c*j.anchorBX-v.s*j.anchorBY-(S.c*j.anchorAX-S.s*j.anchorAY),wt=v.s*j.anchorBX+v.c*j.anchorBY-(S.s*j.anchorAX+S.c*j.anchorAY),N=(k+nt)*G+(P+wt)*E+j.baseSeparation,Q=0,Ct=1,ct=0;N>0?Q=N*a:e&&(Q=Math.max(tt.biasRate*N,-l),Ct=tt.massScale,ct=tt.impulseScale);let At=j.anchorAX,Tt=j.anchorAY,lt=j.anchorBX,Et=j.anchorBY,Xt=(_-x+D*-Et-g*-Tt)*G+(C-w+D*lt-g*At)*E,Jt=-j.normalMass*Ct*(Xt+Q)-ct*j.normalImpulse,Te=Math.max(j.normalImpulse+Jt,0);Jt=Te-j.normalImpulse,j.normalImpulse=Te,j.maxNormalImpulse=Math.max(j.maxNormalImpulse,Jt);let Ge=Jt*G,bt=Jt*E;x-=b*Ge,w-=b*bt,g-=h*(At*bt-Tt*Ge),_+=m*Ge,C+=m*bt,D+=f*(lt*bt-Et*Ge)}for(let ot=0;ot<st;++ot){let j=u.points[ot],nt=j.anchorAX,wt=j.anchorAY,N=j.anchorBX,Q=j.anchorBY,Ct=_-D*Q-(x-g*wt),ct=C+D*N-(w+g*nt),At=Ct*X+ct*L,Tt=j.tangentMass*-At,lt=W*j.normalImpulse,Et=j.tangentImpulse;j.tangentImpulse=Et+Tt,j.tangentImpulse=j.tangentImpulse<-lt?-lt:j.tangentImpulse>lt?lt:j.tangentImpulse,Tt=j.tangentImpulse-Et;let Xt=Tt*X,Jt=Tt*L;x-=b*Xt,w-=b*Jt,g-=h*(nt*Jt-wt*Xt),_+=m*Xt,C+=m*Jt,D+=f*(N*Jt-Q*Xt)}y.linearVelocity.x=x,y.linearVelocity.y=w,y.angularVelocity=g,A.linearVelocity.x=_,A.linearVelocity.y=C,A.angularVelocity=D}}function Na(t){let o=t.graph.colors[Mt],n=o.overflowConstraints,s=o.contacts.count,i=t.world.solverSetArray[M.b2_awakeSet].states,c=t.world.restitutionThreshold,a=new kt;for(let l=0;l<s;++l){let d=n[l],p=d.restitution;if(p===0)continue;let u=d.invMassA,b=d.invIA,h=d.invMassB,m=d.invIB,f=d.indexA===I?a:i.data[d.indexA],y=f.linearVelocity,x=f.angularVelocity,w=d.indexB===I?a:i.data[d.indexB],g=w.linearVelocity,S=w.angularVelocity,A=d.normalX,_=d.normalY,C=d.pointCount;for(let D=0;D<C;++D){let v=d.points[D];if(v.relativeVelocity>-c||v.maxNormalImpulse===0)continue;let k=v.anchorAX,P=v.anchorAY,G=v.anchorBX,E=v.anchorBY,X=g.x+-S*E,L=g.y+S*G,W=y.x+-x*P,tt=y.y+x*k,st=X-W,ot=L-tt,j=st*A+ot*_,nt=-v.normalMass*(j+p*v.relativeVelocity),wt=Math.max(v.normalImpulse+nt,0);nt=wt-v.normalImpulse,v.normalImpulse=wt,v.maxNormalImpulse=Math.max(v.maxNormalImpulse,nt);let N=nt*A,Q=nt*_;y.x-=u*N,y.y-=u*Q,x-=b*(k*Q-P*N),g.x+=h*N,g.y+=h*Q,S+=m*(G*Q-E*N)}f.angularVelocity=x,w.angularVelocity=S}}function Wa(t){let o=t.graph.colors[Mt],n=o.overflowConstraints,s=o.contacts,r=o.contacts.count;for(let i=0;i<r;++i){let c=n[i],l=s.data[i].manifold,d=l.pointCount;for(let p=0;p<d;++p)l.points[p].normalImpulse=c.points[p].normalImpulse,l.points[p].tangentImpulse=c.points[p].tangentImpulse,l.points[p].maxNormalImpulse=c.points[p].maxNormalImpulse,l.points[p].normalVelocity=c.points[p].relativeVelocity}}function Nt(t){let e=t.upperBoundX-t.lowerBoundX,o=t.upperBoundY-t.lowerBoundY;return 2*(e+o)}function Oa(t,e){let o=!1;return e.lowerBoundX<t.lowerBoundX&&(t.lowerBoundX=e.lowerBoundX,o=!0),e.lowerBoundY<t.lowerBoundY&&(t.lowerBoundY=e.lowerBoundY,o=!0),t.upperBoundX<e.upperBoundX&&(t.upperBoundX=e.upperBoundX,o=!0),t.upperBoundY<e.upperBoundY&&(t.upperBoundY=e.upperBoundY,o=!0),o}function tn(t,e){return!(t.lowerBoundX>=e.upperBoundX||t.upperBoundX<=e.lowerBoundX||t.lowerBoundY>=e.upperBoundY||t.upperBoundY<=e.lowerBoundY)}var am=1024;function ru(t){return t.height===0}function Bi(){let t=new Ln;t.root=I,t.nodeCapacity=16,t.nodeCount=0,t.nodes=Array.from({length:t.nodeCapacity},()=>new xn);for(let e=0;e<t.nodeCapacity-1;++e)t.nodes[e].parent_next=e+1,t.nodes[e].height=-1;return t.nodes[t.nodeCapacity-1].parent_next=I,t.nodes[t.nodeCapacity-1].height=-1,t.freeList=0,t.proxyCount=0,t.leafIndices=null,t.leafCenters=null,t.rebuildCapacity=0,t}function Ai(t){t.nodes=null,t.leafIndices=null,t.leafCenters=null}function ur(t){if(t.freeList===I){let n=t.nodes;t.nodeCapacity+=t.nodeCapacity>>1,t.nodes=Array.from({length:t.nodeCapacity},()=>new xn),t.nodes=Array.from({length:t.nodeCapacity},(s,r)=>r<n.length?n[r]:new xn);for(let s=t.nodeCount;s<t.nodeCapacity-1;++s)t.nodes[s].parent_next=s+1,t.nodes[s].height=-1;t.nodes[t.nodeCapacity-1].parent_next=I,t.nodes[t.nodeCapacity-1].height=-1,t.freeList=t.nodeCount}let e=t.freeList,o=t.nodes[e];return t.freeList=o.parent_next,t.nodes[e]=new xn,++t.nodeCount,e}function pr(t,e){t.nodes[e].parent_next=t.freeList,t.nodes[e].height=-1,t.freeList=e,--t.nodeCount}function cm(t,e){let o=Ve(e),n=Nt(e),s=t.nodes,r=t.root,i=s[r].aabb,c=Nt(i),a=Nt(Vt(i,e)),l=0,d=r,p=a,u=r;for(;s[u].height>0;){let b=s[u].child1,h=s[u].child2,m=a+l;m<p&&(d=u,p=m),l+=a-c;let f=s[b].height===0,y=s[h].height===0,x=Number.MAX_VALUE,w=s[b].aabb,g=Nt(Vt(w,e)),S=0;if(f){let v=g+l;v<p&&(d=b,p=v)}else S=Nt(w),x=l+g+Math.min(n-S,0);let A=Number.MAX_VALUE,_=s[h].aabb,C=Nt(Vt(_,e)),D=0;if(y){let v=C+l;v<p&&(d=h,p=v)}else D=Nt(_),A=l+C+Math.min(n-D,0);if(f&&y||p<=x&&p<=A)break;if(x===A&&!f){let v=J(Ve(w),o),k=J(Ve(_),o);x=he(v),A=he(k)}x<A&&!f?(u=b,c=S,a=g):(u=h,c=D,a=C)}return d}var fo={b2_rotateNone:0,b2_rotateBF:1,b2_rotateBG:2,b2_rotateCD:3,b2_rotateCE:4};function iu(t,e){let o=t.nodes,n=o[e];if(n.height<2)return;let s=n.child1,r=n.child2,i=o[s],c=o[r];if(i.height===0){let a=c.child1,l=c.child2,d=o[a],p=o[l],u=Nt(c.aabb),b=Vt(i.aabb,p.aabb),h=Nt(b),m=Vt(i.aabb,d.aabb),f=Nt(m);if(u<h&&u<f)return;h<f?(n.child1=a,c.child1=s,i.parent_next=r,d.parent_next=e,c.aabb=b,c.height=1+Math.max(i.height,p.height),n.height=1+Math.max(c.height,d.height),c.categoryBits=i.categoryBits|p.categoryBits,n.categoryBits=c.categoryBits|d.categoryBits,c.enlarged=i.enlarged||p.enlarged,n.enlarged=c.enlarged||d.enlarged):(n.child1=l,c.child2=s,i.parent_next=r,p.parent_next=e,c.aabb=m,c.height=1+Math.max(i.height,d.height),n.height=1+Math.max(c.height,p.height),c.categoryBits=i.categoryBits|d.categoryBits,n.categoryBits=c.categoryBits|p.categoryBits,c.enlarged=i.enlarged||d.enlarged,n.enlarged=c.enlarged||p.enlarged)}else if(c.height===0){let a=i.child1,l=i.child2,d=o[a],p=o[l],u=Nt(i.aabb),b=Vt(c.aabb,p.aabb),h=Nt(b),m=Vt(c.aabb,d.aabb),f=Nt(m);if(u<h&&u<f)return;h<f?(n.child2=a,i.child1=r,c.parent_next=s,d.parent_next=e,i.aabb=b,i.height=1+Math.max(c.height,p.height),n.height=1+Math.max(i.height,d.height),i.categoryBits=c.categoryBits|p.categoryBits,n.categoryBits=i.categoryBits|d.categoryBits,i.enlarged=c.enlarged||p.enlarged,n.enlarged=i.enlarged||d.enlarged):(n.child2=l,i.child2=r,c.parent_next=s,p.parent_next=e,i.aabb=m,i.height=1+Math.max(c.height,d.height),n.height=1+Math.max(i.height,p.height),i.categoryBits=c.categoryBits|d.categoryBits,n.categoryBits=i.categoryBits|p.categoryBits,i.enlarged=c.enlarged||d.enlarged,n.enlarged=i.enlarged||p.enlarged)}else{let a=i.child1,l=i.child2,d=c.child1,p=c.child2,u=o[a],b=o[l],h=o[d],m=o[p],f=Nt(i.aabb),y=Nt(c.aabb),x=f+y,w=fo.b2_rotateNone,g=x,S=Vt(i.aabb,m.aabb),A=f+Nt(S);A<g&&(w=fo.b2_rotateBF,g=A);let _=Vt(i.aabb,h.aabb),C=f+Nt(_);C<g&&(w=fo.b2_rotateBG,g=C);let D=Vt(c.aabb,b.aabb),v=y+Nt(D);v<g&&(w=fo.b2_rotateCD,g=v);let k=Vt(c.aabb,u.aabb);switch(y+Nt(k)<g&&(w=fo.b2_rotateCE),w){case fo.b2_rotateNone:break;case fo.b2_rotateBF:n.child1=d,c.child1=s,i.parent_next=r,h.parent_next=e,c.aabb=S,c.height=1+Math.max(i.height,m.height),n.height=1+Math.max(c.height,h.height),c.categoryBits=i.categoryBits|m.categoryBits,n.categoryBits=c.categoryBits|h.categoryBits,c.enlarged=i.enlarged||m.enlarged,n.enlarged=c.enlarged||h.enlarged;break;case fo.b2_rotateBG:n.child1=p,c.child2=s,i.parent_next=r,m.parent_next=e,c.aabb=_,c.height=1+Math.max(i.height,h.height),n.height=1+Math.max(c.height,m.height),c.categoryBits=i.categoryBits|h.categoryBits,n.categoryBits=c.categoryBits|m.categoryBits,c.enlarged=i.enlarged||h.enlarged,n.enlarged=c.enlarged||m.enlarged;break;case fo.b2_rotateCD:n.child2=a,i.child1=r,c.parent_next=s,u.parent_next=e,i.aabb=D,i.height=1+Math.max(c.height,b.height),n.height=1+Math.max(i.height,u.height),i.categoryBits=c.categoryBits|b.categoryBits,n.categoryBits=i.categoryBits|u.categoryBits,i.enlarged=c.enlarged||b.enlarged,n.enlarged=i.enlarged||u.enlarged;break;case fo.b2_rotateCE:n.child2=l,i.child2=r,c.parent_next=s,b.parent_next=e,i.aabb=k,i.height=1+Math.max(c.height,u.height),n.height=1+Math.max(i.height,b.height),i.categoryBits=c.categoryBits|u.categoryBits,n.categoryBits=i.categoryBits|b.categoryBits,i.enlarged=c.enlarged||u.enlarged,n.enlarged=i.enlarged||b.enlarged;break;default:break}}}function Ua(t,e,o){if(t.root===I){t.root=e,t.nodes[t.root].parent_next=I;return}let n=t.nodes[e].aabb,s=cm(t,n),r=t.nodes[s].parent_next,i=ur(t),c=t.nodes;c[i].parent_next=r,c[i].userData=-1,c[i].aabb=Vt(n,c[s].aabb),c[i].categoryBits=c[e].categoryBits|c[s].categoryBits,c[i].height=c[s].height+1,r!==I?(c[r].child1===s?c[r].child1=i:c[r].child2=i,c[i].child1=s,c[i].child2=e,c[s].parent_next=i,c[e].parent_next=i):(c[i].child1=s,c[i].child2=e,c[s].parent_next=i,c[e].parent_next=i,t.root=i);let a=c[e].parent_next;for(;a!==I;){let l=c[a].child1,d=c[a].child2;c[a].aabb=Vt(c[l].aabb,c[d].aabb),c[a].categoryBits=c[l].categoryBits|c[d].categoryBits,c[a].height=1+Math.max(c[l].height,c[d].height),c[a].enlarged=c[l].enlarged||c[d].enlarged,o&&iu(t,a),a=c[a].parent_next}}function za(t,e){if(e===t.root){t.root=I;return}let o=t.nodes,n=o[e].parent_next,s=o[n].parent_next,r;if(o[n].child1===e?r=o[n].child2:r=o[n].child1,s!==I){o[s].child1===n?o[s].child1=r:o[s].child2=r,o[r].parent_next=s,pr(t,n);let i=s;for(;i!==I;){let c=o[i],a=o[c.child1],l=o[c.child2];c.aabb=Vt(a.aabb,l.aabb),c.categoryBits=a.categoryBits|l.categoryBits,c.height=1+Math.max(a.height,l.height),i=c.parent_next}}else t.root=r,t.nodes[r].parent_next=I,pr(t,n)}function wi(t,e,o,n){let s=ur(t),r=t.nodes[s];return r.aabb=e,r.userData=n,r.categoryBits=o,r.height=0,Ua(t,s,!0),t.proxyCount+=1,s}function Ci(t,e){za(t,e),pr(t,e),t.proxyCount-=1}function au(t){return t.proxyCount}function vi(t,e,o){za(t,e),t.nodes[e].aabb=o,Ua(t,e,!1)}function Rn(t,e,o){let n=t.nodes;n[e].aabb=o;let s=n[e].parent_next;for(;s!==I;){let r=Oa(n[s].aabb,o);if(n[s].enlarged=!0,s=n[s].parent_next,!r)break}for(;s!==I&&n[s].enlarged!==!0;)n[s].enlarged=!0,s=n[s].parent_next}function cu(t){return t.root===I?0:t.nodes[t.root].height}function lu(t){if(t.root===I)return 0;let e=t.nodes[t.root],o=Nt(e.aabb),n=0;for(let s=0;s<t.nodeCapacity;++s){let r=t.nodes[s];r.height<0||ru(r)||s===t.root||(n+=Nt(r.aabb))}return n/o}function du(t){}function uu(t){let e=0;for(let o=0;o<t.nodeCapacity;++o){let n=t.nodes[o];if(n.height<=1)continue;let s=n.child1,r=n.child2,i=Math.abs(t.nodes[r].height-t.nodes[s].height);e=Math.max(e,i)}return e}function pu(t){let e=new Array(t.nodeCount),o=0;for(let n=0;n<t.nodeCapacity;++n)t.nodes[n].height<0||(ru(t.nodes[n])?(t.nodes[n].parent_next=I,e[o]=n,++o):pr(t,n));for(;o>1;){let n=Number.MAX_VALUE,s=-1,r=-1;for(let u=0;u<o;++u){let b=t.nodes[e[u]].aabb;for(let h=u+1;h<o;++h){let m=t.nodes[e[h]].aabb,f=Vt(b,m),y=Nt(f);y<n&&(s=u,r=h,n=y)}}let i=e[s],c=e[r],a=t.nodes[i],l=t.nodes[c],d=ur(t),p=t.nodes[d];p.child1=i,p.child2=c,p.aabb=Vt(a.aabb,l.aabb),p.categoryBits=a.categoryBits|l.categoryBits,p.height=1+Math.max(a.height,l.height),p.parent_next=I,a.parent_next=d,l.parent_next=d,e[r]=e[o-1],e[s]=d,--o}t.root=e[0]}function bu(t,e){for(let o=0;o<t.nodeCapacity;++o){let n=t.nodes[o];n.aabb.lowerBoundX-=e.x,n.aabb.lowerBoundY-=e.y,n.aabb.upperBoundX-=e.x,n.aabb.upperBoundY-=e.y}}function hu(t){return Object.keys(t).length*8+t.nodeCapacity*Object.keys(t.nodes[0]).length*8+t.rebuildCapacity*32}function Pe(t,e,o,n,s){if(t.root==I)return;let r=[];for(r.push(t.root);r.length>0;){let i=r.pop();if(i==I)continue;let c=t.nodes[i];if(c.categoryBits&o&&tn(c.aabb,e))if(c.height==0){if(n(i,c.userData,s)===!1)return}else r.push(c.child1),r.push(c.child2)}}var _i=Array(64);function Ji(t,e,o){if(t.root==I)return;let n=e.lowerBoundX,s=e.upperBoundX,r=e.lowerBoundY,i=e.upperBoundY,c=t.nodes,a=0;_i[a++]=t.root;let l,d,p;for(;a>0;)l=_i[--a],d=c[l],d.height==0?(p=d.aabb,p.lowerBoundX<s&&p.upperBoundX>n&&p.lowerBoundY<i&&p.upperBoundY>r&&Ka(l,d.userData,o)):(p=d.aabb,p.lowerBoundX<s&&p.upperBoundX>n&&p.lowerBoundY<i&&p.upperBoundY>r&&(_i[a++]=d.child1,_i[a++]=d.child2))}function br(t,e,o,n,s){let r=e.origin,i=e.translation,c=dt(i),a=Gt(1,c),l=Xr(a),d=e.maxFraction,p=$(r,d,i),u=new xt(Math.min(r.x,p.x),Math.min(r.y,p.y),Math.max(r.x,p.x),Math.max(r.y,p.y)),b=[];b.push(t.root);let h=e;for(;b.length>0;){let m=b.pop();if(m==I)continue;let f=t.nodes[m];if(tn(f.aabb,u)==!1||!(f.categoryBits&o))continue;let y=Ve(f.aabb),x=Ds(f.aabb),w=Math.abs(F(a,J(r,y)));if(!(F(l,x)<w))if(f.height==0){h.maxFraction=d;let S=n(h,m,f.userData,s);if(S==0)return;0<S&&S<=d&&(d=S,p=$(r,d,i),u.lowerBoundX=Math.min(r.x,p.x),u.lowerBoundY=Math.min(r.y,p.y),u.upperBoundX=Math.max(r.x,p.x),u.upperBoundY=Math.max(r.y,p.y))}else b.push(f.child1),b.push(f.child2)}}function us(t,e,o,n,s){if(e.count==0)return;let r=new xt(e.points[0],e.points[0]);for(let f=1;f<e.count;++f)r.lowerBoundX=Math.min(r.lowerBoundX,e.points[f].x),r.lowerBoundY=Math.min(r.lowerBoundY,e.points[f].y),r.upperBoundX=Math.max(r.upperBoundX,e.points[f].x),r.upperBoundY=Math.max(r.upperBoundY,e.points[f].y);r.lowerBoundX=r.lowerBoundX-e.radius,r.lowerBoundY=r.lowerBoundY-e.radius,r.upperBoundX=r.upperBoundX+e.radius,r.upperBoundY=r.upperBoundY+e.radius;let i=Ve(r),c=Ds(r),a=e.translation,l=Gt(1,a),d=Xr(l),p=e.maxFraction,u=it(p,e.translation),b=new xt(Math.min(r.lowerBoundX,r.lowerBoundX+u.x),Math.min(r.lowerBoundY,r.lowerBoundY+u.y),Math.max(r.upperBoundX,r.upperBoundX+u.x),Math.max(r.upperBoundY,r.upperBoundY+u.y)),h=e,m=[];for(m.push(t.root);m.length>0;){let f=m.pop();if(f==I)continue;let y=t.nodes[f];if(tn(y.aabb,b)==!1||!(y.categoryBits&o))continue;let x=Ve(y.aabb),w=O(Ds(y.aabb),c),g=Math.abs(F(l,J(i,x)));if(!(F(d,w)<g))if(y.height==0){h.maxFraction=p;let A=n(h,f,y.userData,s);if(A==0)return;0<A&&A<p&&(p=A,u=it(p,e.translation),b.lowerBoundX=Math.min(r.lowerBoundX,r.lowerBoundX+u.x),b.lowerBoundY=Math.min(r.lowerBoundY,r.lowerBoundY+u.y),b.upperBoundX=Math.max(r.upperBoundX,r.upperBoundX+u.x),b.upperBoundY=Math.max(r.upperBoundY,r.upperBoundY+u.y))}else m.push(y.child1),m.push(y.child2)}}function su(t,e,o,n,s){if(s<=2)return o+(s>>1);let r=e[o].x,i=e[o].x,c=e[o].y,a=e[o].y;for(let h=o+1;h<n;++h){let m=e[h].x,f=e[h].y;m<r?r=m:m>i&&(i=m),f<c?c=f:f>a&&(a=f)}let l=i-r,d=a-c,p=l>d,u=o,b=n-1;if(p){let h=.5*(r+i);for(;;){for(;u<=b&&e[u].x<h;)u++;for(;u<=b&&e[b].x>h;)b--;if(u>=b)break;let m=t[u];t[u]=t[b],t[b]=m,m=e[u],e[u]=e[b],e[b]=m,u++,b--}}else{let h=.5*(c+a);for(;;){for(;u<=b&&e[u].y<h;)u++;for(;u<=b&&e[b].y>h;)b--;if(u>=b)break;let m=t[u];t[u]=t[b],t[b]=m,m=e[u],e[u]=e[b],e[b]=m,u++,b--}}return u>o&&u<n?u:o+(s>>1)}function lm(t,e){let{nodes:o,leafIndices:n,leafCenters:s}=t;if(e===1)return o[n[0]].parent_next=I,n[0];let r=new Array(am),i=0;for(r[0]={nodeIndex:ur(t),childCount:-1,startIndex:0,endIndex:e,splitIndex:su(n,s,0,e,e)};;){let d=r[i];if(d.childCount++,d.childCount===2){if(i===0)break;let p=r[i-1],u=o[p.nodeIndex],b=d.nodeIndex;p.childCount===0?u.child1=b:u.child2=b;let h=o[b];h.parent_next=p.nodeIndex;let m=o[h.child1],f=o[h.child2];h.aabb=Vt(m.aabb,f.aabb),h.height=1+Math.max(m.height,f.height),h.categoryBits=m.categoryBits|f.categoryBits,i--}else{let[p,u]=d.childCount===0?[d.startIndex,d.splitIndex]:[d.splitIndex,d.endIndex],b=u-p;if(b===1){let h=n[p],m=o[d.nodeIndex];m[d.childCount===0?"child1":"child2"]=h,o[h].parent_next=d.nodeIndex}else r[++i]={nodeIndex:ur(t),childCount:-1,startIndex:p,endIndex:u,splitIndex:su(n,s,p,u,b)}}}let c=o[r[0].nodeIndex],a=o[c.child1],l=o[c.child2];return c.aabb=Vt(a.aabb,l.aabb),c.height=1+Math.max(a.height,l.height),c.categoryBits=a.categoryBits|l.categoryBits,r[0].nodeIndex}function hr(t){let e=t.proxyCount;if(e===0)return 0;if(e>t.rebuildCapacity){let l=e+Math.floor(e/2);t.leafIndices=Array(l),t.leafCenters=Array(l),t.rebuildCapacity=l}let o=0,n=[],s=t.root,r=t.nodes,i=r[s],c=t.leafIndices,a=t.leafCenters;for(;;){if(i.height===0||i.enlarged===!1)c[o]=s,a[o]=Ve(i.aabb),o++,i.parent_next=I;else{let l=s;n.push(i.child2),s=i.child1,i=r[s],pr(t,l);continue}if(n.length===0)break;s=n.pop(),i=r[s]}return t.root=lm(t,o),o}function mu(t,e){let o=t.nodes[e];return o?o.userData:0}var Ln=class{constructor(){this.nodes=[],this.root=0,this.nodeCount=0,this.nodeCapacity=0,this.freeList=I,this.proxyCount=0,this.leafIndices=[],this.leafCenters=[],this.rebuildCapacity=0}};function mr(t){if(t===0n)return 0;let e=Number(t&0xFFFFFFFFn);if(e!==0)return Math.clz32(e&-e)^31;{let o=Number(t>>32n);return Math.clz32(o&-o)^31|32}}var eo=class{constructor(){this.sims=new bs,this.states=new fr,this.joints=new Qo,this.contacts=new $o,this.islands=new xr,this.setIndex=0}};function En(t,e){let o=t.solverSetArray[e];o.sims=null,o.states=null,o.contacts=null,o.joints=null,o.islands=null,fe(t.solverSetIdPool,e),o=new eo,o.setIndex=I,t.solverSetArray[e]=o}function Ee(t,e){let o=t.solverSetArray[e],n=t.solverSetArray[M.b2_awakeSet],s=t.solverSetArray[M.b2_disabledSet],r=t.bodyArray,i=t.contactArray,c=o.sims.count;for(let b=0;b<c;++b){let h=o.sims.data[b],m=r[h.bodyId];m.setIndex=M.b2_awakeSet,m.localIndex=n.sims.count,m.sleepTime=0;let f=en(n.sims);Object.assign(f,h);let y=hs(n.states);Object.assign(y,new kt);let x=m.headContactKey;for(;x!==I;){let w=x&1,g=x>>1,S=i[g];if(x=S.edges[w].nextKey,S.setIndex!==M.b2_disabledSet)continue;let A=S.localIndex,_=s.contacts.data[A];if(S.setIndex=M.b2_awakeSet,S.localIndex=n.contacts.count,Le(n.contacts).set(_),to(s.contacts,A)!==I){let k=s.contacts.data[A].contactId;i[k].localIndex=A}}}let a=o.contacts.count;for(let b=0;b<a;++b){let h=o.contacts.data[b],m=i[h.contactId];ar(t,h,m),m.setIndex=M.b2_awakeSet}let l=t.jointArray,d=o.joints.count;for(let b=0;b<d;++b){let h=o.joints.data[b],m=l[h.jointId];Ii(t,h,m),m.setIndex=M.b2_awakeSet}let p=t.islandArray,u=o.islands.count;for(let b=0;b<u;++b){let h=o.islands.data[b],m=p[h.islandId];m.setIndex=M.b2_awakeSet,m.localIndex=n.islands.count;let f=jn(n.islands);Object.assign(f,h)}En(t,e),Lt(t)}function yr(t,e){let o=t.islandArray[e];if(o.constraintRemoveCount>0)return;let n=t.bodyMoveEventArray,s=ne(t.solverSetIdPool);if(s===t.solverSetArray.length){let y=new eo;y.setIndex=I,t.solverSetArray.push(y)}let r=t.solverSetArray[M.b2_awakeSet],i=t.solverSetArray[s];i.setIndex=s,i.sims=$a(o.bodyCount),i.contacts=Qa(o.contactCount),i.joints=Za(o.jointCount);let c=t.solverSetArray[M.b2_disabledSet],a=t.bodyArray,l=t.contactArray,d=o.headBody;for(;d!==I;){let y=a[d];y.bodyMoveIndex!==I&&(n[y.bodyMoveIndex].fellAsleep=!0,y.bodyMoveIndex=I);let x=y.localIndex,w=r.sims.data[x],g=i.sims.count,S=en(i.sims);if(w.copyTo(S),ms(r.sims,x)!==I){let D=r.sims.data[x].bodyId,v=a[D];v.localIndex=x}ys(r.states,x),y.setIndex=s,y.localIndex=g;let _=y.headContactKey;for(;_!==I;){let C=_>>1,D=_&1,v=l[C];if(_=v.edges[D].nextKey,v.setIndex===M.b2_disabledSet||v.colorIndex!==I)continue;let k=D^1,P=v.edges[k].bodyId;if(a[P].setIndex===M.b2_awakeSet)continue;let E=v.localIndex,X=r.contacts.data[E];if(v.setIndex=M.b2_disabledSet,v.localIndex=c.contacts.count,Le(c.contacts).set(X),to(r.contacts,E)!==I){let st=r.contacts.data[E].contactId;l[st].localIndex=E}}d=y.islandNext}let p=o.headContact;for(;p!==I;){let y=l[p],x=y.colorIndex,w=t.constraintGraph.colors[x];x!==Mt&&(yo(w.bodySet,y.edges[0].bodyId),yo(w.bodySet,y.edges[1].bodyId));let g=y.localIndex,S=w.contacts.data[g],A=i.contacts.count;if(Le(i.contacts).set(S),to(w.contacts,g)!==I){let v=w.contacts.data[g].contactId,k=l[v];k.localIndex=g}y.setIndex=s,y.colorIndex=I,y.localIndex=A,p=y.islandNext}let u=t.jointArray,b=o.headJoint;for(;b!==I;){let y=u[b],x=y.colorIndex,w=y.localIndex,g=t.constraintGraph.colors[x],S=g.joints.data[w];x!==Mt&&(yo(g.bodySet,y.edges[0].bodyId),yo(g.bodySet,y.edges[1].bodyId));let A=i.joints.count,_=Ze(i.joints);if(S.copyTo(_),Zo(g.joints,w)!==I){let v=g.joints.data[w].jointId,k=u[v];k.localIndex=w}y.setIndex=s,y.colorIndex=I,y.localIndex=A,b=y.islandNext}let h=o.localIndex,m=jn(i.islands);if(m.islandId=e,Ir(r.islands,h)!==I){let x=r.islands.data[h].islandId,w=t.islandArray[x];w.localIndex=h}o.setIndex=s,o.localIndex=0,Lt(t)}function Ha(t,e,o){let n=t.solverSetArray[e],s=t.solverSetArray[o];n.sims.count<s.sims.count&&([n,s]=[s,n],[e,o]=[o,e]);let r=t.bodyArray,i=s.sims.count;for(let b=0;b<i;++b){let h=s.sims.data[b],m=r[h.bodyId];m.setIndex=e,m.localIndex=n.sims.count;let f=en(n.sims);Object.assign(f,h)}let c=t.contactArray,a=s.contacts.count;for(let b=0;b<a;++b){let h=s.contacts.data[b],m=c[h.contactId];m.setIndex=e,m.localIndex=n.contacts.count,Le(n.contacts).set(h)}let l=t.jointArray,d=s.joints.count;for(let b=0;b<d;++b){let h=s.joints.data[b],m=l[h.jointId];m.setIndex=e,m.localIndex=n.joints.count;let f=Ze(n.joints);Object.assign(f,h)}let p=t.islandArray,u=s.islands.count;for(let b=0;b<u;++b){let h=s.islands.data[b],m=h.islandId,f=p[m];f.setIndex=e,f.localIndex=n.islands.count;let y=jn(n.islands);Object.assign(y,h)}En(t,o),Lt(t)}function ps(t,e,o,n){let s=n.localIndex,r=o.sims.data[s],i=e.sims.count,c=en(e.sims);if(Object.assign(c,r),ms(o.sims,s)!==I){let d=o.sims.data[s].bodyId,p=t.bodyArray[d];p.localIndex=s}if(o.setIndex===M.b2_awakeSet)ys(o.states,s);else if(e.setIndex===M.b2_awakeSet){let l=hs(e.states);Object.assign(l,new kt)}n.setIndex=e.setIndex,n.localIndex=i}function xo(t,e,o,n){let s=n.localIndex,r=n.colorIndex,i;if(o.setIndex===M.b2_awakeSet?i=t.constraintGraph.colors[r].joints.data[s]:i=o.joints.data[s],e.setIndex===M.b2_awakeSet)Ii(t,i,n),n.setIndex=M.b2_awakeSet;else{n.setIndex=e.setIndex,n.localIndex=e.joints.count,n.colorIndex=I;let c=Ze(e.joints);Object.assign(c,i)}if(o.setIndex===M.b2_awakeSet)lr(t,n.edges[0].bodyId,n.edges[1].bodyId,r,s);else if(Zo(o.joints,s)!==I){let l=o.joints.data[s].jointId,d=t.jointArray[l];d.localIndex=s}}var on={b2_stagePrepareJoints:0,b2_stagePrepareContacts:1,b2_stageIntegrateVelocities:2,b2_stageWarmStart:3,b2_stageSolve:4,b2_stageIntegratePositions:5,b2_stageRelax:6,b2_stageRestitution:7,b2_stageStoreImpulses:8},fs={b2_bodyBlock:0,b2_jointBlock:1,b2_contactBlock:2,b2_graphJointBlock:3,b2_graphContactBlock:4},nn=class{constructor(){this.startIndex=0,this.count=0,this.blockType=0,this.syncIndex=0}},Mi=class{constructor(){this.type=0,this.blocks=null,this.blockCount=0,this.colorIndex=0,this.completionCount=0}},oc=class{constructor(){this.context=new xs,this.workerIndex=0,this.userTask=null}},re=class t{constructor(e=0,o=0,n=0){this.biasRate=e,this.massScale=o,this.impulseScale=n}clone(){return new t(this.biasRate,this.massScale,this.impulseScale)}},xs=class{constructor(){this.dt=0,this.inv_dt=0,this.h=0,this.inv_h=0,this.subStepCount=0,this.jointSoftness=new re(0,0,0),this.contactSoftness=new re(0,0,0),this.staticSoftness=new re(0,0,0),this.restitutionThreshold=0,this.maxLinearVelocity=0,this.world=null,this.graph=null,this.states=null,this.sims=null,this.enlargedShapes=null,this.enlargedShapeCount=0,this.fastBodies=null,this.fastBodyCount=0,this.bulletBodies=null,this.bulletBodyCount=0,this.joints=null,this.contacts=null,this.simdContactConstraints=null,this.activeColorCount=0,this.workerCount=0,this.stages=null,this.stageCount=0,this.enableWarmStarting=!1,this.atomicSyncBits=0}};function ie(t,e,o){if(t===0)return new re(0,1,0);let n=2*Bo*t,s=2*e+o*n,r=o*n*s,i=1/(1+r);return new re(n/s,r*i,i)}function dm(t,e,o){let n=o.states,s=o.sims,r=o.world.gravity,i=o.h,c=o.maxLinearVelocity,a=Ql*o.inv_dt,l=c*c,d=a*a;for(let p=t;p<e;++p){let u=s[p],b=n[p],h=b.linearVelocity,m=b.angularVelocity,f=1/(1+i*u.linearDamping),y=1/(1+i*u.angularDamping),x=u.mass*u.gravityScale,w=i*u.invMass,g=w*(u.force.x+x*r.x),S=w*(u.force.y+x*r.y),A=i*u.invInertia*u.torque;h.x=g+f*h.x,h.y=S+f*h.y,m=A+y*m;let _=h.x*h.x+h.y*h.y;if(_>l){let C=c/Math.sqrt(_);h.x*=C,h.y*=C,u.isSpeedCapped=!0}if(m*m>d&&u.allowFastRotation===!1){let C=a/Math.abs(m);m*=C,u.isSpeedCapped=!0}b.linearVelocity=h,b.angularVelocity=m}}function um(t,e,o){let n=o.states,s=o.h;for(let r=t;r<e;++r){let i=n[r];Fl(i.deltaRotation,s*i.angularVelocity,i.deltaRotation),i.deltaPosition.x=i.deltaPosition.x+s*i.linearVelocity.x,i.deltaPosition.y=i.deltaPosition.y+s*i.linearVelocity.y}}function pm(t,e,o,n){let s=n,r=s.world,i=r.enableSleep,c=s.states,a=s.sims,l=r.bodyArray,d=s.dt,p=s.inv_dt,u=r.worldId,b=r.bodyMoveEventArray,h=r.islandArray,m=r.taskContextArray[o].enlargedSimBitSet,f=r.taskContextArray[o].awakeIslandBitSet,y=r.taskContextArray[o],x=r.enableContinuous,w=Ht,g=yn;for(let S=t;S<e;++S){let A=c[S],_=a[S],C=A.linearVelocity,D=A.angularVelocity;_.center.x+=A.deltaPosition.x,_.center.y+=A.deltaPosition.y;let v=Vl(A.deltaRotation,_.transform.q),k=Yl(A.deltaRotation,_.transform.q),P=Xl(v,k);_.transform.q=new rt(P*v,P*k);let G=Ut(C)+Math.abs(D)*_.maxExtent,E=Ut(A.deltaPosition)+Math.abs(A.deltaRotation.s)*_.maxExtent,L=Math.max(G,.5*p*E);A.deltaPosition.x=0,A.deltaPosition.y=0,A.deltaRotation.c=1,A.deltaRotation.s=0,_.transform.p.x=_.center.x-(_.transform.q.c*_.localCenter.x-_.transform.q.s*_.localCenter.y),_.transform.p.y=_.center.y-(_.transform.q.s*_.localCenter.x+_.transform.q.c*_.localCenter.y);let W=l[_.bodyId];W.bodyMoveIndex=S,b[S].transform=_.transform,b[S].bodyId=new Ne(_.bodyId+1,u,W.revision),b[S].userData=W.userData,b[S].fellAsleep=!1,_.force.x=0,_.force.y=0,_.torque=0,W.isSpeedCapped=_.isSpeedCapped,_.isSpeedCapped=!1,_.isFast=!1,i===!1||W.enableSleep===!1||L>W.sleepThreshold?(W.sleepTime=0,W.type===et.b2_dynamicBody&&x&&G*d>.5*_.minExtent?(_.isBullet?(s.bulletBodyCount++,s.bulletBodies[s.bulletBodyCount-1]=S):(s.fastBodyCount++,s.fastBodies[s.fastBodyCount-1]=S),_.isFast=!0):(_.center0X=_.center.x,_.center0Y=_.center.y,_.rotation0.x=_.transform.q.x,_.rotation0.y=_.transform.q.y)):(_.center0X=_.center.x,_.center0Y=_.center.y,_.rotation0.x=_.transform.q.x,_.rotation0.y=_.transform.q.y,W.sleepTime+=d);let tt=h[W.islandId];if(W.sleepTime<Zl){let nt=tt.localIndex;Qe(f,nt)}else tt.constraintRemoveCount>0&&W.sleepTime>y.splitSleepTime&&(y.splitIslandId=W.islandId,y.splitSleepTime=W.sleepTime);let st=_.transform,ot=_.isFast,j=W.headShapeId;for(;j!==I;){let nt=r.shapeArray[j];if(ot)nt.isFast=!0,Qe(m,S);else{let wt=ho(nt,st);if(wt.lowerBoundX-=w,wt.lowerBoundY-=w,wt.upperBoundX+=w,wt.upperBoundY+=w,nt.aabb=wt,Vo(nt.fatAABB,wt)===!1){let N=new xt(wt.lowerBoundX-g,wt.lowerBoundY-g,wt.upperBoundX+g,wt.upperBoundY+g);nt.fatAABB=N,nt.enlargedAABB=!0,Qe(m,S)}}j=nt.nextShapeId}}}function bm(t,e,o){let n=t.type,s=o.startIndex,r=s+o.count;n===on.b2_stageIntegrateVelocities?dm(s,r,e):n===on.b2_stageIntegratePositions&&um(s,r,e)}function Lo(t,e){let o=t.blockCount;for(let n=0;n<o;n++)bm(t,e,t.blocks[n])}function hm(t){let e=t.workerIndex,o=t.context,n=o.activeColorCount,s=o.stages;if(e===0){let r=0;Lo(s[r],o),r+=1,Lo(s[r],o),r+=1,rc(o),Va(o);let i=o.subStepCount;for(let c=0;c<i;++c){let a=r;Lo(s[a],o),a+=1,ic(o),Ya(o);for(let d=0;d<n;++d)Lo(s[a],o),a+=1;let l=!0;Di(o,l),gi(o,l);for(let d=0;d<n;++d)Lo(s[a],o),a+=1;Lo(s[a],o),a+=1,l=!1,Di(o,l),gi(o,l);for(let d=0;d<n;++d)Lo(s[a],o),a+=1}r+=1+n+n+1+n;{Na(o);let c=r;for(let a=0;a<n;++a)Lo(s[c],o),c+=1;r+=n}Wa(o),Lo(s[r],o),o.atomicSyncBits=Number.MAX_SAFE_INTEGER;return}}var mm=new Co(new B,new B,new B,new rt,new rt);function tc(t,e,o){let n=o,s=n.fastShape,r=n.fastBodySim;if(e===s.id)return!0;let i=n.world,c=i.shapeArray[e];if(c.bodyId===s.bodyId||c.isSensor===!0)return!0;let a=_r(s.filter,c.filter);if(a===!1)return!0;let l=i.bodyArray[c.bodyId],d=jt(i,l);if(d.isBullet)return!0;let p=i.bodyArray[r.bodyId];if(a=gr(i,p,l),a===!1)return!0;let u=i.customFilterFcn;if(u!=null){let y=new _t(c.id+1,i.worldId,c.revision),x=new _t(s.id+1,i.worldId,s.revision);if(a=u(y,x,i.customFilterContext),a===!1)return!0}if(c.type===Y.b2_chainSegmentShape){let y=d.transform,x=H(y,c.chainSegment.segment.point1),w=H(y,c.chainSegment.segment.point2),g=w.x-x.x,S=w.y-x.y,A=n.centroid1X,_=n.centroid1Y,C=n.centroid2X,D=n.centroid2Y,v=A-x.x,k=_-x.y,P=v*S-k*g;v=C-x.x,k=D-x.y;let G=v*S-k*g;if(P<0||G>0)return!0}let b=new Ts;b.proxyA=ze(c),b.proxyB=ze(s),b.sweepA=ki(d,mm),b.sweepB=n.sweep,b.tMax=n.fraction;let h=n.fraction,m=!1,f=Us(b);if(0<f.t&&f.t<n.fraction)h=f.t,m=!0;else if(f.t===0){let y=as(s);b.proxyB=vt([y],1,Ht),f=Us(b),0<f.t&&f.t<n.fraction&&(h=f.t,m=!0)}if(m&&(c.enablePreSolveEvents||s.enablePreSolveEvents)){let y=De(b.sweepA,h),x=De(b.sweepB,h),w=new Oo;fu(c,y,s,x,w);let g=new _t(c.id+1,i.worldId,c.revision),S=new _t(s.id+1,i.worldId,s.revision);m=i.preSolveFcn(g,S,w,i.preSolveContext)}return m&&(n.fraction=h),!0}var nc=class{constructor(){this.world=null,this.fastBodySim=null,this.fastShape=null,this.centroid1X=0,this.centroid1Y=0,this.centroid2X=0,this.centroid2Y=0,this.sweep=null,this.fraction=0}},Eo=new B,ec=new B,ym=new Co(new B,new B,new B,new rt,new rt);function yu(t,e){let n=t.solverSetArray[M.b2_awakeSet].sims.data[e],s=t.shapeArray,r=ki(n,ym);Eo.x=r.c1.x-(r.q1.c*r.localCenter.x-r.q1.s*r.localCenter.y),Eo.y=r.c1.y-(r.q1.s*r.localCenter.x+r.q1.c*r.localCenter.y);let i=new at(Eo,r.q1);ec.x=r.c2.x-(r.q2.c*r.localCenter.x-r.q2.s*r.localCenter.y),ec.y=r.c2.y-(r.q2.s*r.localCenter.x+r.q2.c*r.localCenter.y);let c=new at(ec,r.q2),a=t.broadPhase.trees[et.b2_staticBody],l=t.broadPhase.trees[et.b2_kinematicBody],d=t.broadPhase.trees[et.b2_dynamicBody],p=t.bodyArray[n.bodyId],u=new nc;u.world=t,u.sweep=r,u.fastBodySim=n,u.fraction=1;let b=n.isBullet,h=p.headShapeId;for(;h!=I;){let y=s[h];h=y.nextShapeId,y.isFast=!1,u.fastShape=y,de(i,y.localCentroid,Eo),u.centroid1X=Eo.x,u.centroid1Y=Eo.y,de(c,y.localCentroid,Eo),u.centroid2X=Eo.x,u.centroid2Y=Eo.y;let x=y.aabb,w=ho(y,c),g=Vt(x,w);y.aabb=w,!y.isSensor&&(Pe(a,g,In,tc,u),b&&(Pe(l,g,In,tc,u),Pe(d,g,In,tc,u)))}let m=Ht,f=yn;if(u.fraction<1){let y=Ca(r.q1,r.q2,u.fraction),x=Zt(r.c1,r.c2,u.fraction),w=J(x,K(y,r.localCenter)),g=new at(w,y);for(n.transform=g,n.center=x,n.rotation0=y,n.center0X=x.x,n.center0Y=x.y,h=p.headShapeId;h!=I;){let S=s[h],A=ho(S,g);if(A.lowerBoundX-=m,A.lowerBoundY-=m,A.upperBoundX+=m,A.upperBoundY+=m,S.aabb=A,!Vo(S.fatAABB,A)){let _=new xt(A.lowerBoundX-f,A.lowerBoundY-f,A.upperBoundX+f,A.upperBoundY+f);S.fatAABB=_,S.enlargedAABB=!0,n.enlargeAABB=!0}h=S.nextShapeId}}else for(n.rotation0=n.transform.q,n.center0X=n.center.x,n.center0Y=n.center.y,h=p.headShapeId;h!=I;){let y=s[h];if(!Vo(y.fatAABB,y.aabb)){let x=new xt(y.aabb.lowerBoundX-f,y.aabb.lowerBoundY-f,y.aabb.upperBoundX+f,y.aabb.upperBoundY+f);y.fatAABB=x,y.enlargedAABB=!0,n.enlargeAABB=!0}h=y.nextShapeId}}function fm(t,e,o){let n=o;for(let s=t;s<e;++s){let r=n.fastBodies[s];yu(n.world,r)}}function xm(t,e,o){let n=o;for(let s=t;s<e;++s){let r=n.bulletBodies[s];yu(n.world,r)}}function sc(t,e){t.stepIndex+=1,Xn(t);let o=t.solverSetArray[M.b2_awakeSet],n=o.sims.count;if(n===0)return;e.fastBodyCount=0,e.fastBodies=Oe(t.stackAllocator,n,"fast bodies"),e.bulletBodyCount=0,e.bulletBodies=Oe(t.stackAllocator,n,"bullet bodies");{let r=t.constraintGraph,i=r.colors;e.sims=o.sims.data,e.states=o.states.data;let c=0,a=0;for(let N=0;N<te-1;++N){let Q=i[N].contacts.count,Ct=i[N].joints.count,ct=Q+Ct;a+=ct>0?1:0,c+=Ct}{let N=t.bodyMoveEventArray;for(;N.length<n;)N.push(new Hr)}let l=t.workerCount,d=4,p=d*l,u=32,b;n>u*p?(u=Math.floor(n/p),b=p):b=Math.floor(n-1>>5)+1;let h=new Array(te),m=new Array(te),f=new Array(te),y=new Array(te),x=new Array(te),w=new Array(te),g=0,S=0,A=i[Mt].contacts.count,_=Oe(t.stackAllocator,A,"overflow contact constraint",()=>new dr);r.colors[Mt].overflowConstraints=_;let C=d,D=S>0?Math.floor(S-1>>2)+1:0;S>C*p&&(C=Math.floor(S/p),D=p);let v=d,k=c>0?Math.floor(c-1>>2)+1:0;c>v*p&&(v=Math.floor(c/p),k=p);let P=0;P+=1,P+=1,P+=1,P+=a,P+=a,P+=1,P+=a,P+=a,P+=1;let G=Array.from({length:P},()=>new Mi),E=Oe(t.stackAllocator,b,"body blocks"),X=Oe(t.stackAllocator,D,"contact blocks"),L=Oe(t.stackAllocator,k,"joint blocks"),W=Oe(t.stackAllocator,g,"graph blocks");t.splitIslandId!=I&&Sr(t,t.splitIslandId);for(let N=0;N<b;++N){let Q=new nn;Q.startIndex=N*u,Q.count=u,Q.blockType=fs.b2_bodyBlock,Q.syncIndex=0,E[N]=Q}E[b-1].count=n-(b-1)*u;for(let N=0;N<k;++N){let Q=new nn;Q.startIndex=N*v,Q.count=v,Q.blockType=fs.b2_jointBlock,Q.syncIndex=0,L[N]=Q}k>0&&(L[k-1].count=c-(k-1)*v);for(let N=0;N<D;++N){let Q=new nn;Q.startIndex=N*C,Q.count=C,Q.blockType=fs.b2_contactBlock,Q.syncIndex=0,X[N]=Q}D>0&&(X[D-1].count=S-(D-1)*C);let tt=new Array(te),st=0;for(let N=0;N<a;++N){tt[N]=st;let Q=w[N],Ct=x[N];for(let Tt=0;Tt<Q;++Tt){let lt=new nn;lt.startIndex=Tt*Ct,lt.count=Ct,lt.blockType=fs.b2_graphJointBlock,lt.syncIndex=0,W[st+Tt]=lt}Q>0&&(W[st+Q-1].count=y[N]-(Q-1)*Ct,st+=Q);let ct=f[N],At=m[N];for(let Tt=0;Tt<ct;++Tt){let lt=new nn;lt.startIndex=Tt*At,lt.count=At,lt.blockType=fs.b2_graphContactBlock,lt.syncIndex=0,W[st+Tt]=lt}ct>0&&(W[st+ct-1].count=h[N]-(ct-1)*At,st+=ct)}let ot=st,j=0,nt=(N,Q,Ct,ct,At=-1)=>{N.type=Q,N.blocks=Ct,N.blockCount=ct,N.colorIndex=At,N.completionCount=0};nt(G[j++],on.b2_stagePrepareJoints,L,k),nt(G[j++],on.b2_stagePrepareContacts,X,D),nt(G[j++],on.b2_stageIntegrateVelocities,E,b),nt(G[j++],on.b2_stageIntegratePositions,E,b),nt(G[j++],on.b2_stageStoreImpulses,X,D),e.graph=r,e.joints=null,e.contacts=null,e.simdContactConstraints=null,e.activeColorCount=a,e.workerCount=l,e.stageCount=P,e.stages=G;{let N=new oc;N.context=e,N.workerIndex=0,hm(N)}t.splitIslandId=I;let wt=o.islands.count;for(let N=0;N<t.workerCount;++N){let Q=t.taskContextArray[N];Q.enlargedSimBitSet=$e(Q.enlargedSimBitSet,n),Q.awakeIslandBitSet=$e(Q.awakeIslandBitSet,wt),Q.splitIslandId=I,Q.splitSleepTime=0}pm(0,n,0,e),Ue(t.stackAllocator,W),Ue(t.stackAllocator,L),Ue(t.stackAllocator,X),Ue(t.stackAllocator,E),Ue(t.stackAllocator,_)}{let r=t.hitEventThreshold,i=t.constraintGraph.colors;for(let c=0;c<te;++c){let a=i[c],l=a.contacts.count,d=a.contacts.data;for(let p=0;p<l;++p){let u=d[p];if(!(u.simFlags&Yt.b2_simEnableHitEvent))continue;let b=new Kr;b.approachSpeed=r,b.shapeIdA=new _t(0,0,0),b.shapeIdB=new _t(0,0,0);let h=!1,m=u.manifold.pointCount;for(let f=0;f<m;++f){let y=u.manifold.points[f],x=-y.normalVelocity;x>b.approachSpeed&&y.maxNormalImpulse>0&&(b.approachSpeed=x,b.pointX=y.pointX,b.pointY=y.pointY,h=!0)}if(h===!0){b.normalX=u.manifold.normalX,b.normalY=u.manifold.normalY;let f=t.shapeArray[u.shapeIdA],y=t.shapeArray[u.shapeIdB];b.shapeIdA=new _t(f.id+1,t.worldId,f.revision),b.shapeIdB=new _t(y.id+1,t.worldId,y.revision),t.contactHitArray.push(b)}}}}let s=t.taskContextArray[0].enlargedSimBitSet;for(let r=1;r<t.workerCount;++r)ls(s,t.taskContextArray[r].enlargedSimBitSet);{let r=t.broadPhase,i=t.shapeArray,c=s.blockCount,a=s.bits;for(let l=0;l<c;++l){let d=a[l];for(;d!==0n;){let p=mr(d),u=64*l+p,b=o.sims.data[u],m=t.bodyArray[b.bodyId].headShapeId;for(;m!==I;){let f=i[m];f.enlargedAABB?(ac(r,f.proxyKey,f.fatAABB),f.enlargedAABB=!1):f.isFast&&rn(r,f.proxyKey),m=f.nextShapeId}d=d&d-1n}}}e.fastBodyCount>0&&fm(0,e.fastBodyCount,e);{let i=t.broadPhase.trees[et.b2_dynamicBody],c=t.bodyArray,a=t.shapeArray,l=e.fastBodies,d=e.fastBodyCount;for(let p=0;p<d;++p){let u=o.sims.data[l[p]];if(u.enlargeAABB===!1)continue;u.enlargeAABB=!1;let h=c[u.bodyId].headShapeId;for(;h!==I;){let m=a[h];if(m.enlargedAABB===!1){h=m.nextShapeId;continue}m.enlargedAABB=!1;let f=m.proxyKey,y=sn(f);Rn(i,y,m.fatAABB),h=m.nextShapeId}}}e.bulletBodyCount>0&&xm(0,e.bulletBodyCount,e);{let i=t.broadPhase.trees[et.b2_dynamicBody],c=t.bodyArray,a=t.shapeArray,l=e.bulletBodies,d=e.bulletBodyCount;for(let p=0;p<d;++p){let u=o.sims.data[l[p]];if(u.enlargeAABB===!1)continue;u.enlargeAABB=!1;let h=c[u.bodyId].headShapeId;for(;h!==I;){let m=a[h];if(m.enlargedAABB===!1){h=m.nextShapeId;continue}m.enlargedAABB=!1;let f=m.proxyKey,y=sn(f);Rn(i,y,m.fatAABB),h=m.nextShapeId}}}if(Ue(t.stackAllocator,e.bulletBodies),e.bulletBodies=null,e.bulletBodyCount=0,Ue(t.stackAllocator,e.fastBodies),e.fastBodies=null,e.fastBodyCount=0,t.enableSleep===!0){let r=0;for(let l=0;l<t.workerCount;++l){let d=t.taskContextArray[l];d.splitIslandId!==I&&d.splitSleepTime>r&&(t.splitIslandId=d.splitIslandId,r=d.splitSleepTime)}let i=t.taskContextArray[0].awakeIslandBitSet;for(let l=1;l<t.workerCount;++l)ls(i,t.taskContextArray[l].awakeIslandBitSet);let c=o.islands.data,a=o.islands.count;for(let l=a-1;l>=0;l-=1){if(nu(i,l)===!0)continue;let p=c[l].islandId;yr(t,p)}Lt(t)}}function xu(t,e){let n=q(t,T.b2_distanceJoint).distanceJoint;n.length=mt(e,St,Me),n.impulse=0,n.lowerImpulse=0,n.upperImpulse=0}function Iu(t){return q(t,T.b2_distanceJoint).distanceJoint.length}function Su(t,e){let n=q(t,T.b2_distanceJoint).distanceJoint;n.enableLimit=e}function gu(t){return q(t,T.b2_distanceJoint).distanceJoint.enableLimit}function _u(t,e,o){let s=q(t,T.b2_distanceJoint).distanceJoint;e=mt(e,St,Me),o=mt(o,St,Me),s.minLength=Math.min(e,o),s.maxLength=Math.max(e,o),s.impulse=0,s.lowerImpulse=0,s.upperImpulse=0}function Bu(t){return q(t,T.b2_distanceJoint).distanceJoint.minLength}function Au(t){return q(t,T.b2_distanceJoint).distanceJoint.maxLength}function wu(t){let e=q(t,T.b2_distanceJoint),o=U(t.world0);if(o.locked)return 0;let n=ue(o,e.bodyIdA),s=ue(o,e.bodyIdB),r=H(n,e.localOriginAnchorA),i=H(s,e.localOriginAnchorB),c=J(i,r);return Ut(c)}function Cu(t,e){let o=q(t,T.b2_distanceJoint);o.distanceJoint.enableSpring=e}function vu(t){return q(t,T.b2_distanceJoint).distanceJoint.enableSpring}function Ju(t,e){let o=q(t,T.b2_distanceJoint);o.distanceJoint.hertz=e}function Mu(t,e){let o=q(t,T.b2_distanceJoint);o.distanceJoint.dampingRatio=e}function Du(t){return q(t,T.b2_distanceJoint).distanceJoint.hertz}function ku(t){return q(t,T.b2_distanceJoint).distanceJoint.dampingRatio}function Pu(t,e){let o=q(t,T.b2_distanceJoint);e!==o.distanceJoint.enableMotor&&(o.distanceJoint.enableMotor=e,o.distanceJoint.motorImpulse=0)}function Tu(t){return q(t,T.b2_distanceJoint).distanceJoint.enableMotor}function Gu(t,e){let o=q(t,T.b2_distanceJoint);o.distanceJoint.motorSpeed=e}function Ru(t){return q(t,T.b2_distanceJoint).distanceJoint.motorSpeed}function Lu(t){let e=U(t.world0),o=q(t,T.b2_distanceJoint);return e.inv_h*o.distanceJoint.motorImpulse}function Eu(t,e){let o=q(t,T.b2_distanceJoint);o.distanceJoint.maxMotorForce=e}function ju(t){return q(t,T.b2_distanceJoint).distanceJoint.maxMotorForce}function cc(t,e){let o=e.distanceJoint,n=ue(t,e.bodyIdA),s=ue(t,e.bodyIdB),r=H(n,e.localOriginAnchorA),i=H(s,e.localOriginAnchorB),c=J(i,r),a=dt(c),l=(o.impulse+o.lowerImpulse-o.upperImpulse+o.motorImpulse)*t.inv_h;return it(l,a)}function lc(t,e){let o=e.world,n=o.bodyArray,s=t.bodyIdA,r=t.bodyIdB,i=n[s],c=n[r],a=o.solverSetArray[i.setIndex],l=o.solverSetArray[c.setIndex],d=a.sims.data[i.localIndex],p=l.sims.data[c.localIndex],u=d.invMass,b=d.invInertia,h=p.invMass,m=p.invInertia;t.invMassA=u,t.invMassB=h,t.invIA=b,t.invIB=m;let f=t.distanceJoint;f.indexA=i.setIndex===M.b2_awakeSet?i.localIndex:I,f.indexB=c.setIndex===M.b2_awakeSet?c.localIndex:I,f.anchorA=K(d.transform.q,J(t.localOriginAnchorA,d.localCenter)),f.anchorB=K(p.transform.q,J(t.localOriginAnchorB,p.localCenter)),f.deltaCenter=J(p.center,d.center);let y=f.anchorA,x=f.anchorB,w=O(J(x,y),f.deltaCenter),g=dt(w),S=z(y,g),A=z(x,g),_=u+h+b*S*S+m*A*A;f.axialMass=_>0?1/_:0,f.distanceSoftness=ie(f.hertz,f.dampingRatio,e.h),e.enableWarmStarting===!1&&(f.impulse=0,f.lowerImpulse=0,f.upperImpulse=0,f.motorImpulse=0)}function dc(t,e){let o=t.invMassA,n=t.invMassB,s=t.invIA,r=t.invIB,i=new kt,c=t.distanceJoint,a=c.indexA===I?i:e.states[c.indexA],l=c.indexB===I?i:e.states[c.indexB],d=K(a.deltaRotation,c.anchorA),p=K(l.deltaRotation,c.anchorB),u=O(J(l.deltaPosition,a.deltaPosition),J(p,d)),b=O(c.deltaCenter,u),h=dt(b),m=c.impulse+c.lowerImpulse-c.upperImpulse+c.motorImpulse,f=it(m,h);a.linearVelocity=It(a.linearVelocity,o,f),a.angularVelocity-=s*z(d,f),l.linearVelocity=$(l.linearVelocity,n,f),l.angularVelocity+=r*z(p,f)}function uc(t,e,o){let n=t.invMassA,s=t.invMassB,r=t.invIA,i=t.invIB,c=new kt,a=t.distanceJoint,l=a.indexA===I?c:e.states[a.indexA],d=a.indexB===I?c:e.states[a.indexB],p=l.linearVelocity,u=l.angularVelocity,b=d.linearVelocity,h=d.angularVelocity,m=K(l.deltaRotation,a.anchorA),f=K(d.deltaRotation,a.anchorB),y=O(J(d.deltaPosition,l.deltaPosition),J(f,m)),x=O(a.deltaCenter,y),w=Ut(x),g=dt(x);if(a.enableSpring&&(a.minLength<a.maxLength||a.enableLimit===!1)){if(a.hertz>0){let S=O(J(b,p),J(Gt(h,f),Gt(u,m))),A=F(g,S),_=w-a.length,C=a.distanceSoftness.biasRate*_,v=-(a.distanceSoftness.massScale*a.axialMass)*(A+C)-a.distanceSoftness.impulseScale*a.impulse;a.impulse+=v;let k=it(v,g);p=It(p,n,k),u-=r*z(m,k),b=$(b,s,k),h+=i*z(f,k)}if(a.enableLimit){{let S=O(J(b,p),J(Gt(h,f),Gt(u,m))),A=F(g,S),_=w-a.minLength,C=0,D=1,v=0;_>0?C=_*e.inv_h:o&&(C=e.jointSoftness.biasRate*_,D=e.jointSoftness.massScale,v=e.jointSoftness.impulseScale);let k=-D*a.axialMass*(A+C)-v*a.lowerImpulse,P=Math.max(0,a.lowerImpulse+k),G=P-a.lowerImpulse;a.lowerImpulse=P;let E=it(G,g);p=It(p,n,E),u-=r*z(m,E),b=$(b,s,E),h+=i*z(f,E)}{let S=O(J(p,b),J(Gt(u,m),Gt(h,f))),A=F(g,S),_=a.maxLength-w,C=0,D=1,v=0;_>0?C=_*e.inv_h:o&&(C=e.jointSoftness.biasRate*_,D=e.jointSoftness.massScale,v=e.jointSoftness.impulseScale);let k=-D*a.axialMass*(A+C)-v*a.upperImpulse,P=Math.max(0,a.upperImpulse+k),G=P-a.upperImpulse;a.upperImpulse=P;let E=it(-G,g);p=It(p,n,E),u-=r*z(m,E),b=$(b,s,E),h+=i*z(f,E)}}if(a.enableMotor){let S=O(J(b,p),J(Gt(h,f),Gt(u,m))),A=F(g,S),_=a.axialMass*(a.motorSpeed-A),C=a.motorImpulse,D=e.h*a.maxMotorForce;a.motorImpulse=mt(a.motorImpulse+_,-D,D);let v=a.motorImpulse-C,k=it(v,g);p=It(p,n,k),u-=r*z(m,k),b=$(b,s,k),h+=i*z(f,k)}}else{let S=O(J(b,p),J(Gt(h,f),Gt(u,m))),A=F(g,S),_=w-a.length,C=0,D=1,v=0;o&&(C=e.jointSoftness.biasRate*_,D=e.jointSoftness.massScale,v=e.jointSoftness.impulseScale);let k=-D*a.axialMass*(A+C)-v*a.impulse;a.impulse+=k;let P=it(k,g);p=It(p,n,P),u-=r*z(m,P),b=$(b,s,P),h+=i*z(f,P)}l.linearVelocity=p,l.angularVelocity=u,d.linearVelocity=b,d.angularVelocity=h}function pc(t,e,o,n){let s=e.distanceJoint,r=H(o,e.localOriginAnchorA),i=H(n,e.localOriginAnchorB),c=dt(J(i,r));if(s.minLength<s.maxLength&&s.enableLimit){let a=$(r,s.minLength,c),l=$(r,s.maxLength,c),d=it(.05*Ye,be(c));s.minLength>St&&t.DrawSegment(J(a,d),O(a,d),V.b2_colorLightGreen,t.context),s.maxLength<Me&&t.DrawSegment(J(l,d),O(l,d),V.b2_colorRed,t.context),s.minLength>St&&s.maxLength<Me&&t.DrawSegment(a,l,V.b2_colorGray,t.context)}if(t.DrawSegment(r,i,V.b2_colorWhite,t.context),t.DrawPoint(r.x,r.y,4,V.b2_colorWhite,t.context),t.DrawPoint(i.x,i.y,4,V.b2_colorWhite,t.context),s.hertz>0&&s.enableSpring){let a=$(r,s.length,c);t.DrawPoint(a.x,a.y,4,V.b2_colorBlue,t.context)}}function Xu(t,e){let o=q(t,T.b2_prismaticJoint);e!==o.prismaticJoint.enableSpring&&(o.prismaticJoint.enableSpring=e,o.prismaticJoint.springImpulse=0)}function Fu(t){return q(t,T.b2_prismaticJoint).prismaticJoint.enableSpring}function qu(t,e){let o=q(t,T.b2_prismaticJoint);o.prismaticJoint.hertz=e}function Vu(t){return q(t,T.b2_prismaticJoint).prismaticJoint.hertz}function Yu(t,e){let o=q(t,T.b2_prismaticJoint);o.prismaticJoint.dampingRatio=e}function Nu(t){return q(t,T.b2_prismaticJoint).prismaticJoint.dampingRatio}function Wu(t,e){let o=q(t,T.b2_prismaticJoint);e!==o.prismaticJoint.enableLimit&&(o.prismaticJoint.enableLimit=e,o.prismaticJoint.lowerImpulse=0,o.prismaticJoint.upperImpulse=0)}function Ou(t){return q(t,T.b2_prismaticJoint).prismaticJoint.enableLimit}function Uu(t){return q(t,T.b2_prismaticJoint).prismaticJoint.lowerTranslation}function zu(t){return q(t,T.b2_prismaticJoint).prismaticJoint.upperTranslation}function Ku(t,e,o){let n=q(t,T.b2_prismaticJoint);(e!==n.prismaticJoint.lowerTranslation||o!==n.prismaticJoint.upperTranslation)&&(n.prismaticJoint.lowerTranslation=Math.min(e,o),n.prismaticJoint.upperTranslation=Math.max(e,o),n.prismaticJoint.lowerImpulse=0,n.prismaticJoint.upperImpulse=0)}function Hu(t,e){let o=q(t,T.b2_prismaticJoint);e!==o.prismaticJoint.enableMotor&&(o.prismaticJoint.enableMotor=e,o.prismaticJoint.motorImpulse=0)}function $u(t){return q(t,T.b2_prismaticJoint).prismaticJoint.enableMotor}function Qu(t,e){let o=q(t,T.b2_prismaticJoint);o.prismaticJoint.motorSpeed=e}function Zu(t){return q(t,T.b2_prismaticJoint).prismaticJoint.motorSpeed}function tp(t){let e=U(t.world0),o=q(t,T.b2_prismaticJoint);return e.inv_h*o.prismaticJoint.motorImpulse}function ep(t,e){let o=q(t,T.b2_prismaticJoint);o.prismaticJoint.maxMotorForce=e}function op(t){return q(t,T.b2_prismaticJoint).prismaticJoint.maxMotorForce}function bc(t,e){let o=e.bodyIdA,n=ue(t,o),s=e.prismaticJoint,r=K(n.q,s.localAxisA),i=pe(r),c=t.inv_h,a=c*s.impulse.x,l=c*(s.motorImpulse+s.lowerImpulse-s.upperImpulse);return O(it(a,i),it(l,r))}function hc(t,e){return t.inv_h*e.prismaticJoint.impulse.y}function mc(t,e){let o=t.bodyIdA,n=t.bodyIdB,s=e.world,r=s.bodyArray,i=r[o],c=r[n],a=s.solverSetArray[i.setIndex],l=s.solverSetArray[c.setIndex],d=i.localIndex,p=c.localIndex,u=a.sims.data[i.localIndex],b=l.sims.data[c.localIndex],h=u.invMass,m=u.invInertia,f=b.invMass,y=b.invInertia;t.invMassA=h,t.invMassB=f,t.invIA=m,t.invIB=y;let x=t.prismaticJoint;x.indexA=i.setIndex==M.b2_awakeSet?d:I,x.indexB=c.setIndex==M.b2_awakeSet?p:I;let w=u.transform.q,g=b.transform.q;x.anchorA=K(w,J(t.localOriginAnchorA,u.localCenter)),x.anchorB=K(g,J(t.localOriginAnchorB,b.localCenter)),x.axisA=K(w,x.localAxisA),x.deltaCenter=J(b.center,u.center),x.deltaAngle=ae(g,w)-x.referenceAngle;let S=x.anchorA,A=x.anchorB,_=O(x.deltaCenter,J(A,S)),C=z(O(_,S),x.axisA),D=z(A,x.axisA),v=h+f+m*C*C+y*D*D;x.axialMass=v>0?1/v:0,x.springSoftness=ie(x.hertz,x.dampingRatio,e.h),e.enableWarmStarting==!1&&(x.impulse=new B(0,0),x.springImpulse=0,x.motorImpulse=0,x.lowerImpulse=0,x.upperImpulse=0)}function yc(t,e){let o=t.invMassA,n=t.invMassB,s=t.invIA,r=t.invIB,i=new kt,c=t.prismaticJoint,a=c.indexA==I?i:e.states[c.indexA],l=c.indexB==I?i:e.states[c.indexB],d=K(a.deltaRotation,c.anchorA),p=K(l.deltaRotation,c.anchorB),u=O(O(J(l.deltaPosition,a.deltaPosition),c.deltaCenter),J(p,d)),b=K(a.deltaRotation,c.axisA),h=z(O(u,d),b),m=z(p,b),f=c.springImpulse+c.motorImpulse+c.lowerImpulse-c.upperImpulse,y=pe(b),x=z(O(u,d),y),w=z(p,y),g=c.impulse.x,S=c.impulse.y,A=O(it(f,b),it(g,y)),_=f*h+g*x+S,C=f*m+g*w+S;a.linearVelocity=It(a.linearVelocity,o,A),a.angularVelocity-=s*_,l.linearVelocity=$(l.linearVelocity,n,A),l.angularVelocity+=r*C}function fc(t,e,o){let n=t.invMassA,s=t.invMassB,r=t.invIA,i=t.invIB,c=new kt,a=t.prismaticJoint,l=a.indexA===I?c:e.states[a.indexA],d=a.indexB===I?c:e.states[a.indexB],p=l.linearVelocity,u=l.angularVelocity,b=d.linearVelocity,h=d.angularVelocity,m=K(l.deltaRotation,a.anchorA),f=K(d.deltaRotation,a.anchorB),y=O(O(J(d.deltaPosition,l.deltaPosition),a.deltaCenter),J(f,m)),x=K(l.deltaRotation,a.axisA),w=F(x,y),g=z(O(y,m),x),S=z(f,x);if(a.enableSpring){let A=w,_=a.springSoftness.biasRate*A,C=a.springSoftness.massScale,D=a.springSoftness.impulseScale,v=F(x,J(b,p))+S*h-g*u,k=-C*a.axialMass*(v+_)-D*a.springImpulse;a.springImpulse+=k;let P=it(k,x),G=k*g,E=k*S;p=It(p,n,P),u-=r*G,b=$(b,s,P),h+=i*E}if(a.enableMotor){let A=F(x,J(b,p))+S*h-g*u,_=a.axialMass*(a.motorSpeed-A),C=a.motorImpulse,D=e.h*a.maxMotorForce;a.motorImpulse=mt(a.motorImpulse+_,-D,D),_=a.motorImpulse-C;let v=it(_,x),k=_*g,P=_*S;p=It(p,n,v),u-=r*k,b=$(b,s,v),h+=i*P}if(a.enableLimit){{let A=w-a.lowerTranslation,_=0,C=1,D=0;A>0?_=A*e.inv_h:o&&(_=e.jointSoftness.biasRate*A,C=e.jointSoftness.massScale,D=e.jointSoftness.impulseScale);let v=a.lowerImpulse,k=F(x,J(b,p))+S*h-g*u,P=-a.axialMass*C*(k+_)-D*v;a.lowerImpulse=Math.max(v+P,0),P=a.lowerImpulse-v;let G=it(P,x),E=P*g,X=P*S;p=It(p,n,G),u-=r*E,b=$(b,s,G),h+=i*X}{let A=a.upperTranslation-w,_=0,C=1,D=0;A>0?_=A*e.inv_h:o&&(_=e.jointSoftness.biasRate*A,C=e.jointSoftness.massScale,D=e.jointSoftness.impulseScale);let v=a.upperImpulse,k=F(x,J(p,b))+g*u-S*h,P=-a.axialMass*C*(k+_)-D*v;a.upperImpulse=Math.max(v+P,0),P=a.upperImpulse-v;let G=it(P,x),E=P*g,X=P*S;p=$(p,n,G),u+=r*E,b=It(b,s,G),h-=i*X}}{let A=pe(x),_=z(O(y,m),A),C=z(f,A),D=new B(F(A,J(b,p))+C*h-_*u,h-u),v=new B,k=1,P=0;if(o){let nt=new B(F(A,y),ae(d.deltaRotation,l.deltaRotation)+a.deltaAngle);v=it(e.jointSoftness.biasRate,nt),k=e.jointSoftness.massScale,P=e.jointSoftness.impulseScale}let G=n+s+r*_*_+i*C*C,E=r*_+i*C,X=r+i;X===0&&(X=1);let L=new ro(new B(G,E),new B(E,X)),W=mn(L,O(D,v)),tt=new B(-k*W.x-P*a.impulse.x,-k*W.y-P*a.impulse.y);a.impulse.x+=tt.x,a.impulse.y+=tt.y;let st=it(tt.x,A),ot=tt.x*_+tt.y,j=tt.x*C+tt.y;p=It(p,n,st),u-=r*ot,b=$(b,s,st),h+=i*j}l.linearVelocity=p,l.angularVelocity=u,d.linearVelocity=b,d.angularVelocity=h}function xc(t,e,o,n){let s=e.prismaticJoint,r=H(o,e.localOriginAnchorA),i=H(n,e.localOriginAnchorB),c=K(o.q,s.localAxisA),a=V.b2_colorGray7,l=V.b2_colorGreen,d=V.b2_colorRed,p=V.b2_colorBlue,u=V.b2_colorGray4;if(t.DrawSegment(r,i,u,t.context),s.enableLimit){let b=$(r,s.lowerTranslation,c),h=$(r,s.upperTranslation,c),m=pe(c);t.DrawSegment(b,h,a,t.context),t.DrawSegment(It(b,.1,m),$(b,.1,m),l,t.context),t.DrawSegment(It(h,.1,m),$(h,.1,m),d,t.context)}else t.DrawSegment(It(r,1,c),$(r,1,c),a,t.context);t.DrawPoint(r.x,r.y,5,a,t.context),t.DrawPoint(i.x,i.y,5,p,t.context)}function np(t,e){let o=q(t,T.b2_revoluteJoint);e!==o.revoluteJoint.enableSpring&&(o.revoluteJoint.enableSpring=e,o.revoluteJoint.springImpulse=0)}function sp(t){return q(t,T.b2_revoluteJoint).revoluteJoint.enableSpring}function rp(t,e){let o=q(t,T.b2_revoluteJoint);o.revoluteJoint.hertz=e}function ip(t){return q(t,T.b2_revoluteJoint).revoluteJoint.hertz}function ap(t,e){let o=q(t,T.b2_revoluteJoint);o.revoluteJoint.dampingRatio=e}function cp(t){return q(t,T.b2_revoluteJoint).revoluteJoint.dampingRatio}function lp(t){let e=U(t.world0),o=q(t,T.b2_revoluteJoint),n=ue(e,o.bodyIdA),s=ue(e,o.bodyIdB),r=ae(s.q,n.q)-o.revoluteJoint.referenceAngle;return r=Fo(r),r}function dp(t,e){let o=q(t,T.b2_revoluteJoint);e!==o.revoluteJoint.enableLimit&&(o.revoluteJoint.enableLimit=e,o.revoluteJoint.lowerImpulse=0,o.revoluteJoint.upperImpulse=0)}function up(t){return q(t,T.b2_revoluteJoint).revoluteJoint.enableLimit}function pp(t){return q(t,T.b2_revoluteJoint).revoluteJoint.lowerAngle}function bp(t){return q(t,T.b2_revoluteJoint).revoluteJoint.upperAngle}function hp(t,e,o){let n=q(t,T.b2_revoluteJoint);(e!==n.revoluteJoint.lowerAngle||o!==n.revoluteJoint.upperAngle)&&(n.revoluteJoint.lowerAngle=Math.min(e,o),n.revoluteJoint.upperAngle=Math.max(e,o),n.revoluteJoint.lowerImpulse=0,n.revoluteJoint.upperImpulse=0)}function mp(t,e){let o=q(t,T.b2_revoluteJoint);e!==o.revoluteJoint.enableMotor&&(o.revoluteJoint.enableMotor=e,o.revoluteJoint.motorImpulse=0)}function yp(t){return q(t,T.b2_revoluteJoint).revoluteJoint.enableMotor}function fp(t,e){let o=q(t,T.b2_revoluteJoint);o.revoluteJoint.motorSpeed=e}function xp(t){return q(t,T.b2_revoluteJoint).revoluteJoint.motorSpeed}function Ip(t){let e=U(t.world0),o=q(t,T.b2_revoluteJoint);return e.inv_h*o.revoluteJoint.motorImpulse}function Sp(t,e){let o=q(t,T.b2_revoluteJoint);o.revoluteJoint.maxMotorTorque=e}function gp(t){return q(t,T.b2_revoluteJoint).revoluteJoint.maxMotorTorque}function Ic(t,e){return it(t.inv_h,e.revoluteJoint.linearImpulse)}function Sc(t,e){let o=e.revoluteJoint;return t.inv_h*(o.motorImpulse+o.lowerImpulse-o.upperImpulse)}function gc(t,e){let o=t.bodyIdA,n=t.bodyIdB,s=e.world,r=s.bodyArray,i=r[o],c=r[n],a=s.solverSetArray[i.setIndex],l=s.solverSetArray[c.setIndex],d=i.localIndex,p=c.localIndex,u=a.sims.data[i.localIndex],b=l.sims.data[c.localIndex],h=u.invMass,m=u.invInertia,f=b.invMass,y=b.invInertia;t.invMassA=h,t.invMassB=f,t.invIA=m,t.invIB=y;let x=t.revoluteJoint;x.indexA=i.setIndex===M.b2_awakeSet?d:I,x.indexB=c.setIndex===M.b2_awakeSet?p:I,x.anchorA=K(u.transform.q,J(t.localOriginAnchorA,u.localCenter)),x.anchorB=K(b.transform.q,J(t.localOriginAnchorB,b.localCenter)),x.deltaCenter=J(b.center,u.center),x.deltaAngle=ae(b.transform.q,u.transform.q)-x.referenceAngle,x.deltaAngle=Fo(x.deltaAngle);let w=m+y;x.axialMass=w>0?1/w:0,x.springSoftness=ie(x.hertz,x.dampingRatio,e.h),e.enableWarmStarting===!1&&(x.linearImpulse=new B(0,0),x.springImpulse=0,x.motorImpulse=0,x.lowerImpulse=0,x.upperImpulse=0)}function _c(t,e){let o=t.invMassA,n=t.invMassB,s=t.invIA,r=t.invIB,i=new kt,c=t.revoluteJoint,a=c.indexA===I?i:e.states[c.indexA],l=c.indexB===I?i:e.states[c.indexB],d=K(a.deltaRotation,c.anchorA),p=K(l.deltaRotation,c.anchorB),u=c.springImpulse+c.motorImpulse+c.lowerImpulse-c.upperImpulse;a.linearVelocity=It(a.linearVelocity,o,c.linearImpulse),a.angularVelocity-=s*(z(d,c.linearImpulse)+u),l.linearVelocity=$(l.linearVelocity,n,c.linearImpulse),l.angularVelocity+=r*(z(p,c.linearImpulse)+u)}function Bc(t,e,o){let n=t.invMassA,s=t.invMassB,r=t.invIA,i=t.invIB,c=new kt,a=t.revoluteJoint,l=a.indexA===I?c:e.states[a.indexA],d=a.indexB===I?c:e.states[a.indexB],p=l.linearVelocity.clone(),u=l.angularVelocity,b=d.linearVelocity.clone(),h=d.angularVelocity,m=r+i===0;if(a.enableSpring&&m===!1){let f=ae(d.deltaRotation,l.deltaRotation)+a.deltaAngle,y=a.springSoftness.biasRate*f,x=a.springSoftness.massScale,w=a.springSoftness.impulseScale,g=h-u,S=-x*a.axialMass*(g+y)-w*a.springImpulse;a.springImpulse+=S,u-=r*S,h+=i*S}if(a.enableMotor&&m===!1){let f=h-u-a.motorSpeed,y=-a.axialMass*f,x=a.motorImpulse,w=e.h*a.maxMotorTorque;a.motorImpulse=mt(a.motorImpulse+y,-w,w),y=a.motorImpulse-x,u-=r*y,h+=i*y}if(a.enableLimit&&m===!1){let f=ae(d.deltaRotation,l.deltaRotation)+a.deltaAngle;f=Fo(f);{let y=f-a.lowerAngle,x=0,w=1,g=0;y>0?x=y*e.inv_h:o&&(x=e.jointSoftness.biasRate*y,w=e.jointSoftness.massScale,g=e.jointSoftness.impulseScale);let S=h-u,A=-w*a.axialMass*(S+x)-g*a.lowerImpulse,_=a.lowerImpulse;a.lowerImpulse=Math.max(a.lowerImpulse+A,0),A=a.lowerImpulse-_,u-=r*A,h+=i*A}{let y=a.upperAngle-f,x=0,w=1,g=0;y>0?x=y*e.inv_h:o&&(x=e.jointSoftness.biasRate*y,w=e.jointSoftness.massScale,g=e.jointSoftness.impulseScale);let S=u-h,A=-w*a.axialMass*(S+x)-g*a.lowerImpulse,_=a.upperImpulse;a.upperImpulse=Math.max(a.upperImpulse+A,0),A=a.upperImpulse-_,u+=r*A,h-=i*A}}{let f=K(l.deltaRotation,a.anchorA),y=K(d.deltaRotation,a.anchorB),x=J(O(b,Gt(h,y)),O(p,Gt(u,f))),w=new B(0,0),g=1,S=0;if(o){let D=l.deltaPosition,v=d.deltaPosition,k=O(O(J(v,D),J(y,f)),a.deltaCenter);w=it(e.jointSoftness.biasRate,k),g=e.jointSoftness.massScale,S=e.jointSoftness.impulseScale}let A={cx:new B(0,0),cy:new B(0,0)};A.cx.x=n+s+f.y*f.y*r+y.y*y.y*i,A.cy.x=-f.y*f.x*r-y.y*y.x*i,A.cx.y=A.cy.x,A.cy.y=n+s+f.x*f.x*r+y.x*y.x*i;let _=mn(A,O(x,w)),C=new B(-g*_.x-S*a.linearImpulse.x,-g*_.y-S*a.linearImpulse.y);a.linearImpulse.x+=C.x,a.linearImpulse.y+=C.y,p=It(p,n,C),u-=r*z(f,C),b=$(b,s,C),h+=i*z(y,C)}l.linearVelocity=p,l.angularVelocity=u,d.linearVelocity=b,d.angularVelocity=h}function Ac(t,e,o,n,s){let r=H(o,e.localOriginAnchorA),i=H(n,e.localOriginAnchorB),c=V.b2_colorRed,a=s;t.DrawCircle(i,a,c,t.context);let l=ae(n.q,o.q),d=new B(a*Math.cos(l),a*Math.sin(l)),p=O(i,d);t.DrawSegment(i,p,c,t.context);let u=V.b2_colorGold;t.DrawSegment(o.p,r,u,t.context),t.DrawSegment(r,i,u,t.context),t.DrawSegment(n.p,i,u,t.context)}function _p(t,e){let o=q(t,T.b2_wheelJoint);e!==o.wheelJoint.enableSpring&&(o.wheelJoint.enableSpring=e,o.wheelJoint.springImpulse=0)}function Bp(t){return q(t,T.b2_wheelJoint).wheelJoint.enableSpring}function Ap(t,e){let o=q(t,T.b2_wheelJoint);o.wheelJoint.hertz=e}function wp(t){return q(t,T.b2_wheelJoint).wheelJoint.hertz}function Cp(t,e){let o=q(t,T.b2_wheelJoint);o.wheelJoint.dampingRatio=e}function vp(t){return q(t,T.b2_wheelJoint).wheelJoint.dampingRatio}function Jp(t,e){let o=q(t,T.b2_wheelJoint);o.wheelJoint.enableLimit!==e&&(o.wheelJoint.lowerImpulse=0,o.wheelJoint.upperImpulse=0,o.wheelJoint.enableLimit=e)}function Mp(t){return q(t,T.b2_wheelJoint).wheelJoint.enableLimit}function Dp(t){return q(t,T.b2_wheelJoint).wheelJoint.lowerTranslation}function kp(t){return q(t,T.b2_wheelJoint).wheelJoint.upperTranslation}function Pp(t,e,o){let n=q(t,T.b2_wheelJoint);(e!==n.wheelJoint.lowerTranslation||o!==n.wheelJoint.upperTranslation)&&(n.wheelJoint.lowerTranslation=Math.min(e,o),n.wheelJoint.upperTranslation=Math.max(e,o),n.wheelJoint.lowerImpulse=0,n.wheelJoint.upperImpulse=0)}function Tp(t,e){let o=q(t,T.b2_wheelJoint);o.wheelJoint.enableMotor!==e&&(o.wheelJoint.motorImpulse=0,o.wheelJoint.enableMotor=e)}function Gp(t){return q(t,T.b2_wheelJoint).wheelJoint.enableMotor}function Rp(t,e){let o=q(t,T.b2_wheelJoint);o.wheelJoint.motorSpeed=e}function Lp(t){return q(t,T.b2_wheelJoint).wheelJoint.motorSpeed}function Ep(t){let e=U(t.world0),o=q(t,T.b2_wheelJoint);return e.inv_h*o.wheelJoint.motorImpulse}function jp(t,e){let o=q(t,T.b2_wheelJoint);o.wheelJoint.maxMotorTorque=e}function Xp(t){return q(t,T.b2_wheelJoint).wheelJoint.maxMotorTorque}function wc(t,e){let o=e.wheelJoint,n=o.axisA,s=pe(n),r=t.inv_h*o.perpImpulse,i=t.inv_h*(o.springImpulse+o.lowerImpulse-o.upperImpulse);return O(it(r,s),it(i,n))}function Cc(t,e){return t.inv_h*e.wheelJoint.motorImpulse}function vc(t,e){let o=t.bodyIdA,n=t.bodyIdB,s=e.world,r=s.bodyArray,i=r[o],c=r[n],a=s.solverSetArray[i.setIndex],l=s.solverSetArray[c.setIndex],d=i.localIndex,p=c.localIndex,u=a.sims.data[i.localIndex],b=l.sims.data[c.localIndex],h=u.invMass,m=u.invInertia,f=b.invMass,y=b.invInertia;t.invMassA=h,t.invMassB=f,t.invIA=m,t.invIB=y;let x=t.wheelJoint;x.indexA=i.setIndex==M.b2_awakeSet?d:I,x.indexB=c.setIndex==M.b2_awakeSet?p:I;let w=u.transform.q,g=b.transform.q;x.anchorA=K(w,J(t.localOriginAnchorA,u.localCenter)),x.anchorB=K(g,J(t.localOriginAnchorB,b.localCenter)),x.axisA=K(w,x.localAxisA),x.deltaCenter=J(b.center,u.center);let S=x.anchorA,A=x.anchorB,_=O(x.deltaCenter,J(A,S)),C=x.axisA,D=pe(C),v=z(O(_,S),D),k=z(A,D),P=h+f+m*v*v+y*k*k;x.perpMass=P>0?1/P:0;let G=z(O(_,S),C),E=z(A,C),X=h+f+m*G*G+y*E*E;x.axialMass=X>0?1/X:0,x.springSoftness=ie(x.hertz,x.dampingRatio,e.h);let L=m+y;x.motorMass=L>0?1/L:0,e.enableWarmStarting==!1&&(x.perpImpulse=0,x.springImpulse=0,x.motorImpulse=0,x.lowerImpulse=0,x.upperImpulse=0)}function Jc(t,e){let o=t.invMassA,n=t.invMassB,s=t.invIA,r=t.invIB,i=new kt,c=t.wheelJoint,a=c.indexA==I?i:e.states[c.indexA],l=c.indexB==I?i:e.states[c.indexB],d=K(a.deltaRotation,c.anchorA),p=K(l.deltaRotation,c.anchorB),u=O(O(J(l.deltaPosition,a.deltaPosition),c.deltaCenter),J(p,d)),b=K(a.deltaRotation,c.axisA),h=pe(b),m=z(O(u,d),b),f=z(p,b),y=z(O(u,d),h),x=z(p,h),w=c.springImpulse+c.lowerImpulse-c.upperImpulse,g=O(it(w,b),it(c.perpImpulse,h)),S=w*m+c.perpImpulse*y+c.motorImpulse,A=w*f+c.perpImpulse*x+c.motorImpulse;a.linearVelocity=It(a.linearVelocity,o,g),a.angularVelocity-=s*S,l.linearVelocity=$(l.linearVelocity,n,g),l.angularVelocity+=r*A}function Mc(t,e,o){let n=t.invMassA,s=t.invMassB,r=t.invIA,i=t.invIB,c=new kt,a=t.wheelJoint,l=a.indexA===I?c:e.states[a.indexA],d=a.indexB===I?c:e.states[a.indexB],p=l.linearVelocity,u=l.angularVelocity,b=d.linearVelocity,h=d.angularVelocity,m=r+i===0,f=K(l.deltaRotation,a.anchorA),y=K(d.deltaRotation,a.anchorB),x=O(O(J(d.deltaPosition,l.deltaPosition),a.deltaCenter),J(y,f)),w=K(l.deltaRotation,a.axisA),g=F(w,x),S=z(O(x,f),w),A=z(y,w);if(a.enableMotor&&m===!1){let _=h-u-a.motorSpeed,C=-a.motorMass*_,D=a.motorImpulse,v=e.h*a.maxMotorTorque;a.motorImpulse=mt(a.motorImpulse+C,-v,v),C=a.motorImpulse-D,u-=r*C,h+=i*C}if(a.enableSpring){let _=g,C=a.springSoftness.biasRate*_,D=a.springSoftness.massScale,v=a.springSoftness.impulseScale,k=F(w,J(b,p))+A*h-S*u,P=-D*a.axialMass*(k+C)-v*a.springImpulse;a.springImpulse+=P;let G=it(P,w),E=P*S,X=P*A;p=It(p,n,G),u-=r*E,b=$(b,s,G),h+=i*X}if(a.enableLimit){let _=F(w,x);{let C=_-a.lowerTranslation,D=0,v=1,k=0;C>0?D=C*e.inv_h:o&&(D=e.jointSoftness.biasRate*C,v=e.jointSoftness.massScale,k=e.jointSoftness.impulseScale);let P=F(w,J(b,p))+A*h-S*u,G=-v*a.axialMass*(P+D)-k*a.lowerImpulse,E=a.lowerImpulse;a.lowerImpulse=Math.max(E+G,0),G=a.lowerImpulse-E;let X=it(G,w),L=G*S,W=G*A;p=It(p,n,X),u-=r*L,b=$(b,s,X),h+=i*W}{let C=a.upperTranslation-_,D=0,v=1,k=0;C>0?D=C*e.inv_h:o&&(D=e.jointSoftness.biasRate*C,v=e.jointSoftness.massScale,k=e.jointSoftness.impulseScale);let P=F(w,J(p,b))+S*u-A*h,G=-v*a.axialMass*(P+D)-k*a.upperImpulse,E=a.upperImpulse;a.upperImpulse=Math.max(E+G,0),G=a.upperImpulse-E;let X=it(G,w),L=G*S,W=G*A;p=$(p,n,X),u+=r*L,b=It(b,s,X),h-=i*W}}{let _=pe(w),C=0,D=1,v=0;if(o){let tt=F(_,x);C=e.jointSoftness.biasRate*tt,D=e.jointSoftness.massScale,v=e.jointSoftness.impulseScale}let k=z(O(x,f),_),P=z(y,_),G=F(_,J(b,p))+P*h-k*u,E=-D*a.perpMass*(G+C)-v*a.perpImpulse;a.perpImpulse+=E;let X=it(E,_),L=E*k,W=E*P;p=It(p,n,X),u-=r*L,b=$(b,s,X),h+=i*W}l.linearVelocity=p,l.angularVelocity=u,d.linearVelocity=b,d.angularVelocity=h}function Dc(t,e,o,n){let s=e.wheelJoint,r=H(o,e.localOriginAnchorA),i=H(n,e.localOriginAnchorB),c=K(o.q,s.localAxisA),a=V.b2_colorGray7,l=V.b2_colorGreen,d=V.b2_colorRed,p=V.b2_colorGray4,u=V.b2_colorBlue;if(t.DrawSegment(r,i,u,t.context),s.enableLimit){let b=$(r,s.lowerTranslation,c),h=$(r,s.upperTranslation,c),m=pe(c);t.DrawSegment(b,h,a,t.context),t.DrawSegment(It(b,.1,m),$(b,.1,m),l,t.context),t.DrawSegment(It(h,.1,m),$(h,.1,m),d,t.context)}else t.DrawSegment(It(r,1,c),$(r,1,c),a,t.context);t.DrawPoint(r.x,r.y,5,a,t.context),t.DrawPoint(i.x,i.y,5,p,t.context)}function Fp(t,e){let o=q(t,T.b2_motorJoint);o.motorJoint.linearOffset=e}function qp(t){return q(t,T.b2_motorJoint).motorJoint.linearOffset}function Vp(t,e){let o=q(t,T.b2_motorJoint);o.motorJoint.angularOffset=mt(e,-Bo,Bo)}function Yp(t){return q(t,T.b2_motorJoint).motorJoint.angularOffset}function Np(t,e){let o=q(t,T.b2_motorJoint);o.motorJoint.maxForce=Math.max(0,e)}function Wp(t){return q(t,T.b2_motorJoint).motorJoint.maxForce}function Op(t,e){let o=q(t,T.b2_motorJoint);o.motorJoint.maxTorque=Math.max(0,e)}function Up(t){return q(t,T.b2_motorJoint).motorJoint.maxTorque}function zp(t,e){let o=q(t,T.b2_motorJoint);o.motorJoint.correctionFactor=mt(e,0,1)}function Kp(t){return q(t,T.b2_motorJoint).motorJoint.correctionFactor}function kc(t,e){return it(t.inv_h,e.motorJoint.linearImpulse)}function Pc(t,e){return t.inv_h*e.motorJoint.angularImpulse}function Tc(t,e){let o=t.bodyIdA,n=t.bodyIdB,s=e.world,r=s.bodyArray,i=r[o],c=r[n],a=s.solverSetArray[i.setIndex],l=s.solverSetArray[c.setIndex],d=i.localIndex,p=c.localIndex,u=a.sims.data[i.localIndex],b=l.sims.data[c.localIndex],h=u.invMass,m=u.invInertia,f=b.invMass,y=b.invInertia;t.invMassA=h,t.invMassB=f,t.invIA=m,t.invIB=y;let x=t.motorJoint;x.indexA=i.setIndex==M.b2_awakeSet?d:I,x.indexB=c.setIndex==M.b2_awakeSet?p:I,x.anchorA=K(u.transform.q,J(t.localOriginAnchorA,u.localCenter)),x.anchorB=K(b.transform.q,J(t.localOriginAnchorB,b.localCenter)),x.deltaCenter=J(J(b.center,u.center),x.linearOffset),x.deltaAngle=ae(b.transform.q,u.transform.q)-x.angularOffset,x.deltaAngle=Fo(x.deltaAngle);let w=x.anchorA,g=x.anchorB,S={cx:new B(0,0),cy:new B(0,0)};S.cx.x=h+f+w.y*w.y*m+g.y*g.y*y,S.cx.y=-w.y*w.x*m-g.y*g.x*y,S.cy.x=S.cx.y,S.cy.y=h+f+w.x*w.x*m+g.x*g.x*y,x.linearMass=Ms(S);let A=m+y;x.angularMass=A>0?1/A:0,e.enableWarmStarting==!1&&(x.linearImpulse=new B(0,0),x.angularImpulse=0)}function Gc(t,e){let o=t.invMassA,n=t.invMassB,s=t.invIA,r=t.invIB,i=t.motorJoint,c=new kt,a=i.indexA==I?c:e.states[i.indexA],l=i.indexB==I?c:e.states[i.indexB],d=K(a.deltaRotation,i.anchorA),p=K(l.deltaRotation,i.anchorB);a.linearVelocity=It(a.linearVelocity,o,i.linearImpulse),a.angularVelocity-=s*(z(d,i.linearImpulse)+i.angularImpulse),l.linearVelocity=$(l.linearVelocity,n,i.linearImpulse),l.angularVelocity+=r*(z(p,i.linearImpulse)+i.angularImpulse)}function Rc(t,e,o){let n=t.invMassA,s=t.invMassB,r=t.invIA,i=t.invIB,c=new kt,a=t.motorJoint,l=a.indexA==I?c:e.states[a.indexA],d=a.indexB==I?c:e.states[a.indexB],p=l.linearVelocity,u=l.angularVelocity,b=d.linearVelocity,h=d.angularVelocity;{let m=ae(d.deltaRotation,l.deltaRotation)+a.deltaAngle;m=Fo(m);let f=e.inv_h*a.correctionFactor*m,y=h-u,x=-a.angularMass*(y+f),w=a.angularImpulse,g=e.h*a.maxTorque;a.angularImpulse=mt(a.angularImpulse+x,-g,g),x=a.angularImpulse-w,u-=r*x,h+=i*x}{let m=K(l.deltaRotation,a.anchorA),f=K(d.deltaRotation,a.anchorB),y=O(J(d.deltaPosition,l.deltaPosition),J(f,m)),x=O(a.deltaCenter,y),w=it(e.inv_h*a.correctionFactor,x),g=J(O(b,Gt(h,f)),O(p,Gt(u,m))),S=Js(a.linearMass,O(g,w)),A=new B(-S.x,-S.y),_=a.linearImpulse,C=e.h*a.maxForce;a.linearImpulse=O(a.linearImpulse,A),he(a.linearImpulse)>C*C&&(a.linearImpulse=dt(a.linearImpulse),a.linearImpulse.x*=C,a.linearImpulse.y*=C),A=J(a.linearImpulse,_),p=It(p,n,A),u-=r*z(m,A),b=$(b,s,A),h+=i*z(f,A)}l.linearVelocity=p,l.angularVelocity=u,d.linearVelocity=b,d.angularVelocity=h}function Hp(t,e){Pi(t);let o=q(t,T.b2_mouseJoint);o.mouseJoint.targetA=e.clone()}function $p(t){return q(t,T.b2_mouseJoint).mouseJoint.targetA}function Qp(t,e){let o=q(t,T.b2_mouseJoint);o.mouseJoint.hertz=e}function Zp(t){return q(t,T.b2_mouseJoint).mouseJoint.hertz}function tb(t,e){let o=q(t,T.b2_mouseJoint);o.mouseJoint.dampingRatio=e}function eb(t){return q(t,T.b2_mouseJoint).mouseJoint.dampingRatio}function ob(t,e){let o=q(t,T.b2_mouseJoint);o.mouseJoint.maxForce=e}function nb(t){return q(t,T.b2_mouseJoint).mouseJoint.maxForce}function Lc(t,e){return it(t.inv_h,e.mouseJoint.linearImpulse)}function Ec(t,e){return t.inv_h*e.mouseJoint.angularImpulse}function jc(t,e){let o=t.bodyIdB,n=e.world,r=n.bodyArray[o];r.setIndex,M.b2_awakeSet;let i=n.solverSetArray[r.setIndex],c=r.localIndex,a=i.sims.data[c];t.invMassB=a.invMass,t.invIB=a.invInertia;let l=t.mouseJoint;l.indexB=r.setIndex===M.b2_awakeSet?c:I,l.anchorB=K(a.transform.q,J(t.localOriginAnchorB,a.localCenter)),l.linearSoftness=ie(l.hertz,l.dampingRatio,e.h);let d=.5,p=.1;l.angularSoftness=ie(d,p,e.h);let u=l.anchorB,b=a.invMass,h=a.invInertia,m={cx:new B(b+h*u.y*u.y,-h*u.x*u.y),cy:new B(-h*u.x*u.y,b+h*u.x*u.x)};l.linearMass=Ms(m),l.deltaCenter=J(a.center,l.targetA),e.enableWarmStarting===!1&&(l.linearImpulse=new B(0,0),l.angularImpulse=0)}function Xc(t,e){t.type,T.b2_mouseJoint;let o=t.invMassB,n=t.invIB,s=t.mouseJoint,r=e.states[s.indexB],i=r.linearVelocity.clone(),c=r.angularVelocity,a=r.deltaRotation,l=K(a,s.anchorB);i=$(i,o,s.linearImpulse),c+=n*(z(l,s.linearImpulse)+s.angularImpulse),r.linearVelocity=i,r.angularVelocity=c}function Fc(t,e){let o=t.invMassB,n=t.invIB,s=t.mouseJoint,r=e.states[s.indexB],i=r.linearVelocity.clone(),c=r.angularVelocity;{let l=s.angularSoftness.massScale,d=s.angularSoftness.impulseScale,p=n>0?-c/n:0;p=l*p-d*s.angularImpulse,s.angularImpulse+=p,c+=n*p}let a=s.maxForce*e.h;{let l=r.deltaRotation,d=K(l,s.anchorB),p=O(i,Gt(c,d)),u=O(O(r.deltaPosition,d),s.deltaCenter),b=it(s.linearSoftness.biasRate,u),h=s.linearSoftness.massScale,m=s.linearSoftness.impulseScale,f=Js(s.linearMass,O(p,b)),y=new B(-h*f.x-m*s.linearImpulse.x,-h*f.y-m*s.linearImpulse.y),x=s.linearImpulse.clone();s.linearImpulse.x+=y.x,s.linearImpulse.y+=y.y,Ut(s.linearImpulse)>a&&(s.linearImpulse=it(a,dt(s.linearImpulse))),y.x=s.linearImpulse.x-x.x,y.y=s.linearImpulse.y-x.y,i=$(i,o,y),c+=n*z(d,y)}r.linearVelocity=i,r.angularVelocity=c}function sb(t,e){if(!(le(e)&&e>=0))throw new Error("Invalid hertz value");let o=q(t,T.b2_weldJoint);o.weldJoint.linearHertz=e}function rb(t){return q(t,T.b2_weldJoint).weldJoint.linearHertz}function ib(t,e){if(!(le(e)&&e>=0))throw new Error("Invalid dampingRatio value");let o=q(t,T.b2_weldJoint);o.weldJoint.linearDampingRatio=e}function ab(t){return q(t,T.b2_weldJoint).weldJoint.linearDampingRatio}function cb(t,e){if(!(le(e)&&e>=0))throw new Error("Invalid hertz value");let o=q(t,T.b2_weldJoint);o.weldJoint.angularHertz=e}function lb(t){return q(t,T.b2_weldJoint).weldJoint.angularHertz}function db(t,e){if(!(le(e)&&e>=0))throw new Error("Invalid dampingRatio value");let o=q(t,T.b2_weldJoint);o.weldJoint.angularDampingRatio=e}function ub(t){return q(t,T.b2_weldJoint).weldJoint.angularDampingRatio}function qc(t,e){return it(t.inv_h,e.weldJoint.linearImpulse)}function Vc(t,e){return t.inv_h*e.weldJoint.angularImpulse}function Yc(t,e){if(t.type!==T.b2_weldJoint)throw new Error("Invalid joint type");let o=t.bodyIdA,n=t.bodyIdB,s=e.world,r=s.bodyArray,i=r[o],c=r[n];if(!(i.setIndex===M.b2_awakeSet||c.setIndex===M.b2_awakeSet))throw new Error("At least one body must be awake");let a=s.solverSetArray[i.setIndex],l=s.solverSetArray[c.setIndex],d=i.localIndex,p=c.localIndex;if(!(0<=d&&d<=a.sims.count))throw new Error("Invalid localIndexA");if(!(0<=p&&p<=l.sims.count))throw new Error("Invalid localIndexB");let u=a.sims.data[i.localIndex],b=l.sims.data[c.localIndex],h=u.invMass,m=u.invInertia,f=b.invMass,y=b.invInertia;t.invMassA=h,t.invMassB=f,t.invIA=m,t.invIB=y;let x=t.weldJoint;x.indexA=i.setIndex===M.b2_awakeSet?d:I,x.indexB=c.setIndex===M.b2_awakeSet?p:I;let w=u.transform.q,g=b.transform.q;x.anchorA=K(w,J(t.localOriginAnchorA,u.localCenter)),x.anchorB=K(g,J(t.localOriginAnchorB,b.localCenter)),x.deltaCenter=J(b.center,u.center),x.deltaAngle=ae(g,w)-x.referenceAngle;let S=m+y;x.axialMass=S>0?1/S:0,x.linearHertz===0?x.linearSoftness=e.jointSoftness:x.linearSoftness=ie(x.linearHertz,x.linearDampingRatio,e.h),x.angularHertz===0?x.angularSoftness=e.jointSoftness:x.angularSoftness=ie(x.angularHertz,x.angularDampingRatio,e.h),e.enableWarmStarting===!1&&(x.linearImpulse=new B(0,0),x.angularImpulse=0)}function Nc(t,e){let o=t.invMassA,n=t.invMassB,s=t.invIA,r=t.invIB,i=new kt,c=t.weldJoint,a=c.indexA===I?i:e.states[c.indexA],l=c.indexB===I?i:e.states[c.indexB],d=K(a.deltaRotation,c.anchorA),p=K(l.deltaRotation,c.anchorB);a.linearVelocity=It(a.linearVelocity,o,c.linearImpulse),a.angularVelocity-=s*(z(d,c.linearImpulse)+c.angularImpulse),l.linearVelocity=$(l.linearVelocity,n,c.linearImpulse),l.angularVelocity+=r*(z(p,c.linearImpulse)+c.angularImpulse)}function Wc(t,e,o){if(t.type!==T.b2_weldJoint)throw new Error("Invalid joint type");let n=t.invMassA,s=t.invMassB,r=t.invIA,i=t.invIB,c=new kt,a=t.weldJoint,l=a.indexA===I?c:e.states[a.indexA],d=a.indexB===I?c:e.states[a.indexB],p=l.linearVelocity,u=l.angularVelocity,b=d.linearVelocity,h=d.angularVelocity;{let m=0,f=1,y=0;if(o||a.angularHertz>0){let g=ae(d.deltaRotation,l.deltaRotation)+a.deltaAngle;m=a.angularSoftness.biasRate*g,f=a.angularSoftness.massScale,y=a.angularSoftness.impulseScale}let x=h-u,w=-f*a.axialMass*(x+m)-y*a.angularImpulse;a.angularImpulse+=w,u-=r*w,h+=i*w}{let m=K(l.deltaRotation,a.anchorA),f=K(d.deltaRotation,a.anchorB),y=new B(0,0),x=1,w=0;if(o||a.linearHertz>0){let C=l.deltaPosition,D=d.deltaPosition,v=O(O(J(D,C),J(f,m)),a.deltaCenter);y=it(a.linearSoftness.biasRate,v),x=a.linearSoftness.massScale,w=a.linearSoftness.impulseScale}let g=J(O(b,Gt(h,f)),O(p,Gt(u,m))),S=new ro;S.cx.x=n+s+m.y*m.y*r+f.y*f.y*i,S.cy.x=-m.y*m.x*r-f.y*f.x*i,S.cx.y=S.cy.x,S.cy.y=n+s+m.x*m.x*r+f.x*f.x*i;let A=mn(S,O(g,y)),_=new B(-x*A.x-w*a.linearImpulse.x,-x*A.y-w*a.linearImpulse.y);a.linearImpulse=O(a.linearImpulse,_),p=It(p,n,_),u-=r*z(m,_),b=$(b,s,_),h+=i*z(f,_)}l.linearVelocity=p,l.angularVelocity=u,d.linearVelocity=b,d.angularVelocity=h}function pb(){let t=new gn;return t.length=1,t.maxLength=Me,t}function bb(){let t=new _n;return t.maxForce=1,t.maxTorque=1,t.correctionFactor=.3,t}function hb(){let t=new Bn;return t.hertz=4,t.dampingRatio=1,t.maxForce=1,t}function mb(){let t=new An;return t.localAxisA=new B(1,0),t}function Ti(){let t=new Do;return t.drawSize=.25,t}function yb(){return new wn}function fb(){let t=new Cn;return t.localAxisA=new B(0,1),t.enableSpring=!0,t.hertz=1,t.dampingRatio=.7,t}function ve(t,e){let o=e.index1-1;return t.jointArray[o]}function Je(t,e){return t.jointArray[e]}function jo(t,e){if(e.setIndex===M.b2_awakeSet){let n=t.constraintGraph.colors[e.colorIndex];return e.jointId,n.joints.data[e.localIndex].jointId,n.joints.data[e.localIndex]}return t.solverSetArray[e.setIndex].joints.data[e.localIndex]}function q(t,e){let o=U(t.world0);if(o.locked)return null;let n=ve(o,t);return jo(o,n)}var Oc=class{constructor(e=null,o=null){this.joint=e,this.jointSim=o}};function qn(t,e,o,n,s,r,i){Lt(t);let c=e.id,a=o.id,l=Math.max(e.setIndex,o.setIndex),d=ne(t.jointIdPool);for(;d>=t.jointArray.length;)t.jointArray.push(new Yi);let p=t.jointArray[d];p.edges=[new Fn,new Fn],p.jointId=d,p.userData=n,p.setIndex=I,p.colorIndex=I,p.localIndex=I,p.islandId=I,p.islandPrev=I,p.islandNext=I,p.revision+=1,p.drawSize=s,p.type=r,p.isMarked=!1,p.collideConnected=i,p.edges[0].bodyId=c,p.edges[0].prevKey=I,p.edges[0].nextKey=e.headJointKey;let u=d<<1|0;if(e.headJointKey!==I){let f=t.jointArray[e.headJointKey>>1].edges[e.headJointKey&1];f.prevKey=u}e.headJointKey=u,e.jointCount+=1,p.edges[1].bodyId=a,p.edges[1].prevKey=I,p.edges[1].nextKey=o.headJointKey;let b=d<<1|1;if(o.headJointKey!==I){let f=t.jointArray[o.headJointKey>>1].edges[o.headJointKey&1];f.prevKey=b}o.headJointKey=b,o.jointCount+=1;let h;if(e.setIndex===M.b2_disabledSet||o.setIndex===M.b2_disabledSet){let m=t.solverSetArray[M.b2_disabledSet];p.setIndex=M.b2_disabledSet,p.localIndex=m.joints.length,h=Ze(m.joints),h.jointId=d,h.bodyIdA=c,h.bodyIdB=a}else if(e.setIndex===M.b2_staticSet&&o.setIndex===M.b2_staticSet){let m=t.solverSetArray[M.b2_staticSet];p.setIndex=M.b2_staticSet,p.localIndex=m.joints.length,h=Ze(m.joints),h.jointId=d,h.bodyIdA=c,h.bodyIdB=a}else if(e.setIndex===M.b2_awakeSet||o.setIndex===M.b2_awakeSet)l>=M.b2_firstSleepingSet&&Ee(t,l),p.setIndex=M.b2_awakeSet,h=xi(t,p),h.jointId=d,h.bodyIdA=c,h.bodyIdB=a;else{let m=l,f=t.solverSetArray[m];p.setIndex=m,p.localIndex=f.joints.length,h=Ze(f.joints),h.jointId=d,h.bodyIdA=c,h.bodyIdB=a,e.setIndex!==o.setIndex&&e.setIndex>=M.b2_firstSleepingSet&&o.setIndex>=M.b2_firstSleepingSet&&(Ha(t,e.setIndex,o.setIndex),m=e.setIndex,h=t.solverSetArray[m].joints[p.localIndex])}return p.setIndex>M.b2_disabledSet&&Is(t,p,!0),Lt(t),new Oc(p,h)}function Vn(t,e,o){let n,s;e.contactCount<o.contactCount?(n=e.headContactKey,s=o.id):(n=o.headContactKey,s=e.id);let r=!1;for(;n!==I;){let i=n>>1,c=n&1,a=t.contactArray[i];n=a.edges[c].nextKey;let l=c^1;a.edges[l].bodyId===s&&mo(t,a,r)}Lt(t)}function Gi(t,e){let o=ft(t);if(o.locked)return new zt;let n=Z(o,e.bodyIdA),s=Z(o,e.bodyIdB),r=qn(o,n,s,e.userData,1,T.b2_distanceJoint,e.collideConnected),i=r.jointSim;return i.type=T.b2_distanceJoint,i.localOriginAnchorA=e.localAnchorA,i.localOriginAnchorB=e.localAnchorB,i.distanceJoint=new Ni,i.distanceJoint.length=Math.max(e.length,St),i.distanceJoint.hertz=e.hertz,i.distanceJoint.dampingRatio=e.dampingRatio,i.distanceJoint.minLength=Math.max(e.minLength,St),i.distanceJoint.maxLength=Math.max(e.minLength,e.maxLength),i.distanceJoint.maxMotorForce=e.maxMotorForce,i.distanceJoint.motorSpeed=e.motorSpeed,i.distanceJoint.enableSpring=e.enableSpring,i.distanceJoint.enableLimit=e.enableLimit,i.distanceJoint.enableMotor=e.enableMotor,i.distanceJoint.impulse=0,i.distanceJoint.lowerImpulse=0,i.distanceJoint.upperImpulse=0,i.distanceJoint.motorImpulse=0,e.collideConnected===!1&&Vn(o,n,s),new zt(i.jointId+1,o.worldId,r.joint.revision)}function Ri(t,e){let o=ft(t);if(o.locked)return new zt;let n=Z(o,e.bodyIdA),s=Z(o,e.bodyIdB),r=qn(o,n,s,e.userData,1,T.b2_motorJoint,e.collideConnected),i=r.jointSim;return i.type=T.b2_motorJoint,i.localOriginAnchorA=new B(0,0),i.localOriginAnchorB=new B(0,0),i.motorJoint=new Wi,i.motorJoint.linearOffset=e.linearOffset,i.motorJoint.angularOffset=e.angularOffset,i.motorJoint.maxForce=e.maxForce,i.motorJoint.maxTorque=e.maxTorque,i.motorJoint.correctionFactor=mt(e.correctionFactor,0,1),e.collideConnected===!1&&Vn(o,n,s),new zt(i.jointId+1,o.worldId,r.joint.revision)}function Li(t,e){let o=ft(t);if(o.locked)return new zt;let n=Z(o,e.bodyIdA),s=Z(o,e.bodyIdB),r=Rt(o,n),i=Rt(o,s),c=qn(o,n,s,e.userData,1,T.b2_mouseJoint,e.collideConnected),a=c.jointSim;return a.type=T.b2_mouseJoint,a.localOriginAnchorA=qe(r,e.target),a.localOriginAnchorB=qe(i,e.target),a.mouseJoint=new Oi,a.mouseJoint.targetA=e.target,a.mouseJoint.hertz=e.hertz,a.mouseJoint.dampingRatio=e.dampingRatio,a.mouseJoint.maxForce=e.maxForce,new zt(a.jointId+1,o.worldId,c.joint.revision)}function an(t,e){let o=ft(t);if(o.locked)return new zt;let n=Z(o,e.bodyIdA),s=Z(o,e.bodyIdB),r=qn(o,n,s,e.userData,e.drawSize,T.b2_revoluteJoint,e.collideConnected),i=r.jointSim;return i.type=T.b2_revoluteJoint,i.localOriginAnchorA=e.localAnchorA,i.localOriginAnchorB=e.localAnchorB,i.revoluteJoint=new zi,i.revoluteJoint.referenceAngle=mt(e.referenceAngle,-Math.PI,Math.PI),i.revoluteJoint.linearImpulse=new B(0,0),i.revoluteJoint.axialMass=0,i.revoluteJoint.springImpulse=0,i.revoluteJoint.motorImpulse=0,i.revoluteJoint.lowerImpulse=0,i.revoluteJoint.upperImpulse=0,i.revoluteJoint.hertz=e.hertz,i.revoluteJoint.dampingRatio=e.dampingRatio,i.revoluteJoint.lowerAngle=Math.min(e.lowerAngle,e.upperAngle),i.revoluteJoint.upperAngle=Math.max(e.lowerAngle,e.upperAngle),i.revoluteJoint.lowerAngle=mt(i.revoluteJoint.lowerAngle,-Math.PI,Math.PI),i.revoluteJoint.upperAngle=mt(i.revoluteJoint.upperAngle,-Math.PI,Math.PI),i.revoluteJoint.maxMotorTorque=e.maxMotorTorque,i.revoluteJoint.motorSpeed=e.motorSpeed,i.revoluteJoint.enableSpring=e.enableSpring,i.revoluteJoint.enableLimit=e.enableLimit,i.revoluteJoint.enableMotor=e.enableMotor,e.collideConnected===!1&&Vn(o,n,s),new zt(i.jointId+1,o.worldId,r.joint.revision)}function Ei(t,e){let o=ft(t);if(o.locked)return new zt;let n=Z(o,e.bodyIdA),s=Z(o,e.bodyIdB),r=qn(o,n,s,e.userData,1,T.b2_prismaticJoint,e.collideConnected),i=r.jointSim;return i.type=T.b2_prismaticJoint,i.localOriginAnchorA=e.localAnchorA,i.localOriginAnchorB=e.localAnchorB,i.prismaticJoint=new Ui,i.prismaticJoint.localAxisA=dt(e.localAxisA),i.prismaticJoint.referenceAngle=e.referenceAngle,i.prismaticJoint.impulse=new B(0,0),i.prismaticJoint.axialMass=0,i.prismaticJoint.springImpulse=0,i.prismaticJoint.motorImpulse=0,i.prismaticJoint.lowerImpulse=0,i.prismaticJoint.upperImpulse=0,i.prismaticJoint.hertz=e.hertz,i.prismaticJoint.dampingRatio=e.dampingRatio,i.prismaticJoint.lowerTranslation=e.lowerTranslation,i.prismaticJoint.upperTranslation=e.upperTranslation,i.prismaticJoint.maxMotorForce=e.maxMotorForce,i.prismaticJoint.motorSpeed=e.motorSpeed,i.prismaticJoint.enableSpring=e.enableSpring,i.prismaticJoint.enableLimit=e.enableLimit,i.prismaticJoint.enableMotor=e.enableMotor,e.collideConnected===!1&&Vn(o,n,s),new zt(i.jointId+1,o.worldId,r.joint.revision)}function ji(t,e){let o=ft(t);if(o.locked)return new zt;let n=Z(o,e.bodyIdA),s=Z(o,e.bodyIdB),r=qn(o,n,s,e.userData,1,T.b2_weldJoint,e.collideConnected),i=r.jointSim;return i.type=T.b2_weldJoint,i.localOriginAnchorA=e.localAnchorA,i.localOriginAnchorB=e.localAnchorB,i.weldJoint=new Ki,i.weldJoint.referenceAngle=e.referenceAngle,i.weldJoint.linearHertz=e.linearHertz,i.weldJoint.linearDampingRatio=e.linearDampingRatio,i.weldJoint.angularHertz=e.angularHertz,i.weldJoint.angularDampingRatio=e.angularDampingRatio,i.weldJoint.linearImpulse=new B(0,0),i.weldJoint.angularImpulse=0,e.collideConnected===!1&&Vn(o,n,s),new zt(i.jointId+1,o.worldId,r.joint.revision)}function Xi(t,e){let o=ft(t);if(o.locked)return new zt;let n=Z(o,e.bodyIdA),s=Z(o,e.bodyIdB),r=qn(o,n,s,e.userData,1,T.b2_wheelJoint,e.collideConnected),i=r.jointSim;return i.type=T.b2_wheelJoint,i.localOriginAnchorA=e.localAnchorA,i.localOriginAnchorB=e.localAnchorB,i.wheelJoint=new Hi,i.wheelJoint.localAxisA=dt(e.localAxisA),i.wheelJoint.perpMass=0,i.wheelJoint.axialMass=0,i.wheelJoint.motorImpulse=0,i.wheelJoint.lowerImpulse=0,i.wheelJoint.upperImpulse=0,i.wheelJoint.lowerTranslation=e.lowerTranslation,i.wheelJoint.upperTranslation=e.upperTranslation,i.wheelJoint.maxMotorTorque=e.maxMotorTorque,i.wheelJoint.motorSpeed=e.motorSpeed,i.wheelJoint.hertz=e.hertz,i.wheelJoint.dampingRatio=e.dampingRatio,i.wheelJoint.enableSpring=e.enableSpring,i.wheelJoint.enableLimit=e.enableLimit,i.wheelJoint.enableMotor=e.enableMotor,e.collideConnected===!1&&Vn(o,n,s),new zt(i.jointId+1,o.worldId,r.joint.revision)}function Fi(t,e,o){let n=e.jointId,s=e.edges[0],r=e.edges[1],i=s.bodyId,c=r.bodyId,a=gt(t,i),l=gt(t,c);if(s.prevKey!==I){let m=t.jointArray[s.prevKey>>1].edges[s.prevKey&1];m.nextKey=s.nextKey}if(s.nextKey!==I){let m=t.jointArray[s.nextKey>>1].edges[s.nextKey&1];m.prevKey=s.prevKey}let d=n<<1|0;if(a.headJointKey===d&&(a.headJointKey=s.nextKey),a.jointCount-=1,r.prevKey!==I){let m=t.jointArray[r.prevKey>>1].edges[r.prevKey&1];m.nextKey=r.nextKey}if(r.nextKey!==I){let m=t.jointArray[r.nextKey>>1].edges[r.nextKey&1];m.prevKey=r.prevKey}let p=n<<1|1;l.headJointKey===p&&(l.headJointKey=r.nextKey),l.jointCount-=1,e.islandId!==I&&Ss(t,e);let u=e.setIndex,b=e.localIndex;if(u===M.b2_awakeSet)lr(t,e.edges[0].bodyId,e.edges[1].bodyId,e.colorIndex,b);else{let h=t.solverSetArray[u];if(Zo(h.joints,b)!==I){let y=h.joints.data[b].jointId,x=t.jointArray[y];x.localIndex=b}}e.setIndex=I,e.colorIndex=I,e.localIndex=I,e.jointId=I,e.type=T.b2_unknown,fe(t.jointIdPool,n),o&&(Wt(t,a),Wt(t,l)),Lt(t)}function qi(t){let e=U(t.world0);if(e.locked)return;let o=ve(e,t);Fi(e,o,!0)}function xb(t){let e=U(t.world0);return ve(e,t).type}function Ib(t){let e=U(t.world0),o=ve(e,t);return cs(e,o.edges[0].bodyId)}function Sb(t){let e=U(t.world0),o=ve(e,t);return cs(e,o.edges[1].bodyId)}function gb(t){let e=U(t.world0),o=ve(e,t);return jo(e,o).localOriginAnchorA}function _b(t){let e=U(t.world0),o=ve(e,t);return jo(e,o).localOriginAnchorB}function Bb(t,e){let o=yt(t.world0);if(o===null)return;let n=ve(o,t);if(n.collideConnected===e)return;n.collideConnected=e;let s=gt(o,n.edges[0].bodyId),r=gt(o,n.edges[1].bodyId);if(e){let i=s.shapeCount,c=r.shapeCount,a=i<c?s.headShapeId:r.headShapeId;for(;a!==I;){let l=o.shapeArray[a];l.proxyKey!==I&&rn(o.broadPhase,l.proxyKey),a=l.nextShapeId}}else Vn(o,s,r)}function Ab(t){let e=U(t.world0);return ve(e,t).collideConnected}function wb(t,e){let o=U(t.world0),n=ve(o,t);n.userData=e}function Cb(t){let e=U(t.world0);return ve(e,t).userData}function Pi(t){let e=yt(t.world0);if(e===null)return;let o=ve(e,t),n=e.bodyArray[o.edges[0].bodyId],s=e.bodyArray[o.edges[1].bodyId];Wt(e,n),Wt(e,s)}function vb(t){let e=U(t.world0),o=ve(e,t),n=jo(e,o);switch(o.type){case T.b2_distanceJoint:return cc(e,n);case T.b2_motorJoint:return kc(e,n);case T.b2_mouseJoint:return Lc(e,n);case T.b2_prismaticJoint:return bc(e,n);case T.b2_revoluteJoint:return Ic(e,n);case T.b2_weldJoint:return qc(e,n);case T.b2_wheelJoint:return wc(e,n);default:return new B(0,0)}}function Jb(t){let e=U(t.world0),o=ve(e,t),n=jo(e,o);switch(o.type){case T.b2_distanceJoint:return 0;case T.b2_motorJoint:return Pc(e,n);case T.b2_mouseJoint:return Ec(e,n);case T.b2_prismaticJoint:return hc(e,n);case T.b2_revoluteJoint:return Sc(e,n);case T.b2_weldJoint:return Vc(e,n);case T.b2_wheelJoint:return Cc(e,n);default:return 0}}function Mb(t,e){switch(t.type){case T.b2_distanceJoint:lc(t,e);break;case T.b2_motorJoint:Tc(t,e);break;case T.b2_mouseJoint:jc(t,e);break;case T.b2_prismaticJoint:mc(t,e);break;case T.b2_revoluteJoint:gc(t,e);break;case T.b2_weldJoint:Yc(t,e);break;case T.b2_wheelJoint:vc(t,e);break;default:}}function Db(t,e){switch(t.type){case T.b2_distanceJoint:dc(t,e);break;case T.b2_motorJoint:Gc(t,e);break;case T.b2_mouseJoint:Xc(t,e);break;case T.b2_prismaticJoint:yc(t,e);break;case T.b2_revoluteJoint:_c(t,e);break;case T.b2_weldJoint:Nc(t,e);break;case T.b2_wheelJoint:Jc(t,e);break;default:}}function kb(t,e,o){switch(t.type){case T.b2_distanceJoint:uc(t,e,o);break;case T.b2_motorJoint:Rc(t,e,o);break;case T.b2_mouseJoint:Fc(t,e);break;case T.b2_prismaticJoint:fc(t,e,o);break;case T.b2_revoluteJoint:Bc(t,e,o);break;case T.b2_weldJoint:Wc(t,e,o);break;case T.b2_wheelJoint:Mc(t,e,o);break;default:}}function rc(t){let e=t.graph,o=e.colors[Mt].joints.data,n=e.colors[Mt].joints.count;for(let s=0;s<n;++s){let r=o[s];Mb(r,t)}}function ic(t){let e=t.graph,o=e.colors[Mt].joints.data,n=e.colors[Mt].joints.count;for(let s=0;s<n;++s){let r=o[s];Db(r,t)}}function Di(t,e){let o=t.graph,n=o.colors[Mt].joints.data,s=o.colors[Mt].joints.count;for(let r=0;r<s;++r){let i=n[r];kb(i,t,e)}}function Vi(t,e,o){let n=gt(e,o.edges[0].bodyId),s=gt(e,o.edges[1].bodyId);if(n.setIndex===M.b2_disabledSet||s.setIndex===M.b2_disabledSet)return;let r=jo(e,o),i=Rt(e,n),c=Rt(e,s),a=H(i,r.localOriginAnchorA),l=H(c,r.localOriginAnchorB),d=V.b2_colorDarkSeaGreen;switch(o.type){case T.b2_distanceJoint:pc(t,r,i,c);break;case T.b2_mouseJoint:{let p=r.mouseJoint.targetA,u=V.b2_colorGreen;t.DrawPoint(p.x,p.y,4,u,t.context),t.DrawPoint(l.x,l.y,4,u,t.context);let b=V.b2_colorGray8;t.DrawSegment(p,l,b,t.context)}break;case T.b2_prismaticJoint:xc(t,r,i,c);break;case T.b2_revoluteJoint:Ac(t,r,i,c,o.drawSize);break;case T.b2_wheelJoint:Dc(t,r,i,c);break;default:t.DrawSegment(i.p,a,d,t.context),t.DrawSegment(a,l,d,t.context),t.DrawSegment(c.p,l,d,t.context)}if(t.drawGraphColors){let p=[V.b2_colorRed,V.b2_colorOrange,V.b2_colorYellow,V.b2_colorGreen,V.b2_colorCyan,V.b2_colorBlue,V.b2_colorViolet,V.b2_colorPink,V.b2_colorChocolate,V.b2_colorGoldenrod,V.b2_colorCoral,V.b2_colorBlack],u=o.colorIndex;if(u!==I){let b=Zt(a,l,.5);t.DrawPoint(b.x,b.y,5,p[u],t.context)}}}var Fn=class{constructor(){this.bodyId=I,this.prevKey=I,this.nextKey=I}},Yi=class{constructor(){this.userData=null,this.setIndex=I,this.colorIndex=I,this.localIndex=I,this.edges=[new Fn,new Fn],this.jointId=I,this.islandId=I,this.islandPrev=I,this.islandNext=I,this.revision=0,this.drawSize=0,this.type=T.b2_unknown,this.isMarked=!1,this.collideConnected=!1}},Ni=class t{constructor(){this.length=0,this.hertz=0,this.dampingRatio=0,this.minLength=0,this.maxLength=0,this.maxMotorForce=0,this.motorSpeed=0,this.impulse=0,this.lowerImpulse=0,this.upperImpulse=0,this.motorImpulse=0,this.indexA=I,this.indexB=I,this.anchorA=new B,this.anchorB=new B,this.deltaCenter=new B,this.distanceSoftness=new re,this.axialMass=0,this.enableSpring=!1,this.enableLimit=!1,this.enableMotor=!1}clone(){let e=new t;return e.length=this.length,e.hertz=this.hertz,e.dampingRatio=this.dampingRatio,e.minLength=this.minLength,e.maxLength=this.maxLength,e.maxMotorForce=this.maxMotorForce,e.motorSpeed=this.motorSpeed,e.impulse=this.impulse,e.lowerImpulse=this.lowerImpulse,e.upperImpulse=this.upperImpulse,e.motorImpulse=this.motorImpulse,e.indexA=this.indexA,e.indexB=this.indexB,e.anchorA=this.anchorA.clone(),e.anchorB=this.anchorB.clone(),e.deltaCenter=this.deltaCenter.clone(),e.distanceSoftness=this.distanceSoftness,e.axialMass=this.axialMass,e.enableSpring=this.enableSpring,e.enableLimit=this.enableLimit,e.enableMotor=this.enableMotor,e}},Wi=class t{constructor(){this.linearOffset=new B,this.angularOffset=0,this.linearImpulse=new B,this.angularImpulse=0,this.maxForce=0,this.maxTorque=0,this.correctionFactor=0,this.indexA=I,this.indexB=I,this.anchorA=new B,this.anchorB=new B,this.deltaCenter=new B,this.deltaAngle=0,this.linearMass=new ro,this.angularMass=0}clone(){let e=new t;return e.linearOffset=this.linearOffset.clone(),e.angularOffset=this.angularOffset,e.linearImpulse=this.linearImpulse.clone(),e.angularImpulse=this.angularImpulse,e.maxForce=this.maxForce,e.maxTorque=this.maxTorque,e.correctionFactor=this.correctionFactor,e.indexA=this.indexA,e.indexB=this.indexB,e.anchorA=this.anchorA.clone(),e.anchorB=this.anchorB.clone(),e.deltaCenter=this.deltaCenter.clone(),e.deltaAngle=this.deltaAngle,e.linearMass=this.linearMass.clone(),e.angularMass=this.angularMass,e}},Oi=class t{constructor(){this.targetA=new B,this.hertz=0,this.dampingRatio=0,this.maxForce=0,this.linearImpulse=new B,this.angularImpulse=0,this.linearSoftness=new re,this.angularSoftness=new re,this.indexB=I,this.anchorB=new B,this.deltaCenter=new B,this.linearMass=new ro}clone(){let e=new t;return e.targetA=this.targetA.clone(),e.hertz=this.hertz,e.dampingRatio=this.dampingRatio,e.maxForce=this.maxForce,e.linearImpulse=this.linearImpulse.clone(),e.angularImpulse=this.angularImpulse,e.linearSoftness=this.linearSoftness,e.angularSoftness=this.angularSoftness,e.indexB=this.indexB,e.anchorB=this.anchorB.clone(),e.deltaCenter=this.deltaCenter.clone(),e.linearMass=this.linearMass.clone(),e}},Ui=class t{constructor(){this.localAxisA=new B,this.impulse=new B,this.springImpulse=0,this.motorImpulse=0,this.lowerImpulse=0,this.upperImpulse=0,this.hertz=0,this.dampingRatio=0,this.maxMotorForce=0,this.motorSpeed=0,this.referenceAngle=0,this.lowerTranslation=0,this.upperTranslation=0,this.indexA=I,this.indexB=I,this.anchorA=new B,this.anchorB=new B,this.axisA=new B,this.deltaCenter=new B,this.deltaAngle=0,this.axialMass=0,this.springSoftness=new re,this.enableSpring=!1,this.enableLimit=!1,this.enableMotor=!1}clone(){let e=new t;return e.localAxisA=this.localAxisA.clone(),e.impulse=this.impulse.clone(),e.springImpulse=this.springImpulse,e.motorImpulse=this.motorImpulse,e.lowerImpulse=this.lowerImpulse,e.upperImpulse=this.upperImpulse,e.hertz=this.hertz,e.dampingRatio=this.dampingRatio,e.maxMotorForce=this.maxMotorForce,e.motorSpeed=this.motorSpeed,e.referenceAngle=this.referenceAngle,e.lowerTranslation=this.lowerTranslation,e.upperTranslation=this.upperTranslation,e.indexA=this.indexA,e.indexB=this.indexB,e.anchorA=this.anchorA.clone(),e.anchorB=this.anchorB.clone(),e.axisA=this.axisA.clone(),e.deltaCenter=this.deltaCenter.clone(),e.deltaAngle=this.deltaAngle,e.axialMass=this.axialMass,e.springSoftness=this.springSoftness.clone(),e.enableSpring=this.enableSpring,e.enableLimit=this.enableLimit,e.enableMotor=this.enableMotor,e}},zi=class t{constructor(){this.linearImpulse=new B,this.springImpulse=0,this.motorImpulse=0,this.lowerImpulse=0,this.upperImpulse=0,this.hertz=0,this.dampingRatio=0,this.maxMotorTorque=0,this.motorSpeed=0,this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.indexA=I,this.indexB=I,this.anchorA=new B,this.anchorB=new B,this.deltaCenter=new B,this.deltaAngle=0,this.axialMass=0,this.springSoftness=new re,this.enableSpring=!1,this.enableMotor=!1,this.enableLimit=!1}clone(){let e=new t;return e.linearImpulse=this.linearImpulse.clone(),e.springImpulse=this.springImpulse,e.motorImpulse=this.motorImpulse,e.lowerImpulse=this.lowerImpulse,e.upperImpulse=this.upperImpulse,e.hertz=this.hertz,e.dampingRatio=this.dampingRatio,e.maxMotorTorque=this.maxMotorTorque,e.motorSpeed=this.motorSpeed,e.referenceAngle=this.referenceAngle,e.lowerAngle=this.lowerAngle,e.upperAngle=this.upperAngle,e.indexA=this.indexA,e.indexB=this.indexB,e.anchorA=this.anchorA.clone(),e.anchorB=this.anchorB.clone(),e.deltaCenter=this.deltaCenter.clone(),e.deltaAngle=this.deltaAngle,e.axialMass=this.axialMass,e.springSoftness=this.springSoftness,e.enableSpring=this.enableSpring,e.enableMotor=this.enableMotor,e.enableLimit=this.enableLimit,e}},Ki=class t{constructor(){this.referenceAngle=0,this.linearHertz=0,this.linearDampingRatio=0,this.angularHertz=0,this.angularDampingRatio=0,this.linearSoftness=new re,this.angularSoftness=new re,this.linearImpulse=new B,this.angularImpulse=0,this.indexA=I,this.indexB=I,this.anchorA=new B,this.anchorB=new B,this.deltaCenter=new B,this.deltaAngle=0,this.axialMass=0}clone(){let e=new t;return e.referenceAngle=this.referenceAngle,e.linearHertz=this.linearHertz,e.linearDampingRatio=this.linearDampingRatio,e.angularHertz=this.angularHertz,e.angularDampingRatio=this.angularDampingRatio,e.linearSoftness=this.linearSoftness,e.angularSoftness=this.angularSoftness,e.linearImpulse=this.linearImpulse.clone(),e.angularImpulse=this.angularImpulse,e.indexA=this.indexA,e.indexB=this.indexB,e.anchorA=this.anchorA.clone(),e.anchorB=this.anchorB.clone(),e.deltaCenter=this.deltaCenter.clone(),e.deltaAngle=this.deltaAngle,e.axialMass=this.axialMass,e}},Hi=class t{constructor(){this.localAxisA=new B,this.perpImpulse=0,this.motorImpulse=0,this.springImpulse=0,this.lowerImpulse=0,this.upperImpulse=0,this.maxMotorTorque=0,this.motorSpeed=0,this.lowerTranslation=0,this.upperTranslation=0,this.hertz=0,this.dampingRatio=0,this.indexA=I,this.indexB=I,this.anchorA=new B,this.anchorB=new B,this.axisA=new B,this.deltaCenter=new B,this.perpMass=0,this.motorMass=0,this.axialMass=0,this.springSoftness=new re,this.enableSpring=!1,this.enableMotor=!1,this.enableLimit=!1}clone(){let e=new t;return e.localAxisA=this.localAxisA.clone(),e.perpImpulse=this.perpImpulse,e.motorImpulse=this.motorImpulse,e.springImpulse=this.springImpulse,e.lowerImpulse=this.lowerImpulse,e.upperImpulse=this.upperImpulse,e.maxMotorTorque=this.maxMotorTorque,e.motorSpeed=this.motorSpeed,e.lowerTranslation=this.lowerTranslation,e.upperTranslation=this.upperTranslation,e.hertz=this.hertz,e.dampingRatio=this.dampingRatio,e.indexA=this.indexA,e.indexB=this.indexB,e.anchorA=this.anchorA.clone(),e.anchorB=this.anchorB.clone(),e.axisA=this.axisA.clone(),e.deltaCenter=this.deltaCenter.clone(),e.perpMass=this.perpMass,e.motorMass=this.motorMass,e.axialMass=this.axialMass,e.springSoftness=this.springSoftness,e.enableSpring=this.enableSpring,e.enableMotor=this.enableMotor,e.enableLimit=this.enableLimit,e}},gs=class{constructor(){this.jointId=I,this.bodyIdA=I,this.bodyIdB=I,this.type=T.b2_unknown,this.localOriginAnchorA=new B,this.localOriginAnchorB=new B,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.joint=null,this.distanceJoint=null,this.motorJoint=null,this.mouseJoint=null,this.revoluteJoint=null,this.prismaticJoint=null,this.weldJoint=null,this.wheelJoint=null}copyTo(e){e.jointId=this.jointId,e.bodyIdA=this.bodyIdA,e.bodyIdB=this.bodyIdB,e.type=this.type,e.localOriginAnchorA=this.localOriginAnchorA.clone(),e.localOriginAnchorB=this.localOriginAnchorB.clone(),e.invMassA=this.invMassA,e.invMassB=this.invMassB,e.invIA=this.invIA,e.invIB=this.invIB,e.joint=this.joint,e.distanceJoint=this.distanceJoint?this.distanceJoint.clone():null,e.motorJoint=this.motorJoint?this.motorJoint.clone():null,e.mouseJoint=this.mouseJoint?this.mouseJoint.clone():null,e.revoluteJoint=this.revoluteJoint?this.revoluteJoint.clone():null,e.prismaticJoint=this.prismaticJoint?this.prismaticJoint.clone():null,e.weldJoint=this.weldJoint?this.weldJoint.clone():null,e.wheelJoint=this.wheelJoint?this.wheelJoint.clone():null}};var $i=class{setIndex=0;localIndex=0;islandId=0;headBody=0;tailBody=0;bodyCount=0;headContact=0;tailContact=0;contactCount=0;headJoint=0;tailJoint=0;jointCount=0;parentIsland=0;constraintRemoveCount=0},_s=class{islandId=0};function Qi(t,e){let o=ne(t.islandIdPool);if(o===t.islandArray.length){let i=new $i;i.setIndex=I,t.islandArray.push(i)}let n=t.solverSetArray[e],s=t.islandArray[o];s.setIndex=e,s.localIndex=n.islands.count,s.islandId=o,s.headBody=I,s.tailBody=I,s.bodyCount=0,s.headContact=I,s.tailContact=I,s.contactCount=0,s.headJoint=I,s.tailJoint=I,s.jointCount=0,s.parentIsland=I,s.constraintRemoveCount=0;let r=jn(n.islands);return r.islandId=o,s}function Br(t,e){let o=t.islandArray[e],n=t.solverSetArray[o.setIndex];if(Ir(n.islands,o.localIndex)!==I){let i=n.islands.data[o.localIndex].islandId,c=t.islandArray[i];c.localIndex=o.localIndex}o.islandId=I,o.setIndex=I,o.localIndex=I,fe(t.islandIdPool,e)}function Io(t,e){return t.islandArray[e]}function Uc(t,e,o){let n=t.islandArray[e];if(n.headContact!==I){o.islandNext=n.headContact;let s=t.contactArray[n.headContact];s.islandPrev=o.contactId}n.headContact=o.contactId,n.tailContact===I&&(n.tailContact=n.headContact),n.contactCount+=1,o.islandId=e,So(t,e)}function Kc(t,e){let o=e.edges[0].bodyId,n=e.edges[1].bodyId,s=gt(t,o),r=gt(t,n);s.setIndex===M.b2_awakeSet&&r.setIndex>=M.b2_firstSleepingSet&&Ee(t,r.setIndex),r.setIndex===M.b2_awakeSet&&s.setIndex>=M.b2_firstSleepingSet&&Ee(t,s.setIndex);let i=s.islandId,c=r.islandId;if(i===c){Uc(t,i,e);return}let a=null;if(i!==I){a=Io(t,i);let d=a.parentIsland;for(;d!==I;){let p=Io(t,d);p.parentIsland!==I&&(a.parentIsland=p.parentIsland),a=p,i=d,d=a.parentIsland}}let l=null;if(c!==I){l=Io(t,c);let d=l.parentIsland;for(;l.parentIsland!==I;){let p=Io(t,d);p.parentIsland!==I&&(l.parentIsland=p.parentIsland),l=p,c=d,d=l.parentIsland}}a!==l&&a!==null&&l!==null&&(l.parentIsland=i),a!==null?Uc(t,i,e):Uc(t,c,e)}function Ar(t,e){let o=e.islandId,n=Io(t,o);if(e.islandPrev!==I){let s=t.contactArray[e.islandPrev];s.islandNext=e.islandNext}if(e.islandNext!==I){let s=t.contactArray[e.islandNext];s.islandPrev=e.islandPrev}n.headContact===e.contactId&&(n.headContact=e.islandNext),n.tailContact===e.contactId&&(n.tailContact=e.islandPrev),n.contactCount-=1,n.constraintRemoveCount+=1,e.islandId=I,e.islandPrev=I,e.islandNext=I,So(t,o)}function zc(t,e,o){let n=t.islandArray[e];if(n.headJoint!==I){o.islandNext=n.headJoint;let s=Je(t,n.headJoint);s.islandPrev=o.jointId}n.headJoint=o.jointId,n.tailJoint===I&&(n.tailJoint=n.headJoint),n.jointCount+=1,o.islandId=e,So(t,e)}function Is(t,e,o){let n=gt(t,e.edges[0].bodyId),s=gt(t,e.edges[1].bodyId);n.setIndex===M.b2_awakeSet&&s.setIndex>=M.b2_firstSleepingSet?Ee(t,s.setIndex):s.setIndex===M.b2_awakeSet&&n.setIndex>=M.b2_firstSleepingSet&&Ee(t,n.setIndex);let r=n.islandId,i=s.islandId;if(r===i){zc(t,r,e);return}let c=null;if(r!==I)for(c=Io(t,r);c.parentIsland!==I;){let l=Io(t,c.parentIsland);l.parentIsland!==I&&(c.parentIsland=l.parentIsland),r=c.parentIsland,c=l}let a=null;if(i!==I)for(a=Io(t,i);a.parentIsland!==I;){let l=Io(t,a.parentIsland);l.parentIsland!==I&&(a.parentIsland=l.parentIsland),i=a.parentIsland,a=l}c!==a&&c!==null&&a!==null&&(a.parentIsland=r),c!==null?zc(t,r,e):zc(t,i,e),o&&Xn(t)}function Ss(t,e){let o=e.islandId,n=t.islandArray[o];if(e.islandPrev!==I){let s=Je(t,e.islandPrev);s.islandNext=e.islandNext}if(e.islandNext!==I){let s=Je(t,e.islandNext);s.islandPrev=e.islandPrev}n.headJoint===e.jointId&&(n.headJoint=e.islandNext),n.tailJoint===e.jointId&&(n.tailJoint=e.islandPrev),n.jointCount-=1,n.constraintRemoveCount+=1,e.islandId=I,e.islandPrev=I,e.islandNext=I,So(t,o)}function gm(t,e){let o=e.parentIsland,n=t.islandArray[o],s=e.headBody;for(;s!==I;){let l=gt(t,s);l.islandId=o,s=l.islandNext}let r=e.headContact;for(;r!==I;){let l=t.contactArray[r];l.islandId=o,r=l.islandNext}let i=e.headJoint;for(;i!==I;){let l=Je(t,i);l.islandId=o,i=l.islandNext}let c=gt(t,n.tailBody);c.islandNext=e.headBody;let a=gt(t,e.headBody);if(a.islandPrev=n.tailBody,n.tailBody=e.tailBody,n.bodyCount+=e.bodyCount,n.headContact===I)n.headContact=e.headContact,n.tailContact=e.tailContact,n.contactCount=e.contactCount;else if(e.headContact!==I){let l=t.contactArray[n.tailContact];l.islandNext=e.headContact;let d=t.contactArray[e.headContact];d.islandPrev=n.tailContact,n.tailContact=e.tailContact,n.contactCount+=e.contactCount}if(n.headJoint===I)n.headJoint=e.headJoint,n.tailJoint=e.tailJoint,n.jointCount=e.jointCount;else if(e.headJoint!==I){let l=Je(t,n.tailJoint);l.islandNext=e.headJoint;let d=Je(t,e.headJoint);d.islandPrev=n.tailJoint,n.tailJoint=e.tailJoint,n.jointCount+=e.jointCount}n.constraintRemoveCount+=e.constraintRemoveCount,So(t,o)}function Xn(t){let e=t.solverSetArray[M.b2_awakeSet],o=e.islands.data,n=e.islands.count,s=t.islandArray;for(let r=0;r<n;++r){let i=o[r].islandId,c=s[i],a=i,l=c;for(;l.parentIsland!==I;){let d=s[l.parentIsland];d.parentIsland!==I&&(l.parentIsland=d.parentIsland),a=l.parentIsland,l=d}l!==c&&(c.parentIsland=a)}for(let r=n-1;r>=0;--r){let i=o[r].islandId,c=s[i];c.parentIsland!==I&&(gm(t,c),Br(t,i))}wr(t)}function Sr(t,e){let o=t.islandArray[e],n=o.setIndex;if(n!==M.b2_awakeSet||o.constraintRemoveCount===0)return;So(t,e);let s=o.bodyCount,r=t.bodyArray,i=t.contactArray,c=[],a=[],l=o.headBody;for(;l!==I;){a.push(l);let u=r[l];u.isMarked=!1,l=u.islandNext}let d=o.headContact;for(;d!==I;){let u=i[d];u.isMarked=!1,d=u.islandNext}let p=o.headJoint;for(;p!==I;){let u=Je(t,p);u.isMarked=!1,p=u.islandNext}Br(t,e);for(let u=0;u<s;++u){let b=a[u],h=r[b];if(h.isMarked===!0)continue;c.push(b),h.isMarked=!0;let m=Qi(t,n),f=m.islandId;for(;c.length>0;){let y=c.pop(),x=r[y];x.islandId=f,m.tailBody!==I&&(r[m.tailBody].islandNext=y),x.islandPrev=m.tailBody,x.islandNext=I,m.tailBody=y,m.headBody===I&&(m.headBody=y),m.bodyCount+=1;let w=x.headContactKey;for(;w!==I;){let S=w>>1,A=w&1,_=t.contactArray[S];if(w=_.edges[A].nextKey,_.isMarked||_.flags&ht.b2_contactSensorFlag||!(_.flags&ht.b2_contactTouchingFlag))continue;_.isMarked=!0;let C=A^1,D=_.edges[C].bodyId,v=r[D];if(v.isMarked===!1&&v.setIndex!==M.b2_staticSet&&(c.push(D),v.isMarked=!0),_.islandId=f,m.tailContact!==I){let k=t.contactArray[m.tailContact];k.islandNext=S}_.islandPrev=m.tailContact,_.islandNext=I,m.tailContact=S,m.headContact===I&&(m.headContact=S),m.contactCount+=1}let g=x.headJointKey;for(;g!==I;){let S=g>>1,A=g&1,_=Je(t,S);if(g=_.edges[A].nextKey,_.isMarked)continue;_.isMarked=!0;let C=A^1,D=_.edges[C].bodyId,v=r[D];if(v.setIndex!==M.b2_disabledSet){if(v.isMarked===!1&&v.setIndex===M.b2_awakeSet&&(c.push(D),v.isMarked=!0),_.islandId=f,m.tailJoint!==I){let k=Je(t,m.tailJoint);k.islandNext=S}_.islandPrev=m.tailJoint,_.islandNext=I,m.tailJoint=S,m.headJoint===I&&(m.headJoint=S),m.jointCount+=1}}}So(t,f)}}function So(t,e){if(!lo)return;se(t.islandArray,e);let o=t.islandArray[e];{let n=t.bodyArray;o.bodyCount>1;let s=0,r=o.headBody;for(;r!=I;){se(n,r);let i=n[r];s+=1,s==o.bodyCount,r=i.islandNext}}if(o.headContact!=I){o.contactCount>1;let n=0,s=o.headContact;for(;s!=I;){se(t.contactArray,s);let r=t.contactArray[s];n+=1,n==o.contactCount,s=r.islandNext}}if(o.headJoint!=I){o.jointCount>1;let n=0,s=o.headJoint;for(;s!=I;){se(t.jointArray,s);let r=t.jointArray[s];n+=1,n==o.jointCount,s=r.islandNext}}}function ki(t,e){return e.c1.x=t.center0X,e.c1.y=t.center0Y,e.c2.copy(t.center),e.q1.copy(t.rotation0),e.q2.copy(t.transform.q),e.localCenter.copy(t.localCenter),e}function gt(t,e){return t.bodyArray[e]}function Z(t,e){return gt(t,e.index1-1)}function Rt(t,e){return t.solverSetArray[e.setIndex].sims.data[e.localIndex].transform}function ue(t,e){let o=t.bodyArray[e];return Rt(t,o)}function cs(t,e){let o=t.bodyArray[e];return new Ne(e+1,t.worldId,o.revision)}function jt(t,e){return t.solverSetArray[e.setIndex].sims.data[e.localIndex]}function Yn(t,e){return e.setIndex===M.b2_awakeSet?t.solverSetArray[M.b2_awakeSet].states.data[e.localIndex]:null}function Hc(t,e,o){let n=Qi(t,e);o.islandId=n.islandId,n.headBody=o.id,n.tailBody=o.id,n.bodyCount=1}function $c(t,e){if(e.islandId===I)return;let o=e.islandId,n=t.islandArray[o];if(e.islandPrev!==I){let r=gt(t,e.islandPrev);r.islandNext=e.islandNext}if(e.islandNext!==I){let r=gt(t,e.islandNext);r.islandPrev=e.islandPrev}n.bodyCount-=1;let s=!1;n.headBody===e.id?(n.headBody=e.islandNext,n.headBody===I&&(Br(t,n.islandId),s=!0)):n.tailBody===e.id&&(n.tailBody=e.islandPrev),s===!1&&So(t,o),e.islandId=I,e.islandPrev=I,e.islandNext=I}function Qc(t,e,o){let n=e.headContactKey;for(;n!==I;){let s=n>>1,r=n&1,i=t.contactArray[s];n=i.edges[r].nextKey,mo(t,i,o)}Lt(t)}function je(t,e){let o=ft(t);if(o.locked)return new Ne(0,0,0);let n=(e.isAwake||e.enableSleep===!1)&&e.isEnabled,s;if(e.isEnabled===!1)s=M.b2_disabledSet;else if(e.type===et.b2_staticBody)s=M.b2_staticSet;else if(n===!0)s=M.b2_awakeSet;else{if(s=ne(o.solverSetIdPool),s===o.solverSetArray.length){let l=new eo;l.setIndex=s,o.solverSetArray.push(l)}o.solverSetArray[s].setIndex=s}let r=ne(o.bodyIdPool),i=o.solverSetArray[s],c=en(i.sims);if(Object.assign(c,{transform:new at(e.position,e.rotation),center:e.position.clone(),rotation0:e.rotation,center0X:e.position.x,center0Y:e.position.y,localCenter:new B,force:new B,torque:0,mass:0,invMass:0,inertia:0,invInertia:0,minExtent:Me,maxExtent:0,linearDamping:e.linearDamping,angularDamping:e.angularDamping,gravityScale:e.gravityScale,bodyId:r,isBullet:e.isBullet,allowFastRotation:e.allowFastRotation,enlargeAABB:!1,isFast:!1,isSpeedCapped:!1}),s===M.b2_awakeSet){let l=hs(i.states);Object.assign(l,{linearVelocity:e.linearVelocity,angularVelocity:e.angularVelocity,deltaRotation:new rt})}for(;r>=o.bodyArray.length;)o.bodyArray.push(new oa);let a=o.bodyArray[r];return Object.assign(a,{userData:e.userData,setIndex:s,localIndex:i.sims.count-1,revision:a.revision+1,headShapeId:I,shapeCount:0,headChainId:I,headContactKey:I,contactCount:0,headJointKey:I,jointCount:0,islandId:I,islandPrev:I,islandNext:I,bodyMoveIndex:I,id:r,sleepThreshold:e.sleepThreshold,sleepTime:0,type:e.type,enableSleep:e.enableSleep,fixedRotation:e.fixedRotation,isSpeedCapped:!1,isMarked:!1,updateBodyMass:e.updateBodyMass}),s>=M.b2_awakeSet&&Hc(o,s,a),Lt(o),new Ne(r+1,o.worldId,a.revision)}function Wt(t,e){return e.setIndex>=M.b2_firstSleepingSet?(Ee(t,e.setIndex),!0):!1}function cn(t){let e=yt(t.world0);if(e===null)return;let o=Z(e,t),n=!0,s=o.headJointKey;for(;s!==I;){let l=s>>1,d=s&1,p=e.jointArray[l];s=p.edges[d].nextKey,Fi(e,p,n)}Qc(e,o,n);let r=o.headShapeId;for(;r!==I;){let l=e.shapeArray[r];Ko(l,e.broadPhase),fe(e.shapeIdPool,r),l.id=I,r=l.nextShapeId}let i=o.headChainId;for(;i!==I;){let l=e.chainArray[i];l.shapeIndices=null,fe(e.chainIdPool,i),l.id=I,i=l.nextChainId}$c(e,o);let c=e.solverSetArray[o.setIndex];if(ms(c.sims,o.localIndex)!==I){let d=c.sims.data[o.localIndex].bodyId,p=e.bodyArray[d];p.localIndex=o.localIndex}if(o.setIndex===M.b2_awakeSet){let l=ys(c.states,o.localIndex)}else c.setIndex>=M.b2_firstSleepingSet&&c.sims.count==0&&En(e,c.setIndex);fe(e.bodyIdPool,o.id),o.setIndex=I,o.localIndex=I,o.id=I,Lt(e)}function Pb(t){let e=yt(t.world0);return e===null?0:Z(e,t).contactCount}function Tb(t,e,o){let n=yt(t.world0);if(n===null)return 0;let r=Z(n,t).headContactKey,i=0;for(;r!==I&&i<o;){let c=r>>1,a=r&1,l=n.contactArray[c];if(l.flags&ht.b2_contactTouchingFlag){let d=n.shapeArray[l.shapeIdA],p=n.shapeArray[l.shapeIdB];e[i].shapeIdA=new _t(d.id+1,t.world0,d.revision),e[i].shapeIdB=new _t(p.id+1,t.world0,p.revision);let u=Gn(n,l);e[i].manifold=u.manifold,i+=1}r=l.edges[a].nextKey}return i}function Gb(t){let e=yt(t.world0);if(e===null)return new xt;let o=Z(e,t);if(o.headShapeId===I){let r=ue(e,o.id);return new xt(r.p.x,r.p.y,r.p.x,r.p.y)}let n=e.shapeArray[o.headShapeId],s=n.aabb;for(;n.nextShapeId!==I;)n=e.shapeArray[n.nextShapeId],s=Vt(s,n.aabb);return s}function Ho(t,e){let o=jt(t,e);if(o.mass=0,o.invMass=0,o.inertia=0,o.invInertia=0,o.minExtent=Me,o.maxExtent=0,e.type!==et.b2_dynamicBody){if(o.center=o.transform.p.clone(),e.type===et.b2_kinematicBody){let c=e.headShapeId;for(;c!==I;){let a=t.shapeArray[c];c=a.nextShapeId;let l=di(a,new B);o.minExtent=Math.min(o.minExtent,l.minExtent),o.maxExtent=Math.max(o.maxExtent,l.maxExtent)}}return}let n=new B,s=e.headShapeId;for(;s!==I;){let c=t.shapeArray[s];if(s=c.nextShapeId,c.density===0)continue;let a=Ea(c);o.mass+=a.mass,n=$(n,a.mass,a.center),o.inertia+=a.rotationalInertia}o.mass>0&&(o.invMass=1/o.mass,n=it(o.invMass,n)),o.inertia>0&&e.fixedRotation===!1?(o.inertia-=o.mass*F(n,n),o.invInertia=1/o.inertia):(o.inertia=0,o.invInertia=0);let r=o.center.clone();o.localCenter=n,o.center=H(o.transform,o.localCenter);let i=Yn(t,e);if(i!==null){let c=Gt(i.angularVelocity,J(o.center,r));i.linearVelocity=O(i.linearVelocity,c)}for(s=e.headShapeId;s!==I;){let c=t.shapeArray[s];s=c.nextShapeId;let a=di(c,n);o.minExtent=Math.min(o.minExtent,a.minExtent),o.maxExtent=Math.max(o.maxExtent,a.maxExtent)}}function Rb(t){let e=U(t.world0),o=Z(e,t);return Rt(e,o).p}function Cr(t){let e=U(t.world0),o=Z(e,t);return Rt(e,o).q}function Zi(t){let e=U(t.world0),o=Z(e,t);return Rt(e,o)}function vr(t,e){let o=U(t.world0),n=Z(o,t),s=Rt(o,n);return qe(s,e)}function Lb(t,e){let o=U(t.world0),n=Z(o,t),s=Rt(o,n);return H(s,e)}function Eb(t,e){let o=U(t.world0),n=Z(o,t),s=Rt(o,n);return ge(s.q,e)}function jb(t,e){let o=U(t.world0),n=Z(o,t),s=Rt(o,n);return K(s.q,e)}function Jr(t,e,o){let n=U(t.world0),s=Z(n,t),r=jt(n,s);r.transform.p=e,o!==void 0&&(r.transform.q=o),r.center=H(r.transform,r.localCenter),r.rotation0=r.transform.q,r.center0X=r.center.x,r.center0Y=r.center.y;let i=n.broadPhase,c=r.transform,a=yn,l=Ht,d=s.headShapeId;for(;d!==I;){let p=n.shapeArray[d],u=ho(p,c);if(u.lowerBoundX-=l,u.lowerBoundY-=l,u.upperBoundX+=l,u.upperBoundY+=l,p.aabb=u,Vo(p.fatAABB,u)===!1){let b=new xt(u.lowerBoundX-a,u.lowerBoundY-a,u.upperBoundX+a,u.upperBoundY+a);p.fatAABB=b,p.proxyKey!==I&&ir(i,p.proxyKey,b)}d=p.nextShapeId}}function Xb(t){let e=U(t.world0),o=Z(e,t),n=Yn(e,o);return n!==null?n.linearVelocity.clone():new B}function Fb(t){let e=U(t.world0),o=Z(e,t),n=Yn(e,o);return n!==null?n.angularVelocity:0}function qb(t,e){let o=U(t.world0),n=Z(o,t);if(n.type==et.b2_staticBody)return;he(e)>0&&Wt(o,n);let s=Yn(o,n);s!==null&&(s.linearVelocity=e)}function Vb(t,e){let o=U(t.world0),n=Z(o,t);if(n.type==et.b2_staticBody||n.fixedRotation)return;e!==0&&Wt(o,n);let s=Yn(o,n);s!==null&&(s.angularVelocity=e)}function Yb(t,e,o,n){let s=U(t.world0),r=Z(s,t);if(n&&r.setIndex>=M.b2_firstSleepingSet&&Wt(s,r),r.setIndex===M.b2_awakeSet){let i=jt(s,r);i.force=O(i.force,e),i.torque+=z(J(o,i.center),e)}}function ta(t,e,o){let n=U(t.world0),s=Z(n,t);if(o&&s.setIndex>=M.b2_firstSleepingSet&&Wt(n,s),s.setIndex===M.b2_awakeSet){let r=jt(n,s);r.force=O(r.force,e)}}function Nb(t,e,o){let n=U(t.world0),s=Z(n,t);if(o&&s.setIndex>=M.b2_firstSleepingSet&&Wt(n,s),s.setIndex===M.b2_awakeSet){let r=jt(n,s);r.torque+=e}}function Wb(t,e,o,n){let s=U(t.world0),r=Z(s,t);if(n&&r.setIndex>=M.b2_firstSleepingSet&&Wt(s,r),r.setIndex===M.b2_awakeSet){let i=r.localIndex,c=s.solverSetArray[M.b2_awakeSet],a=c.states.data[i],l=c.sims.data[i];a.linearVelocity=$(a.linearVelocity,l.invMass,e),a.angularVelocity+=l.invInertia*z(J(o,l.center),e)}}function Ob(t,e,o){let n=U(t.world0),s=Z(n,t);if(o&&s.setIndex>=M.b2_firstSleepingSet&&Wt(n,s),s.setIndex===M.b2_awakeSet){let r=s.localIndex,i=n.solverSetArray[M.b2_awakeSet],c=i.states.data[r],a=i.sims.data[r];c.linearVelocity=$(c.linearVelocity,a.invMass,e)}}function Ub(t,e,o){let n=U(t.world0),s=t.index1-1,r=n.bodyArray[s];if(o&&r.setIndex>=M.b2_firstSleepingSet&&Wt(n,r),r.setIndex===M.b2_awakeSet){let i=r.localIndex,c=n.solverSetArray[M.b2_awakeSet],a=c.states.data[i],l=c.sims.data[i];a.angularVelocity+=l.invInertia*e}}function zb(t){let e=U(t.world0);return Z(e,t).type}function Kb(t,e){let o=U(t.world0),n=Z(o,t),s=n.type;if(s===e)return;if(n.setIndex===M.b2_disabledSet){n.type=e,Ho(o,n);return}Qc(o,n,!1),Wt(o,n);{let i=n.headJointKey;for(;i!==I;){let c=i>>1,a=i&1,l=o.jointArray[c];l.islandId!==I&&Ss(o,l);let d=o.bodyArray[l.edges[0].bodyId],p=o.bodyArray[l.edges[1].bodyId];Wt(o,d),Wt(o,p),i=l.edges[a].nextKey}}if(n.type=e,s===et.staticBody){let i=o.solverSetArray[M.b2_staticSet],c=o.solverSetArray[M.b2_awakeSet];ps(o,c,i,n),Hc(o,M.b2_awakeSet,n);let a=n.headJointKey;for(;a!==I;){let p=a>>1,u=a&1,b=o.jointArray[p];b.setIndex===M.b2_staticSet?xo(o,c,i,b):b.setIndex===M.b2_awakeSet&&(xo(o,i,c,b),xo(o,c,i,b)),a=b.edges[u].nextKey}let l=Rt(o,n),d=n.headShapeId;for(;d!==I;){let p=o.shapeArray[d];d=p.nextShapeId,Ko(p,o.broadPhase);let u=!0,b=e;Tn(p,o.broadPhase,b,l,u)}}else if(e===et.b2_staticBody){let i=o.solverSetArray[M.b2_staticSet],c=o.solverSetArray[M.b2_awakeSet];ps(o,i,c,n),$c(o,n);let a=n.headJointKey;for(;a!==I;){let p=a>>1,u=a&1,b=o.jointArray[p];a=b.edges[u].nextKey;let h=u^1,m=o.bodyArray[b.edges[h].bodyId];b.setIndex!==M.b2_disabledSet&&(m.setIndex===M.b2_staticSet?xo(o,i,c,b):(xo(o,i,c,b),xo(o,c,i,b)))}let l=Rt(o,n),d=n.headShapeId;for(;d!==I;){let p=o.shapeArray[d];d=p.nextShapeId,Ko(p,o.broadPhase),Tn(p,o.broadPhase,et.b2_staticBody,l,!0)}}else{let i=Rt(o,n),c=n.headShapeId;for(;c!==I;){let a=o.shapeArray[c];c=a.nextShapeId,Ko(a,o.broadPhase);let l=e;Tn(a,o.broadPhase,l,i,!0)}}{let i=n.headJointKey;for(;i!==I;){let c=i>>1,a=i&1,l=o.jointArray[c];i=l.edges[a].nextKey;let d=a^1,p=l.edges[d].bodyId,u=o.bodyArray[p];u.setIndex!==M.b2_disabledSet&&(n.type===et.b2_staticBody&&u.type===et.b2_staticBody||Is(o,l,!1))}Xn(o)}Ho(o,n),Lt(o)}function ln(t,e){let o=U(t.world0),n=Z(o,t);n.userData=e}function Hb(t){let e=U(t.world0);return Z(e,t).userData}function $b(t){let e=U(t.world0),o=Z(e,t);return jt(e,o).mass}function Qb(t){let e=U(t.world0),o=Z(e,t);return jt(e,o).inertia}function Zb(t){let e=U(t.world0),o=Z(e,t);return jt(e,o).localCenter.clone()}function t2(t){let e=U(t.world0),o=Z(e,t);return jt(e,o).center.clone()}function e2(t,e){let o=yt(t.world0);if(o===null)return;let n=Z(o,t),s=jt(o,n);s.mass=e.mass,s.inertia=e.rotationalInertia,s.localCenter=e.center;let r=H(s.transform,e.center);s.center=r,s.center0X=r.x,s.center0Y=r.y,s.invMass=s.mass>0?1/s.mass:0,s.invInertia=s.inertia>0?1/s.inertia:0}function o2(t){let e=U(t.world0),o=Z(e,t),n=jt(e,o),s=new We;return s.mass=n.mass,s.center=n.localCenter,s.rotationalInertia=n.inertia,s}function n2(t){let e=yt(t.world0);if(e===null)return;let o=Z(e,t);Ho(e,o)}function s2(t,e){let o=yt(t.world0);if(o===null)return;let n=Z(o,t),s=jt(o,n);s.linearDamping=e}function r2(t){let e=U(t.world0),o=Z(e,t);return jt(e,o).linearDamping}function i2(t,e){let o=yt(t.world0);if(o===null)return;let n=Z(o,t),s=jt(o,n);s.angularDamping=e}function a2(t){let e=U(t.world0),o=Z(e,t);return jt(e,o).angularDamping}function c2(t,e){let o=yt(t.world0);if(o===null)return;let n=Z(o,t),s=jt(o,n);s.gravityScale=e}function l2(t){let e=U(t.world0),o=Z(e,t);return jt(e,o).gravityScale}function d2(t){let e=U(t.world0);return Z(e,t).setIndex===M.b2_awakeSet}function u2(t,e){let o=yt(t.world0);if(o===null)return;let n=Z(o,t);e&&n.setIndex>=M.b2_firstSleepingSet?Wt(o,n):e===!1&&n.setIndex===M.b2_awakeSet&&(o.islandArray[n.islandId].constraintRemoveCount>0&&Sr(o,n.islandId),yr(o,n.islandId))}function p2(t){let e=U(t.world0);return Z(e,t).setIndex!==M.b2_disabledSet}function b2(t){let e=U(t.world0);return Z(e,t).enableSleep}function h2(t,e){let o=U(t.world0),n=Z(o,t);n.sleepThreshold=e}function m2(t){let e=U(t.world0);return Z(e,t).sleepThreshold}function y2(t,e){let o=yt(t.world0);if(o===null)return;let n=Z(o,t);n.enableSleep=e,e===!1&&Wt(o,n)}function f2(t){let e=yt(t.world0);if(e===null)return;let o=Z(e,t);if(o.setIndex===M.b2_disabledSet)return;Qc(e,o,!0),$c(e,o);let s=o.headShapeId;for(;s!==I;){let a=e.shapeArray[s];s=a.nextShapeId,Ko(a,e.broadPhase)}let r=e.solverSetArray[o.setIndex],i=e.solverSetArray[M.b2_disabledSet];ps(e,i,r,o);let c=o.headJointKey;for(;c!==I;){let a=c>>1,l=c&1,d=e.jointArray[a];if(c=d.edges[l].nextKey,d.setIndex===M.b2_disabledSet)continue;d.islandId!==I&&Ss(e,d);let p=e.solverSetArray[d.setIndex];xo(e,i,p,d)}wr(e),Lt(e)}function x2(t){let e=yt(t.world0);if(e===null)return;let o=Z(e,t);if(o.setIndex!==M.b2_disabledSet)return;let n=e.solverSetArray[M.b2_disabledSet],s=o.type===et.b2_staticBody?M.b2_staticSet:M.b2_awakeSet,r=e.solverSetArray[s];ps(e,r,n,o);let i=Rt(e,o),c=o.type,a=!0,l=o.headShapeId;for(;l!==I;){let u=e.shapeArray[l];l=u.nextShapeId,Tn(u,e.broadPhase,c,i,a)}s!==M.b2_staticSet&&Hc(e,s,o);let d=!1,p=o.headJointKey;for(;p!==I;){let u=p>>1,b=p&1,h=e.jointArray[u];p=h.edges[b].nextKey;let m=e.bodyArray[h.edges[0].bodyId],f=e.bodyArray[h.edges[1].bodyId];if(m.setIndex===M.b2_disabledSet||f.setIndex===M.b2_disabledSet)continue;let y;m.setIndex===M.b2_staticSet&&f.setIndex===M.b2_staticSet?y=M.b2_staticSet:m.setIndex===M.b2_staticSet?y=f.setIndex:y=m.setIndex;let x=e.solverSetArray[y];xo(e,x,n,h),y!==M.b2_staticSet&&Is(e,h,d)}Xn(e),Lt(e)}function I2(t,e){let o=yt(t.world0);if(o===null)return;let n=Z(o,t);if(n.fixedRotation!==e){n.fixedRotation=e;let s=Yn(o,n);s!==null&&(s.angularVelocity=0),Ho(o,n)}}function S2(t){let e=U(t.world0);return Z(e,t).fixedRotation}function g2(t,e){let o=yt(t.world0);if(o===null)return;let n=Z(o,t),s=jt(o,n);s.isBullet=e}function _2(t){let e=U(t.world0),o=Z(e,t);return jt(e,o).isBullet}function B2(t,e){let o=U(t.world0),s=Z(o,t).headShapeId;for(;s!==I;){let r=o.shapeArray[s];r.enableHitEvents=e,s=r.nextShapeId}}function A2(t){let e=U(t.world0);return Z(e,t).shapeCount}function ea(t,e){let o=U(t.world0),s=Z(o,t).headShapeId,r=0;for(;s!==I;){let i=o.shapeArray[s],c=new _t(i.id+1,t.world0,i.revision);e[r]=c,r+=1,s=i.nextShapeId}return r}function w2(t){let e=U(t.world0);return Z(e,t).jointCount}function C2(t,e,o){let n=U(t.world0),r=Z(n,t).headJointKey,i=0;for(;r!==I&&i<o;){let c=r>>1,a=r&1,l=Je(n,c),d=new zt;d.index1=c+1,d.world0=t.world0,d.revision=l.revision,e[i]=d,i+=1,r=l.edges[a].nextKey}return i}function gr(t,e,o){if(e.type!==et.b2_dynamicBody&&o.type!==et.b2_dynamicBody)return!1;let n,s;for(e.jointCount<o.jointCount?(n=e.headJointKey,s=o.id):(n=o.headJointKey,s=e.id);n!==I;){let r=n>>1,i=n&1,c=i^1,a=Je(t,r);if(a.collideConnected===!1&&a.edges[c].bodyId===s)return!1;n=a.edges[i].nextKey}return!0}function Xo(t){let e=o=>{typeof o=="object"&&o!==null&&Object.keys(o).forEach(n=>{switch(typeof o[n]){case"number":o[n]=0;break;case"boolean":o[n]=!1;break;case"string":o[n]="";break;case"object":Array.isArray(o[n])||(o[n]!==null?e(o[n]):o[n]=null);break}})};e(t)}var oa=class{constructor(){this.userData=null,this.setIndex=0,this.localIndex=0,this.headContactKey=0,this.contactCount=0,this.headShapeId=0,this.shapeCount=0,this.headChainId=0,this.headJointKey=I,this.jointCount=0,this.islandId=0,this.islandPrev=0,this.islandNext=0,this.sleepThreshold=0,this.sleepTime=0,this.bodyMoveIndex=0,this.id=I,this.type=et.b2_staticBody,this.revision=0,this.enableSleep=!1,this.fixedRotation=!1,this.isSpeedCapped=!1,this.isMarked=!1,this.updateBodyMass=!1}},kt=class{constructor(){this.linearVelocity=new B(0,0),this.angularVelocity=0,this.flags=0,this.deltaPosition=new B(0,0),this.deltaRotation=new rt(1,0)}},Bs=class{constructor(){this.transform=new at,this.center=new B(0,0),this.rotation0=new rt(1,0),this.center0X=0,this.center0Y=0,this.localCenter=new B(0,0),this.force=new B(0,0),this.torque=0,this.mass=0,this.invMass=0,this.inertia=0,this.invInertia=0,this.minExtent=0,this.maxExtent=0,this.linearDamping=0,this.angularDamping=0,this.gravityScale=0,this.bodyId=0,this.isFast=!1,this.isBullet=!1,this.isSpeedCapped=!1,this.allowFastRotation=!1,this.enlargeAABB=!1}copyTo(e){e.transform=this.transform.deepClone(),e.center=this.center.clone(),e.rotation0=this.rotation0.clone(),e.center0X=this.center0X,e.center0Y=this.center0Y,e.localCenter=this.localCenter.clone(),e.force=this.force.clone(),e.torque=this.torque,e.mass=this.mass,e.invMass=this.invMass,e.inertia=this.inertia,e.invInertia=this.invInertia,e.minExtent=this.minExtent,e.maxExtent=this.maxExtent,e.linearDamping=this.linearDamping,e.angularDamping=this.angularDamping,e.gravityScale=this.gravityScale,e.bodyId=this.bodyId,e.isFast=this.isFast,e.isBullet=this.isBullet,e.isSpeedCapped=this.isSpeedCapped,e.allowFastRotation=this.allowFastRotation,e.enlargeAABB=this.enlargeAABB}};var go=16,bs=class{constructor(e=0){this.data=[],this.count=0,this.capacity=e}},fr=class{constructor(e=0){this.data=[],this.count=0,this.capacity=e}},$o=class{constructor(e=0){this.data=[],this.count=0,this.capacity=e}},xr=class{constructor(e=0){this.data=[],this.count=0,this.capacity=e}},Qo=class{constructor(e=0){this.data=[],this.count=0,this.capacity=e}};function $a(t){let e=new bs(t);return t>0?(e.data=co(t,()=>new Bs),e):(e.data=null,e)}function Qa(t){let e=new $o(t);return t>0?(e.data=co(t,()=>new Nn),e):(e.data=null,e)}function Za(t){let e=new Qo(t);return t>0?(e.data=co(t,()=>new gs),e):(e.data=null,e)}function en(t){if(t.capacity===0)t.data=co(go,()=>new Bs),t.capacity=go,t.count=0;else if(t.count===t.capacity){let e=2*t.capacity;Sn(t.data,e,()=>new Bs),t.capacity=e}else Xo(t.data[t.count]);return t.count+=1,t.data[t.count-1]}function hs(t){if(t.capacity===0)t.data=co(go,()=>new kt),t.capacity=go,t.count=0;else if(t.count===t.capacity){let e=2*t.capacity;Sn(t.data,e,()=>new kt),t.capacity=e}else Xo(t.data[t.count]);return t.count+=1,t.data[t.count-1]}function Le(t){if(t.capacity===0)t.data=co(go,()=>new Nn),t.capacity=go,t.count=0;else if(t.count===t.capacity){let e=8*t.capacity;Sn(t.data,e,()=>new Nn),t.capacity=e}else{let e=t.data[t.count];Xo(e),e._bodyIdA=e._bodyIdB=I}return t.count+=1,t.data[t.count-1]}function Ze(t){if(t.capacity===0)t.data=co(go,()=>new gs),t.capacity=go,t.count=0;else if(t.count===t.capacity){let e=2*t.capacity;Sn(t.data,e,()=>new gs),t.capacity=e}else Xo(t.data[t.count]);return t.count+=1,t.data[t.count-1]}function jn(t){if(t.capacity===0)t.data=co(go,()=>new _s),t.capacity=go,t.count=0;else if(t.count===t.capacity){let e=2*t.capacity;Sn(t.data,e,()=>new _s),t.capacity=e}else Xo(t.data[t.count]);return t.count+=1,t.data[t.count-1].islandId=I,t.data[t.count-1]}function Mr(t,e){if(e<t.count-1){let o=t.data[t.count-1],n=t.data[e];return t.data[e]=o,t.data[t.count-1]=n,t.count-=1,t.count}return t.count-=1,I}function ms(t,e){return Mr(t,e)}function ys(t,e){return Mr(t,e)}function to(t,e){return Mr(t,e)}function Zo(t,e){return Mr(t,e)}function Ir(t,e){return Mr(t,e)}var ee=(t,e)=>(t&255)<<8|e&255,Dt=new at(new B,new rt),Zc=new at(new B,new rt),pt=new B,ut=new B,Kt=new B,$t=new B;function rl(t,e,o){let n=J(e,t),s=dt(n),r=be(s),i=new Be;return i.vertices=[t,e],i.centroid=Zt(t,e,.5),i.normals=[r,Qt(r)],i.count=2,i.radius=o,i}function sa(t,e,o,n,s){qo(e,n,Dt);let r=t.center,i=Dt.q.c*o.center.x-Dt.q.s*o.center.y+Dt.p.x,c=Dt.q.s*o.center.x+Dt.q.c*o.center.y+Dt.p.y,a=i-r.x,l=c-r.y,d=Math.sqrt(a*a+l*l),p=0,u=0;d>=Ft&&(p=a/d,u=l/d);let b=t.radius,h=o.radius,m=d-b-h;if(m>Ht)return s.clear();let f=r.x+b*p,y=r.y+b*u,x=i+-h*p,w=c+-h*u,g=f+.5*(x-f),S=y+.5*(w-y);s.normalX=e.q.c*p-e.q.s*u,s.normalY=e.q.s*p+e.q.c*u,s.normalX=e.q.c*p-e.q.s*u,s.normalY=e.q.s*p+e.q.c*u;let A=s.points[0];return A.anchorAX=e.q.c*g-e.q.s*S,A.anchorAY=e.q.s*g+e.q.c*S,A.anchorBX=A.anchorAX+(e.p.x-n.p.x),A.anchorBY=A.anchorAY+(e.p.y-n.p.y),A.pointX=e.p.x+A.anchorAX,A.pointY=e.p.y+A.anchorAY,A.separation=m,A.id=0,s.pointCount=1,s}function Dr(t,e,o,n,s){qo(e,n,Dt);let r=H(Dt,o.center),i=t.center1,c=t.center2,a=J(c,i),l,d=F(J(r,i),a),p=F(J(c,r),a);if(d<0)l=i;else if(p<0)l=c;else{let A=d/F(a,a);l=$(i,A,a)}let u=so(J(r,l)),b=u.length,h=u.normal,m=t.radius,f=o.radius,y=b-m-f;if(y>Ht)return s.clear();let x=$(l,m,h),w=$(r,-f,h),g=Zt(x,w,.5);s.normalX=e.q.c*h.x-e.q.s*h.y,s.normalY=e.q.s*h.x+e.q.c*h.y;let S=s.points[0];return S.anchorAX=e.q.c*g.x-e.q.s*g.y,S.anchorAY=e.q.s*g.x+e.q.c*g.y,S.anchorBX=S.anchorAX+(e.p.x-n.p.x),S.anchorBY=S.anchorAY+(e.p.y-n.p.y),S.pointX=e.p.x+S.anchorAX,S.pointY=e.p.y+S.anchorAY,S.separation=y,S.id=0,s.pointCount=1,s}var qt=new B;function ra(t,e,o,n,s){let r=Ht;qo(e,n,Dt),de(Dt,o.center,qt);let i=t.radius,c=o.radius,a=i+c,l=0,d=-Number.MAX_VALUE,p=t.count,u=t.vertices,b=t.normals;for(let g=0;g<p;++g){let S=b[g].x*(qt.x-u[g].x)+b[g].y*(qt.y-u[g].y);S>d&&(d=S,l=g)}if(d>a+r)return s.clear();let h=l,m=h+1<p?h+1:0,f=u[h],y=u[m],x=(qt.x-f.x)*(y.x-f.x)+(qt.y-f.y)*(y.y-f.y),w=(qt.x-y.x)*(f.x-y.x)+(qt.y-y.y)*(f.y-y.y);if(x<0&&d>Ft){let g=qt.x-f.x,S=qt.y-f.y,A=Math.sqrt(g*g+S*S),_=0,C=0;if(A>Ft){let L=1/A;_=g*L,C=S*L}if(d=(qt.x-f.x)*_+(qt.y-f.y)*C,d>a+r)return s.clear();let D=f.x+i*_,v=f.y+i*C,k=qt.x-c*_,P=qt.y-c*C,G=.5*(D+k),E=.5*(v+P);s.normalX=e.q.c*_-e.q.s*C,s.normalY=e.q.s*_+e.q.c*C;let X=s.points[0];X.anchorAX=e.q.c*G-e.q.s*E,X.anchorAY=e.q.s*G+e.q.c*E,X.anchorBX=X.anchorAX+(e.p.x-n.p.x),X.anchorBY=X.anchorAY+(e.p.y-n.p.y),X.pointX=e.p.x+X.anchorAX,X.pointY=e.p.y+X.anchorAY,X.separation=(k-D)*_+(P-v)*C,X.id=0,s.pointCount=1}else if(w<0&&d>Ft){let g=qt.x-y.x,S=qt.y-y.y,A=Math.sqrt(g*g+S*S),_=0,C=0;if(A>Ft){let L=1/A;_=g*L,C=S*L}if(d=(qt.x-y.x)*_+(qt.y-y.y)*C,d>a+r)return s.clear();let D=y.x+i*_,v=y.y+i*C,k=qt.x-c*_,P=qt.y-c*C,G=.5*(D+k),E=.5*(v+P);s.normalX=e.q.c*_-e.q.s*C,s.normalY=e.q.s*_+e.q.c*C;let X=s.points[0];X.anchorAX=e.q.c*G-e.q.s*E,X.anchorAY=e.q.s*G+e.q.c*E,X.anchorBX=X.anchorAX+(e.p.x-n.p.x),X.anchorBY=X.anchorAY+(e.p.y-n.p.y),X.pointX=e.p.x+X.anchorAX,X.pointY=e.p.y+X.anchorAY,X.separation=(k-D)*_+(P-v)*C,X.id=0,s.pointCount=1}else{let g=b[l].x,S=b[l].y;s.normalX=e.q.c*g-e.q.s*S,s.normalY=e.q.s*g+e.q.c*S;let A=i-((qt.x-f.x)*g+(qt.y-f.y)*S),_=qt.x+A*g,C=qt.y+A*S,D=qt.x-c*g,v=qt.y-c*S,k=(_+D)*.5,P=(C+v)*.5,G=s.points[0];G.anchorAX=e.q.c*k-e.q.s*P,G.anchorAY=e.q.s*k+e.q.c*P,G.anchorBX=G.anchorAX+(e.p.x-n.p.x),G.anchorBY=G.anchorAY+(e.p.y-n.p.y),G.pointX=e.p.x+G.anchorAX,G.pointY=e.p.y+G.anchorAY,G.separation=d-a,G.id=0,s.pointCount=1}return s}function kr(t,e,o,n,s){let r=t.center1;jr(e.p,1,K(e.q,r),Zc.p),Zc.q=e.q,qo(Zc,n,Dt),pt.x=0,pt.y=0,Kt.x=t.center2.x-r.x,Kt.y=t.center2.y-r.y,de(Dt,o.center1,ut),de(Dt,o.center2,$t);let i=Kt.x,c=Kt.y,a=$t.x-ut.x,l=$t.y-ut.y,d=i*i+c*c,p=a*a+l*l,u=pt.x-ut.x,b=pt.y-ut.y,h=u*i+b*c,m=u*a+b*l,f=i*a+c*l,y=d*p-f*f,x=0;y!==0&&(x=mt((f*m-h*p)/y,0,1));let w=(f*x+m)/p;w<0?(w=0,x=mt(-h/d,0,1)):w>1&&(w=1,x=mt((f-h)/d,0,1));let g={x:pt.x+x*i,y:pt.y+x*c},S={x:ut.x+w*a,y:ut.y+w*l},A=me(g,S),_=t.radius,C=o.radius,D=_+C,v=D+Ht;if(A>v*v){Xo(s);return}let k=Math.sqrt(A),P=Aa(i,c),G=i*1/P,E=c*1/P,X=Aa(a,l),L=a*1/X,W=l*1/X,tt=(ut.x-pt.x)*G+(ut.y-pt.y)*E,st=($t.x-pt.x)*G+($t.y-pt.y)*E,ot=tt<=0&&st<=0||tt>=P&&st>=P,j=(pt.x-ut.x)*G+(pt.y-ut.y)*W,nt=(Kt.x-ut.x)*G+(Kt.y-ut.y)*W,wt=j<=0&&nt<=0||j>=X&&nt>=X;if(s.pointCount=0,ot===!1&&wt===!1){let N,Q,Ct;{N=-E,Q=G;let lt=(ut.x-pt.x)*N+(ut.y-pt.y)*Q,Et=($t.x-pt.x)*N+($t.y-pt.y)*Q,Xt=Math.min(lt,Et),Jt=Math.max(-lt,-Et);Xt>Jt?Ct=Xt:(Ct=Jt,N=-N,Q=-Q)}let ct,At,Tt;{ct=-W,At=L;let lt=(pt.x-ut.x)*ct+(pt.y-ut.y)*At,Et=(Kt.x-ut.x)*ct+(Kt.y-ut.y)*At,Xt=Math.min(lt,Et),Jt=Math.max(-lt,-Et);Xt>Jt?Tt=Xt:(Tt=Jt,ct=-ct,At=-At)}if(Ct>=Tt){s.normalX=N,s.normalY=Q;let lt=ut.x,Et=ut.y,Xt=$t.x,Jt=$t.y;if(tt<0&&st>0){let bt=(0-tt)/(st-tt);lt=ut.x+bt*($t.x-ut.x),Et=ut.y+bt*($t.y-ut.y)}else if(st<0&&tt>0){let bt=(0-st)/(tt-st);Xt=$t.x+bt*(ut.x-$t.x),Jt=$t.y+bt*(ut.y-$t.y)}if(tt>P&&st<P){let bt=(tt-P)/(tt-st);lt=ut.x+bt*($t.x-ut.x),Et=ut.y+bt*($t.y-ut.y)}else if(st>P&&tt<P){let bt=(st-P)/(st-tt);Xt=$t.x+bt*(ut.x-$t.x),Jt=$t.y+bt*(ut.y-$t.y)}let Te=(lt-pt.x)*N+(Et-pt.y)*Q,Ge=(Xt-pt.x)*N+(Jt-pt.y)*Q;if(Te<=k+St||Ge<=k+St){let bt=.5*(_-C-Te);s.points[0].anchorAX=lt+bt*N,s.points[0].anchorAY=Et+bt*Q,s.points[0].separation=Te-D,s.points[0].id=ee(0,0),bt=.5*(_-C-Ge),s.points[1].anchorAX=Xt+bt*N,s.points[1].anchorAY=Jt+bt*Q,s.points[1].separation=Ge-D,s.points[1].id=ee(0,1),s.pointCount=2}}else{s.normalX=-ct,s.normalY=-At;let lt=pt.x,Et=pt.y,Xt=Kt.x,Jt=Kt.y;if(j<0&&nt>0){let bt=(0-j)/(nt-j);lt=pt.x+bt*(Kt.x-pt.x),Et=pt.y+bt*(Kt.y-pt.y)}else if(nt<0&&j>0){let bt=(0-nt)/(j-nt);Xt=Kt.x+bt*(pt.x-Kt.x),Jt=Kt.y+bt*(pt.y-Kt.y)}if(j>X&&nt<X){let bt=(j-X)/(j-nt);lt=pt.x+bt*(Kt.x-pt.x),Et=pt.y+bt*(Kt.y-pt.y)}else if(nt>X&&j<X){let bt=(nt-X)/(nt-j);Xt=Kt.x+bt*(pt.x-Kt.x),Jt=Kt.y+bt*(pt.y-Kt.y)}let Te=(lt-ut.x)*ct+(Et-ut.y)*At,Ge=(Xt-ut.x)*ct+(Jt-ut.y)*At;if(Te<=k+St||Ge<=k+St){let bt=.5*(C-_-Te);s.points[0].anchorAX=lt+bt*ct,s.points[0].anchorAY=Et+bt*At,s.points[0].separation=Te-D,s.points[0].id=ee(0,0),bt=.5*(C-_-Ge),s.points[1].anchorAX=Xt+bt*ct,s.points[1].anchorAY=Jt+bt*At,s.points[1].separation=Ge-D,s.points[1].id=ee(1,0),s.pointCount=2}}}if(s.pointCount===0){let N=S.x-g.x,Q=S.y-g.y,Ct=N*N+Q*Q;if(Ct>bn){let Jt=Math.sqrt(Ct);N/=Jt,Q/=Jt}else N=-E,Q=G;let ct=g.x+_*N,At=g.y+_*Q,Tt=S.x-C*N,lt=S.y-C*Q,Et=x===0?0:1,Xt=w===0?0:1;s.normalX=N,s.normalY=Q,s.points[0].anchorAX=(ct+Tt)*.5,s.points[0].anchorAY=(At+lt)*.5,s.points[0].separation=Math.sqrt(A)-D,s.points[0].id=ee(Et,Xt),s.pointCount=1}if(s.pointCount>0){let N=e.q.c*s.normalX-e.q.s*s.normalY,Q=e.q.s*s.normalX+e.q.c*s.normalY;s.normalX=N,s.normalY=Q;for(let Ct=0;Ct<s.pointCount;++Ct){let ct=s.points[Ct],At=ct.anchorAX+r.x,Tt=ct.anchorAY+r.y,lt=e.q.c*At-e.q.s*Tt,Et=e.q.s*At+e.q.c*Tt;ct.anchorAX=lt,ct.anchorAY=Et,ct.anchorBX=ct.anchorAX+(e.p.x-n.p.x),ct.anchorBY=ct.anchorAY+(e.p.y-n.p.y),ct.pointX=e.p.x+ct.anchorAX,ct.pointY=e.p.y+ct.anchorAY}}}var na=new _e;function ia(t,e,o,n,s){return na.center1=t.point1,na.center2=t.point2,na.radius=0,kr(na,e,o,n)}function aa(t,e,o,n,s){let r=rl(o.center1,o.center2,o.radius);return As(t,e,r,n,s)}function v2(t,e,o,n,s,r){let i,c,a,l,d,p;s?(i=e,l=t,c=n,a=n+1<e.count?n+1:0,d=o,p=o+1<t.count?o+1:0):(i=t,l=e,c=o,a=o+1<t.count?o+1:0,d=n,p=n+1<e.count?n+1:0);let u=i.normals[c],b=i.vertices[c],h=i.vertices[a],m=l.vertices[d],f=l.vertices[p],y=-1*u.y,x=1*u.x,w=0,g=h.x-b.x,S=h.y-b.y,A=g*y+S*x;g=m.x-b.x,S=m.y-b.y;let _=g*y+S*x;g=f.x-b.x,S=f.y-b.y;let C=g*y+S*x,D;C<w&&_-C>Ft?D=Zt(f,m,(w-C)/(_-C)):D=f;let v;_>A&&_-C>Ft?v=Zt(f,m,(A-C)/(_-C)):v=m;let k=ga(D,b,u),P=ga(v,b,u),G=i.radius,E=l.radius;jr(D,.5*(G-E-k),u,pt),jr(v,.5*(G-E-P),u,ut);let X=G+E;if(s===!1){r.normalX=u.x,r.normalY=u.y;let L=r.points[0];L.anchorAX=pt.x,L.anchorAY=pt.y,L.separation=k-X,L.id=ee(c,p),L=r.points[1],L.anchorAX=ut.x,L.anchorAY=ut.y,L.separation=P-X,L.id=ee(a,d),r.pointCount=2}else{r.normalX=-u.x,r.normalY=-u.y;let L=r.points[0];L.anchorAX=ut.x,L.anchorAY=ut.y,L.separation=P-X,L.id=ee(d,a),L=r.points[1],L.anchorAX=pt.x,L.anchorAY=pt.y,L.separation=k-X,L.id=ee(p,c),r.pointCount=2}return r}function J2(t,e){let o=t.count,n=e.count,s=t.normals,r=t.vertices,i=e.vertices,c=0,a=Number.NEGATIVE_INFINITY;for(let l=0;l<o;++l){let d=s[l],p=r[l].x,u=r[l].y,b=Number.POSITIVE_INFINITY;for(let h=0;h<n;++h){let m=i[h].x-p,f=i[h].y-u,y=d.x*m+d.y*f;y<b&&(b=y)}b>a&&(a=b,c=l)}return{edgeIndex:c,maxSeparation:a}}var Pt=new Be(Ae),Ot=new Be(Ae),tl=new B,el=new at;function As(t,e,o,n,s){let r=t.vertices[0].x,i=t.vertices[0].y;tl.x=e.p.x+(e.q.c*r-e.q.s*i),tl.y=e.p.y+(e.q.s*r+e.q.c*i),el.p=tl,el.q=e.q,qo(el,n,Dt),Pt.centroid=null,Pt.count=t.count,Pt.radius=t.radius,Pt.vertices[0].x=0,Pt.vertices[0].y=0,Pt.normals[0].x=t.normals[0].x,Pt.normals[0].y=t.normals[0].y;for(let m=1;m<Pt.count;++m){let f=Pt.vertices[m];f.x=t.vertices[m].x-r,f.y=t.vertices[m].y-i;let y=Pt.normals[m];y.x=t.normals[m].x,y.y=t.normals[m].y}Pt.centroid=null,Ot.count=o.count,Ot.radius=o.radius;for(let m=0;m<Ot.count;++m){let f=Ot.vertices[m],y=o.vertices[m];f.x=Dt.q.c*y.x-Dt.q.s*y.y+Dt.p.x,f.y=Dt.q.s*y.x+Dt.q.c*y.y+Dt.p.y;let x=Ot.normals[m];x.x=Dt.q.c*o.normals[m].x-Dt.q.s*o.normals[m].y,x.y=Dt.q.s*o.normals[m].x+Dt.q.c*o.normals[m].y}let c=J2(Pt,Ot),a=c.edgeIndex,l=c.maxSeparation,d=J2(Ot,Pt),p=d.edgeIndex,u=d.maxSeparation,b=Pt.radius+Ot.radius;if(l>Ht+b||u>Ht+b)return s.clear();let h;if(l>=u){h=!1;let m=Pt.normals[a],f=Ot.count,y=Ot.normals;p=0;let x=Number.MAX_VALUE;for(let w=0;w<f;++w){let g=m.x*y[w].x+m.y*y[w].y;g<x&&(x=g,p=w)}}else{h=!0;let m=Ot.normals[p],f=Pt.count,y=Pt.normals;a=0;let x=Number.MAX_VALUE;for(let w=0;w<f;++w){let g=m.x*y[w].x+m.y*y[w].y;g<x&&(x=g,a=w)}}if(l>.1*St||u>.1*St){let m=a,f=a+1<Pt.count?a+1:0,y=p,x=p+1<Ot.count?p+1:0,w=Pt.vertices[m],g=Pt.vertices[f],S=Ot.vertices[y],A=Ot.vertices[x],_=Qr(w.x,w.y,g.x,g.y,S.x,S.y,A.x,A.y);if(_.fraction1===0&&_.fraction2===0){let C=S.x-w.x,D=S.y-w.y,v=Math.sqrt(_.distanceSquared);if(v>Ht+b)return s.clear();let k=1/v;C*=k,D*=k;let P=w.x+Pt.radius*C,G=w.y+Pt.radius*D,E=S.x-Ot.radius*C,X=S.y-Ot.radius*D;s.normalX=C,s.normalY=D;let L=s.points[0];L.anchorAX=(P+E)*.5,L.anchorAY=(G+X)*.5,L.separation=v-b,L.id=ee(m,y),s.pointCount=1}else if(_.fraction1===0&&_.fraction2===1){let C=A.x-w.x,D=A.y-w.y,v=Math.sqrt(_.distanceSquared);if(v>Ht+b)return s.clear();let k=1/v;C*=k,D*=k;let P=w.x+Pt.radius*C,G=w.y+Pt.radius*D,E=A.x-Ot.radius*C,X=A.y-Ot.radius*D;s.normalX=C,s.normalY=D;let L=new vo;L.anchorAX=(P+E)*.5,L.anchorAY=(G+X)*.5,L.separation=v-b,L.id=ee(m,x),s.points[0]=L,s.pointCount=1}else if(_.fraction1===1&&_.fraction2===0){let C=S.x-g.x,D=S.y-g.y,v=Math.sqrt(_.distanceSquared);if(v>Ht+b)return s.clear();let k=1/v;C*=k,D*=k;let P=g.x+Pt.radius*C,G=g.y+Pt.radius*D,E=S.x-Ot.radius*C,X=S.y-Ot.radius*D;s.normalX=C,s.normalY=D;let L=new vo;L.anchorAX=(P+E)*.5,L.anchorAY=(G+X)*.5,L.separation=v-b,L.id=ee(f,y),s.points[0]=L,s.pointCount=1}else if(_.fraction1===1&&_.fraction2===1){let C=A.x-g.x,D=A.y-g.y,v=Math.sqrt(_.distanceSquared);if(v>Ht+b)return s.clear();let k=1/v;C*=k,D*=k;let P=g.x+Pt.radius*C,G=g.y+Pt.radius*D,E=A.x-Ot.radius*C,X=A.y-Ot.radius*D;s.normalX=C,s.normalY=D;let L=new vo;L.anchorAX=(P+E)*.5,L.anchorAY=(G+X)*.5,L.separation=v-b,L.id=ee(f,x),s.points[0]=L,s.pointCount=1}else v2(Pt,Ot,a,p,h,s)}else v2(Pt,Ot,a,p,h,s);if(s.pointCount>0){let m=s.normalX;s.normalX=e.q.c*s.normalX-e.q.s*s.normalY,s.normalY=e.q.s*m+e.q.c*s.normalY;for(let f=0;f<s.pointCount;++f){let y=s.points[f],x=y.anchorAX+r,w=y.anchorAY+i;y.anchorAX=e.q.c*x-e.q.s*w,y.anchorAY=e.q.s*x+e.q.c*w,y.anchorBX=y.anchorAX+(e.p.x-n.p.x),y.anchorBY=y.anchorAY+(e.p.y-n.p.y),y.pointX=e.p.x+y.anchorAX,y.pointY=e.p.y+y.anchorAY}}return s}function ca(t,e,o,n,s){let r=new _e;return r.center1=t.point1,r.center2=t.point2,r.radius=0,Dr(r,e,o,n,s)}function la(t,e,o,n,s){let r=rl(t.point1,t.point2,0);return As(r,e,o,n,s)}function da(t,e,o,n,s){qo(e,n,Dt);let r=H(Dt,o.center),i=t.segment.point1,c=t.segment.point2,a=J(c,i);if(F(be(a),J(r,i))<0)return s.clear();let d=F(a,J(c,r)),p=F(a,J(r,i)),u;if(p<=0){let A=J(i,t.ghost1);if(F(A,J(r,i))<=0)return s.clear();u=i}else if(d<=0){let A=J(t.ghost2,c);if(F(A,J(r,c))>0)return s.clear();u=c}else{let A=F(a,a);u=new B(d*i.x+p*c.x,d*i.y+p*c.y),u=A>0?it(1/A,u):i}let b=so(J(r,u)),h=b.length,m=b.normal,f=o.radius,y=h-f;if(y>Ht)return s.clear();let x=u,w=$(r,-f,m),g=Zt(x,w,.5);s.normalX=e.q.c*m.x-e.q.s*m.y,s.normalY=e.q.s*m.x+e.q.c*m.y;let S=s.points[0];return S.anchorAX=e.q.c*g.x-e.q.s*g.y,S.anchorAY=e.q.s*g.x+e.q.c*g.y,S.anchorBX=S.anchorAX+(e.p.x-n.p.x),S.anchorBY=S.anchorAY+(e.p.y-n.p.y),S.pointX=e.p.x+S.anchorAX,S.pointY=e.p.y+S.anchorAY,S.separation=y,S.id=0,s.pointCount=1,s}function ua(t,e,o,n,s,r){let i=rl(o.center1,o.center2,o.radius);return Pr(t,e,i,n,s,r)}function ol(t,e,o,n,s,r,i,c,a,l){let d=pe(s),p=0,u=F(J(e,t),d),b=F(J(o,t),d),h=F(J(n,t),d);if(b<p||u<h)return l.clear();let m;h<p&&b-h>Ft?m=Zt(n,o,(p-h)/(b-h)):m=n;let f;b>u&&b-h>Ft?f=Zt(n,o,(u-h)/(b-h)):f=o;let y=F(J(m,t),s),x=F(J(f,t),s);m=$(m,.5*(r-i-y),s),f=$(f,.5*(r-i-x),s);let w=r+i;l.normalX=s.x,l.normalY=s.y;let g=l.points[0];g.anchorAX=m.x,g.anchorAY=m.y,g.separation=y-w,g.id=c;let S=l.points[1];return S.anchorAX=f.x,S.anchorAY=f.y,S.separation=x-w,S.id=a,l.pointCount=2,l}var oo={b2_normalSkip:0,b2_normalAdmit:1,b2_normalSnap:2};function nl(t,e){return F(e,t.edge1)<=0?t.convex1?z(e,t.normal0)>.01?oo.b2_normalSkip:oo.b2_normalAdmit:oo.b2_normalSnap:t.convex2?z(t.normal2,e)>.01?oo.b2_normalSkip:oo.b2_normalAdmit:oo.b2_normalSnap}var sl=class{constructor(){this.edge1=new B,this.normal0=new B,this.normal2=new B,this.convex1=!1,this.convex2=!1}};function Pr(t,e,o,n,s,r){qo(e,n,Dt);let i=H(Dt,o.centroid),c=o.radius,a=t.segment.point1,l=t.segment.point2,d=dt(J(l,a)),p=new sl;p.edge1=d.clone();let u=.01,b=dt(J(a,t.ghost1));p.normal0=be(b),p.convex1=z(b,d)>=u;let h=dt(J(t.ghost2,l));p.normal2=be(h),p.convex2=z(d,h)>=u;let m=be(d),f=F(m,J(i,a))<0,y=!0,x=!0;if(p.convex1&&(y=F(p.normal0,J(i,a))<0),p.convex2&&(x=F(p.normal2,J(i,l))<0),f&&y&&x)return r.clear();let w=o.count,g=[],S=[];for(let W=0;W<w;++W)g[W]=H(Dt,o.vertices[W]),S[W]=K(Dt.q,o.normals[W]);let A=new ye;A.proxyA=vt([t.segment.point1,t.segment.point2],2,0),A.proxyB=vt(g,w,0),A.transformA=new at(new B(0,0),new rt(1,0)),A.transformB=new at(new B(0,0),new rt(1,0)),A.useRadii=!1;let _=Ce(s,A,null,0);if(_.distance>c+Ht)return r.clear();let C=p.convex1?p.normal0:m,D=p.convex2?p.normal2:m,v=-1,k=-1;if(f==!1&&_.distance>.1*St)if(s.count==1){let W=_.pointA,tt=_.pointB,st=dt(J(tt,W)),ot=nl(p,st);if(ot==oo.b2_normalSkip)return r.clear();if(ot==oo.b2_normalAdmit){r.normalX=e.q.c*st.x-e.q.s*st.y,r.normalY=e.q.s*st.x+e.q.c*st.y;let j=new vo;return j.anchorAX=e.q.c*W.x-e.q.s*W.y,j.anchorAY=e.q.s*W.x+e.q.c*W.y,j.anchorBX=j.anchorAX+(e.p.x-n.p.x),j.anchorBY=j.anchorAY+(e.p.y-n.p.y),j.pointX=e.p.x+j.anchorAX,j.pointY=e.p.y+j.anchorAY,j.separation=_.distance-c,j.id=ee(s.indexA[0],s.indexB[0]),r.points[0]=j,r.pointCount=1,r}v=s.indexB[0]}else{let W=s.indexA[0],tt=s.indexA[1],st=s.indexB[0],ot=s.indexB[1];if(W==tt){let j=J(_.pointA,_.pointB),nt=F(j,S[st]),wt=F(j,S[ot]),N=nt>wt?st:ot;j=S[N];let Q=nl(p,Qt(j));if(Q==oo.b2_normalSkip)return r.clear();if(Q==oo.b2_normalAdmit){st=N,ot=N<w-1?N+1:0;let Ct=g[st],ct=g[ot];if(nt=F(j,J(a,Ct)),wt=F(j,J(l,Ct)),nt<wt){if(F(C,j)<F(m,j))return r.clear()}else if(F(D,j)<F(m,j))return r.clear();ol(Ct,ct,a,l,j,c,0,ee(st,1),ee(ot,0),r),r.normalX=e.q.c*-j.x-e.q.s*-j.y,r.normalY=e.q.s*-j.x+e.q.c*-j.y,r.points[0].anchorAX=e.q.c*r.points[0].anchorAX-e.q.s*r.points[0].anchorAY,r.points[0].anchorAY=e.q.s*r.points[0].anchorAX+e.q.c*r.points[0].anchorAY,r.points[1].anchorAX=e.q.c*r.points[1].anchorAX-e.q.s*r.points[1].anchorAY,r.points[1].anchorAY=e.q.s*r.points[1].anchorAX+e.q.c*r.points[1].anchorAY;let At=J(e.p,n.p);return r.points[0].anchorBX=r.points[0].anchorAX+At.x,r.points[0].anchorBY=r.points[0].anchorAY+At.y,r.points[1].anchorBX=r.points[1].anchorAX+At.x,r.points[1].anchorBY=r.points[1].anchorAY+At.y,r.points[0].pointX=e.p.x+r.points[0].anchorAX,r.points[0].pointY=e.p.y+r.points[0].anchorAY,r.points[1].pointX=e.p.x+r.points[1].anchorAX,r.points[1].pointY=e.p.y+r.points[1].anchorAY,r}k=N}else{let j=F(m,J(g[st],a)),nt=F(m,J(g[ot],l));v=j<nt?st:ot}}else{let W=Number.MAX_VALUE;for(let ot=0;ot<w;++ot){let j=F(m,J(g[ot],a));j<W&&(W=j,v=ot)}if(p.convex1){let ot=Number.MAX_VALUE;for(let j=0;j<w;++j){let nt=F(p.normal0,J(g[j],a));nt<ot&&(ot=nt)}ot>W&&(W=ot,v=-1)}if(p.convex2){let ot=Number.MAX_VALUE;for(let j=0;j<w;++j){let nt=F(p.normal2,J(g[j],l));nt<ot&&(ot=nt)}ot>W&&(W=ot,v=-1)}let tt=-Number.MAX_VALUE,st=-1;for(let ot=0;ot<w;++ot){let j=S[ot];if(nl(p,Qt(j))!=oo.b2_normalAdmit)continue;let wt=g[ot],N=Math.min(F(j,J(l,wt)),F(j,J(a,wt)));N>tt&&(tt=N,st=ot)}if(tt>W){let ot=st,j=ot<w-1?ot+1:0,nt=g[ot],wt=g[j],N=S[ot],Q=F(N,J(a,nt)),Ct=F(N,J(l,nt));if(Q<Ct){if(F(C,N)<F(m,N))return r.clear()}else if(F(D,N)<F(m,N))return r.clear(0);ol(nt,wt,a,l,S[ot],c,0,ee(ot,1),ee(j,0),r),r.normalX=e.q.c*-S[ot].x-e.q.s*-S[ot].y,r.normalY=e.q.s*-S[ot].x+e.q.c*-S[ot].y,r.points[0].anchorAX=e.q.c*r.points[0].anchorAX-e.q.s*r.points[0].anchorAY,r.points[0].anchorAY=e.q.s*r.points[0].anchorAX+e.q.c*r.points[0].anchorAY,r.points[1].anchorAX=e.q.c*r.points[1].anchorAX-e.q.s*r.points[1].anchorAY,r.points[1].anchorAY=e.q.s*r.points[1].anchorAX+e.q.c*r.points[1].anchorAY;let ct=J(e.p,n.p);return r.points[0].anchorBX=r.points[0].anchorAX+ct.x,r.points[0].anchorBY=r.points[0].anchorAY+ct.y,r.points[1].anchorBX=r.points[1].anchorAX+ct.x,r.points[1].anchorBY=r.points[1].anchorAY+ct.y,r.points[0].pointX=e.p.x+r.points[0].anchorAX,r.points[0].pointY=e.p.y+r.points[0].anchorAY,r.points[1].pointX=e.p.x+r.points[1].anchorAX,r.points[1].pointY=e.p.y+r.points[1].anchorAY,r}if(v==-1)return r.clear()}let P,G,E,X;if(k!=-1)E=k,X=E<w-1?E+1:0,P=g[E],G=g[X];else{let W=v,tt=W>0?W-1:w-1,st=F(m,S[tt]),ot=F(m,S[W]);st<ot?(E=tt,X=W,P=g[E],G=g[X]):(E=W,X=W<w-1?W+1:0,P=g[E],G=g[X])}ol(a,l,P,G,m,0,c,ee(0,X),ee(1,E),r),r.normalX=e.q.c*r.normalX-e.q.s*r.normalY,r.normalY=e.q.s*r.normalX+e.q.c*r.normalY,r.points[0].anchorAX=e.q.c*r.points[0].anchorAX-e.q.s*r.points[0].anchorAY,r.points[0].anchorAY=e.q.s*r.points[0].anchorAX+e.q.c*r.points[0].anchorAY,r.points[1].anchorAX=e.q.c*r.points[1].anchorAX-e.q.s*r.points[1].anchorAY,r.points[1].anchorAY=e.q.s*r.points[1].anchorAX+e.q.c*r.points[1].anchorAY;let L=J(e.p,n.p);return r.points[0].anchorBX=r.points[0].anchorAX+L.x,r.points[0].anchorBY=r.points[0].anchorAY+L.y,r.points[1].anchorBX=r.points[1].anchorAX+L.x,r.points[1].anchorBY=r.points[1].anchorAY+L.y,r.points[0].pointX=e.p.x+r.points[0].anchorAX,r.points[0].pointY=e.p.y+r.points[0].anchorAY,r.points[1].pointX=e.p.x+r.points[1].anchorAX,r.points[1].pointY=e.p.y+r.points[1].anchorAY,r}var ht={b2_contactTouchingFlag:1,b2_contactHitEventFlag:2,b2_contactSensorFlag:4,b2_contactSensorTouchingFlag:8,b2_contactEnableSensorEvents:16,b2_contactEnableContactEvents:32},Tr=class{constructor(){this.bodyId=0,this.prevKey=0,this.nextKey=0}},ws=class{constructor(){this.setIndex=0,this.colorIndex=0,this.localIndex=0,this.edges=[new Tr,new Tr],this.shapeIdA=0,this.shapeIdB=0,this.islandPrev=0,this.islandNext=0,this.islandId=I,this.contactId=I,this.flags=0,this.isMarked=!1}},Nn=class{constructor(e=new Oo){this.contactId=0,this._bodyIdA=I,this._bodyIdB=I,this.bodySimIndexA=0,this.bodySimIndexB=0,this.shapeIdA=0,this.shapeIdB=0,this.invMassA=0,this.invIA=0,this.invMassB=0,this.invIB=0,this.manifold=e,this.friction=0,this.restitution=0,this.tangentSpeed=0,this.simFlags=0,this.cache=new Ie}set(e){this.contactId=e.contactId,this._bodyIdA=e._bodyIdA,this._bodyIdB=e._bodyIdB,this.bodySimIndexA=e.bodySimIndexA,this.bodySimIndexB=e.bodySimIndexB,this.shapeIdA=e.shapeIdA,this.shapeIdB=e.shapeIdB,this.invMassA=e.invMassA,this.invIA=e.invIA,this.invMassB=e.invMassB,this.invIB=e.invIB,e.manifold.copyTo(this.manifold),this.friction=e.friction,this.restitution=e.restitution,this.tangentSpeed=e.tangentSpeed,this.simFlags=e.simFlags,this.cache=e.cache.clone()}};function _m(t,e){return Math.sqrt(t*e)}function Bm(t,e){return Math.max(t,e)}var al=class{constructor(e=null,o=!1){this.fcn=e,this.primary=o}},dn=Array(Y.b2_shapeTypeCount).fill().map(()=>Array(Y.b2_shapeTypeCount).fill().map(()=>new al)),M2=!1;function Am(t,e,o,n,s,r){return sa(t.circle,e,o.circle,n,r)}function wm(t,e,o,n,s,r){return Dr(t.capsule,e,o.circle,n,r)}function Cm(t,e,o,n,s,r){return kr(t.capsule,e,o.capsule,n,r)}function vm(t,e,o,n,s,r){return ra(t.polygon,e,o.circle,n,r)}function Jm(t,e,o,n,s,r){return aa(t.polygon,e,o.capsule,n,r)}function Mm(t,e,o,n,s,r){return As(t.polygon,e,o.polygon,n,r)}function Dm(t,e,o,n,s,r){return ca(t.segment,e,o.circle,n,r)}function km(t,e,o,n,s,r){return ia(t.segment,e,o.capsule,n,r)}function Pm(t,e,o,n,s,r){return la(t.segment,e,o.polygon,n,r)}function Tm(t,e,o,n,s,r){return da(t.chainSegment,e,o.circle,n,r)}function Gm(t,e,o,n,s,r){return ua(t.chainSegment,e,o.capsule,n,s,r)}function Rm(t,e,o,n,s,r){return Pr(t.chainSegment,e,o.polygon,n,s,r)}function Xe(t,e,o){dn[e][o].fcn=t,dn[e][o].primary=!0,e!=o&&(dn[o][e].fcn=t,dn[o][e].primary=!1)}function cl(){M2===!1&&(Xe(Am,Y.b2_circleShape,Y.b2_circleShape),Xe(wm,Y.b2_capsuleShape,Y.b2_circleShape),Xe(Cm,Y.b2_capsuleShape,Y.b2_capsuleShape),Xe(vm,Y.b2_polygonShape,Y.b2_circleShape),Xe(Jm,Y.b2_polygonShape,Y.b2_capsuleShape),Xe(Mm,Y.b2_polygonShape,Y.b2_polygonShape),Xe(Dm,Y.b2_segmentShape,Y.b2_circleShape),Xe(km,Y.b2_segmentShape,Y.b2_capsuleShape),Xe(Pm,Y.b2_segmentShape,Y.b2_polygonShape),Xe(Tm,Y.b2_chainSegmentShape,Y.b2_circleShape),Xe(Gm,Y.b2_chainSegmentShape,Y.b2_capsuleShape),Xe(Rm,Y.b2_chainSegmentShape,Y.b2_polygonShape),M2=!0)}function pa(t,e,o){let n=e.type,s=o.type;if(dn[n][s].fcn===null)return;if(dn[n][s].primary===!1){pa(t,o,e);return}let r=gt(t,e.bodyId),i=gt(t,o.bodyId),c;r.setIndex===M.b2_awakeSet||i.setIndex===M.b2_awakeSet?c=M.b2_awakeSet:c=M.b2_disabledSet;let a=t.solverSetArray[c],l=ne(t.contactIdPool);for(;t.contactArray.length<=l;)t.contactArray.push(new ws);let d=e.id,p=o.id,u=t.contactArray[l];u.contactId=l,u.setIndex=c,u.colorIndex=I,u.localIndex=a.contacts.count,u.islandId=I,u.islandPrev=I,u.islandNext=I,u.shapeIdA=d,u.shapeIdB=p,u.isMarked=!1,u.flags=0,(e.isSensor||o.isSensor)&&(u.flags|=ht.b2_contactSensorFlag),(e.enableSensorEvents||o.enableSensorEvents)&&(u.flags|=ht.b2_contactEnableSensorEvents),(e.enableContactEvents||o.enableContactEvents)&&(u.flags|=ht.b2_contactEnableContactEvents);{u.edges[0].bodyId=e.bodyId,u.edges[0].prevKey=I,u.edges[0].nextKey=r.headContactKey;let m=l<<1|0,f=r.headContactKey;if(f!==I){let y=t.contactArray[f>>1];y.edges[f&1].prevKey=m}r.headContactKey=m,r.contactCount+=1}{u.edges[1].bodyId=o.bodyId,u.edges[1].prevKey=I,u.edges[1].nextKey=i.headContactKey;let m=l<<1|1,f=i.headContactKey;if(i.headContactKey!==I){let y=t.contactArray[f>>1];y.edges[f&1].prevKey=m}i.headContactKey=m,i.contactCount+=1}let b=Es(d,p);Rs(t.broadPhase.pairSet,b);let h=Le(a.contacts);h.contactId=l,h._bodyIdA=e.bodyId,h._bodyIdB=o.bodyId,h.bodySimIndexA=I,h.bodySimIndexB=I,h.invMassA=0,h.invIA=0,h.invMassB=0,h.invIB=0,h.shapeIdA=d,h.shapeIdB=p,h.friction=_m(e.friction,o.friction),h.restitution=Bm(e.restitution,o.restitution),h.tangentSpeed=0,h.simFlags=0,(e.enablePreSolveEvents||o.enablePreSolveEvents)&&(h.simFlags|=Yt.b2_simEnablePreSolveEvents)}function mo(t,e,o){let n=Es(e.shapeIdA,e.shapeIdB);Ls(t.broadPhase.pairSet,n);let s=e.edges[0],r=e.edges[1],i=s.bodyId,c=r.bodyId,a=gt(t,i),l=gt(t,c),d=e.flags;if(d&(ht.b2_contactTouchingFlag|ht.b2_contactSensorTouchingFlag)&&d&(ht.b2_contactEnableContactEvents|ht.b2_contactEnableSensorEvents)){let h=t.worldId,m=t.shapeArray[e.shapeIdA],f=t.shapeArray[e.shapeIdB],y=new _t(m.id+1,h,m.revision),x=new _t(f.id+1,h,f.revision);if(d&ht.b2_contactTouchingFlag&&d&ht.b2_contactEnableContactEvents){let w=new Jn(y,x);t.contactEndArray.push(w)}if(d&ht.b2_contactSensorTouchingFlag&&d&ht.b2_contactEnableSensorEvents){let w=new vn;m.isSensor?(w.sensorShapeId=y,w.visitorShapeId=x):(w.sensorShapeId=x,w.visitorShapeId=y),t.sensorEndEventArray.push(w)}}if(s.prevKey!==I){let m=t.contactArray[s.prevKey>>1].edges[s.prevKey&1];m.nextKey=s.nextKey}if(s.nextKey!==I){let m=t.contactArray[s.nextKey>>1].edges[s.nextKey&1];m.prevKey=s.prevKey}let p=e.contactId,u=p<<1|0;if(a.headContactKey===u&&(a.headContactKey=s.nextKey),a.contactCount-=1,r.prevKey!==I){let m=t.contactArray[r.prevKey>>1].edges[r.prevKey&1];m.nextKey=r.nextKey}if(r.nextKey!==I){let m=t.contactArray[r.nextKey>>1].edges[r.nextKey&1];m.prevKey=r.prevKey}let b=p<<1|1;if(l.headContactKey===b&&(l.headContactKey=r.nextKey),l.contactCount-=1,e.islandId!==I&&Ar(t,e),e.colorIndex!==I)cr(t,i,c,e.colorIndex,e.localIndex);else{let h=t.solverSetArray[e.setIndex];if(to(h.contacts,e.localIndex)!==I){let f=h.contacts.data[e.localIndex];t.contactArray[f.contactId].localIndex=e.localIndex}}e.contactId=I,e.setIndex=I,e.colorIndex=I,e.localIndex=I,fe(t.contactIdPool,p),o&&(Wt(t,a),Wt(t,l))}function Gn(t,e){return e.setIndex===M.b2_awakeSet&&e.colorIndex!==I?t.constraintGraph.colors[e.colorIndex].contacts.data[e.localIndex]:t.solverSetArray[e.setIndex].contacts.data[e.localIndex]}function _r(t,e){return t.groupIndex===e.groupIndex&&t.groupIndex!==0?t.groupIndex>0:(t.maskBits&e.categoryBits)!==0&&(t.categoryBits&e.maskBits)!==0}function Lm(t,e,o,n,s){let r=new ye;return r.proxyA=ze(t),r.proxyB=ze(o),r.transformA=e,r.transformB=n,r.useRadii=!0,Ce(s,r,null,0).distance<10*Ft}var il=new Oo;function ll(t,e,o,n,s,r,i,c){let a;if(o.isSensor||r.isSensor)a=Lm(o,n,r,i,e.cache);else{e.manifold.copyTo(il);let l=dn[o.type][r.type].fcn;l(o,n,r,i,e.cache,e.manifold);let d=e.manifold.pointCount;if(a=d>0,a&&t.preSolveFcn&&e.simFlags&Yt.b2_simEnablePreSolveEvents){let p=new _t(o.id+1,t.worldId,o.revision),u=new _t(r.id+1,t.worldId,r.revision);a=t.preSolveFcn(p,u,e.manifold,t.preSolveContext),a==!1&&(e.manifold.pointCount=0)}a&&(o.enableHitEvents||r.enableHitEvents)?e.simFlags|=Yt.b2_simEnableHitEvent:e.simFlags&=~Yt.b2_simEnableHitEvent;for(let p=0;p<d;++p){let u=e.manifold.points[p];u.anchorAX-=s.x,u.anchorAY-=s.y,u.anchorBX-=c.x,u.anchorBY-=c.y,u.normalImpulse=0,u.tangentImpulse=0,u.maxNormalImpulse=0,u.normalVelocity=0,u.persisted=!1;let b=u.id;for(let h=0,m=il.pointCount;h<m;++h){let f=il.points[h];if(f.id===b){u.normalImpulse=f.normalImpulse,u.tangentImpulse=f.tangentImpulse,u.persisted=!0;break}}}}return a?e.simFlags|=Yt.b2_simTouchingFlag:e.simFlags&=~Yt.b2_simTouchingFlag,a}function fu(t,e,o,n,s){let r=dn[t.type][o.type].fcn,i=new Ie;return r(t,e,o,n,i,s)}var Yt={b2_simTouchingFlag:65536,b2_simDisjoint:131072,b2_simStartedTouching:262144,b2_simStoppedTouching:524288,b2_simEnableHitEvent:1048576,b2_simEnablePreSolveEvents:2097152};var Gr=class{constructor(){this.trees=new Array(et.b2_bodyTypeCount).fill().map(()=>new Ln),this.moveSet=null,this.moveArray=null,this.moveResults=null,this.movePairs=null,this.movePairCapacity=0,this.movePairIndex=0,this.pairSet=null}},Ro=t=>t&3,sn=t=>t>>2,bl=(t,e)=>t<<2|e;function rn(t,e){Rs(t.moveSet,e+1)||t.moveArray.push(e)}function hl(t){t.moveSet=Yr(),t.moveArray=[],t.moveResults=null,t.movePairs=null,t.movePairCapacity=0,t.movePairIndex=0,t.pairSet=Yr();for(let e=0;e<et.b2_bodyTypeCount;++e)t.trees[e]=Bi()}function ml(t){for(let e=0;e<et.b2_bodyTypeCount;++e)Ai(t.trees[e]);Nr(t.moveSet),t.moveArray=null,Nr(t.pairSet),Object.keys(t).forEach(e=>delete t[e])}function Em(t,e){if(Ls(t.moveSet,e+1)){let n=t.moveArray.length;for(let s=0;s<n;++s)if(t.moveArray[s]===e){t.moveArray[s]=t.moveArray[n-1],t.moveArray.pop();break}}}function hi(t,e,o,n,s,r){let i=wi(t.trees[e],o,n,s),c=bl(i,e);return(e!==et.b2_staticBody||r)&&rn(t,c),c}function mi(t,e){Em(t,e);let o=Ro(e),n=sn(e);Ci(t.trees[o],n)}function ir(t,e,o){let n=Ro(e),s=sn(e);vi(t.trees[n],s,o),rn(t,e)}function ac(t,e,o){let n=Ro(e),s=sn(e);Rn(t.trees[n],s,o),rn(t,e)}var dl=class{constructor(){this.shapeIndexA=0,this.shapeIndexB=0,this.next=null}},ul=class{constructor(){this.pairList=null}},pl=class{constructor(){this.world=null,this.moveResult=null,this.queryTreeType=0,this.queryProxyKey=0,this.queryShapeIndex=0}};function Ka(t,e,o){let n=o,s=n.world.broadPhase,r=bl(t,n.queryTreeType);if(r===n.queryProxyKey||n.queryTreeType!==et.b2_staticBody&&r<n.queryProxyKey&&Wr(s.moveSet,r+1))return!0;let i=Es(e,n.queryShapeIndex);if(Wr(s.pairSet,i))return!0;let c,a;r<n.queryProxyKey?(c=e,a=n.queryShapeIndex):(c=n.queryShapeIndex,a=e);let l=n.world,d=l.shapeArray[c],p=l.shapeArray[a],u=d.bodyId,b=p.bodyId;if(u===b||!_r(d.filter,p.filter)||d.isSensor&&p.isSensor)return!0;let h=gt(l,u),m=gt(l,b);if(!gr(l,h,m))return!0;let f=n.world.customFilterFcn;if(f){let w=new _t(c+1,l.worldId,d.revision),g=new _t(a+1,l.worldId,p.revision);if(!f(w,g,n.world.customFilterContext))return!0}let y=s.movePairIndex++,x;return y<s.movePairCapacity?x=s.movePairs[y]:x=new dl,x.shapeIndexA=c,x.shapeIndexB=a,x.next=n.moveResult.pairList,n.moveResult.pairList=x,!0}function yl(t){let e=t.broadPhase,o=e.moveArray.length;if(o===0)return;let n=t.stackAllocator;e.moveResults=Oe(n,o,"move results",()=>new ul),jm(0,o,t);let s=t.shapeArray;for(let r of e.moveResults)for(let i=r.pairList;i;i=i.next)pa(t,s[i.shapeIndexA],s[i.shapeIndexB]);e.moveArray.length=0,Ja(e.moveSet),Ue(n,e.moveResults),e.moveResults=null,Lt(t)}function jm(t,e,o){let n=o.broadPhase,s=new pl;s.world=o;for(let r=t;r<e;++r){let i=n.moveArray[r];if(i===I)continue;let c=Ro(i),a=sn(i);s.queryProxyKey=i;let l=n.trees[c],d=l.nodes[a].aabb;s.queryShapeIndex=mu(l,a);let p=n.moveResults[r];p.pairList=null,s.moveResult=p,c===et.b2_dynamicBody&&(D2(n,d,s,et.b2_kinematicBody),D2(n,d,s,et.b2_staticBody)),s.queryTreeType=et.b2_dynamicBody,Ji(n.trees[et.b2_dynamicBody],d,s)}}function D2(t,e,o,n){o.queryTreeType=n,Ji(t.trees[n],e,o)}function fl(t){hr(t.trees[et.b2_dynamicBody]),hr(t.trees[et.b2_kinematicBody])}var Cs=32,M={b2_staticSet:0,b2_disabledSet:1,b2_awakeSet:2,b2_firstSleepingSet:3},Rr=class{stackAllocator=new Kn;broadPhase=new Gr;constraintGraph=new ds;bodyArray=[];solverSetArray=[];jointArray=[];contactArray=[];islandArray=[];shapeArray=[];chainArray=[];taskContextArray=[];bodyMoveEventArray=[];sensorBeginEventArray=[];sensorEndEventArray=[];contactBeginArray=[];contactEndArray=[];contactHitArray=[];debugBodySet=new ke;debugJointSet=new ke;debugContactSet=new ke;stepIndex=0;splitIslandId=0;gravity=new B(0,0);hitEventThreshold=0;restitutionThreshold=0;maxLinearVelocity=0;contactPushoutVelocity=0;contactHertz=0;contactDampingRatio=0;jointHertz=0;jointDampingRatio=0;revision=0;preSolveFcn=null;preSolveContext=null;customFilterFcn=null;customFilterContext=null;workerCount=0;userTaskContext=null;userTreeTask=null;inv_h=0;worldId=new Yo;enableSleep=!0;locked=!1;enableWarmStarting=!1;enableContinuous=!1;inUse=!1},Lr=class{constructor(){this.world=null,this.fcn=null,this.filter=null,this.proxy=null,this.transform=null,this.userContext=null}},On=class{constructor(){this.world=null,this.fcn=null,this.filter=null,this.fraction=0,this.userContext=null}},_l=class{constructor(){this.contactStateBitSet=new ke,this.enlargedSimBitSet=new ke,this.awakeIslandBitSet=new ke,this.splitSleepTime=0,this.splitIslandId=I}};function ft(t){return Se[t.index1-1]}function U(t){return Se[t]}function yt(t){let e=Se[t];return e.locked?null:e}var Se=null;function ba(){if(Se==null){Se=[];for(let t=0;t<Cs;t++)Se[t]=new Rr,Se[t].inUse=!1}}function ha(t){let e=I;for(let r=0;r<Se.length;++r)if(Se[r].inUse===!1){e=r;break}if(e===I)return new Yo(0,0);cl();let o=Se[e],n=o.revision;o.worldId=e,o.revision=n,o.inUse=!0,o.stackAllocator=Da(),hl(o.broadPhase),o.constraintGraph=Fa(o.constraintGraph,16),o.bodyIdPool=ko("body"),o.bodyArray=[],o.solverSetArray=[],o.solverSetIdPool=ko("solverSet");let s;s=new eo,s.setIndex=ne(o.solverSetIdPool),o.solverSetArray.push(s),s=new eo,s.setIndex=ne(o.solverSetIdPool),o.solverSetArray.push(s),s=new eo,s.setIndex=ne(o.solverSetIdPool),o.solverSetArray.push(s),o.shapeIdPool=ko("shapeId"),o.shapeArray=[],o.chainIdPool=ko("chainId"),o.chainArray=[],o.contactIdPool=ko("contactId"),o.contactArray=[];for(let r=0;r<4096;r++)o.contactArray.push(new ws);o.jointIdPool=ko("jointId"),o.jointArray=[],o.islandIdPool=ko("islandId"),o.islandArray=[],o.bodyMoveEventArray=[],o.sensorBeginEventArray=[],o.sensorEndEventArray=[],o.contactBeginArray=[],o.contactEndArray=[],o.contactHitArray=[],o.stepIndex=0,o.splitIslandId=I,o.gravity=t.gravity,o.hitEventThreshold=t.hitEventThreshold,o.restitutionThreshold=t.restitutionThreshold,o.maxLinearVelocity=t.maximumLinearVelocity,o.contactPushoutVelocity=t.contactPushoutVelocity,o.contactHertz=t.contactHertz,o.contactDampingRatio=t.contactDampingRatio,o.jointHertz=t.jointHertz,o.jointDampingRatio=t.jointDampingRatio,o.enableSleep=t.enableSleep,o.locked=!1,o.enableWarmStarting=!0,o.enableContinuous=t.enableContinuous,o.userTreeTask=null,o.workerCount=1,o.userTaskContext=null,o.taskContextArray=[];for(let r=0;r<o.workerCount;++r){let i=new _l;i.contactStateBitSet=Ke(1024),i.enlargedSimBitSet=Ke(256),i.awakeIslandBitSet=Ke(256),o.taskContextArray[r]=i}return o.debugBodySet=Ke(256),o.debugJointSet=Ke(256),o.debugContactSet=Ke(256),new Yo(e+1,o.revision)}function P2(t){let e=ft(t);He(e.debugBodySet),He(e.debugJointSet),He(e.debugContactSet);for(let r=0;r<e.workerCount;++r)He(e.taskContextArray[r].contactStateBitSet),He(e.taskContextArray[r].enlargedSimBitSet),He(e.taskContextArray[r].awakeIslandBitSet);e.taskContextArray=null,e.bodyMoveEventArray=null,e.sensorBeginEventArray=null,e.sensorEndEventArray=null,e.contactBeginArray=null,e.contactEndArray=null,e.contactHitArray=null;let o=e.chainArray.length;for(let r=0;r<o;++r){let i=e.chainArray[r];i.id!==I&&(i.shapeIndices=null)}e.bodyArray=null,e.shapeArray=null,e.chainArray=null,e.contactArray=null,e.jointArray=null,e.islandArray=null;let n=e.solverSetArray.length;for(let r=0;r<n;++r)e.solverSetArray[r].setIndex!==I&&En(e,r);e.solverSetArray=null,qa(e.constraintGraph),ml(e.broadPhase),Po(e.bodyIdPool),Po(e.shapeIdPool),Po(e.chainIdPool),Po(e.contactIdPool),Po(e.jointIdPool),Po(e.islandIdPool),Po(e.solverSetIdPool),ka(e.stackAllocator);let s=e.revision;e=new Rr,e.worldId=I,e.revision=s+1}var xl=new B,Il=new B;function Xm(t,e,o,n){let s=n,r=s.world,i=r.taskContextArray[o],c=s.contacts,a=r.shapeArray,l=r.bodyArray;for(let d=t;d<e;++d){let p=c[d],u=p.contactId,b=a[p.shapeIdA],h=a[p.shapeIdB];if(!tn(b.fatAABB,h.fatAABB))p.simFlags|=Yt.b2_simDisjoint,p.simFlags&=~Yt.b2_simTouchingFlag,Qe(i.contactStateBitSet,u);else{let f=(p.simFlags&Yt.b2_simTouchingFlag)!==0,y=l[b.bodyId],x=l[h.bodyId],w=jt(r,y),g=jt(r,x);p.bodySimIndexA=y.setIndex===M.b2_awakeSet?y.localIndex:I,p.invMassA=w.invMass,p.invIA=w.invInertia,p.bodySimIndexB=x.setIndex===M.b2_awakeSet?x.localIndex:I,p.invMassB=g.invMass,p.invIB=g.invInertia;let S=w.transform,A=g.transform;xl.x=S.q.c*w.localCenter.x-S.q.s*w.localCenter.y,xl.y=S.q.s*w.localCenter.x+S.q.c*w.localCenter.y,Il.x=A.q.c*g.localCenter.x-A.q.s*g.localCenter.y,Il.y=A.q.s*g.localCenter.x+A.q.c*g.localCenter.y;let _=ll(r,p,b,S,xl,h,A,Il);_&&!f?(p.simFlags|=Yt.b2_simStartedTouching,Qe(i.contactStateBitSet,u)):!_&&f&&(p.simFlags|=Yt.b2_simStoppedTouching,Qe(i.contactStateBitSet,u))}}}function Fm(t,e,o){let n=t.solverSetArray[M.b2_awakeSet];e.colorIndex=I,e.localIndex=n.contacts.count,Le(n.contacts).set(o)}function qm(t,e,o){let n=t.solverSetArray[e];if(to(n.contacts,o)!==I){let r=n.contacts.data[o],i=t.contactArray[r.contactId];i.localIndex=o}}function Vm(t){let e=t.world;fl(e.broadPhase);let o=0,n=e.constraintGraph.colors;for(let b=0;b<te;++b)o+=n[b].contacts.count;let s=e.solverSetArray[M.b2_awakeSet].contacts.count;if(o+=s,o==0)return;let r=[],i=0;for(let b=0;b<te;++b){let h=n[b],m=h.contacts.count,f=h.contacts.data;for(let y=0;y<m;++y)r.push(f[y]),i+=1}{let b=e.solverSetArray[M.b2_awakeSet].contacts.data;for(let h=0;h<s;++h)r.push(b[h]),i+=1}t.contacts=r;let c=Zn(e.contactIdPool);for(let b=0;b<e.workerCount;++b)e.taskContextArray[b].contactStateBitSet=$e(e.taskContextArray[b].contactStateBitSet,c);Xm(0,o,0,t),t.contacts=null;let a=e.taskContextArray[0].contactStateBitSet;for(let b=1;b<e.workerCount;++b)ls(a,e.taskContextArray[b].contactStateBitSet);let l=e.contactArray,d=e.solverSetArray[M.b2_awakeSet],p=e.shapeArray,u=e.worldId;for(let b=0;b<a.blockCount;++b){let h=a.bits[b];for(;h!=0n;){let m=mr(h),f=64*b+m,y=l[f],x=y.colorIndex,w=y.localIndex,g;x!=I?g=n[x].contacts.data[w]:g=d.contacts.data[w];let S=p[y.shapeIdA],A=p[y.shapeIdB],_=new _t(S.id+1,u,S.revision),C=new _t(A.id+1,u,A.revision),D=y.flags,v=g.simFlags;if(v&Yt.b2_simDisjoint){if(D&ht.b2_contactTouchingFlag&&D&ht.b2_contactEnableContactEvents){let k=new Jn;k.shapeIdA=_,k.shapeIdB=C,e.contactEndArray.push(k)}y.flags&=~ht.b2_contactTouchingFlag,mo(e,y,!1)}else if(v&Yt.b2_simStartedTouching)if(D&ht.b2_contactSensorFlag){if(D&ht.b2_contactEnableSensorEvents){if(S.isSensor){let k=new Ns;k.sensorShapeId=_,k.visitorShapeId=C,e.sensorBeginEventArray.push(k)}if(A.isSensor){let k=new Ns;k.sensorShapeId=C,k.visitorShapeId=_,e.sensorBeginEventArray.push(k)}}g.simFlags&=~Yt.b2_simStartedTouching,y.flags|=ht.b2_contactSensorTouchingFlag}else{if(D&ht.b2_contactEnableContactEvents){let k=new zr;k.shapeIdA=_,k.shapeIdB=C,k.manifold=g.manifold,e.contactBeginArray.push(k)}y.flags|=ht.b2_contactTouchingFlag,Kc(e,y),g=d.contacts.data[w],g.simFlags&=~Yt.b2_simStartedTouching,ar(e,g,y),qm(e,M.b2_awakeSet,w)}else if(v&Yt.b2_simStoppedTouching)if(g.simFlags&=~Yt.b2_simStoppedTouching,D&ht.b2_contactSensorFlag){if(y.flags&=~ht.b2_contactSensorTouchingFlag,D&ht.b2_contactEnableSensorEvents){if(S.isSensor){let k=new vn;k.sensorShapeId=_,k.visitorShapeId=C,e.sensorEndEventArray.push(k)}if(A.isSensor){let k=new vn;k.sensorShapeId=C,k.visitorShapeId=_,e.sensorEndEventArray.push(k)}}}else{if(y.flags&=~ht.b2_contactTouchingFlag,y.flags&ht.b2_contactEnableContactEvents){let G=new Jn;G.shapeIdA=_,G.shapeIdB=C,e.contactEndArray.push(G)}Ar(e,y);let k=y.edges[0].bodyId,P=y.edges[1].bodyId;Fm(e,y,g),cr(e,k,P,x,w)}h=h&h-1n}}Lt(e),dh(e)}Fe.b2Vec2Count=0;Ll.calls={};Fe.b2Rot2Count=0;El.calls={};Fe.b2ManifoldCount=0;Fe.b2ManifoldPointCount=0;jl.calls={};Fe.b2PolyCollideCount=0;Fe.b2ContactSimCount=0;Fe.b2TOIInputCount=0;Fe.b2ShapeCastPairInputCount=0;Fe.b2SweepCount=0;function ma(t,e,o){Fe.b2FrameCount++;let n=ft(t);if(n.locked||(n.bodyMoveEventArray=[],n.sensorBeginEventArray=[],n.sensorEndEventArray=[],n.contactBeginArray=[],n.contactEndArray=[],n.contactHitArray=[],e===0))return;n.locked=!0,yl(n);let s=new xs;s.world=n,s.dt=e,s.subStepCount=Math.max(1,o),e>0?(s.inv_dt=1/e,s.h=e/s.subStepCount,s.inv_h=s.subStepCount*s.inv_dt):(s.inv_dt=0,s.h=0,s.inv_h=0),n.inv_h=s.inv_h;let r=Math.min(n.contactHertz,.25*s.inv_h),i=Math.min(n.jointHertz,.125*s.inv_h);s.contactSoftness=ie(r,n.contactDampingRatio,s.h),s.staticSoftness=ie(2*r,n.contactDampingRatio,s.h),s.jointSoftness=ie(i,n.jointDampingRatio,s.h),s.restitutionThreshold=n.restitutionThreshold,s.maxLinearVelocity=n.maxLinearVelocity,s.enableWarmStarting=n.enableWarmStarting,Vm(s),s.dt>0&&sc(n,s),n.locked=!1}var un=new B,Wn=new B,Ym=new rt,Sl=new at(un,Ym);function T2(t,e,o,n){let s=o.clone();switch(e.type){case Y.b2_capsuleShape:{let r=e.capsule;de(s,r.center1,un),de(s,r.center2,Wn),e.image?t.DrawImageCapsule(un,Wn,r.radius,e,t.context):e.imageNoDebug||t.DrawSolidCapsule(un,Wn,r.radius,n,t.context)}break;case Y.b2_circleShape:{let r=e.circle;Nl(s,r.center,Sl),e.image?t.DrawImageCircle(Sl,r.radius,e,t.context):e.imageNoDebug||t.DrawSolidCircle(Sl,r.radius,n,t.context)}break;case Y.b2_polygonShape:{let r=e.polygon;e.image?t.DrawImagePolygon(s,e,t.context):e.imageNoDebug||t.DrawSolidPolygon(s,r.vertices,r.count,r.radius,n,t.context)}break;case Y.b2_segmentShape:{let r=e.segment;de(s,r.point1,un),de(s,r.point2,Wn),e.imageNoDebug||t.DrawSegment(un,Wn,n,t.context)}break;case Y.b2_chainSegmentShape:{let r=e.chainSegment.segment;de(s,r.point1,un),de(s,r.point2,Wn),e.imageNoDebug||t.DrawSegment(un,Wn,n,t.context)}break;default:break}}var Bl=class{constructor(e,o){this.world=e,this.draw=o}};function Nm(t,e,o){let n=o,s=n.world,r=n.draw,i=s.shapeArray[e];if(Qe(s.debugBodySet,i.bodyId),r.drawShapes){let c=s.bodyArray[i.bodyId],a=jt(s,c),l;c.setIndex>=M.b2_firstSleepingSet?l=V.b2_colorGray:i.customColor!==0?l=i.customColor:c.type===et.b2_dynamicBody&&a.mass===0?l=V.b2_colorRed:c.setIndex===M.b2_disabledSet?l=V.b2_colorSlateGray:i.isSensor?l=V.b2_colorWheat:a.isBullet&&c.setIndex===M.b2_awakeSet?l=V.b2_colorTurquoise:c.isSpeedCapped?l=V.b2_colorYellow:a.isFast?l=V.b2_colorSalmon:c.type===et.b2_staticBody?l=V.b2_colorPaleGreen:c.type===et.b2_kinematicBody?l=V.b2_colorRoyalBlue:c.setIndex===M.b2_awakeSet?l=V.b2_colorPink:l=V.b2_colorGray,T2(r,i,a.transform,l)}if(r.drawAABBs){let c=i.fatAABB,a=[new B(c.lowerBoundX,c.lowerBoundY),new B(c.upperBoundX,c.lowerBoundY),new B(c.upperBoundX,c.upperBoundY),new B(c.lowerBoundX,c.upperBoundY)];r.DrawPolygon(a,4,V.b2_colorGold,r.context)}return!0}function Wm(t,e){let o=1,n=.3,s=V.b2_colorGray3,r=V.b2_colorGreen,i=V.b2_colorBlue,c=V.b2_colorGray9,a=V.b2_colorMagenta,l=V.b2_colorYellow,d=[V.b2_colorRed,V.b2_colorOrange,V.b2_colorYellow,V.b2_colorGreen,V.b2_colorCyan,V.b2_colorBlue,V.b2_colorViolet,V.b2_colorPink,V.b2_colorChocolate,V.b2_colorGoldenrod,V.b2_colorCoral,V.b2_colorBlack],p=Zn(t.bodyIdPool);t.debugBodySet=$e(t.debugBodySet,p);let u=Zn(t.jointIdPool);t.debugJointSet=$e(t.debugJointSet,u);let b=Zn(t.contactIdPool);t.debugContactSet=$e(t.debugContactSet,b);let h=new Bl(t,e);for(let y=0;y<et.b2_bodyTypeCount;++y)Pe(t.broadPhase.trees[y],e.drawingBounds,In,Nm,h);let m=t.debugBodySet.blockCount,f=t.debugBodySet.bits;for(let y=0;y<m;++y){let x=f[y];for(;x!==0;){let w=mr(x),g=64*y+w,S=t.bodyArray[g];if(e.drawMass&&S.type===et.b2_dynamicBody){let _=new B(.1,.1),C=jt(t,S),D=new at(C.center,C.transform.q);e.DrawTransform(D,e.context);let v=H(D,_),k=`  ${C.mass.toFixed(2)}`;e.DrawString(v,k,e.context)}if(e.drawJoints){let _=S.headJointKey;for(;_!==I;){let C=_>>1,D=_&1,v=t.jointArray[C];k2(t.debugJointSet,C)===!1&&(Vi(e,t,v),Qe(t.debugJointSet,C)),_=v.edges[D].nextKey}}let A=St;if(e.drawContacts&&S.type===et.b2_dynamicBody&&S.setIndex===M.b2_awakeSet){let _=S.headContactKey;for(;_!==I;){let C=_>>1,D=_&1,v=t.contactArray[C];if(_=v.edges[D].nextKey,!(v.setIndex!==M.b2_awakeSet||v.colorIndex===I)){if(k2(t.debugContactSet,C)===!1){let P=t.constraintGraph.colors[v.colorIndex].contacts.data[v.localIndex],G=P.manifold.pointCount,E=new B(P.manifold.normalX,P.manifold.normalY);for(let X=0;X<G;++X){let L=P.manifold.points[X];if(e.drawGraphColors){let W=v.colorIndex===Mt?7.5:5;e.DrawPoint(L.pointX,L.pointY,W,d[v.colorIndex],e.context)}else L.separation>A?e.DrawPoint(L.pointX,L.pointY,5,s,e.context):L.persisted===!1?e.DrawPoint(L.pointX,L.pointY,10,r,e.context):L.persisted===!0&&e.DrawPoint(L.pointX,L.pointY,5,i,e.context);if(e.drawContactNormals){let W=new B(L.pointX,L.pointY),tt=$(W,n,E);e.DrawSegment(W,tt,c,e.context)}else if(e.drawContactImpulses){let W=new B(L.pointX,L.pointY),tt=$(W,o*L.normalImpulse,E);e.DrawSegment(W,tt,a,e.context);let st=`${(1e3*L.normalImpulse).toFixed(1)}`;e.DrawString(W,st,e.context)}if(e.drawFrictionImpulses){let W=be(E),tt=new B(L.pointX,L.pointY),st=$(tt,o*L.tangentImpulse,W);e.DrawSegment(tt,st,l,e.context);let ot=`${(1e3*L.tangentImpulse).toFixed(1)}`;e.DrawString(tt,ot,e.context)}}Qe(t.debugContactSet,C)}_=v.edges[D].nextKey}}}x=x&x-1}}}function G2(t,e){let o=ft(t);if(!o.locked){if(e.useDrawingBounds){Wm(o,e);return}if(e.drawShapes){let n=o.solverSetArray.length;for(let s=0;s<n;++s){let r=o.solverSetArray[s],i=r.sims.count;for(let c=0;c<i;++c){let a=r.sims.data[c],l=o.bodyArray[a.bodyId],d=a.transform,p=l.headShapeId;for(;p!==I;){let u=o.shapeArray[p],b;l.setIndex>=M.b2_firstSleepingSet?b=V.b2_colorGray:u.customColor!==0?b=u.customColor:l.type===et.b2_dynamicBody&&a.mass===0?b=V.b2_colorRed:l.setIndex===M.b2_disabledSet?b=V.b2_colorSlateGray:u.isSensor?b=V.b2_colorWheat:a.isBullet&&l.setIndex===M.b2_awakeSet?b=V.b2_colorTurquoise:l.isSpeedCapped?b=V.b2_colorYellow:a.isFast?b=V.b2_colorSalmon:l.type===et.b2_staticBody?b=V.b2_colorPaleGreen:l.type===et.b2_kinematicBody?b=V.b2_colorRoyalBlue:l.setIndex===M.b2_awakeSet?b=V.b2_colorPink:b=V.b2_colorGray,T2(e,u,d,b),p=u.nextShapeId}}}}if(e.drawJoints){let n=o.jointArray.length;for(let s=0;s<n;++s){let r=o.jointArray[s];r.setIndex!==I&&Vi(e,o,r)}}if(e.drawAABBs){let n=V.b2_colorGray,s=M.b2_awakeSet;{let r=o.solverSetArray[s],i=r.sims.count;for(let c=0;c<i;++c){let a=r.sims.data[c],l=at.identity(),p=o.bodyArray[a.bodyId].headShapeId;for(;p!==I;){let u=o.shapeArray[p],b=u.fatAABB,h=[new B(b.lowerBoundX,b.lowerBoundY),new B(b.upperBoundX,b.lowerBoundY),new B(b.upperBoundX,b.upperBoundY),new B(b.lowerBoundX,b.upperBoundY)];e.DrawPolygon(l,h,4,n,e.context),p=u.nextShapeId}}}}if(e.drawMass){let n=new B(.1,.1),s=o.solverSetArray.length;for(let r=0;r<s;++r){let i=o.solverSetArray[r],c=i.sims.count;for(let a=0;a<c;++a){let l=i.sims.data[a],d=new at(l.center,l.transform.q);e.DrawTransform(d,e.context);let p=H(d,n),u=`  ${l.mass.toFixed(2)}`;e.DrawString(p,u,e.context)}}}if(e.drawContacts){let r=St,i=V.b2_colorGray3,c=V.b2_colorGreen,a=V.b2_colorBlue,l=V.b2_colorGray9,d=V.b2_colorMagenta,p=V.b2_colorYellow,u=[V.b2_colorRed,V.b2_colorOrange,V.b2_colorYellow,V.b2_colorGreen,V.b2_colorCyan,V.b2_colorBlue,V.b2_colorViolet,V.b2_colorPink,V.b2_colorChocolate,V.b2_colorGoldenrod,V.b2_colorCoral,V.b2_colorBlack];for(let b=0;b<te;++b){let h=o.constraintGraph.colors[b],m=h.contacts.count;for(let f=0;f<m;++f){let y=h.contacts.data[f],x=y.manifold.pointCount,w=new B(y.manifold.normalX,y.manifold.normalY);for(let g=0;g<x;++g){let S=y.manifold.points[g];if(e.drawGraphColors&&0<=b&&b<=te){let A=b===Mt?7.5:5;e.DrawPoint(S.pointX,S.pointY,A,u[b],e.context)}else S.separation>r?e.DrawPoint(S.pointX,S.pointY,5,i,e.context):S.persisted===!1?e.DrawPoint(S.pointX,S.pointY,10,c,e.context):S.persisted===!0&&e.DrawPoint(S.pointX,S.pointY,5,a,e.context);if(e.drawContactNormals){let A=new B(S.pointX,S.pointY),_=$(A,.3,w);e.DrawSegment(A,_,l,e.context)}else if(e.drawContactImpulses){let A=new B(S.pointX,S.pointY),_=$(A,1*S.normalImpulse,w);e.DrawSegment(A,_,d,e.context);let C=`${(1e3*S.normalImpulse).toFixed(2)}`;e.DrawString(A,C,e.context)}if(e.drawFrictionImpulses){let A=be(w),_=new B(S.pointX,S.pointY),C=$(_,1*S.tangentImpulse,A);e.DrawSegment(_,C,p,e.context);let D=`${S.normalImpulse.toFixed(2)}`;e.DrawString(_,D,e.context)}}}}}}}function R2(t){let e=ft(t);if(e.locked)return new Qn;let o=e.bodyMoveEventArray.length,n=new Qn;return n.moveEvents=e.bodyMoveEventArray,n.moveCount=o,n}function L2(t){let e=ft(t);if(e.locked)return new Hn;let o=e.sensorBeginEventArray.length,n=e.sensorEndEventArray.length,s=new Hn;return s.beginEvents=e.sensorBeginEventArray,s.endEvents=e.sensorEndEventArray,s.beginCount=o,s.endCount=n,s}function E2(t){let e=ft(t);if(e.locked)return new $n;let o=e.contactBeginArray.length,n=e.contactEndArray.length,s=e.contactHitArray.length,r=new $n;return r.beginEvents=e.contactBeginArray,r.endEvents=e.contactEndArray,r.hitEvents=e.contactHitArray,r.beginCount=o,r.endCount=n,r.hitCount=s,r}function j2(t){if(t===void 0||t.index1<1||Cs<t.index1)return!1;let e=Se[t.index1-1];return e.worldId!==t.index1-1?!1:t.revision===e.revision}function X2(t){if(t===void 0||!(t instanceof Ne)||t.world0<0||Cs<=t.world0)return!1;let e=Se[t.world0];if(e.worldId!==t.world0||t.index1<1||e.bodyArray.length<t.index1)return!1;let o=e.bodyArray[t.index1-1];return!(o.setIndex===I||o.revision!==t.revision)}function F2(t){if(t===void 0||Cs<=t.world0)return!1;let e=Se[t.world0];if(e.worldId!==t.world0)return!1;let o=t.index1-1;if(o<0||e.shapeArray.length<=o)return!1;let n=e.shapeArray[o];return n.id===I?!1:t.revision===n.revision}function q2(t){if(t===void 0||t.world0<0||Cs<=t.world0)return!1;let e=Se[t.world0];if(e.worldId!==t.world0)return!1;let o=t.index1-1;if(o<0||e.chainArray.length<=o)return!1;let n=e.chainArray[o];return n.id===I?!1:t.revision===n.revision}function V2(t){if(t===void 0||t.world0<0||Cs<=t.world0)return!1;let e=Se[t.world0];if(e.worldId!==t.world0)return!1;let o=t.index1-1;if(o<0||e.jointArray.length<=o)return!1;let n=e.jointArray[o];return n.jointId===I?!1:t.revision===n.revision}function Y2(t,e){let o=ft(t);if(!o.locked&&e!==o.enableSleep&&(o.enableSleep=e,e===!1)){let n=o.solverSetArray.length;for(let s=M.b2_firstSleepingSet;s<n;++s)o.solverSetArray[s].sims.length>0&&Ee(o,s)}}function N2(t,e){let o=ft(t);o.locked||(o.enableWarmStarting=e)}function W2(t,e){let o=ft(t);o.locked||(o.enableContinuous=e)}function O2(t,e){let o=ft(t);o.locked||(o.restitutionThreshold=Math.max(0,Math.min(e,Number.MAX_VALUE)))}function U2(t,e){let o=ft(t);o.locked||(o.hitEventThreshold=Math.max(0,Math.min(e,Number.MAX_VALUE)))}function z2(t,e,o,n){let s=ft(t);s.locked||(s.contactHertz=mt(e,0,Number.MAX_VALUE),s.contactDampingRatio=mt(o,0,Number.MAX_VALUE),s.contactPushoutVelocity=mt(n,0,Number.MAX_VALUE))}function Om(t,e,o){let n=o,s=n.world,r=s.shapeArray[e],i=r.filter,c=n.filter;if(!(i.categoryBits&c.maskBits)||!(i.maskBits&c.categoryBits))return!0;let a=new _t(e+1,s.worldId,r.revision);return n.fcn(a,n.userContext)}var Al=class{constructor(e=null,o=null,n=null,s=null){this.world=e,this.fcn=o,this.filter=n,this.userContext=s}};function K2(t,e,o,n,s){let r=ft(t);if(r.locked)return;let i=new Al(r,n,o,s);for(let c=0;c<et.b2_bodyTypeCount;++c)Pe(r.broadPhase.trees[c],e,o.maskBits,Om,i)}function Cl(t,e,o){let n=o,s=n.world,r=s.shapeArray[e],i=r.filter,c=n.filter;if(!(i.categoryBits&c.maskBits)||!(i.maskBits&c.categoryBits))return!0;let a=gt(s,r.bodyId),l=Rt(s,a),d=new ye;d.proxyA=n.proxy,d.proxyB=ze(r),d.transformA=n.transform,d.transformB=l,d.useRadii=!0;let p=new Ie;if(Ce(p,d,null,0).distance>0)return!0;let b=new _t(r.id+1,s.worldId,r.revision);return n.fcn(b,n.userContext)}function H2(t,e,o,n,s,r){let i=ft(t);if(i.locked)return;let c=ns(e,o),a=new Lr;a.world=i,a.fcn=s,a.filter=n,a.proxy=vt(e.center,1,e.radius),a.transform=o,a.userContext=r;for(let l=0;l<et.b2_bodyTypeCount;++l)Pe(i.broadPhase.trees[l],c,n.maskBits,Cl,a)}function $2(t,e,o,n,s,r){let i=ft(t);if(i.locked)return;let c=ss(e,o),a=new Lr;a.world=i,a.fcn=s,a.filter=n,a.proxy=vt(e.center,2,e.radius),a.transform=o,a.userContext=r;for(let l=0;l<et.b2_bodyTypeCount;++l)Pe(i.broadPhase.trees[l],c,n.maskBits,Cl,a)}function Q2(t,e,o,n,s,r){let i=ft(t);if(i.locked)return;let c=rs(e,o),a=new Lr;a.world=i,a.fcn=s,a.filter=n,a.proxy=vt(e.vertices,e.count,e.radius),a.transform=o,a.userContext=r;for(let l=0;l<et.b2_bodyTypeCount;++l)Pe(i.broadPhase.trees[l],c,n.maskBits,Cl,a)}function Z2(t,e,o,n){let s=n,r=s.world,i=r.shapeArray[o],c=i.filter,a=s.filter;if(!(c.categoryBits&a.maskBits)||!(c.maskBits&a.categoryBits))return t.maxFraction;let l=gt(r,i.bodyId),d=Rt(r,l),p=ja(t,i,d);if(p.hit){let u=new _t(o+1,r.worldId,i.revision),b=s.fcn(u,p.point,p.normal,p.fraction,s.userContext);return b>=0&&b<=1&&(s.fraction=b),b}return t.maxFraction}function th(t,e,o,n,s,r){let i=ft(t);if(i.locked)return;let c=new Wo;c.origin=e,c.translation=o,c.maxFraction=1;let a=new On;a.world=i,a.fcn=s,a.filter=n,a.fraction=1,a.userContext=r;for(let l=0;l<et.b2_bodyTypeCount;++l){if(br(i.broadPhase.trees[l],c,n.maskBits,Z2,a),a.fraction===0)return;c.maxFraction=a.fraction}}function Um(t,e,o,n,s){let r=s;return r.shapeId=t,r.point=e,r.normal=o,r.fraction=n,r.hit=!0,n}function eh(t,e,o,n){let s=new Ys,r=ft(t);if(r.locked)return s;let i=new Wo;i.origin=e,i.translation=o,i.maxFraction=1;let c=new On;c.world=r,c.fcn=Um,c.fraction=1,c.userContext=s;for(let a=0;a<et.b2_bodyTypeCount;++a){if(br(r.broadPhase.trees[a],i,n.maskBits,Z2,c),c.fraction==0)return s;i.maxFraction=c.fraction}return s}function vl(t,e,o,n){let s=n,r=s.world,i=r.shapeArray[o],c=i.filter,a=s.filter;if(!(c.categoryBits&a.maskBits)||!(c.maskBits&a.categoryBits))return t.maxFraction;let l=gt(r,i.bodyId),d=Rt(r,l),p=Xa(t,i,d);if(p.hit){let u=new _t(o+1,r.worldId,i.revision),b=s.fcn(u,p.point,p.normal,p.fraction,s.userContext);return s.fraction=b,b}return t.maxFraction}function oh(t,e,o,n,s,r,i){let c=ft(t);if(c.locked)return;let a=new fn;a.points=[H(o,e.center)],a.count=1,a.radius=e.radius,a.translation=n,a.maxFraction=1;let l=new On;l.world=c,l.fcn=r,l.filter=s,l.fraction=1,l.userContext=i;for(let d=0;d<et.b2_bodyTypeCount;++d){if(us(c.broadPhase.trees[d],a,s.maskBits,vl,l),l.fraction==0)return;a.maxFraction=l.fraction}}function nh(t,e,o,n,s,r,i){let c=ft(t);if(c.locked)return;let a=new fn;a.points=[H(o,e.center1),H(o,e.center2)],a.count=2,a.radius=e.radius,a.translation=n,a.maxFraction=1;let l=new On;l.world=c,l.fcn=r,l.filter=s,l.fraction=1,l.userContext=i;for(let d=0;d<et.b2_bodyTypeCount;++d){if(us(c.broadPhase.trees[d],a,s.maskBits,vl,l),l.fraction==0)return;a.maxFraction=l.fraction}}function sh(t,e,o,n,s,r,i){let c=ft(t);if(c.locked)return;let a=new fn;a.points=e.vertices.map(d=>H(o,d)),a.count=e.count,a.radius=e.radius,a.translation=n,a.maxFraction=1;let l=new On;l.world=c,l.fcn=r,l.filter=s,l.fraction=1,l.userContext=i;for(let d=0;d<et.b2_bodyTypeCount;++d){if(us(c.broadPhase.trees[d],a,s.maskBits,vl,l),l.fraction==0)return;a.maxFraction=l.fraction}}function rh(t,e,o){let n=ft(t);n.preSolveFcn=e,n.preSolveContext=o}function ih(t,e,o){let n=ft(t);n.customFilterFcn=e,n.customFilterContext=o}function ah(t,e){let o=ft(t);o.gravity=e}function ch(t){return ft(t).gravity}var wl=class{constructor(e,o,n,s){this.world=e,this.position=o,this.radius=n,this.magnitude=s}};function zm(t,e,o){let n=o,s=n.world,r=s.shapeArray[e],i=s.bodyArray[r.bodyId];if(i.type===et.b2_kinematicBody||(Wt(s,i),i.setIndex!==M.b2_awakeSet))return!0;let c=Rt(s,i),a=new ye;a.proxyA=ze(r),a.proxyB=vt([n.position],1,0),a.transformA=c,a.transformB=new at(new B(0,0),new rt(1,0)),a.useRadii=!0;let l=new Ie,d=Ce(l,a,null,0);if(d.distance>n.radius)return!0;let p=d.pointA;if(d.distance===0){let S=as(r);p=H(c,S)}let u=.4,b=La(r),h=n.magnitude*b*(1-u*d.distance/n.radius),m=dt(J(p,n.position)),f=it(h,m),y=i.localIndex,x=s.solverSetArray[M.b2_awakeSet],w=x.states.data[y],g=x.sims.data[y];return w.linearVelocity=$(w.linearVelocity,g.invMass,f),w.angularVelocity+=g.invInertia*z(J(p,g.center),f),!0}function lh(t,e,o,n){let s=ft(t);if(s.locked)return;let r=new wl(s,e,o,n),i=new xt(e.x-o,e.y-o,e.x+o,e.y+o);Pe(s.broadPhase.trees[et.b2_dynamicBody],i,In,zm,r)}function gl(t,e){if(e===I)return I;let o=e,n=t.islandArray[e];for(;n.parentIsland!==I;){let s=t.islandArray[n.parentIsland];o=n.parentIsland,n=s}return o}function se(t,e){Array.isArray(t)}function wr(t){if(!lo)return;let e=t.bodyArray.length;for(let o=0;o<e;++o){let n=t.bodyArray[o];if(n.id===I)continue;let s=gl(t,n.islandId),r=n.setIndex,i=n.headContactKey;for(;i!==I;){let a=i>>1,l=i&1,d=t.contactArray[a];if((d.flags&ht.b2_contactTouchingFlag)!==0&&!(d.flags&ht.b2_contactSensorFlag)&&r!==M.b2_staticSet){let u=gl(t,d.islandId)}i=d.edges[l].nextKey}let c=n.headJointKey;for(;c!==I;){let a=c>>1,l=c&1,d=t.jointArray[a],p=l^1,u=t.bodyArray[d.edges[p].bodyId];if(!(r===M.b2_disabledSet||u.setIndex===M.b2_disabledSet))if(r===M.b2_staticSet)u.setIndex,M.b2_staticSet;else{let b=gl(t,d.islandId)}c=d.edges[l].nextKey}}}function Lt(t){if(!lo)return;let e=0,o=0,n=0,s=0,r=0,i=t.solverSetArray.length;for(let u=0;u<i;++u){let b=t.solverSetArray[u];if(b.setIndex!==I){e+=1,u===M.b2_staticSet||u===M.b2_awakeSet||M.b2_disabledSet;{let h=t.bodyArray;o+=b.sims.count;for(let m=0;m<b.sims.count;++m){let y=b.sims.data[m].bodyId;se(h,y);let x=h[y];M.b2_disabledSet;let w=I,g=x.headShapeId;for(;g!==I;){t.shapeArray;let _=t.shapeArray[g];if(u!==M.b2_disabledSet){if(u!==M.b2_staticSet){let C=Ro(_.proxyKey)}}w=g,g=_.nextShapeId}let S=x.headContactKey;for(;S!==I;){let _=S>>1,C=S&1;se(t.contactArray,_),S=t.contactArray[_].edges[C].nextKey}let A=x.headJointKey;for(;A!==I;){let _=A>>1,C=A&1;se(t.jointArray,_);let D=t.jointArray[_],v=C^1;se(t.bodyArray,D.edges[v].bodyId);let k=t.bodyArray[D.edges[v].bodyId];u===M.b2_disabledSet||k.setIndex===M.b2_disabledSet||u===M.b2_staticSet&&k.setIndex===M.b2_staticSet||u===M.b2_awakeSet||u>=M.b2_firstSleepingSet;let P=jo(t,D);A=D.edges[C].nextKey}}}{let h=t.contactArray;s+=b.contacts.count;for(let m=0;m<b.contacts.count;++m){let f=b.contacts.data[m],y=h[f.contactId];M.b2_awakeSet}}{let h=t.jointArray;n+=b.joints.count;for(let m=0;m<b.joints.count;++m){let f=b.joints.data[m],y=h[f.jointId]}}{let h=t.islandArray;r+=b.islands.count;for(let m=0;m<b.islands.count;++m){let f=b.islands.data[m],y=h[f.islandId]}}}}let c=Uo(t.solverSetIdPool),a=Uo(t.bodyIdPool),l=Uo(t.islandIdPool);for(let u=0;u<te;++u){let b=t.constraintGraph.colors[u];{let h=t.contactArray;s+=b.contacts.count;for(let m=0;m<b.contacts.count;++m){let f=b.contacts.data[m];se(h,f.contactId);let y=h[f.contactId],x=y.edges[0].bodyId,w=y.edges[1].bodyId;if(se(t.bodyArray,x),se(t.bodyArray,w),u<Mt){let g=t.bodyArray[x],S=t.bodyArray[w]}}}{let h=t.jointArray;n+=b.joints.count;for(let m=0;m<b.joints.count;++m){let f=b.joints.data[m];se(h,f.jointId);let y=h[f.jointId],x=y.edges[0].bodyId,w=y.edges[1].bodyId;if(se(t.bodyArray,x),se(t.bodyArray,w),u<Mt){let g=t.bodyArray[x],S=t.bodyArray[w]}}}}let d=Uo(t.contactIdPool),p=Uo(t.jointIdPool)}function k2(t,e){let o=Math.floor(e/64);return o>=t.blockCount?!1:(t.bits[o]&BigInt(1)<<BigInt(e%64))!==BigInt(0)}function dh(t){if(!lo)return;let e=t.contactArray.length,o=0;for(let s=0;s<e;++s){let r=t.contactArray[s];if(r.contactId===I)continue;o+=1;let i=(r.flags&ht.b2_contactTouchingFlag)!==0,c=(r.flags&ht.b2_contactSensorTouchingFlag)!==0,a=(r.flags&ht.b2_contactSensorFlag)!==0,l=r.setIndex;l===M.b2_awakeSet||l>=M.b2_firstSleepingSet;let p=(Gn(t,r).simFlags&Yt.b2_simTouchingFlag)!==0}let n=Uo(t.contactIdPool)}function Km(){}function Hm(){}function $m(){}function R(t,e,o){return o!==void 0?(t[e]=o,!0):!1}var no=new Map,pn=30;function Qm(t){pn=t}function Zm(){return pn}function ty(t){return t*pn}function ey(t){return t/pn}function Er(t,e){return new B(t/pn,e/pn)}function Jl(t){return new rt(Math.cos(-t),Math.sin(-t))}function oy(t,e,o){no.has(t)||no.set(t,new Map),no.get(t).set(e,o)}function ny(t,e,o=!1){if(no.has(t)){let n=no.get(t),s=n.get(e);if(s&&o){let r=s.bodyId;cn(r)}n.delete(e)}}function sy(t){no.has(t)&&no.get(t).clear()}function ry(t,e){return no.has(t)?no.get(t).get(e):null}function iy(t){no.has(t)&&no.get(t).forEach((e,o)=>{uh(e,o)})}function uh(t,e){let o=Zi(t.bodyId);e.x=o.p.x*pn,e.y=-(o.p.y*pn),e.rotation=-Math.atan2(o.q.s,o.q.c)}function ay(t,e,o){let n=e?.scaleX||e?.scale?.x||1,s=e?.scaleY||e?.scale?.y||1,r={worldId:t,type:Dl,size:Er(e.width*n/2,e.height*s/2)},i=bh({...r,...o});return Jr(i.bodyId,Er(e.x,-e.y),Jl(e.rotation)),i}function cy(t,e,o){let n=e?.scaleX||e?.scale?.x||1,s=e?.scaleY||e?.scale?.y||1,r={worldId:t,type:Dl,size:Er(e.width*n/2,e.height*s/2)},i=ph({...r,...o});return Jr(i.bodyId,Er(e.x,-e.y),Jl(e.rotation)),i}function ly(t){let e=t.worldDef;return e||(e=Or()),ba(),{worldId:ha(e)}}var ya=0;function dy(t){let e=t.fixedTimeStep;e||(e=1/60);let o=t.subStepCount;o||(o=4);let n=e*2;ya=Math.min(ya+t.deltaTime,e+n);let r=2;t.deltaTime>e&&(r=0);let i=0;for(;ya>=e&&r-->=0&&i<e;){let c=performance.now();ma(t.worldId,e,o),i=(performance.now()-c)/1e3,ya-=e}return i}function uy(t){let e=vs(t.firstLinkPosition,t.lastLinkPosition)/t.chainLinks,o=t.type!==void 0?t.type:et.b2_dynamicBody,n=t.density!==void 0?t.density:1,s=t.friction!==void 0?t.friction:.5,r=t.color!==void 0?t.color:V.b2_colorGold,i=t.radius!==void 0?t.radius:.5;var c=null,a=O(t.firstLinkPosition,new B(t.linkLength,0));let l=[];for(let d=0;d<t.chainLinks;d++){let p=xa({worldId:t.worldId,type:o,position:a,center1:new B(-t.linkLength/2+t.radius,0),center2:new B(t.linkLength/2-t.radius,0),radius:i,density:n,friction:s,groupIndex:-1,color:r});l.push(p),d==0?t.fixEnds&&fa({worldId:t.worldId,bodyIdA:t.groundId,bodyIdB:p.bodyId,anchorA:t.firstLinkPosition,anchorB:new B(-t.linkLength/2,0)}):fa({worldId:t.worldId,bodyIdA:c.bodyId,bodyIdB:p.bodyId,anchorA:new B(t.linkLength/2,0),anchorB:new B(-t.linkLength/2,0)}),c=p,a=O(a,new B(e,0))}return t.fixEnds&&fa({worldId:t.worldId,bodyIdA:t.groundId,bodyIdB:c.bodyId,anchorA:t.lastLinkPosition,anchorB:new B(t.linkLength/2,0)}),l}function ph(t){let e=t.bodyDef;e||(e=we()),R(e,"type",t.type),R(e,"position",t.position);let o=t.bodyId;o||(o=je(t.worldId,e));let n=t.shapeDef;n||(n=ce()),R(n,"density",t.density),R(n,"friction",t.friction),R(n.filter,"groupIndex",t.groupIndex),R(n.filter,"categoryBits",t.categoryBits),R(n.filter,"maskBits",t.maskBits),R(n,"customColor",t.color),R(n,"enablePreSolveEvents",t.preSolve),R(n,"isSensor",t.isSensor),R(n,"restitution",t.restitution);let s=new oe;R(s,"radius",t.radius),t.bodyId&&R(s,"center",t.offset);let r=Pn(o,n,s);return{bodyId:o,shapeId:r,object:s}}function xa(t){let e=t.bodyDef;e||(e=we()),R(e,"type",t.type),R(e,"position",t.position),R(e,"fixedRotation",t.fixedRotation),R(e,"linearDamping",t.linearDamping);let o=t.bodyId;o||(o=je(t.worldId,e));let n=t.shapeDef;n||(n=ce()),R(n,"density",t.density),R(n,"friction",t.friction),R(n.filter,"groupIndex",t.groupIndex),R(n.filter,"categoryBits",t.categoryBits),R(n.filter,"maskBits",t.maskBits),R(n,"customColor",t.color);let s=new _e;t.width&&(t.radius=t.width/2),t.height&&(t.radius=Math.min(t.radius,t.height/2),t.center1=new B(0,-(t.height/2)),t.center2=new B(0,t.height/2)),R(s,"center1",t.center1),R(s,"center2",t.center2),R(s,"radius",t.radius);let r=is(o,n,s);return{bodyId:o,shapeId:r,object:s}}function bh(t){let e=t.bodyDef;e||(e=we()),R(e,"type",t.type),R(e,"position",t.position),R(e,"fixedRotation",t.fixedRotation),R(e,"linearDamping",t.linearDamping),R(e,"angularDamping",t.angularDamping);let o=t.bodyId;o||(o=je(t.worldId,e));let n=t.shapeDef;n||(n=ce()),t.userData&&ln(o,t.userData),R(n,"density",t.density),R(n,"friction",t.friction),R(n,"restitution",t.restitution),R(n.filter,"groupIndex",t.groupIndex),R(n.filter,"categoryBits",t.categoryBits),R(n.filter,"maskBits",t.maskBits),R(n,"customColor",t.color),R(n,"enablePreSolveEvents",t.preSolve);let r;t.size instanceof B?t.bodyId?r=oi(t.size.x,t.size.y,t.position,wa(0)):r=Go(t.size.x,t.size.y):r=Go(t.size,t.size);let i=bo(o,n,r);return{bodyId:o,shapeId:i,object:r}}function py(t){if(t.sides<3||t.sides>Ae)return null;let e=t.bodyDef||we();R(e,"type",t.type),R(e,"position",t.position);let o=t.bodyId;o||(o=je(t.worldId,e));let n=t.shapeDef||ce();R(n,"density",t.density),R(n,"friction",t.friction),R(n.filter,"groupIndex",t.groupIndex),R(n,"customColor",t.color);let s=[],r=2*Math.PI/t.sides;for(let l=0;l<t.sides;l++){let d=l*r,p=t.radius*Math.cos(d),u=t.radius*Math.sin(d);s.push(new B(p,u))}let i,c=Mn(s,t.sides);if(t.bodyId!=null){let l=ue(t.worldId,t.bodyId),d=new at(t.position,l.q);i=Hs(c,0,d)}else i=Dn(c,0);let a=bo(o,n,i);return{bodyId:o,shapeId:a,object:i}}function Ml(t){if(t.vertices.length<3||t.vertices.length>Ae)return null;let e=t.bodyDef||we();R(e,"type",t.type),R(e,"position",t.position);let o=t.bodyId;o||(o=je(t.worldId,e));let n=t.shapeDef||ce();R(n,"density",t.density),R(n,"friction",t.friction),R(n.filter,"groupIndex",t.groupIndex),R(n,"customColor",t.color);let s,r=Mn(t.vertices,t.vertices.length);if(t.bodyId!=null){let c=ue(t.worldId,t.bodyId),a=new at(t.position,c.q);s=Hs(r,0,a)}else s=Dn(r,0);let i=bo(o,n,s);return{bodyId:o,shapeId:i,object:s}}function by(t){if(t.vertices.length<3)return null;let e=t.bodyDef||we();R(e,"type",t.type),R(e,"position",t.position);let o=t.shapeDef||ce();R(o,"density",t.density),R(o,"friction",t.friction),R(o,"restitution",t.restitution),R(o.filter,"groupIndex",t.groupIndex),R(o,"customColor",t.color);let n=[],s=t.vertexScale;s||(s=new B(1,1));let r=t.vertexOffset;r||(r=new B(0,0));for(let c=0,a=t.indices[0].length;c<a;c+=3){let l=[];for(let d=0;d<3;d++){let p=t.indices[0][c+d]*2;l.push(new B((t.vertices[p]+r.x)*s.x,(t.vertices[p+1]+r.y)*s.y))}n.push(l)}let i=null;n.forEach(c=>{if(!i)i=Ml({worldId:t.worldId,type:et.b2_dynamicBody,bodyDef:e,vertices:c,density:1,friction:.3,color:V.b2_colorSkyBlue});else{let a=Mn(c,c.length),l=Dn(a,0);bo(i.bodyId,o,l)}})}function hh(t){if(t.vertices.length<3)return null;let e=t.bodyDef||we();R(e,"type",t.type),R(e,"position",t.position);let o=t.shapeDef||ce();R(o,"density",t.density),R(o,"friction",t.friction),R(o,"restitution",t.restitution),R(o.filter,"groupIndex",t.groupIndex),R(o,"customColor",t.color);let n=t.vertexScale;n||(n=new B(1,1));let s=t.vertexOffset;s||(s=new B(0,0));let r=[];for(let c=0,a=t.indices.length;c<a;c++){let l=[],d=t.indices[c];for(let p=0,u=d.length;p<u;p++){let b=d[p]*2;l.push(new B((t.vertices[b]+s.x)*n.x,(t.vertices[b+1]+s.y)*n.y))}r.push(l)}let i=null;r.forEach(c=>{if(!i)i=Ml({worldId:t.worldId,type:et.b2_dynamicBody,bodyDef:e,vertices:c,density:1,friction:.3,color:V.b2_colorSkyBlue});else{let a=Mn(c,c.length),l=Dn(a,0);bo(i.bodyId,o,l)}})}function hy(t){let e=t.key,o=t.url;async function n(i){try{let a=await(await fetch(i)).text();return new DOMParser().parseFromString(a,"text/xml")}catch(c){throw c}}function s(i,c){let a=c.querySelectorAll(`body[name=${i}] fixtures polygon`),l=[],d=[];function p(u,b){let m=l.length;for(let f=0;f<m;f+=2)if(Math.abs(l[f]-u)<1e-6&&Math.abs(l[f+1]-b)<1e-6)return f/2;return l.push(u,b),m/2}return Array.from(a).forEach(u=>{let b=u.textContent.trim().split(/[,\s]+/).map(Number),h=[];for(let m=0;m<b.length;m+=2){let f=p(b[m],b[m+1]);h.push(f)}d.push(h)}),{vertices:l,indices:d}}function r(i){return hh({...t,indices:i.indices,vertices:i.vertices})}return new Promise(async(i,c)=>{try{let a=await n(o),l=s(e,a),d=r(l);i(d)}catch(a){c(a)}})}function fa(t){let e=t.jointDef;return e||(e=new Do),e.bodyIdA=t.bodyIdA,e.bodyIdB=t.bodyIdB,R(e,"localAnchorA",t.anchorA),R(e,"localAnchorB",t.anchorB),R(e,"lowerAngle",t.lowerAngle),R(e,"upperAngle",t.upperAngle),R(e,"enableLimit",t.enableLimit),R(e,"enableMotor",t.enableMotor),R(e,"motorSpeed",t.motorSpeed),R(e,"maxMotorTorque",t.maxMotorTorque),R(e,"enableSpring",t.enableSpring),R(e,"hertz",t.hertz),R(e,"dampingRatio",t.dampingRatio),R(e,"collideConnected",t.collideConnected),R(e,"drawSize",t.drawSize),{jointId:an(t.worldId,e)}}function my(t){let e=t.jointDef;e||(e=new wn),e.bodyIdA=t.bodyIdA,e.bodyIdB=t.bodyIdB,R(e,"localAnchorA",t.anchorA),R(e,"localAnchorB",t.anchorB);let o=Cr(t.bodyIdA),n=Cr(t.bodyIdB);return e.referenceAngle=ae(n,o),R(e,"referenceAngle",t.referenceAngle),R(e,"angularHertz",t.hertz),R(e,"angularDampingRatio",t.dampingRatio),R(e,"collideConnected",t.collideConnected),{jointId:ji(t.worldId,e)}}function yy(t){let e=t.jointDef;return e||(e=new gn),e.bodyIdA=t.bodyIdA,e.bodyIdB=t.bodyIdB,R(e,"localAnchorA",t.anchorA),R(e,"localAnchorB",t.anchorB),R(e,"length",t.length),R(e,"minLength",t.minLength),R(e,"maxLength",t.maxLength),R(e,"enableSpring",t.enableSpring),R(e,"hertz",t.hertz),R(e,"dampingRatio",t.dampingRatio),R(e,"enableLimit",t.enableLimit),R(e,"collideConnected",t.collideConnected),{jointId:Gi(t.worldId,e)}}function fy(t){let e=t.jointDef;return e||(e=new Cn),e.bodyIdA=t.bodyIdA,e.bodyIdB=t.bodyIdB,R(e,"localAnchorA",t.anchorA),R(e,"localAnchorB",t.anchorB),R(e,"enableSpring",t.enableSpring),R(e,"localAxisA",t.axis),R(e,"hertz",t.hertz),R(e,"dampingRatio",t.dampingRatio),R(e,"enableLimit",t.enableLimit),R(e,"lowerTranslation",t.lowerTranslation),R(e,"upperTranslation",t.upperTranslation),R(e,"enableMotor",t.enableMotor),R(e,"maxMotorTorque",t.maxMotorTorque),R(e,"motorSpeed",t.motorSpeed),R(e,"collideConnected",t.collideConnected),{jointId:Xi(t.worldId,e)}}function xy(t){let e=t.jointDef;return e||(e=new An),e.bodyIdA=t.bodyIdA,e.bodyIdB=t.bodyIdB,R(e,"localAnchorA",t.anchorA),R(e,"localAnchorB",t.anchorB),R(e,"localAxisA",t.axis),R(e,"referenceAngle",t.referenceAngle),R(e,"enableSpring",t.enableSpring),R(e,"hertz",t.hertz),R(e,"dampingRatio",t.dampingRatio),R(e,"enableLimit",t.enableLimit),R(e,"lowerTranslation",t.lowerTranslation),R(e,"upperTranslation",t.upperTranslation),R(e,"enableMotor",t.enableMotor),R(e,"maxMotorForce",t.maxMotorForce),R(e,"motorSpeed",t.motorSpeed),R(e,"collideConnected",t.collideConnected),{jointId:Ei(t.worldId,e)}}function Iy(t){let e=t.jointDef;return e||(e=new _n),e.bodyIdA=t.bodyIdA,e.bodyIdB=t.bodyIdB,R(e,"linearOffset",t.linearOffset),R(e,"maxForce",t.maxForce),R(e,"angularOffset",t.angularOffset),R(e,"maxTorque",t.maxTorque),R(e,"correctionFactor",t.correctionFactor),R(e,"collideConnected",t.collideConnected),{jointId:Ri(t.worldId,e)}}function Sy(t){let e=t.jointDef;return e||(e=new Bn),e.bodyIdA=t.bodyIdA,e.bodyIdB=t.bodyIdB,R(e,"target",t.target),R(e,"hertz",t.hertz),R(e,"dampingRatio",t.dampingRatio),R(e,"maxForce",t.maxForce),R(e,"collideConnected",t.collideConnected),{jointId:Li(t.worldId,e)}}var _o=new B,gy=!1;function _y(t,e,o=20){let n=1280,s=720;if(t){let i=function(){window.innerWidth<window.innerHeight?(n=t.width=720,s=t.height=1280):(n=t.width=1280,s=t.height=720);let c=window.devicePixelRatio;t.width=n*c,t.height=s*c,t.style.width=n+"px",t.style.height=s+"px",e.scale(c,c)};window.addEventListener("resize",i),i()}let r=new Ws;return gy?(r.DrawCapsule=()=>{},r.DrawCircle=()=>{},r.DrawPoint=()=>{},r.DrawPolygon=()=>{},r.DrawImageCapsule=()=>{},r.DrawImageCircle=()=>{},r.DrawImagePolygon=()=>{},r.DrawSegment=()=>{},r.DrawSolidCapsule=()=>{},r.DrawSolidCircle=()=>{},r.DrawSolidPolygon=()=>{},r.DrawString=()=>{},r.DrawTransform=()=>{},r):(r.DrawPolygon=function(i,c,a,l,d){d.beginPath();let p=l>>16&255,u=l>>8&255,b=l&255,h=.5,m=(n>>1)+this.positionOffset.x,f=(s>>1)+this.positionOffset.y;for(let y=0;y<a;y++){de(i,c[y],_o),_o.y=-_o.y;let x=o*_o.x,w=o*_o.y,g=x+m,S=w+f;y===0?d.moveTo(g,S):d.lineTo(g,S)}d.closePath(),d.strokeStyle=`rgb(${p}, ${u}, ${b})`,d.lineWidth=1,d.stroke()},r.DrawImagePolygon=function(i,c,a){let l=ho(c,i),d=(n>>1)+this.positionOffset.x,p=(s>>1)+this.positionOffset.y,u=i.p.x,b=i.p.y,h=o*u,m=o*b,f=h+d,y=m-p;y=-y,a.save(),a.translate(f,y);let x=-Math.atan2(i.q.s,i.q.c);a.rotate(x);let w=c.image,g=c.imageScale||new B(1,1),S=c.imageOffset||new B(0,0),A=l.upperBoundX-l.lowerBoundX,_=l.upperBoundY-l.lowerBoundY,C=A/_;C>1?(_*=o*g.x,A=_*C*g.y):(A*=o*g.x,_=A/C*g.y),a.drawImage(w,c.imageRect.lowerBoundX,c.imageRect.lowerBoundY,c.imageRect.upperBoundX,c.imageRect.upperBoundY,-A/2+A*S.x,-_/2+_*S.y,A,_),a.restore()},r.DrawSolidPolygon=function(i,c,a,l,d,p){p.beginPath();let u=d>>16&255,b=d>>8&255,h=d&255,m=.5,f=(n>>1)+this.positionOffset.x,y=(s>>1)+this.positionOffset.y;for(let x=0;x<a;x++){de(i,c[x],_o),_o.y=-_o.y;let w=o*_o.x,g=o*_o.y,S=w+f,A=g+y;x===0?p.moveTo(S,A):p.lineTo(S,A)}p.closePath(),p.fillStyle=`rgba(${u}, ${b}, ${h}, ${m})`,p.fill(),p.strokeStyle=`rgb(${u}, ${b}, ${h})`,p.lineWidth=l*2,p.stroke()},r.DrawCircle=function(i,c,a,l){l.beginPath();let d=a>>16&255,p=a>>8&255,u=a&255,b=.5,h=(n>>1)+this.positionOffset.x,m=(s>>1)+this.positionOffset.y,f=o*h,y=o*m,x=f+h,w=y+m;w=-w,l.arc(x,w,c*o,0,2*Math.PI),l.strokeStyle=`rgb(${d}, ${p}, ${u})`,l.lineWidth=2,l.stroke()},r.DrawImageCircle=function(i,c,a,l){let d=(n>>1)+this.positionOffset.x,p=(s>>1)+this.positionOffset.y,u=i.p.x,b=-i.p.y,h=o*u,m=o*b,f=h+d,y=m+p;y=-y,l.save(),l.translate(f,y);let x=-Math.atan2(i.q.s,i.q.c);l.rotate(x);let w=a.image,g=a.imageScale||new B(1,1),S=a.imageOffset||new B(0,0),A=w.width/w.height,_,C;A>1?(C=c*2*o*g.x,_=C*A*g.y):(_=c*2*o*g.x,C=_/A*g.y),l.drawImage(w,-_/2+_*S.x,-C/2+C*S.y,_,C),l.restore()},r.DrawSolidCircle=function(i,c,a,l){l.beginPath();let d=a>>16&255,p=a>>8&255,u=a&255,b=.5,h=(n>>1)+this.positionOffset.x,m=(s>>1)+this.positionOffset.y,f=i.p.x,y=-i.p.y,x=o*f,w=o*y,g=x+h,S=w+m;l.arc(g,S,c*o,0,2*Math.PI),l.fillStyle=`rgba(${d}, ${p}, ${u}, ${b})`,l.fill(),l.strokeStyle=`rgb(${d}, ${p}, ${u})`,l.lineWidth=2,l.stroke()},r.DrawImageCapsule=function(i,c,a,l,d){let p=(n>>1)+this.positionOffset.x,u=(s>>1)+this.positionOffset.y,b=a*o,h=i,m=c;h.y=-h.y,m.y=-m.y;let f=o*h.x,y=o*h.y,x=o*m.x,w=o*m.y,g=f+p,S=y+u,A=x+p,_=w+u,C=A-g,D=_-S,v=Math.atan2(D,C),k=Math.sqrt(C*C+D*D);d.save(),d.translate(g+C/2,S+D/2),d.rotate(v+Math.PI/2);let P=l.image,G=l.imageScale||new B(1,1),E=l.imageOffset||new B(0,0),X=P.width/P.height,L=1.1,W=(k+b*2)*L*G.y,tt=b*2*L*Math.abs(G.x);d.scale(Math.sign(G.x),1),d.drawImage(P,l.imageRect.lowerBoundX,l.imageRect.lowerBoundY,l.imageRect.upperBoundX,l.imageRect.upperBoundY,-tt/2+tt*E.x,-W/2+W*E.y,tt,W),d.restore()},r.DrawSolidCapsule=function(i,c,a,l,d){let p=l>>16&255,u=l>>8&255,b=l&255,h=.5,m=(n>>1)+this.positionOffset.x,f=(s>>1)+this.positionOffset.y,y=i,x=c;y.y=-y.y,x.y=-x.y;let w=o*y.x,g=o*y.y,S=o*x.x,A=o*x.y,_=w+m,C=g+f,D=S+m,v=A+f,k=D-_,P=v-C,G=Math.atan2(P,k),E=Math.sqrt(k*k+P*P);d.save(),d.translate(_,C),d.rotate(G),d.beginPath(),d.arc(0,0,a*o,Math.PI/2,-Math.PI/2),d.lineTo(E,-a*o),d.arc(E,0,a*o,-Math.PI/2,Math.PI/2),d.lineTo(0,a*o),d.closePath(),d.fillStyle=`rgba(${p}, ${u}, ${b}, ${h})`,d.fill(),d.strokeStyle=`rgb(${p}, ${u}, ${b})`,d.lineWidth=2,d.stroke(),d.restore()},r.DrawSegment=function(i,c,a,l){l.beginPath();let d=a>>16&255,p=a>>8&255,u=a&255,b=.5,h=(n>>1)+this.positionOffset.x,m=(s>>1)+this.positionOffset.y,f=i,y=c;f.y=-f.y,y.y=-y.y;let x=o*f.x+h,w=o*f.y+m,g=o*y.x+h,S=o*y.y+m;l.moveTo(x,w),l.lineTo(g,S),l.strokeStyle=`rgba(${d}, ${p}, ${u}, ${b})`,l.lineWidth=2,l.stroke()},r.DrawPoint=function(i,c,a,l,d){let p=l>>16&255,u=l>>8&255,b=l&255,h=.5,m=(n>>1)+this.positionOffset.x,f=(s>>1)+this.positionOffset.y;c=-c;let y=o*i+m,x=o*c+f;d.beginPath(),d.arc(y,x,a,0,2*Math.PI),d.fillStyle=`rgba(${p}, ${u}, ${b}, ${h})`,d.fill(),d.strokeStyle=`rgb(${p}, ${u}, ${b})`,d.lineWidth=1,d.stroke()},r.SetPosition=function(i,c){r.positionOffset.x=n/2-i,r.positionOffset.y=c-s/2},r.context=e,r)}function By(t){let e=0,o=0,n=0,s=0,r=0;function i(c){requestAnimationFrame(i),e===0&&(e=c);let a=Math.min((c-e)/1e3,1/10);e=c,o+=a,t(a,o,r),n++,c-s>=1e3&&(r=Math.round(n*1e3/(c-s)),n=0,s=c)}requestAnimationFrame(i)}function Ay(t){return new Promise((e,o)=>{let n=new Image;n.onload=()=>e(n),n.onerror=s=>{let r={message:"Failed to load image",url:t,event:s};o(new Error(JSON.stringify(r,null,2)))},n.src=t})}function wy(t,e,o,n,s=null,r=null,i=null,c=null){let a=ft(t),l=[];ea(e,l);let d=a.shapeArray[l[l.length-1].index1-1];d.imageOffset=s,d.imageScale=r,d.imageRect=new xt(i.x,i.y,c.x,c.y);let p=o+"/"+n;return Ay(p).then(u=>{d.image=u}).catch(u=>{}),d}function Cy(t,e){let o=t.getBoundingClientRect();return{u:(e.x-o.left)/o.width,v:1-(e.y-o.top)/o.height}}function vy(t,e,o){let n=t.clientWidth,s=t.clientHeight,r=Cy(t,o);var i=n/s,c=new B(0,0),a=s/2/e,l=new B(a*i,a),d=J(c,l),p=O(c,l),u=new B((1-r.u)*d.x+r.u*p.x,(1-r.v)*d.y+r.v*p.y);return u}function Jy(t,e,o){let n=t.clientWidth,s=t.clientHeight;var r=n/s,i=new B(0,0),c=s/2/e,a=new B(c*r,c),l=J(i,a),d=O(i,a),p=(o.x-l.x)/(d.x-l.x),u=(o.y-l.y)/(d.y-l.y),b=new B(p*n,u*s);return b}var kl=class{constructor(){this.bodyId=null,this.jointId=null,this.frictionScale=1,this.parentIndex=-1,this.name=""}},Pl=class{static HumanBones={e_hip:0,e_torso:1,e_head:2,e_upperLeftLeg:3,e_lowerLeftLeg:4,e_upperRightLeg:5,e_lowerRightLeg:6,e_upperLeftArm:7,e_lowerLeftArm:8,e_upperRightArm:9,e_lowerRightArm:10,e_count:11};static sideViewHuman11={BONE_DATA:[{name:"hip",parentIndex:-1,position:[0,.95],capsule:{center1:[0,-.02],center2:[0,.02],radius:.095}},{name:"torso",parentIndex:0,position:[0,1.2],capsule:{center1:[0,-.135],center2:[0,.135],radius:.09},frictionScale:.5},{name:"head",parentIndex:1,position:[0,1.5],capsule:{center1:[0,-.0325],center2:[0,.0325],radius:.08},frictionScale:.25,linearDamping:.1},{name:"upperLeftLeg",parentIndex:0,position:[0,.775],capsule:{center1:[0,-.125],center2:[0,.125],radius:.06}},{name:"lowerLeftLeg",parentIndex:3,position:[0,.475],capsule:{center1:[0,-.14],center2:[0,.125],radius:.05},frictionScale:.5,foot:"right"},{name:"upperRightLeg",parentIndex:0,position:[0,.775],capsule:{center1:[0,-.125],center2:[0,.125],radius:.06}},{name:"lowerRightLeg",parentIndex:5,position:[0,.475],capsule:{center1:[0,-.14],center2:[0,.125],radius:.05},frictionScale:.5,foot:"right"},{name:"upperLeftArm",parentIndex:1,position:[0,1.225],capsule:{center1:[0,-.125],center2:[0,.125],radius:.035},frictionScale:.5},{name:"lowerLeftArm",parentIndex:7,position:[0,.975],capsule:{center1:[0,-.125],center2:[0,.125],radius:.03},frictionScale:.1,linearDamping:.1},{name:"upperRightArm",parentIndex:1,position:[0,1.225],capsule:{center1:[0,-.125],center2:[0,.125],radius:.035},frictionScale:.5},{name:"lowerRightArm",parentIndex:9,position:[0,.975],capsule:{center1:[0,-.125],center2:[0,.125],radius:.03},frictionScale:.1,linearDamping:.1}],JOINT_DATA:[{boneName:"torso",pivot:[0,1],limits:[-.25*Math.PI,0]},{boneName:"head",pivot:[0,1.4],limits:[-.3*Math.PI,.1*Math.PI]},{boneName:"upperLeftLeg",pivot:[0,.9],limits:[-.05*Math.PI,.4*Math.PI]},{boneName:"lowerLeftLeg",pivot:[0,.625],limits:[-.5*Math.PI,-.02*Math.PI]},{boneName:"upperRightLeg",pivot:[0,.9],limits:[-.05*Math.PI,.4*Math.PI]},{boneName:"lowerRightLeg",pivot:[0,.625],limits:[-.5*Math.PI,-.02*Math.PI]},{boneName:"upperLeftArm",pivot:[0,1.35],limits:[-.1*Math.PI,.8*Math.PI]},{boneName:"lowerLeftArm",pivot:[0,1.1],limits:[.01*Math.PI,.5*Math.PI]},{boneName:"upperRightArm",pivot:[0,1.35],limits:null},{boneName:"lowerRightArm",pivot:[0,1.1],limits:[.01*Math.PI,.5*Math.PI]}]};static frontViewHuman11={BONE_DATA:[{name:"hip",parentIndex:-1,position:[0,.95],capsule:{center1:[-.03,0],center2:[.03,0],radius:.095}},{name:"torso",parentIndex:0,position:[0,1.2],capsule:{center1:[0,-.135],center2:[0,.135],radius:.09},frictionScale:.5},{name:"head",parentIndex:1,position:[0,1.5],capsule:{center1:[0,-.0325],center2:[0,.0325],radius:.08},frictionScale:.25,linearDamping:.1},{name:"upperLeftLeg",parentIndex:0,position:[-.1,.775],capsule:{center1:[0,-.125],center2:[0,.125],radius:.06}},{name:"lowerLeftLeg",parentIndex:3,position:[-.1,.475],capsule:{center1:[0,-.14],center2:[0,.125],radius:.05},frictionScale:.5,foot:"left"},{name:"upperRightLeg",parentIndex:0,position:[.1,.775],capsule:{center1:[0,-.125],center2:[0,.125],radius:.06}},{name:"lowerRightLeg",parentIndex:5,position:[.1,.475],capsule:{center1:[0,-.14],center2:[0,.125],radius:.05},frictionScale:.5,foot:"right"},{name:"upperLeftArm",parentIndex:1,position:[-.15,1.22],capsule:{center1:[0,-.125],center2:[.05,.125],radius:.035},frictionScale:.5},{name:"lowerLeftArm",parentIndex:7,position:[-.15,.97],capsule:{center1:[0,-.125],center2:[0,.125],radius:.03},frictionScale:.1,linearDamping:.1},{name:"upperRightArm",parentIndex:1,position:[.15,1.22],capsule:{center1:[0,-.125],center2:[-.05,.125],radius:.035},frictionScale:.5},{name:"lowerRightArm",parentIndex:9,position:[.15,.97],capsule:{center1:[0,-.125],center2:[0,.125],radius:.03},frictionScale:.1,linearDamping:.1}],JOINT_DATA:[{boneName:"torso",pivot:[0,1],limits:[-.1*Math.PI,.1*Math.PI]},{boneName:"head",pivot:[0,1.4],limits:[-.2*Math.PI,.2*Math.PI]},{boneName:"upperLeftLeg",pivot:[-.1,.9],limits:[-.3*Math.PI,.1*Math.PI]},{boneName:"lowerLeftLeg",pivot:[-.1,.625],limits:[0,.5*Math.PI]},{boneName:"upperRightLeg",pivot:[.1,.9],limits:[-.1*Math.PI,.3*Math.PI]},{boneName:"lowerRightLeg",pivot:[.1,.625],limits:[-.5*Math.PI,0]},{boneName:"upperLeftArm",pivot:[-.12,1.35],limits:[-.7*Math.PI,.1*Math.PI]},{boneName:"lowerLeftArm",pivot:[-.16,1.1],limits:[0,.75*Math.PI]},{boneName:"upperRightArm",pivot:[.12,1.35],limits:[-.1*Math.PI,.7*Math.PI]},{boneName:"lowerRightArm",pivot:[.14,1.1],limits:[0,.75*Math.PI]}]};static ElephantBones={e_torso:0,e_head:1,e_trunkBase:2,e_trunkMid:3,e_trunkTip:4,e_upperFrontLegL:5,e_lowerFrontLegL:6,e_upperRearLegL:7,e_lowerRearLegL:8,e_tail:9,e_ear:10,e_count:11};static sideViewElephant={BONE_DATA:[{name:"torso",parentIndex:-1,position:[0,1.5],capsule:{center1:[.8,0],center2:[-.8,0],radius:.6},frictionScale:.5},{name:"head",parentIndex:0,position:[-1.4,2.2],capsule:{center1:[.3,0],center2:[-.3,0],radius:.35},frictionScale:.25,linearDamping:.1},{name:"trunkBase",parentIndex:1,position:[-1.95,1.85],capsule:{center1:[0,-.2],center2:[0,.2],radius:.15}},{name:"trunkMid",parentIndex:2,position:[-1.95,1.4],capsule:{center1:[0,-.2],center2:[0,.2],radius:.12}},{name:"trunkTip",parentIndex:3,position:[-1.95,1.05],capsule:{center1:[0,-.2],center2:[0,.2],radius:.08},frictionScale:.1,linearDamping:.1},{name:"upperFrontLeg",parentIndex:0,position:[-.6,.8],capsule:{center1:[0,-.3],center2:[0,.3],radius:.2}},{name:"lowerFrontLeg",parentIndex:5,position:[-.6,.2],capsule:{center1:[0,-.3],center2:[0,.3],radius:.18},frictionScale:.5},{name:"upperBackLeg",parentIndex:0,position:[.7,.8],capsule:{center1:[0,-.3],center2:[0,.3],radius:.22}},{name:"lowerBackLeg",parentIndex:7,position:[.7,.2],capsule:{center1:[0,-.3],center2:[0,.3],radius:.2},frictionScale:.5},{name:"tail",parentIndex:0,position:[1.2,1.6],capsule:{center1:[0,-.3],center2:[0,.3],radius:.05},frictionScale:.1,linearDamping:.1},{name:"ear",parentIndex:1,position:[-1.1,2],capsule:{center1:[0,-.15],center2:[0,.15],radius:.3},frictionScale:.1,linearDamping:.1}],JOINT_DATA:[{boneName:"head",pivot:[-1,2],limits:[-.1*Math.PI,.3*Math.PI]},{boneName:"trunkBase",pivot:[-1.95,2],limits:[-.5*Math.PI,.5*Math.PI]},{boneName:"trunkMid",pivot:[-1.95,1.55],limits:[-.7*Math.PI,.7*Math.PI]},{boneName:"trunkTip",pivot:[-1.95,1.15],limits:[-.9*Math.PI,.9*Math.PI]},{boneName:"upperFrontLeg",pivot:[-.6,1.1],limits:[-.2*Math.PI,.2*Math.PI]},{boneName:"lowerFrontLeg",pivot:[-.6,.5],limits:[-.3*Math.PI,.1*Math.PI]},{boneName:"upperBackLeg",pivot:[.7,1.1],limits:[-.2*Math.PI,.2*Math.PI]},{boneName:"lowerBackLeg",pivot:[.7,.5],limits:[-.1*Math.PI,.3*Math.PI]},{boneName:"tail",pivot:[1.2,1.9],limits:[-.4*Math.PI,.4*Math.PI]},{boneName:"ear",pivot:[-1.1,2.2],limits:[-.3*Math.PI,.9*Math.PI]}]}},Tl=class{constructor(e,o,n,s,r,i,c=2){this.skeleton=e,this.position=new B(o,n),this.worldId=s,this.groupIndex=r,this.color=i,this.m_scale=c,this.frictionTorque=.05,this.hertz=0,this.dampingRatio=.5,this.jointDrawSize=.5,this.maxTorque=this.frictionTorque*this.m_scale,this.m_bones=[],this.create()}createBone(e){let{bodyId:o}=xa({worldId:this.worldId,position:O(new B(e.position[0]*this.m_scale,e.position[1]*this.m_scale),this.position),type:et.b2_dynamicBody,center1:new B(e.capsule.center1[0]*this.m_scale,e.capsule.center1[1]*this.m_scale),center2:new B(e.capsule.center2[0]*this.m_scale,e.capsule.center2[1]*this.m_scale),radius:e.capsule.radius*this.m_scale,density:1,friction:.2,groupIndex:-this.groupIndex,color:this.color}),n=new kl;if(n.name=e.name,n.parentIndex=e.parentIndex,n.frictionScale=e.frictionScale||1,n.bodyId=o,e.foot){let s=ce();s.density=1,s.friction=.2,s.filter.groupIndex=-this.groupIndex,s.filter.maskBits=1,s.customColor=this.color;let r=e.foot=="left"?-1:1,i=new _e;i.center1=new B(r*-.02*this.m_scale,-.175*this.m_scale),i.center2=new B(r*.13*this.m_scale,-.175*this.m_scale),i.radius=.03*this.m_scale,is(o,s,i)}return n}createJoint(e){let o=this.m_bones.find(i=>i.name===e.boneName),n=this.m_bones[o.parentIndex],s=O(new B(e.pivot[0]*this.m_scale,e.pivot[1]*this.m_scale),this.position),r=new Do;return r.bodyIdA=n.bodyId,r.bodyIdB=o.bodyId,r.localAnchorA=vr(r.bodyIdA,s),r.localAnchorB=vr(r.bodyIdB,s),e.limits&&(r.enableLimit=!0,r.lowerAngle=e.limits[0],r.upperAngle=e.limits[1]),r.enableMotor=!0,r.maxMotorTorque=o.frictionScale*this.maxTorque,r.enableSpring=this.hertz>0,r.hertz=this.hertz,r.dampingRatio=this.dampingRatio,r.drawSize=this.jointDrawSize,an(this.worldId,r)}create(){return this.m_bones=this.skeleton.BONE_DATA.map(e=>this.createBone(e)),this.skeleton.JOINT_DATA.forEach(e=>{let o=this.m_bones.find(n=>n.name===e.boneName);o.jointId=this.createJoint(e)}),this.m_bones.forEach(e=>ln(e.bodyId,this)),this}destroy(){for(let e=0;e<this.m_bones.length;++e)this.m_bones[e].jointId&&this.m_bones[e].jointId.index1-1!=I&&(qi(this.m_bones[e].jointId),this.m_bones[e].jointId=new zt);for(let e=0;e<this.m_bones.length;++e)this.m_bones[e].bodyId.index1-1!=I&&(cn(this.m_bones[e].bodyId),this.m_bones[e].bodyId=null);this.m_bones=null}};function mh(t,e){return t+(Math.random()-.5)*e}var Ia=class{constructor(e,o){this.id=e,this.created=o}};function My(t,e,o,n,s,r){let i=we();i.type=et.b2_dynamicBody,i.fixedRotation=!1,i.position=t.clone();let c=ce();c.density=n,c.friction=.05,c.restitution=.5,c.customColor=s;let a=je(r,i),l=new oe;l.center=new B(0,0),l.radius=o,Pn(a,c,l);let d=new B(mh(e.x,400),mh(e.y,1500));return ta(a,d,!0),a}var Gl=class{constructor(e,o,n,s,r,i,c,a){this.worldId=a,this.position=e,this.power=o,this.frequency=n,this.life=s,this.radius=r,this.density=i,this.color=c,this.activeBalls=[],this.nextShotTime=this.frequency,this.totalTime=0}update(e){if(!isNaN(e)){if(this.totalTime+=e,this.nextShotTime-=e,this.nextShotTime<=0){this.nextShotTime=Math.max(this.nextShotTime+this.frequency,1/240);let o=My(this.position,this.power,this.radius,this.density,this.color,this.worldId),n=new Ia(o,this.totalTime);this.activeBalls.push(n),ln(o,n)}for(let o=this.activeBalls.length-1;o>=0;--o){let n=this.activeBalls[o];this.totalTime-n.created>=this.life&&this.destroyBall(n)}}}destroyBall(e){let o=this.activeBalls.indexOf(e);return o!=-1?(cn(e.id),this.activeBalls.splice(o,1),!0):!1}},Rl=class{constructor(e,o,n,s,r=1,i){let c=we();c.type=et.b2_staticBody,c.position=e;let a=je(i,c),l=new oe;l.center=new B(0,0),l.radius=2*r;let d=ce();d.density=1,d.friction=.05,d.filter.maskBits=0,d.customColor=s,Pn(a,d,l);let p=we();p.type=et.b2_dynamicBody,p.position=e,p.fixedRotation=!1;let u=je(i,p),b=Go(12*r,.5*r),h=ce();h.density=5,h.friction=1,h.customColor=s,bo(u,h,b);let m=Ti();m.bodyIdA=u,m.bodyIdB=a,m.localAnchorA=new B(0,0),m.localAnchorB=new B(0,0),m.enableMotor=!0,m.motorSpeed=n,m.maxMotorTorque=o,an(i,m)}};var IB=0,SB=1,Dl=2;export{Ia as ActiveBall,oy as AddSpriteToWorld,wy as AttachImage,Wh as B2_ID_EQUALS,Nh as B2_IS_NON_NULL,Yh as B2_IS_NULL,I as B2_NULL_INDEX,uh as BodyToSprite,sy as ClearWorldSprites,vy as ConvertScreenToWorld,Jy as ConvertWorldToScreen,bh as CreateBoxPolygon,xa as CreateCapsule,uy as CreateChain,ph as CreateCircle,_y as CreateDebugDraw,yy as CreateDistanceJoint,Iy as CreateMotorJoint,Sy as CreateMouseJoint,py as CreateNGonPolygon,hy as CreatePhysicsEditorShape,Ml as CreatePolygon,by as CreatePolygonFromEarcut,hh as CreatePolygonFromVertices,xy as CreatePrismaticJoint,fa as CreateRevoluteJoint,my as CreateWeldJoint,fy as CreateWheelJoint,ly as CreateWorld,Dl as DYNAMIC,ry as GetBodyFromSprite,Zm as GetWorldScale,Gl as Gun,SB as KINEMATIC,By as RAF,Tl as Ragdoll,ny as RemoveSpriteFromWorld,Jl as RotFromRad,IB as STATIC,Qm as SetWorldScale,Pl as Skeletons,Rl as Spinner,ay as SpriteToBox,cy as SpriteToCircle,iy as UpdateWorldSprites,dy as WorldStep,xt as b2AABB,Ve as b2AABB_Center,Vo as b2AABB_Contains,Ds as b2AABB_Extents,Wl as b2AABB_IsValid,Vt as b2AABB_Union,Xr as b2Abs,xh as b2AbsFloat,gh as b2AbsInt,O as b2Add,Xs as b2BodyDef,Qn as b2BodyEvents,Ne as b2BodyId,et as b2BodyType,Ub as b2Body_ApplyAngularImpulse,Yb as b2Body_ApplyForce,ta as b2Body_ApplyForceToCenter,Wb as b2Body_ApplyLinearImpulse,Ob as b2Body_ApplyLinearImpulseToCenter,n2 as b2Body_ApplyMassFromShapes,Nb as b2Body_ApplyTorque,Gb as b2Body_ComputeAABB,f2 as b2Body_Disable,x2 as b2Body_Enable,B2 as b2Body_EnableHitEvents,y2 as b2Body_EnableSleep,a2 as b2Body_GetAngularDamping,Fb as b2Body_GetAngularVelocity,Pb as b2Body_GetContactCapacity,Tb as b2Body_GetContactData,l2 as b2Body_GetGravityScale,w2 as b2Body_GetJointCount,C2 as b2Body_GetJoints,r2 as b2Body_GetLinearDamping,Xb as b2Body_GetLinearVelocity,Zb as b2Body_GetLocalCenterOfMass,vr as b2Body_GetLocalPoint,Eb as b2Body_GetLocalVector,$b as b2Body_GetMass,o2 as b2Body_GetMassData,Rb as b2Body_GetPosition,Cr as b2Body_GetRotation,Qb as b2Body_GetRotationalInertia,A2 as b2Body_GetShapeCount,ea as b2Body_GetShapes,m2 as b2Body_GetSleepThreshold,Zi as b2Body_GetTransform,zb as b2Body_GetType,Hb as b2Body_GetUserData,t2 as b2Body_GetWorldCenterOfMass,Lb as b2Body_GetWorldPoint,jb as b2Body_GetWorldVector,d2 as b2Body_IsAwake,_2 as b2Body_IsBullet,p2 as b2Body_IsEnabled,S2 as b2Body_IsFixedRotation,b2 as b2Body_IsSleepEnabled,X2 as b2Body_IsValid,i2 as b2Body_SetAngularDamping,Vb as b2Body_SetAngularVelocity,u2 as b2Body_SetAwake,g2 as b2Body_SetBullet,I2 as b2Body_SetFixedRotation,c2 as b2Body_SetGravityScale,s2 as b2Body_SetLinearDamping,qb as b2Body_SetLinearVelocity,e2 as b2Body_SetMassData,h2 as b2Body_SetSleepThreshold,Jr as b2Body_SetTransform,Kb as b2Body_SetType,ln as b2Body_SetUserData,_e as b2Capsule,xe as b2CastOutput,qs as b2ChainDef,No as b2ChainId,ao as b2ChainSegment,q2 as b2Chain_IsValid,$d as b2Chain_SetFriction,Qd as b2Chain_SetRestitution,oe as b2Circle,Ah as b2Clamp,mt as b2ClampFloat,_h as b2ClampInt,Dr as b2CollideCapsuleAndCircle,kr as b2CollideCapsules,ua as b2CollideChainSegmentAndCapsule,da as b2CollideChainSegmentAndCircle,Pr as b2CollideChainSegmentAndPolygon,sa as b2CollideCircles,aa as b2CollidePolygonAndCapsule,ra as b2CollidePolygonAndCircle,As as b2CollidePolygons,ia as b2CollideSegmentAndCapsule,ca as b2CollideSegmentAndCircle,la as b2CollideSegmentAndPolygon,Ch as b2ComputeAngularVelocity,ss as b2ComputeCapsuleAABB,Qs as b2ComputeCapsuleMass,ns as b2ComputeCircleAABB,$s as b2ComputeCircleMass,Mn as b2ComputeHull,rs as b2ComputePolygonAABB,ni as b2ComputePolygonMass,Zs as b2ComputeSegmentAABB,Pa as b2ContactData,$n as b2ContactEvents,je as b2CreateBody,is as b2CreateCapsuleShape,yd as b2CreateChain,Pn as b2CreateCircleShape,Gi as b2CreateDistanceJoint,Ri as b2CreateMotorJoint,Li as b2CreateMouseJoint,bo as b2CreatePolygonShape,Ei as b2CreatePrismaticJoint,an as b2CreateRevoluteJoint,bd as b2CreateSegmentShape,Lh as b2CreateTimer,ji as b2CreateWeldJoint,Xi as b2CreateWheelJoint,ha as b2CreateWorld,ba as b2CreateWorldArray,z as b2Cross,Gt as b2CrossSV,hn as b2CrossVS,Ws as b2DebugDraw,we as b2DefaultBodyDef,ed as b2DefaultChainDef,pb as b2DefaultDistanceJointDef,Ur as b2DefaultFilter,bb as b2DefaultMotorJointDef,hb as b2DefaultMouseJointDef,mb as b2DefaultPrismaticJointDef,td as b2DefaultQueryFilter,Ti as b2DefaultRevoluteJointDef,ce as b2DefaultShapeDef,yb as b2DefaultWeldJointDef,fb as b2DefaultWheelJointDef,Or as b2DefaultWorldDef,cn as b2DestroyBody,fd as b2DestroyChain,qi as b2DestroyJoint,md as b2DestroyShape,P2 as b2DestroyWorld,vs as b2Distance,Ie as b2DistanceCache,ye as b2DistanceInput,gn as b2DistanceJointDef,Su as b2DistanceJoint_EnableLimit,Pu as b2DistanceJoint_EnableMotor,Cu as b2DistanceJoint_EnableSpring,wu as b2DistanceJoint_GetCurrentLength,Iu as b2DistanceJoint_GetLength,Au as b2DistanceJoint_GetMaxLength,ju as b2DistanceJoint_GetMaxMotorForce,Bu as b2DistanceJoint_GetMinLength,Lu as b2DistanceJoint_GetMotorForce,Ru as b2DistanceJoint_GetMotorSpeed,ku as b2DistanceJoint_GetSpringDampingRatio,Du as b2DistanceJoint_GetSpringHertz,gu as b2DistanceJoint_IsLimitEnabled,Tu as b2DistanceJoint_IsMotorEnabled,vu as b2DistanceJoint_IsSpringEnabled,xu as b2DistanceJoint_SetLength,_u as b2DistanceJoint_SetLengthRange,Eu as b2DistanceJoint_SetMaxMotorForce,Gu as b2DistanceJoint_SetMotorSpeed,Mu as b2DistanceJoint_SetSpringDampingRatio,Ju as b2DistanceJoint_SetSpringHertz,Ps as b2DistanceOutput,Re as b2DistanceProxy,me as b2DistanceSquared,F as b2Dot,Ln as b2DynamicTree,Bi as b2DynamicTree_Create,wi as b2DynamicTree_CreateProxy,Ai as b2DynamicTree_Destroy,Ci as b2DynamicTree_DestroyProxy,Rn as b2DynamicTree_EnlargeProxy,lu as b2DynamicTree_GetAreaRatio,hu as b2DynamicTree_GetByteCount,cu as b2DynamicTree_GetHeight,uu as b2DynamicTree_GetMaxBalance,au as b2DynamicTree_GetProxyCount,vi as b2DynamicTree_MoveProxy,Pe as b2DynamicTree_Query,br as b2DynamicTree_RayCast,hr as b2DynamicTree_Rebuild,pu as b2DynamicTree_RebuildBottomUp,us as b2DynamicTree_ShapeCast,bu as b2DynamicTree_ShiftOrigin,du as b2DynamicTree_Validate,Mo as b2Filter,Rh as b2GetByteCount,Ms as b2GetInverse22,so as b2GetLengthAndNormalize,Kl as b2GetLengthUnitsPerMeter,jh as b2GetMilliseconds,Xh as b2GetMillisecondsAndReset,De as b2GetSweepTransform,Eh as b2GetTicks,$l as b2GetVersion,V as b2HexColor,Un as b2Hull,wh as b2IntegrateRotation,Dh as b2InvMulRot,va as b2InvMulTransforms,ge as b2InvRotateVector,qe as b2InvTransformPoint,Sa as b2IsNormalized,le as b2IsValid,cd as b2IsValidRay,zt as b2JointId,T as b2JointType,Ib as b2Joint_GetBodyA,Sb as b2Joint_GetBodyB,Ab as b2Joint_GetCollideConnected,vb as b2Joint_GetConstraintForce,Jb as b2Joint_GetConstraintTorque,gb as b2Joint_GetLocalAnchorA,_b as b2Joint_GetLocalAnchorB,xb as b2Joint_GetType,Cb as b2Joint_GetUserData,V2 as b2Joint_IsValid,Bb as b2Joint_SetCollideConnected,wb as b2Joint_SetUserData,Pi as b2Joint_WakeBodies,pe as b2LeftPerp,Ut as b2Length,he as b2LengthSquared,Zt as b2Lerp,Go as b2MakeBox,oi as b2MakeOffsetBox,Hs as b2MakeOffsetPolygon,Dn as b2MakePolygon,vt as b2MakeProxy,wa as b2MakeRot,dd as b2MakeRoundedBox,ei as b2MakeSquare,Oo as b2Manifold,We as b2MassData,Ba as b2Max,fh as b2MaxFloat,Sh as b2MaxInt,_a as b2Min,yh as b2MinFloat,Ih as b2MinInt,_n as b2MotorJointDef,Yp as b2MotorJoint_GetAngularOffset,Kp as b2MotorJoint_GetCorrectionFactor,qp as b2MotorJoint_GetLinearOffset,Wp as b2MotorJoint_GetMaxForce,Up as b2MotorJoint_GetMaxTorque,Vp as b2MotorJoint_SetAngularOffset,zp as b2MotorJoint_SetCorrectionFactor,Fp as b2MotorJoint_SetLinearOffset,Np as b2MotorJoint_SetMaxForce,Op as b2MotorJoint_SetMaxTorque,Bn as b2MouseJointDef,nb as b2MouseJoint_GetMaxForce,eb as b2MouseJoint_GetSpringDampingRatio,Zp as b2MouseJoint_GetSpringHertz,$p as b2MouseJoint_GetTarget,ob as b2MouseJoint_SetMaxForce,tb as b2MouseJoint_SetSpringDampingRatio,Qp as b2MouseJoint_SetSpringHertz,Hp as b2MouseJoint_SetTarget,Bh as b2Mul,$ as b2MulAdd,Js as b2MulMV,ql as b2MulRot,it as b2MulSV,It as b2MulSub,kh as b2MulTransforms,Ca as b2NLerp,Qt as b2Neg,dt as b2Normalize,Th as b2NormalizeChecked,Fr as b2NormalizeRot,ri as b2PointInCapsule,si as b2PointInCircle,ii as b2PointInPolygon,Be as b2Polygon,An as b2PrismaticJointDef,Wu as b2PrismaticJoint_EnableLimit,Hu as b2PrismaticJoint_EnableMotor,Xu as b2PrismaticJoint_EnableSpring,Uu as b2PrismaticJoint_GetLowerLimit,op as b2PrismaticJoint_GetMaxMotorForce,tp as b2PrismaticJoint_GetMotorForce,Zu as b2PrismaticJoint_GetMotorSpeed,Nu as b2PrismaticJoint_GetSpringDampingRatio,Vu as b2PrismaticJoint_GetSpringHertz,zu as b2PrismaticJoint_GetUpperLimit,Ou as b2PrismaticJoint_IsLimitEnabled,$u as b2PrismaticJoint_IsMotorEnabled,Fu as b2PrismaticJoint_IsSpringEnabled,Ku as b2PrismaticJoint_SetLimits,ep as b2PrismaticJoint_SetMaxMotorForce,Qu as b2PrismaticJoint_SetMotorSpeed,Yu as b2PrismaticJoint_SetSpringDampingRatio,qu as b2PrismaticJoint_SetSpringHertz,Vs as b2QueryFilter,tr as b2RayCastCapsule,po as b2RayCastCircle,Wo as b2RayCastInput,er as b2RayCastPolygon,kn as b2RayCastSegment,Ys as b2RayResult,ae as b2RelativeAngle,Do as b2RevoluteJointDef,dp as b2RevoluteJoint_EnableLimit,mp as b2RevoluteJoint_EnableMotor,np as b2RevoluteJoint_EnableSpring,lp as b2RevoluteJoint_GetAngle,pp as b2RevoluteJoint_GetLowerLimit,gp as b2RevoluteJoint_GetMaxMotorTorque,xp as b2RevoluteJoint_GetMotorSpeed,Ip as b2RevoluteJoint_GetMotorTorque,cp as b2RevoluteJoint_GetSpringDampingRatio,ip as b2RevoluteJoint_GetSpringHertz,bp as b2RevoluteJoint_GetUpperLimit,up as b2RevoluteJoint_IsLimitEnabled,yp as b2RevoluteJoint_IsMotorEnabled,sp as b2RevoluteJoint_IsSpringEnabled,hp as b2RevoluteJoint_SetLimits,Sp as b2RevoluteJoint_SetMaxMotorTorque,fp as b2RevoluteJoint_SetMotorSpeed,ap as b2RevoluteJoint_SetSpringDampingRatio,rp as b2RevoluteJoint_SetSpringHertz,be as b2RightPerp,rt as b2Rot,vh as b2Rot_GetAngle,Jh as b2Rot_GetXAxis,Mh as b2Rot_GetYAxis,Ph as b2Rot_IsValid,K as b2RotateVector,io as b2Segment,Qr as b2SegmentDistance,ks as b2SegmentDistanceResult,Hn as b2SensorEvents,Gh as b2SetAllocator,Hl as b2SetAssertFcn,zl as b2SetLengthUnitsPerMeter,zo as b2ShapeCast,ci as b2ShapeCastCapsule,ai as b2ShapeCastCircle,fn as b2ShapeCastInput,wo as b2ShapeCastPairInput,li as b2ShapeCastPolygon,or as b2ShapeCastSegment,Fs as b2ShapeDef,Ce as b2ShapeDistance,_t as b2ShapeId,Y as b2ShapeType,Rd as b2Shape_AreContactEventsEnabled,Xd as b2Shape_AreHitEventsEnabled,Ed as b2Shape_ArePreSolveEventsEnabled,Td as b2Shape_AreSensorEventsEnabled,Gd as b2Shape_EnableContactEvents,jd as b2Shape_EnableHitEvents,Ld as b2Shape_EnablePreSolveEvents,Pd as b2Shape_EnableSensorEvents,eu as b2Shape_GetAABB,xd as b2Shape_GetBody,Nd as b2Shape_GetCapsule,Yd as b2Shape_GetChainSegment,qd as b2Shape_GetCircle,ou as b2Shape_GetClosestPoint,Zd as b2Shape_GetContactCapacity,tu as b2Shape_GetContactData,wd as b2Shape_GetDensity,Dd as b2Shape_GetFilter,vd as b2Shape_GetFriction,Hd as b2Shape_GetParentChain,Wd as b2Shape_GetPolygon,Md as b2Shape_GetRestitution,Vd as b2Shape_GetSegment,Fd as b2Shape_GetType,Sd as b2Shape_GetUserData,gd as b2Shape_IsSensor,F2 as b2Shape_IsValid,Bd as b2Shape_RayCast,Ud as b2Shape_SetCapsule,Od as b2Shape_SetCircle,Ad as b2Shape_SetDensity,kd as b2Shape_SetFilter,Cd as b2Shape_SetFriction,Kd as b2Shape_SetPolygon,Jd as b2Shape_SetRestitution,zd as b2Shape_SetSegment,Id as b2Shape_SetUserData,_d as b2Shape_TestPoint,zn as b2Simplex,Fh as b2SleepMilliseconds,mn as b2Solve22,J as b2Sub,Co as b2Sweep,Ts as b2TOIInput,Gs as b2TOIOutput,Us as b2TimeOfImpact,at as b2Transform,H as b2TransformPoint,ud as b2TransformPolygon,Fo as b2UnwindAngle,ti as b2ValidateHull,B as b2Vec2,qr as b2Vec2_IsValid,wn as b2WeldJointDef,ub as b2WeldJoint_GetAngularDampingRatio,lb as b2WeldJoint_GetAngularHertz,ab as b2WeldJoint_GetLinearDampingRatio,rb as b2WeldJoint_GetLinearHertz,db as b2WeldJoint_SetAngularDampingRatio,cb as b2WeldJoint_SetAngularHertz,ib as b2WeldJoint_SetLinearDampingRatio,sb as b2WeldJoint_SetLinearHertz,Cn as b2WheelJointDef,Jp as b2WheelJoint_EnableLimit,Tp as b2WheelJoint_EnableMotor,_p as b2WheelJoint_EnableSpring,Dp as b2WheelJoint_GetLowerLimit,Xp as b2WheelJoint_GetMaxMotorTorque,Lp as b2WheelJoint_GetMotorSpeed,Ep as b2WheelJoint_GetMotorTorque,vp as b2WheelJoint_GetSpringDampingRatio,wp as b2WheelJoint_GetSpringHertz,kp as b2WheelJoint_GetUpperLimit,Mp as b2WheelJoint_IsLimitEnabled,Gp as b2WheelJoint_IsMotorEnabled,Bp as b2WheelJoint_IsSpringEnabled,Pp as b2WheelJoint_SetLimits,jp as b2WheelJoint_SetMaxMotorTorque,Rp as b2WheelJoint_SetMotorSpeed,Cp as b2WheelJoint_SetSpringDampingRatio,Ap as b2WheelJoint_SetSpringHertz,js as b2WorldDef,Yo as b2WorldId,nh as b2World_CastCapsule,oh as b2World_CastCircle,sh as b2World_CastPolygon,th as b2World_CastRay,eh as b2World_CastRayClosest,G2 as b2World_Draw,$m as b2World_DumpMemoryStats,W2 as b2World_EnableContinuous,Y2 as b2World_EnableSleeping,N2 as b2World_EnableWarmStarting,lh as b2World_Explode,R2 as b2World_GetBodyEvents,E2 as b2World_GetContactEvents,Hm as b2World_GetCounters,ch as b2World_GetGravity,Km as b2World_GetProfile,L2 as b2World_GetSensorEvents,j2 as b2World_IsValid,K2 as b2World_OverlapAABB,$2 as b2World_OverlapCapsule,H2 as b2World_OverlapCircle,Q2 as b2World_OverlapPolygon,z2 as b2World_SetContactTuning,ih as b2World_SetCustomFilterCallback,ah as b2World_SetGravity,U2 as b2World_SetHitEventThreshold,rh as b2World_SetPreSolveCallback,O2 as b2World_SetRestitutionThreshold,ma as b2World_Step,qh as b2Yield,ty as mpx,ey as pxm,Er as pxmVec2};
